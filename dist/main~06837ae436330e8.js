(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{225:function(t,e,n){},584:function(t,e,n){},586:function(t,e,n){},589:function(t,e,n){},591:function(t,e,n){},592:function(t,e,n){},593:function(t,e,n){},594:function(t,e,n){},595:function(t,e,n){},596:function(t,e,n){},597:function(t,e){document.addEventListener("DOMContentLoaded",(function(){var t=Array.prototype.slice.call(document.querySelectorAll(".navbar-burger"),0);t.length>0&&t.forEach((function(t){t.addEventListener("click",(function(){var e=t.dataset.target,n=document.getElementById(e);t.classList.toggle("is-active"),n&&n.classList.toggle("is-active")}))}))}))},599:function(t,e,n){"use strict";n.r(e);n(225),n(226),n(581),n(582),n(583),n(584);var o=n(215),r=n.n(o),i=n(216),a=n.n(i),s=n(113),c=n(21),l=n(117),u=n(223),p=n(219),h=(n(586),n(33)),d=n(224),f=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},m=function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},g=function(){function t(t){this._storageKey="auth",this._storage=localStorage,this.connector=new h.default({baseUrl:t.baseUrl,auth:t.auth});var e=this._storage.getItem(this._storageKey);e&&(this.auth=JSON.parse(e))}return t.prototype.login=function(t){return f(this,void 0,void 0,(function(){var e,n;return m(this,(function(o){switch(o.label){case 0:return this._errorMessage="",t?[3,2]:[4,this.getAuth()];case 1:t=o.sent(),o.label=2;case 2:return o.trys.push([2,4,,7]),[4,this.connector.login(t)];case 3:if(o.sent(),!(e=this.connector.user))throw new Error;if("guest"===e.keyname)throw new Error;return[3,7];case 4:return o.sent(),this._errorMessage="Не удаётся войти",[4,this._showLoginDialog(t)];case 5:return n=o.sent(),[4,this.login(n)];case 6:return o.sent(),[3,7];case 7:return this.connector&&this._storage.setItem(this._storageKey,JSON.stringify(t)),[2]}}))}))},t.prototype.logout=function(){this.connector.logout(),this._storage.setItem(this._storageKey,""),this._errorMessage=""},t.prototype.getAuth=function(){return f(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,this._showLoginDialog(this.auth)];case 1:return[2,t.sent()]}}))}))},t.prototype._showLoginDialog=function(t){var e=this;return new Promise((function(n,o){var r=new d.a,i=e._createDialogHtml(t,(function(t){r.close(),n(t)}),(function(t){r.close(),o(t)}));r.updateContent(i),r.show()}))},t.prototype._createDialogHtml=function(t,e,n){void 0===t&&(t={login:"",password:""});var o=t.login,r=t.password,i=document.createElement("div");i.className="dialog--form login";var a='\n      <div><label><div>Имя пользователя:</div>\n        <input value="'+o+'" class="input dialog--input name"></input>\n      </label></div>\n      <div><label><div>Пароль:</div>\n        <input value="'+r+'" type="password" class="input dialog--input password"></input>\n      </label></div>\n      <div class="dialog-error"></div>\n      <button class="button dialog--button accept">Войти</button>\n      <button class="button dialog--button cancel">Отмена</button>\n    ';i.innerHTML=a;var s=i.getElementsByClassName("name")[0],c=i.getElementsByClassName("password")[0];if(this._errorMessage){var l=i.getElementsByClassName("dialog-error")[0];l.className="dialog-error",l.innerHTML='<div class="dialog-error--message">'+this._errorMessage+"</div>"}var u=i.getElementsByClassName("accept")[0],p=i.getElementsByClassName("cancel")[0],h=function(){return{login:s.value,password:c.value}},d=function(){var t=h();u.disabled=!(t.login&&t.password)},f=function(){d()},m=function(){[s,c].forEach((function(t){["change","input"].forEach((function(e){return t.removeEventListener(e,f)}))}))};return u.onclick=function(){m(),e(h())},p.onclick=function(){m(),n("Login cancel")},d(),[s,c].forEach((function(t){["change","input"].forEach((function(e){return t.addEventListener(e,f)}))})),i},t}(),v=n(221),y=n.n(v);function w(t){return"string"==typeof t&&(e=t,new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e))?'<a href="'+t+'" target="_blank">'+t+"</a>":t;var e}var _=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},b=function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},C=function(){function t(t){this.ngwMap=t,this._resourceItems={}}return t.prototype.setNgwMap=function(t){this.ngwMap=t},t.prototype.createPopupContent=function(t){var e=document.createElement("div"),n=document.createElement("div");n.className="properties";var o=Object.keys(t.properties).map((function(e){return{key:e,value:t.properties[e]}}));return n.innerHTML=this.createPropertiesHtml(o),e.appendChild(n),e},t.prototype.createPropertiesHtml=function(t){var e="";return t.forEach((function(t){var n=t.key,o=t.value;"object"==typeof o&&o&&("year"in o?o=[o.day,o.month,o.year].join("."):"hour"in o&&(o=[o.hour,o.minute].join(":"))),e+='\n      <div class="columns is-mobile">\n        <div class="column is-two-fifths">'+n+'</div>\n        <div class="column">'+w(o)+"</div>\n      </div>\n      "})),e},t.prototype.updateElementContent=function(t,e,n){return _(this,void 0,void 0,(function(){var o,r,i,a;return b(this,(function(s){switch(s.label){case 0:return[4,this._getResourceItem(e)];case 1:return(o=s.sent()).feature_layer&&(r=[],o.feature_layer.fields.forEach((function(t){if(t.grid_visibility){var e=n.properties[t.keyname];e&&r.push({key:t.display_name,value:e})}})),i=this.createPropertiesHtml(r),(a=t.getElementsByClassName("properties")[0])&&(a.innerHTML=i)),[2]}}))}))},t.prototype._addPhotos=function(t,e,n,o){return _(this,void 0,void 0,(function(){var r,i,a,s,c,l,u;return b(this,(function(p){switch(p.label){case 0:(r=document.createElement("div")).className="carousel attachment",i=0,a=e,p.label=1;case 1:return i<a.length?(s=a[i],300,300,(c=document.createElement("figure")).className="image is-300x300",[4,this._loadImage(s,{width:300,height:300,id:n,fid:o})]):[3,4];case 2:l=p.sent(),(u=document.createElement("img")).src=l,c.appendChild(u),r.appendChild(c),p.label=3;case 3:return i++,[3,1];case 4:return t.appendChild(r),y.a.attach(r),[2]}}))}))},t.prototype._getResourceItem=function(t){return _(this,void 0,void 0,(function(){var e;return b(this,(function(n){switch(n.label){case 0:return this._resourceItems[t]?[3,2]:[4,this.ngwMap.connector.get("resource.item",null,{id:t})];case 1:e=n.sent(),this._resourceItems[t]=e,n.label=2;case 2:return[2,this._resourceItems[t]]}}))}))},t.prototype._loadImage=function(t,e){var n=this;return new Promise((function(o,r){var i=e.width,a=e.height,s="/api/resource/"+e.id+"/feature/"+e.fid+"/attachment/"+t.id+"/image"+(i&&a?"?size="+i+"x"+a:"");n.ngwMap.connector.makeQuery(s,{},{responseType:"blob"}).then((function(t){var e=new FileReader;e.readAsDataURL(t),e.onloadend=function(){o(e.result)}})).catch((function(t){r(t)}))}))},t}(),M=(n(589),n(222)),k=n.n(M),E=(n(590),n(591),function(){function t(t){this.options=t,this._container=document.createElement("div"),this.status=void 0===this.options.open||this.options.open,this._updateContainer(),this.options.parent&&this.options.parent.appendChild(this.getContainer())}return t.prototype.getContainer=function(){return this._container},t.prototype.open=function(){this._content.innerHTML||this._updateContent(),this._toggle&&(this._toggle.innerHTML=this._getToggleButtonHtml("fas fa-chevron-up")),this.status=!0},t.prototype.close=function(){this._cleanContent(),this._toggle&&(this._toggle.innerHTML=this._getToggleButtonHtml("fas fa-chevron-down")),this.status=!1},t.prototype.toggle=function(){this.status?this.close():this.open()},t.prototype._getToggleButtonHtml=function(t){return'\n    <a class="button is-small">\n    <span class="icon is-small">\n      <i class="'+t+'"></i>\n    </span>\n    </a>\n    '},t.prototype._updateContainer=function(){if(this._container.innerHTML="",this.options.title){var t=this._createHeader();this._container.appendChild(t)}var e=document.createElement("div");e.className="panel-content",this._content=e,this._container.appendChild(e),this.status?this.open():this.close()},t.prototype._createHeader=function(){var t=this,e=document.createElement("div");e.className="level is-mobile panel-header";var n=document.createElement("div");n.className="level-left";var o=document.createElement("div");o.className="level-item panel-header__title",o.innerHTML=this.options.title,n.appendChild(o);var r=document.createElement("div");r.className="level-right";var i=document.createElement("div");return i.className="level-item panel-header__toggle",r.appendChild(i),i.onclick=function(){t.toggle()},this._toggle=i,e.appendChild(n),e.appendChild(r),e},t.prototype._cleanContent=function(){this._content.innerHTML=""},t.prototype._updateContent=function(){this._cleanContent();var t="function"==typeof this.options.content?this.options.content():this.options.content;return this._content.appendChild(t),this._content},t}()),L=n(23),T=function(){function t(t){var e=this._createTreeItem(t);e&&(this._container=e)}return t.prototype.getContainer=function(){return this._container},t.prototype._createTreeBranch=function(t){var e=this,n=document.createElement("div");return n.className="tree-container__item-children",t.reverse().forEach((function(t){if(t.item){var o=e._createTreeItem(t);o&&n.appendChild(o)}})),n},t.prototype._createTreeItem=function(t){var e=t.item;if(!e)return!1;var n=document.createElement("div");if(n.className="tree-container__item",e.display_name){var o=document.createElement("input");o.setAttribute("type","checkbox");var r="layer"!==e.item_type||e.layer_enabled;o.checked=r;var i=t.properties.property("visibility");i&&(i.emitter.on("change",(function(t){o.checked=t.value})),o.onclick=function(){i.set(o.checked,{propagation:L.default.keys.pressed("ctrl")})});var a=document.createElement("span");a.innerHTML=e.display_name,n.appendChild(o),n.appendChild(a)}if("group"===e.item_type||"root"===e.item_type&&e.children.length){var s=t.tree.getChildren(),c=this._createTreeBranch(s.reverse());n.appendChild(c)}return n},t}(),N=(n(592),function(){function t(t){this.options=t,this._select=[["24","24 часа"],["48","48 часов"],["72","72 часа"],["168","неделя"]],this.ngwMap=t.ngwMap,this._container=this._createContainer()}return t.prototype.getContainer=function(){return this._container},t.prototype._createContainer=function(){var t=this,e=document.createElement("div");e.className="fires-contentainer panel-content-padding ";var n=this._createSelector();e.appendChild(n);var o=document.createElement("div");return o.className="fires-contentainer__layers",this.options.fires.forEach((function(e){t._createFireItem(e,o)})),e.appendChild(o),e},t.prototype._createFireItem=function(t,e){var n=this,o=document.createElement("div");o.className="tree-container__item";var r=this.ngwMap.getLayer(t.id).item,i=document.createElement("input");i.setAttribute("type","checkbox"),i.checked=!0,i.onclick=function(){n.ngwMap.toggleLayer(t.id,i.checked)};var a=document.createElement("span"),s=r.resource.display_name.split("__")[0];a.innerHTML=s.replace("fires","").trim();var c=this._createSymbol(t);o.appendChild(i),o.appendChild(c),o.appendChild(a),e.appendChild(o)},t.prototype._createSymbol=function(t){var e=document.createElement("span");return e.className="item-symbol",e.style.color=t.color,e.style.borderColor=t.color,e.style.backgroundColor=t.color,e},t.prototype._createSelector=function(){var t=this,e=document.createElement("div"),n=document.createElement("label");n.appendChild(document.createTextNode("Просмотр термоточек: "));var o=document.createElement("select");return this._select.forEach((function(t){var e=document.createElement("option");e.value=t[0],e.text=t[1],o.appendChild(e)})),o.onchange=function(){t.options.fires.forEach((function(e){t.ngwMap.getLayer(e.id).propertiesFilter([["timestamp","ge",Math.floor(Date.now()/1e3)-3600*Number(o.value)]])}))},n.appendChild(o),e.appendChild(n),e},t}()),B=(n(593),function(){function t(t){var e=this;this.options=t,this.ngwMap=t.ngwMap,this._container=this._createContainer(),this.ngwMap.emitter.on("layer:add",(function(t){e.ngwMap.isBaseLayer(t)&&e._updateBaseMapContainer()}))}return t.prototype.getContainer=function(){return this._container},t.prototype._createContainer=function(){var t=document.createElement("div");t.className="basemaps-contentainer panel-content-padding control";var e=document.createElement("div");return e.className="basemaps-contentainer__layers",this._baseMapsContainer=e,t.appendChild(e),this._updateBaseMapContainer(),t},t.prototype._updateBaseMapContainer=function(){var t=this;this._baseMapsContainer.innerHTML="",this._createBaseMapItem(),this.ngwMap.getBaseLayers().forEach((function(e){var n=t.ngwMap.getLayer(e);n&&t._createBaseMapItem(n)}))},t.prototype._createBaseMapItem=function(t){var e=this,n=document.createElement("div");n.className="control";var o=document.createElement("label");o.className="radio basemap-container__item";var r=document.createElement("input");r.setAttribute("type","radio"),r.setAttribute("name","basemap"),r.checked=this.ngwMap.isLayerVisible(t),r.onclick=function(){t?e.ngwMap.toggleLayer(t.id,r.checked):e.ngwMap.hideLayer(e.ngwMap.getActiveBaseLayer())};var i=t&&(t.name||t.options.name)||"Blank",a=document.createTextNode(i);o.appendChild(r),o.appendChild(a),n.appendChild(o),this._baseMapsContainer.appendChild(n)},t}()),x=(n(594),n(7)),I=function(){function t(t){this.options=t,this.ngwMap=t.ngwMap,this._container=this._createContainer()}return t.prototype.getContainer=function(){return this._container},t.prototype._createContainer=function(){var t=this,e=document.createElement("div");e.className="bookmarks-contentainer panel-content-padding ";var n=document.createElement("div");return n.className="bookmarks-contentainer__layers",this.options.bookmarks.forEach((function(n){t.ngwMap.connector.get("resource.item",null,{id:n.id}).then((function(o){var r=o.feature_layer.fields.find((function(t){return t.label_field}));t.ngwMap.getNgwLayerItems({resourceId:n.id}).then((function(n){n.forEach((function(n){var o=t._createBookmarkItem(n,r.keyname);e.appendChild(o)}))}))}))})),e.appendChild(n),e},t.prototype._createBookmarkItem=function(t,e){var n=this;void 0===e&&(e="name");var o=document.createElement("div");o.className="tree-container__item bookmark";var r=document.createElement("div");return r.innerHTML=t.fields[e],r.onclick=function(){var e=new x.GeoJSON(t.geom);n.ngwMap.mapAdapter.map.fitBounds(e.getBounds())},o.appendChild(r),o},t}(),O=function(){return(O=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},P={target:"tree"},H=function(){function t(t,e){if(this.actionMap=t,this.options=O(O({},P),e),"string"==typeof this.options.target){var n=document.getElementById(this.options.target);if(!n)throw new Error("No element with ID #"+this.options.target+" in document for webmap tree");this._target=n}else this.options.target instanceof HTMLElement&&(this._target=this.options.target);this.sidebar=new k.a(this._target,{closeButton:!1,position:"left",autoPan:!1}),this.sidebar.addTo(this.actionMap.ngwMap.mapAdapter.map),this.ngwLayers=this.options.ngwLayers,this._container=this._createContainer(),this.options.status||this.hide(),this._target.appendChild(this._container)}return t.prototype.show=function(){this._container.classList.remove("hidden"),this.sidebar.show()},t.prototype.hide=function(){this.sidebar.hide(),this._container.classList.add("hidden")},t.prototype._createContainer=function(){var t=this,e=document.createElement("div");return e.className="tree-container",void 0!==this.options.width&&(e.style.width=this.options.width+"px"),this.options.fires&&new E({title:"Термоточки (FIRMS)",content:function(){return t._createFiresContainer()},parent:e}),new E({title:"Базовые слои",content:function(){return t._createNgwLayers()},open:!1,parent:e}),new E({title:"Подложки",content:function(){return t._createBasemapsContainer()},open:!1,parent:e}),new E({title:"Закладки",content:function(){return t._createBookmarksContainer()},open:!1,parent:e}),e},t.prototype._createNgwLayers=function(){var t=document.createElement("div");for(var e in t.className="webmap-tree-container",this.ngwLayers){var n=this.ngwLayers[e],o=new T(n.layer.layer).getContainer();o&&t.appendChild(o)}return t},t.prototype._createBookmarksContainer=function(){var t=document.createElement("div"),e=this.options.bookmarks;if(e){var n=new I({bookmarks:e,ngwMap:this.options.ngwMap});t.appendChild(n.getContainer())}return t},t.prototype._createFiresContainer=function(){var t=document.createElement("div"),e=this.options.fires;if(e){var n=new N({fires:e,ngwMap:this.options.ngwMap});t.appendChild(n.getContainer())}return t},t.prototype._createBasemapsContainer=function(){var t=document.createElement("div");if(this.options.fires){var e=new B({ngwMap:this.options.ngwMap});t.appendChild(e.getContainer())}return t},t}(),S=(n(595),n(596),n(29)),F=n(32),j=function(){function t(t,e){var n=this;this.actionMap=t,this.html='<i class="fas fa-map-pin btn-control-icon "></i>',this.title={off:"Полученить координаты с карты",on:"Выключить режим получения координат с карты"},this.addClass="toggle-control webmap-tree-control",this.addClassOn="active",this.status=!1,this.emitter=new F.EventEmitter,this._toggle=e.toggle,this.actionMap.ngwMap.addLayer("GEOJSON",{id:"show-coordinate-click",visibility:!0,paint:{radius:6},popup:!0,popupOptions:{createPopupContent:function(t){return n._createPopupContent(t.feature.geometry.coordinates.map((function(t){return t.toFixed(5)})))}}}).then((function(t){t&&(n._layer=t)}))}return t.prototype.onClick=function(t){this.toggleControl(t)},t.prototype.show=function(){var t=this;this.actionMap.ngwMap.setCursor("crosshair"),this._removeClickListener(),this.__onMapClick=function(e){return t._onMapClick(e)},this.actionMap.ngwMap.emitter.on("click",this.__onMapClick)},t.prototype.hide=function(){this.actionMap.ngwMap.setCursor("default"),this._removeClickListener(),this.actionMap.ngwMap.clearLayerData(this._layer)},t.prototype._removeClickListener=function(){this.__onMapClick&&(this.actionMap.ngwMap.emitter.off("click",this.__onMapClick),this.__onMapClick=null)},t.prototype._onMapClick=function(t){var e={type:"Feature",properties:{},geometry:{type:"Point",coordinates:[t.latLng.lng,t.latLng.lat]}};this.actionMap.ngwMap.setLayerData(this._layer,e)},t.prototype.toggleControl=function(t){(t=void 0!==t?t:!this.status)?this.show():this.hide(),this.status=t,this._toggle&&this._toggle(t),this.emitter.emit("status",this.status)},t.prototype._createPopupContent=function(t){var e=t[0],n=t[1],o=document.createElement("div"),r=n+", "+e;return o.innerHTML='\n    <span>Широта/Долгота:</span>\n    <span class="lat-lng-coord"> '+r+'</span>\n    <a href="#" class="copy-to-clipboard">\n    <i class="far fa-clipboard"></i>\n    </a>',o.getElementsByClassName("copy-to-clipboard")[0].onclick=function(){S.a.copy(r)},o},t}(),A=function(){return(A=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},D=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},G=function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},R=function(){function t(t){this.options=t,this._promises={},this._stopToggleControlsCb=[],this.popup=new C(this.ngwMap)}return t.prototype.create=function(t,e,n){return D(this,void 0,void 0,(function(){var o,r,i,a,c=this;return G(this,(function(h){switch(h.label){case 0:o=new g(t),r=A({},t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,o.login()];case 2:return h.sent(),r.connector=o.connector,[3,4];case 3:return h.sent(),[3,4];case 4:return this.ngwMap=new s.default(new u.a,A({controls:[],minZoom:4,runtimeParams:[new p.default]},r)),this.ngwMap.setCursor("default"),this.popup.setNgwMap(this.ngwMap),n&&this.ngwMap.onLoad().then((function(){return n.forEach((function(t,e){c.ngwMap.addBaseLayer("QMS",A(A({},t),{visibility:0===e}))}))})),this.ngwMap.getPaintFunctions={base:l.a},this.ngwMap.addControl("ZOOM","top-left"),this._createLocateControl(),this.ngwMap.addControl("ATTRIBUTION","bottom-right"),this._createShareControl(),[4,this._createAuthControl(o)];case 5:return h.sent(),[4,this.ngwMap.getNgwLayers()];case 6:return i=h.sent(),a=[],Object.values(i).forEach((function(t){var e=t.layer.item&&t.layer.item.webmap&&t.layer.item.webmap.bookmark_resource;e&&a.push(e)})),[4,this._addFires(e)];case 7:return h.sent(),this._createGetCoordinateControl(),this._addTreeControl({ngwLayers:i,fires:e,bookmarks:a}),this.ngwMap.addControl(this._crateMeasureControl(),"top-left"),this._addEventsListeners(),[2]}}))}))},t.prototype._locate=function(){var t=this;this.ngwMap.locate({setView:!1},{locationfound:function(e){var n=e.lngLat;t.ngwMap.setCenter(n)}})},t.prototype._createAuthControl=function(t){return D(this,void 0,void 0,(function(){var e,n,o,r=this;return G(this,(function(i){return e=document.getElementsByClassName("js-auth-btn")[0],n=function(){return!(!r.ngwMap.connector||!r.ngwMap.connector.user)},o=function(){t.logout(),window.location.reload()},e.innerHTML=n()?"Выйти":"Войти",e.style.display="block",e.addEventListener("click",o),[2]}))}))},t.prototype._createShareControl=function(){var t=this,e=document.getElementsByClassName("js-modal")[0],n=document.getElementsByClassName("js-modal-close")[0],o=document.getElementsByClassName("js-share-modal-content")[0],i=document.getElementsByClassName("js-share-input")[0];n.addEventListener("click",(function(){o.innerHTML="",e.classList.remove("is-active")}));var a=this.ngwMap.createButtonControl({html:'<i class="fas fa-share-alt btn-control-icon "></i>',onClick:function(){var n,a;n=location.href,a=t._createShareModalContent(n),i.value=n,o.innerHTML=a,r.a.update(),e.classList.add("is-active")}});this.ngwMap.addControl(a,"bottom-right")},t.prototype._createGetCoordinateControl=function(){return D(this,void 0,void 0,(function(){var t,e,n=this;return G(this,(function(o){switch(o.label){case 0:return t=new j(this,{toggle:function(t){t?(n._stopToggleControlsFor("coordinate"),n.ngwMap.disableSelection()):n.ngwMap.enableSelection()}}),[4,this.ngwMap.createToggleControl(t)];case 1:return e=o.sent(),this.ngwMap.addControl(e,"top-left"),this._stopToggleControlsCb.push({name:"coordinate",stop:function(){return e.onClick(!1)}}),[2]}}))}))},t.prototype._createLocateControl=function(){var t=this,e=this.ngwMap.createButtonControl({html:'<i class="fas fa-location-arrow btn-control-icon"></i>',title:"Найти меня на карте",onClick:function(){return t._locate()}});this.ngwMap.addControl(e,"top-left")},t.prototype._createShareModalContent=function(t){return'<div class="buttons share-btn js-share-btn" data-url="'+t+'" data-title="" data-desc="">\n      '+[{id:"tw",name:"Twitter",icon:"fab fa-twitter"},{id:"vk",name:"VK",icon:"fab fa-vk"},{id:"fb",name:"Facebook",icon:"fab fa-facebook-square"}].map((function(t){return'<a class="button is-primary" data-id="'+t.id+'">\n                    <span class="icon">\n                        <i class="'+t.icon+'"></i>\n                    </span>\n                    <span>'+t.name+"</span>\n                </a>"})).join("")+"\n    </div>"},t.prototype._addFires=function(t){return D(this,void 0,void 0,(function(){var e,n,o,r=this;return G(this,(function(i){switch(i.label){case 0:if(!t)return[3,4];e=0,n=t,i.label=1;case 1:return e<n.length?(o=n[e],[4,this.ngwMap.addNgwLayer({resourceId:o.resourceId,id:o.id,adapterOptions:{propertiesFilter:[["timestamp","ge",Math.floor(Date.now()/1e3)-3600*Number(this.options.timedelta)]],paint:{stroke:!0,color:o.color,fillOpacity:.6,radius:5},selectable:!0,selectedPaint:{stroke:!0,color:o.color,fillOpacity:.9,radius:7},selectOnHover:!0,popupOnSelect:!0,popupOptions:{createPopupContent:function(t){if(t.feature){var e=t.feature;return r.popup.createPopupContent(e)}}}}})]):[3,4];case 2:i.sent(),i.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))},t.prototype._addTreeControl=function(t){return D(this,void 0,void 0,(function(){var e,n,o,r,i,a=this;return G(this,(function(s){switch(s.label){case 0:return e=document.getElementsByClassName("js-sidebar")[0],n=function(){return e.classList.contains("is-active")},o=function(){return e.classList.add("is-active")},r=function(){return e.classList.remove("is-active")},[4,this.ngwMap.onLoad()];case 1:return s.sent(),this.tree=new H(this,A(A({},t),{ngwMap:this.ngwMap})),i=function(t){(t=void 0!==t?t:n())?(a._stopToggleControlsFor("tree"),a.tree.show(),o()):(a.tree.hide(),r())},e.addEventListener("click",(function(){i()})),setTimeout((function(){i()}),500),this._stopToggleControlsCb.push({name:"tree",stop:function(){return i(!1)}}),[2]}}))}))},t.prototype._clean=function(){this._promises.getFeaturePromise&&this._promises.getFeaturePromise.cancel&&this._promises.getFeaturePromise.cancel(),this.ngwMap.removeLayer("highlight")},t.prototype._highlighNgwLayer=function(t){var e=this;this._clean();var n=c.default.utils.getIdentifyGeoJsonParams(t)[0];if(n){var o=n.resourceId;this._promises.getFeaturePromise=this.ngwMap.connector.get("feature_layer.feature.item",null,{id:n.resourceId,fid:n.featureId,geom_format:"geojson",srs:4326}).then((function(t){delete e._promises.getFeaturePromise;var r=c.default.utils.createGeoJsonFeature(t);e.ngwMap.addLayer("GEOJSON",{id:"highlight",data:r,visibility:!0,paint:{color:"green",stroke:!0,fillOpacity:"0.8"},selectOnHover:!0,popup:!0,popupOptions:{createPopupContent:function(r){if(r.feature){var i=e.popup.createPopupContent(r.feature);return e.popup.updateElementContent(i,o,r.feature),t.extensions&&t.extensions.attachment&&t.extensions.attachment.length&&e.popup._addPhotos(i,t.extensions.attachment,n.resourceId,n.featureId),i}}}})}))}},t.prototype._stopToggleControlsFor=function(t){this._stopToggleControlsCb.forEach((function(e){e.name!==t&&e.stop()}))},t.prototype._addEventsListeners=function(){var t=this;this.ngwMap.emitter.on("ngw:select",(function(e){return t._highlighNgwLayer(e)}))},t.prototype._crateMeasureControl=function(){var t=this,e=new a.a({showBearings:!0,bearingTextIn:"In",bearingTextOut:"Out",tooltipTextFinish:"Кликните чтобы <b>завершить изменрение</b><br>",tooltipTextDelete:"SHIFT + клик чтобы <b>удалить точку</b>",tooltipTextMove:"Клик + тянуть чтобы <b>передвинуть точку</b><br>",tooltipTextResume:"<br>CTRL + клик чтобы <b>продолжить линию</b>",tooltipTextAdd:"CTRL + клик чтобы <b>добавить точку</b>",measureControlTitleOn:"Перейти в режим измерения",measureControlTitleOff:"Выйти из режима измерений",measureControlLabel:'<i class="fas fa-ruler-combined btn-control-icon"></i>',measureControlClasses:[],unitControlLabel:{metres:"м",kilometres:"км"}});return this.ngwMap.mapAdapter.map.on("polylinemeasure:toggle",(function(e){e.sttus?(t._stopToggleControlsFor("measure"),t.ngwMap.disableSelection()):(t.ngwMap.setCursor("default"),t.ngwMap.enableSelection())})),this._stopToggleControlsCb.push({name:"measure",stop:function(){e._measuring&&e._toggleMeasure()}}),e},t}(),J=(n(597),function(){return(J=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)}),z=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},K=function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},U=function(){function t(t){this.options=t,this.actionMap=new R(this.options)}return t.prototype.create=function(t){return z(this,void 0,void 0,(function(){return K(this,(function(e){return this.options=J(J({},this.options),t),this.actionMap.create(this.options.mapOptions,this.options.fires,this.options.basemaps),[2]}))}))},t}(),V={};try{V=n(598)}catch(t){console.warn("Config file is not funded, run with default settings")}new U(s.default.utils.deepmerge({mapOptions:{target:"map",bounds:[36.59,43.385,49.374,50.214]},timedelta:24},V)).create()}},[[600,3,4,7,8,5,9,6,2,1]]]);