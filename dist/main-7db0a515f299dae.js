(self.webpackChunkclear_horizon=self.webpackChunkclear_horizon||[]).push([[367],{57836:function(e,t,r){"use strict";r.d(t,{lO:function(){return me},Zj:function(){return ve},D1:function(){return _e},K1:function(){return Oe},Cg:function(){return h},UJ:function(){return x},vS:function(){return f},nm:function(){return L},U2:function(){return E},GW:function(){return xe},RP:function(){return ge},PA:function(){return Le}});var n=r(56018),o=r(40203),i=r(17187),a=r(97060),s=["fields","intersects","limit","orderBy","strategy"];function c(e){var t={};return s.forEach((function(r){var n=e[r];void 0!==n&&(t[r]=n)})),t}function u(e,t){return r=this,n=void 0,i=function(){var r,n,o,i,a;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(s){switch(s.label){case 0:return r=e.resource,n=r,o=e.keyname,i=e.resourceId,r?"string"!=typeof r?[3,1]:(o=r,[3,5]):[3,5];case 1:return"number"!=typeof r?[3,2]:(i=r,[3,5]);case 2:return n.resource&&void 0!==n.resource&&"resmeta"in n?(i=r.resource.id,[3,5]):[3,3];case 3:return[4,u(r,t)];case 4:i=s.sent(),s.label=5;case 5:return i||!o?[3,7]:[4,t.getResource(o)];case 6:(a=s.sent())&&(i=a.resource.id),s.label=7;case 7:return[2,i]}}))},new((o=void 0)||(o=Promise))((function(e,t){function a(e){try{c(i.next(e))}catch(e){t(e)}}function s(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(e){e(r)}))).then(a,s)}c((i=i.apply(r,n||[])).next())}));var r,n,o,i}var l=r(43590),p=function(){return(p=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function f(e){var t=p({},v);return m(t,e),e.connector.get("feature_layer.feature.item",null,p({id:e.resourceId,fid:e.featureId},t)).then((function(t){return p(p({},t),{toGeojson:function(){return t.geom?l.Z.resolve(b(t)):f(p(p({},e),{geom:!0,fields:null,extensions:null})).then((function(e){var r=e.geom;return b(p(p({},t),{geom:r}))}))}})}))}function h(e){return f(e).then((function(e){return b(e)}))}var y=function(){return(y=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},d=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},v={srs:4326,geom_format:"geojson"};function b(e){var t=e.geom;return{id:e.id,type:"Feature",properties:e.fields,geometry:t}}function m(e,t){var r=t.extensions,n=t.geom,i=t.fields,a=t.srs;e.extensions=r?r.join(","):"",void 0!==i&&(e.fields=Array.isArray(i)?i.join(","):""),void 0!==n&&(e.geom=n?"yes":"no"),(0,o.ri)(a)&&(e.srs=a)}function w(e){var t=e.filterById[2],r="number"==typeof t?[t]:t.split(",").map((function(e){return Number(e)}));if("eq"!==e.filterById[1]&&"in"!==e.filterById[1])throw new Error("Unable to filter by object id. Except `eq` or `in` operator");var n=r.map((function(t){return f({connector:e.connector,resourceId:e.resourceId,featureId:t})}));return l.Z.all(n)}function g(e,t,r){void 0===t&&(t=[]),void 0===r&&(r=[]);var n=e.filters,o=e.connector,i=e.resourceId,s="string"==typeof n[0]?n[0]:"all",c=n.filter((function(e){return Array.isArray(e)})),u=function(e){return["fld_"+e[0]+"__"+e[1],e[2]]};if("any"===s)c.forEach((function(n){"id"===n[0]&&t.push(w({filterById:n,connector:o,resourceId:i})),(0,a.a$)(n)?t.push(_(y(y({},e),{paramList:d(r,[u(n)])}))):g(y(y({},e),{filters:n}),t,d(r))}));else if("all"===s){var p=c.find((function(e){return"id"===e[0]}));if(p)t.push(w({filterById:p,connector:o,resourceId:i}));else{var f=[],h=[];c.forEach((function(e){(0,a.a$)(e)?f.push(u(e)):h.push(e)})),h.length?h.forEach((function(n){g(y(y({},e),{filters:n}),t,d(r,f))})):t.push(_(y(y({},e),{paramList:d(r,f)})))}}return l.Z.all(t).then((function(t){var r=t.reduce((function(e,t){return e.concat(t)}),[]),n=void 0!==e.offset?e.offset:0,o=void 0!==e.limit?e.limit:r.length;return e.offset||e.limit?r.splice(n,o):r}))}function _(e){var t=y({},v),r=e.connector,n=e.limit,o=e.offset,i=e.intersects,a=e.orderBy,s=e.resourceId,c=e.paramList;return n&&(t.limit=n),o&&(t.offset=o),m(t,e),a&&(t.order_by=a.join(",")),i&&(t.intersects=i),c&&(t.paramList=c),r.get("feature_layer.feature.collection",null,y({id:s},t))}var O=function(){return(O=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function L(e){var t=e.filters;return t?g(O(O({},e),{filters:t})):_(e).then((function(e){return t?e.filter((function(e){var r=e.fields;r&&(0,a.Ml)(r,t)})):e}))}function x(e){return function(e){return L(e).then((function(e){var t=[];return e.forEach((function(e){t.push(b(e))})),t}))}(e).then((function(e){return{type:"FeatureCollection",features:e}}))}function I(e){var t=e.extent_bottom,r=e.extent_left,n=e.extent_top,o=e.extent_right;if(t&&r&&n&&o){var i=[r,t,o,n];return i[3]>82&&(i[3]=82),i[1]<-82&&(i[1]=-82),i}}function M(e,t){return t.get("layer.extent",null,{id:e}).then((function(e){if(e){var t=e.extent,r=t.maxLat,n=t.maxLon,o=t.minLat;return[t.minLon,o,n,r]}}))}function E(e,t){return r=this,n=void 0,i=function(){var r;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(n){return e.webmap?[2,I(e.webmap)]:(r=e.resource).cls&&-1!==r.cls.indexOf("style")?[2,t.getResource(r.parent.id).then((function(e){if(e)return M(e.resource.id,t)}))]:[2,M(r.id,t)]}))},new((o=void 0)||(o=Promise))((function(e,t){function a(e){try{c(i.next(e))}catch(e){t(e)}}function s(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(e){e(r)}))).then(a,s)}c((i=i.apply(r,n||[])).next())}));var r,n,o,i}var P,k=(P=function(e,t){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}P(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),N=function(){return(N=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},j=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},S=function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function A(e){return j(this,void 0,void 0,(function(){var t,r,n,s,l,p,f,h,y,d,v,b,m,w=this;return S(this,(function(g){switch(g.label){case 0:return t=e.webMap,r=e.connector,n=e.item,s=void 0===e.addLayerOptionsPriority||e.addLayerOptionsPriority,l=e.layerOptions,p=e.Adapter||t.mapAdapter.layerAdapters.GEOJSON,h=!1,[4,u(l,r)];case 1:return d=g.sent(),l.adapterOptions&&l.adapterOptions.popupOptions&&l.adapterOptions.popupOptions.fromProperties&&(l.adapterOptions.popupOptions.createPopupContent=function(e){var t=e.feature;return t&&function(e,t){var r=document.createElement("div");if(t&&t.feature_layer)t.feature_layer.fields.forEach((function(t){if(t.grid_visibility){var n=e.properties&&e.properties[t.keyname];if(n){var o=document.createElement("div");r.appendChild(o),o.innerHTML="<span>"+t.display_name+"</span>: "+n+"<span></span>"}}}));else if(e.properties)for(var n in e.properties){var o=document.createElement("div");r.appendChild(o),o.innerHTML="<span>"+n+"</span>: "+e.properties[n]+"<span></span>"}return r}(t,n)}),v=function(e,t){return j(w,void 0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return m(),y={filters:e,options:t},[4,f=x(N(N({resourceId:d,filters:e,connector:r},t),{limit:void 0!==(null==t?void 0:t.limit)?t.limit:3e3}))];case 1:return[2,n.sent()]}}))}))},b=!1,m=function(){f&&(f.cancel(),f=void 0)},[2,function(e){function u(){var t=null!==e&&e.apply(this,arguments)||this;return t.emitter=new i.EventEmitter,t}return k(u,e),u.prototype.addLayer=function(t){return j(this,void 0,void 0,(function(){var r,o,i,a;return S(this,(function(u){switch(u.label){case 0:return r=!t.data,o=void 0===t.waitFullLoad||t.waitFullLoad,void 0!==l.id&&(t.id=l.id),n&&n.vector_layer&&(t.type=de[n.vector_layer.geometry_type]),l.adapterOptions&&(t=s?N(N({},l.adapterOptions),t):N(N({},t),l.adapterOptions)),t.data&&0===Object.keys(t.data).length&&(t.data=void 0,r=!1),i=e.prototype.addLayer.call(this,t),this.options.strategy=t.strategy||void 0,y={filters:t.propertiesFilter,options:c(t)},r&&(a=this.updateLayer()),o&&a?[4,a]:[3,2];case 1:u.sent(),u.label=2;case 2:return"BBOX"===this.options.strategy&&this._addBboxEventListener(),[2,i]}}))}))},u.prototype.getExtent=function(){var t=this.getLayers&&this.getLayers().length;return"BBOX"===this.options.strategy||t?E(n,r):e.prototype.getExtent?e.prototype.getExtent.call(this):void 0},u.prototype.beforeRemove=function(){b=!0,this._removeMoveEventListener(),this._removeBboxEventListener(),this.__disableMapMoveListener=void 0,this.__enableMapMoveListener=void 0,this.__onMapMove=void 0,this.__onMapMoveStart=void 0,m()},u.prototype.getCount=function(){var e=this;return void 0!==this._count?this._count:r.get("feature_layer.feature.count",null,{id:d}).then((function(t){t&&(e._count=t.total_count)}))},u.prototype.updateLayer=function(r){return j(this,void 0,void 0,(function(){var n,o;return S(this,(function(i){switch(i.label){case 0:return r=r||y||{},"BBOX"!==this.options.strategy?[3,2]:[4,t.onLoad("create")];case 1:i.sent(),r.options=r.options||{},r.options.intersects=this._getMapBbox(),i.label=2;case 2:if(b)return[2];i.label=3;case 3:return i.trys.push([3,5,,6]),[4,v(r.filters,r.options)];case 4:return n=i.sent(),t.setLayerData(this,n),this.emitter.emit("updated"),[3,6];case 5:if("CancelError"!==(o=i.sent()).name)throw o;return[3,6];case 6:return e.prototype.updateLayer&&e.prototype.updateLayer.call(this),[2]}}))}))},u.prototype.propertiesFilter=function(e,t){return j(this,void 0,void 0,(function(){var r;return S(this,(function(n){switch(n.label){case 0:return m(),this.filter&&h?(this.filter((function(t){return!t.feature||!t.feature.properties||(0,a.Ml)(t.feature.properties,e)})),[3,3]):[3,1];case 1:return this.setData?(this.clearLayer&&this.clearLayer(),[4,v(e,t)]):[3,3];case 2:r=n.sent(),this.setData(r),n.label=3;case 3:return[2]}}))}))},u.prototype.removeFilter=function(){y=void 0,this.propertiesFilter([]),this.filter&&this.filter((function(){return!0}))},u.prototype._addBboxEventListener=function(){var e=this;this.__enableMapMoveListener=function(t){t===e&&(e._removeMoveEventListener(),e.updateLayer(),e._addMoveEventListener())},this.__disableMapMoveListener=function(t){t===e&&e._removeMoveEventListener()},t.emitter.on("layer:show",this.__enableMapMoveListener),t.emitter.on("layer:hide",this.__disableMapMoveListener),this.__enableMapMoveListener(this)},u.prototype._removeBboxEventListener=function(){this.__enableMapMoveListener&&t.emitter.on("layer:show",this.__enableMapMoveListener),this.__disableMapMoveListener&&t.emitter.on("layer:hide",this.__disableMapMoveListener)},u.prototype._addMoveEventListener=function(){var e=this;this.__onMapMove=(0,o.Ds)((function(){return e.updateLayer()})),this.__onMapMoveStart=m,t.emitter.on("movestart",this.__onMapMoveStart),t.emitter.on("moveend",this.__onMapMove)},u.prototype._removeMoveEventListener=function(){this.__onMapMove&&t.emitter.removeListener("moveend",this.__onMapMove),this.__onMapMoveStart&&t.emitter.removeListener("movestart",this.__onMapMoveStart)},u.prototype._getMapBbox=function(){var e=t.getBounds();if(e){var r=e[0],n=e[1],i=e[2],a=e[3];return"POLYGON(("+[[r,n],[i,n],[i,a],[r,a],[r,n]].map((function(e){var t=e[0],r=e[1],n=(0,o.Qm)(t,r);return n[0]+" "+n[1]})).join(", ")+"))"}},u}(p)]}}))}))}var T=function(){return(T=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function G(e,t,r){var n,o=e.adapter||"IMAGE",i=t.getLayerAdapters(),a=!i||i.IMAGE,s=e.resource,c=e.tileNoData?e.tileNoData:200;if("number"==typeof s){if("IMAGE"===o){if(a)return{url:n=r+"/api/component/render/image",resourceId:s,headers:e.headers,params:{resource:s,nd:c},updateWmsParams:function(e){return he(T({nd:c},e),s)}};o="TILE"}if("WMS"===o){n=r+"/api/resource/"+s+"/wms";var u=e.adapterOptions;return{url:n,format:"image/png",version:"1.1.1",layers:u&&u.layers,headers:e.headers}}if("MVT"===o)return{url:n=r+"/api/component/feature_layer/mvt?x={x}&y={y}&z={z}&resource="+s+"&simplification="+(e.simplification||0)};if("TERRAIN"===o)return{url:n=r+"/api/resource/"+s+"/terrain_provider",adapter:o};if("MODEL_3D"===o)return{url:n=r+"/api/component/model_3d/"+s+"/data.glb"};if("TILE"===o)return{url:n=r+"/api/component/render/tile?z={z}&x={x}&y={y}&resource="+s+"&nd="+c,adapter:o}}else{if(void 0!==s)throw new Error("Option `resource` must be number, not "+typeof s);console.log("Option `resource` not set")}}var C=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),B=function(){return(B=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},R=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},F=function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function U(e){var t=e.layerOptions,r=e.webMap,n=e.connector,i=e.item;return R(this,void 0,void 0,(function(){var e,a,s,c,l,p;return F(this,(function(f){switch(f.label){case 0:return e=i.resource.cls,a={wmsserver_service:"WMS",tmsclient_layer:"IMAGE"},void 0!==(s=t.adapter||e&&a[e]||"IMAGE")&&(t.adapter=s),"IMAGE"===s&&(!(c=r.getLayerAdapters())||c.IMAGE||(s="TILE")),(l=r.mapAdapter.layerAdapters[s])?[4,u(t,n)]:[3,2];case 1:return p=f.sent(),[2,function(e){function a(a,s){var c,u=e.call(this,a,s)||this;u.map=a,u.item=i,u.resourceId=p;var l=G(t,r,n.options.baseUrl||"");if(l){var f=B(B({},l),{setViewDelay:null===(c=t.adapterOptions)||void 0===c?void 0:c.setViewDelay,params:{resource:p},layers:String(p),resourceId:p});t.adapterOptions&&(0,o.ri)(t.adapterOptions.setViewDelay)&&(f.setViewDelay=t.adapterOptions.setViewDelay),u.options=B(B({},u.options),f)}return u}return C(a,e),a.prototype.addLayer=function(t){return e.prototype.addLayer.call(this,B(B({},this.options),t))},a.prototype.getIdentificationIds=function(){return R(this,void 0,void 0,(function(){var e;return F(this,(function(t){return(e=this.item&&this.item.resource.parent.id)?[2,[e]]:[2]}))}))},a}(l)];case 2:throw new Error(s+" not supported yet. Only TILE")}}))}))}var D=r(87187),Z=r(14949),W=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),V=function(){return(V=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},$=function(e){function t(r,n,o,a,s,c){var u=e.call(this,V(V({},t.options),o))||this;if(u.webMap=r,u.emitter=new i.EventEmitter,u._rootDescendantsCount=0,a&&(u.connector=a),s&&u.tree.setParent(s),u.item=n,"root"===u.item.item_type)u._rootDescendantsCount=u._sumUp(u.item.children);else{var l=u.tree.getRoot();l&&(u._rootDescendantsCount=l._rootDescendantsCount)}return u.initProperties(),c||u._init(n),u}return W(t,e),t.create=function(e,r,n,o,i){return a=this,s=void 0,u=function(){var a;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(s){switch(s.label){case 0:return[4,(a=new t(e,r,n,o,i,!0))._init(r)];case 1:return s.sent(),[2,a]}}))},new((c=void 0)||(c=Promise))((function(e,t){function r(e){try{o(u.next(e))}catch(e){t(e)}}function n(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):(o=t.value,o instanceof c?o:new c((function(e){e(o)}))).then(r,n)}o((u=u.apply(a,s||[])).next())}));var a,s,c,u},t.prototype.initItem=function(e){var r=this,n=e,o=this.getItemOptions(e),i=function(e){n._layer=e,r.layer=e,r.properties.get("visibility")&&r.properties.set("visibility",!0),void 0!==o.opacity&&r.webMap.setLayerOpacity(e,o.opacity)};if("group"===e.item_type||"root"===e.item_type)return e.children&&e.children.length&&this.getChildren(e).forEach((function(e){var n=new t(r.webMap,e,r.options,r.connector,r);r.tree.addChild(n)})),Promise.resolve();var a=void 0;return"layer"===e.item_type?a=e.adapter||e.layer_adapter.toUpperCase():t.GetAdapterFromLayerType[e.item_type]&&(a=(0,t.GetAdapterFromLayerType[e.item_type])(e,o,this.webMap,this.connector)),a?this.webMap.addLayer(a,o).then((function(e){i(e)})):e._layer?Promise.resolve(i(e._layer)):Promise.reject("No layer added")},t.prototype.bringToFront=function(){},t.prototype.fit=function(){this.item.item_type},t.prototype.getItemOptions=function(e){var t="layer"===e.item_type&&e.layer_transparency,r="number"==typeof t?(100-t)/100:void 0,n={visibility:!1,headers:this.options.headers,crossOrigin:this.options.crossOrigin,setViewDelay:this.options.setViewDelay,params:{resource:this.item.resourceId}};if(this.options.order){var i=this.options.drawOrderEnabled&&"draw_order_position"in e?this._rootDescendantsCount-e.draw_order_position:this.id;n.order=Number((0|this.options.order)+"."+i)}if("layer"===e.item_type){var a=e.layer_max_scale_denom?this._mapScaleToZoomLevel(e.layer_max_scale_denom):this.webMap.options.maxZoom,s=e.layer_min_scale_denom?this._mapScaleToZoomLevel(e.layer_min_scale_denom):this.webMap.options.minZoom;(0,o.wB)(n,{updateWmsParams:e.updateWmsParams,url:e.url,headers:this.options.headers,ratio:this.options.ratio,maxZoom:a,minZoom:s,minScale:e.layer_min_scale_denom,maxScale:e.layer_max_scale_denom})}return void 0!==r&&(n.opacity=r),n},t.prototype.getChildren=function(e){return function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n}(e.children).reverse()},t.prototype._mapScaleToZoomLevel=function(e){return function(e,t){void 0===t&&(t=0);var r=t;return function(e){return Math.log(e/256)/Math.LN2}(function(){if(void 0===ye){var e=document.createElement("div");e.style.cssText="position: absolute;  left: -100%;  top: -100%;  width: 100cm;",document.body.appendChild(e);var t=e.offsetWidth;document.body.removeChild(e),ye=t}return ye}()*function(e){return 12756274*Math.PI*Math.cos(e*Math.PI/180)}(r)/e)}(e)},t.prototype._init=function(e){var t=this;this.initItem(e).then((function(){t.emitter.emit("init")}))},t.prototype._sumUp=function(e,t){void 0===t&&(t=0);for(var r=0,n=e;r<n.length;r++){var o=n[r];"layer"===o.item_type?(t+=1,o.draw_order_position=o.draw_order_position||t):"group"===o.item_type&&(t=this._sumUp(o.children,t))}return t},t.GetAdapterFromLayerType={},t.options={properties:[{type:"boolean",name:"visibility",getProperty:function(e){if(e){if("group"===e.item.item_type||"root"===e.item.item_type)return(0,Z.cC)(e.item,(function(e){return"layer_enabled"in e&&e.layer_enabled}),(function(e){return e.children}));if("layer"===e.item.item_type)return e.item.layer_enabled}return!1},onSet:function(e,t,r){r&&"layer"===r.item.item_type&&(r.layer&&(e?r.webMap.showLayer(r.layer):r.webMap.hideLayer(r.layer)),r.item.layer_enabled=e)}}]},t}(D.ck),q=function(){return(q=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},z=function(){return(z=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},J=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},Y=function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},H=function(){function e(e,t){this.map=e,this.options=t,this.NgwWebmapItem=$,this.pixelRadius=10,this.webmapClassName="webmap",this.emitter=new i.EventEmitter;var r=t.resourceId;if(Array.isArray(r)?(this.resourceId=r[0],this.options.id=r[1]):this.resourceId=r,!this.resourceId)throw new Error("NGW `resourceId` is not defined")}return e.prototype.addLayer=function(e){return J(this,void 0,void 0,(function(){var t;return Y(this,(function(r){switch(r.label){case 0:return this.options=z(z({},this.options),e),t=this,[4,this._getWebMapLayerItem()];case 1:return t.layer=r.sent(),[2,this.layer]}}))}))},e.prototype.removeLayer=function(){var e=this.options.webMap.mapAdapter;this.getDependLayers().forEach((function(t){"layer"in t&&e.removeLayer(t.layer.layer)})),delete this.layer,delete this.response,delete this._webmapLayersIds},e.prototype.showLayer=function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!0)},e.prototype.hideLayer=function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!1)},e.prototype.getExtent=function(){var e=this.response&&this.response.webmap;if(e)return I(e)},e.prototype.getDependLayers=function(){return this.layer&&this.layer.tree.getDescendants()||[]},e.prototype.getIdentificationIds=function(){return J(this,void 0,void 0,(function(){var e,t;return Y(this,(function(r){switch(r.label){case 0:return e=[],(t=this._webmapLayersIds)?[3,2]:[4,this._getWebMapIds()];case 1:t=r.sent(),this._webmapLayersIds=t,r.label=2;case 2:return t&&t.length&&this.getDependLayers().sort((function(e,t){return t.id-e.id})).forEach((function(t){var r=t.item,n=r.parentId;if(void 0!==n&&"layer"===r.item_type){var o=t.properties.property("visibility");o.get()&&!o.isBlocked()&&e.push(n)}})),[2,e]}}))}))},e.prototype._getWebMapLayerItem=function(){return J(this,void 0,void 0,(function(){var e,t=this;return Y(this,(function(r){switch(r.label){case 0:return this.resourceId?[4,this.getWebMapConfig(this.resourceId)]:[3,2];case 1:if((e=r.sent())&&e.root_item)return[2,new Promise((function(r){var n={};if(t.options.connector&&t.options.connector.options.auth){var o=t.options.connector.getAuthorizationHeaders();o&&(n.headers=o)}n.setViewDelay=t.options.setViewDelay,n.order=t.options.order,n.ratio=t.options.ratio,n.crossOrigin=t.options.crossOrigin,n.drawOrderEnabled=e.draw_order_enabled;var i=new t.NgwWebmapItem(t.options.webMap,e.root_item,n,t.options.connector);i.emitter.on("init",(function(){return r(i)}))}))];r.label=2;case 2:return[2]}}))}))},e.prototype.getWebMapConfig=function(e){return J(this,void 0,void 0,(function(){var t,r;return Y(this,(function(n){switch(n.label){case 0:return[4,this.options.connector.getResource(e)];case 1:return(t=n.sent())&&(this.response=t,r=t[this.webmapClassName],t.basemap_webmap&&t.basemap_webmap.basemaps.length?this._setBasemaps(t.basemap_webmap):this.options.defaultBasemap&&this.options.webMap.addBaseLayer("OSM",{id:"webmap-default-baselayer",name:"OpenStreetMap"}),r)?(this._extent=[r.extent_left,r.extent_bottom,r.extent_right,r.extent_top],this._updateItemsParams(r.root_item,this.options.webMap,t),[2,r]):[2]}}))}))},e.prototype._setBasemaps=function(e){var t=this,r=this.options.webMap,n=!1;e.basemaps.forEach((function(e){(function(e){var t,r,n,o,i=e.webMap,a=e.connector,s=e.item,c=e.adapterOptions,u=void 0===c?{}:c,l=e.idPrefix,p=void 0===l?"basemapwebmap":l;return t=this,r=void 0,o=function(){return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(e){return[2,function(){function e(){this.options={},this.layer=[],this._removed=!1}return e.prototype.addLayer=function(){return this.layer},e.prototype.removeLayer=function(){this._removed=!0,this.layer.forEach((function(e){return i.removeLayer(e)}))},e.prototype.showLayer=function(){var e=this;this.options.visibility=!0,this.layer.length?this.layer.forEach((function(e){i.showLayer(e)})):le({resource:s.resource_id,adapterOptions:{name:s.display_name,opacity:s.opacity}},i,a).then((function(t){if(t){var r=new t(i.mapAdapter.map,q(q({},u),{baselayer:!1}));r.addLayer({}).then((function(t){r.options.baselayer=!1,Object.assign(r.options,u),r.id=p+"-"+s.resource_id,r.layer=t,e._removed&&i.removeLayer(r),e.options.visibility&&i.showLayer(r),e.layer.push(r)}))}}))},e.prototype.hideLayer=function(){this.options.visibility=!1,this.layer&&this.layer.forEach((function(e){return i.hideLayer(e)}))},e}()]}))},new((n=void 0)||(n=Promise))((function(e,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(e){e(r)}))).then(a,s)}c((o=o.apply(t,r||[])).next())}))})({webMap:r,connector:t.options.connector,item:e,adapterOptions:{crossOrigin:t.options.crossOrigin}}).then((function(t){var o=!n&&e.enabled;r.addBaseLayer(t,{name:e.display_name,opacity:e.opacity,visibility:o}),e.enabled&&(n=!0)}))}))},e.prototype._updateItemsParams=function(e,t,r){var n=this;if(e)if("group"===e.item_type||"root"===e.item_type)e.children&&(e.children=e.children.map((function(e){return n._updateItemsParams(e,t,r)}))),"root"===e.item_type&&(e.display_name=r.resource.display_name);else if("layer"===e.item_type){var i=(0,o.nH)(this.options.connector.options.baseUrl+"/api/component/render/image"),a=e.layer_style_id;e.url=i,e.resourceId=a,e.updateWmsParams=function(e){return he(e,a)};var s=G({adapter:e.layer_adapter.toUpperCase(),resource:a},t,this.options.connector.options.baseUrl||"");e=z(z({},e),s)}return e},e.prototype._getWebMapIds=function(){return J(this,void 0,void 0,(function(){var e,t,r,n=this;return Y(this,(function(o){switch(o.label){case 0:return(e=this.layer)&&"root"===e.item.item_type?(t=e.tree.getDescendants(),r=[],t.forEach((function(e){var t=e.item;if("layer"===t.item_type){var o=t.layer_style_id,i=n.options.connector.getResource(o).then((function(e){if(e){var r=Number(e.resource.parent.id);return t.parentId=r,r}}));r.push(i)}})),[4,Promise.all(r)]):[3,2];case 1:return[2,o.sent().filter((function(e){return void 0!==e}))];case 2:return[2]}}))}))},e}(),K=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Q=function(){function e(){}return e.prototype.getExtent=function(){return e=this,t=void 0,n=function(){var e;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(t){switch(t.label){case 0:return this._extent?[2,this._extent]:this.item?(e=this,[4,E(this.item,this.connector).then()]):[3,2];case 1:return e._extent=t.sent(),[2,this._extent];case 2:return[2]}}))},new((r=void 0)||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}));var e,t,r,n},e}(),X=r(33258),ee=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),te=function(){return(te=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},re=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},ne=function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},oe=function(){return(oe=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},ie=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},ae=function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},se={},ce=["mapserver_style","qgis_vector_style","qgis_raster_style","wmsserver_service","raster_style","basemap_layer","vector_layer","raster_layer","webmap","tmsclient_layer"];function ue(e){var t=e.layerOptions,r=e.webMap,n=e.connector,o=e.item;return ie(this,void 0,void 0,(function(){var e,i,a;return ae(this,(function(s){switch(s.label){case 0:return e=o.resource.id,[4,n.get("resource.collection",null,{parent:e})];case 1:return i=s.sent(),(a=i&&i[0])?[2,le(oe(oe({},t),{resource:a.resource.id}),r,n)]:[2]}}))}))}function le(e,t,r){return ie(this,void 0,void 0,(function(){var n,i,a,s,c,l,p,f,h,y,d,v;return ae(this,(function(b){switch(b.label){case 0:return a=e.adapter,[4,u(e,r)];case 1:return(s=b.sent())?(c=e.resource)&&c.resource&&void 0!==c.resource.id?(i=c,[3,4]):[3,2]:[3,15];case 2:return[4,r.getResource(s)];case 3:i=b.sent(),b.label=4;case 4:return i?(l=i.resource.cls,p=oe(oe({},e),{resource:s}),f={layerOptions:p,webMap:t,connector:r,item:i},-1===ce.indexOf(l)?[3,12]:"webmap"!==l?[3,5]:(n=function(e){var t,r,n,o,i=e.layerOptions,a=e.webMap,s=e.connector;return t=this,r=void 0,o=function(){var e;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(t){switch(t.label){case 0:return[4,u(i,s)];case 1:return e=t.sent(),[2,function(t){function r(r){return t.call(this,r,{url:"",webMap:a,resourceId:e,connector:s})||this}return K(r,t),r}(H)]}}))},new((n=void 0)||(n=Promise))((function(e,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(e){e(r)}))).then(a,s)}c((o=o.apply(t,r||[])).next())}))}(f),[3,11])):[3,14];case 5:if("vector_layer"!==l)return[3,6];if(void 0!==a&&"GEOJSON"!==a){if("MVT"!==a)return[2,ue(f)];n=U(f)}else n=A(f);return[3,11];case 6:return"raster_layer"!==l?[3,7]:[2,ue(f)];case 7:return"basemap_layer"!==l?[3,8]:(n=function(e){var t=e.webMap,r=e.item;return re(this,void 0,void 0,(function(){var e,n,o,i;return ne(this,(function(a){if(r.basemap_layer){if(e=r.basemap_layer.qms,n=r.basemap_layer.url,e)return(o=Promise.resolve(X.WL.utils.createQmsAdapter(t))).then((function(t){if(t&&r){var n=JSON.parse(e);t.prototype.qms=n,t.prototype.baselayer=!0}})),[2,o];if(n&&(i=t.mapAdapter.layerAdapters.TILE))return[2,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ee(t,e),t.prototype.addLayer=function(t){return re(this,void 0,void 0,(function(){return ne(this,(function(r){return[2,e.prototype.addLayer.call(this,te(te({},t),{url:n}))]}))}))},t}(i)]}return[2]}))}))}(f),[3,11]);case 8:return"GEOJSON"!==a?[3,10]:[4,r.getResource(i.resource.parent.id)];case 9:return(h=b.sent())&&(y=oe(oe({},e),{resource:i.resource.parent.id}),n=A(oe(oe({},f),{item:h,layerOptions:y}))),[3,11];case 10:n=U(f),b.label=11;case 11:return[3,13];case 12:if(!se[l])throw"Resource class '"+l+"' not yet supported.";d=se[l],v=void 0,(v=a&&"function"!=typeof v?d[a]:d)&&(n=v(f)),b.label=13;case 13:return[3,15];case 14:throw"Resource item is not found";case 15:return n?[2,n.then((function(e){if(e){var t=e;return i&&(t.prototype.item=i,t.prototype.resourceId=i.resource.id,t.prototype.connector=r),(0,o.ef)(t,[Q],{replace:!1}),t}}))]:[2]}}))}))}var pe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fe=function(){return(fe=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function he(e,t){var r=e.bbox,n=e.width,o=e.height,i=e.nd;return{resource:t,extent:r,size:n+","+o,timestamp:Date.now(),nd:i}}var ye,de={POINT:"point",LINESTRING:"line",POLYGON:"polygon",MULTIPOINT:"point",MULTILINESTRING:"line",MULTIPOLYGON:"polygon",POINTZ:"point",LINESTRINGZ:"line",POLYGONZ:"polygon",MULTIPOINTZ:"point",MULTILINESTRINGZ:"line",MULTIPOLYGONZ:"polygon"};function ve(e,t,r){var n=r.getAuthorizationHeaders();return n&&(e.headers=n),le(e,t,r)}var be=function(){return(be=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},me=function(){function e(e){if(this.options=e,this.options.connector)this.url=this.options.connector.options.baseUrl||"",this.connector=this.options.connector;else{if(!this.options.baseUrl)throw new Error("url is not defined");this.url=this.options.baseUrl,this.connector=new n.Z({baseUrl:this.url,auth:this.options.auth})}}return e.addClassAdapters=function(e,t){se[e]=t},e.prototype.onLoadSync=function(e){return t=this,r=void 0,o=function(){var t,r,n,o,i;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(a){switch(a.label){case 0:if(!this.options.resourceId||!this.url)return[3,4];if(!(t=[this.options.resourceId]).length)return[3,4];r=0,n=t,a.label=1;case 1:return r<n.length?(o=n[r],i={resourceId:o,connector:this.connector,webMap:e},[4,e.addLayer(H,be({visibility:!0,fit:!0,pixelRadius:this.options.pixelRadius},i))]):[3,4];case 2:return[2,a.sent()];case 3:return r++,[3,1];case 4:return[2]}}))},new((n=void 0)||(n=Promise))((function(e,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(e){e(r)}))).then(a,s)}c((o=o.apply(t,r||[])).next())}));var t,r,n,o},e.prototype.getLayerAdapters=function(){return Promise.resolve([this._getLayerAdapter()])},e.prototype._getLayerAdapter=function(){var e=this;return{name:"WEBMAP",createAdapter:function(t){return Promise.resolve(e._createAdapter(t))}}},e.prototype._createAdapter=function(e){var t,r=this.connector,n=this.url;return t={webMap:e,connector:r,baseUrl:n},function(e){function r(r,n){return n=fe(fe({},t),n),e.call(this,r,n)||this}return pe(r,e),r}(H)},e}(),we=function(){return(we=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function ge(e,t){var r;void 0===t&&(t=!1);var n=[],o=[];for(var i in e){var a=Number(i);isNaN(a)||n.push(a)}var s=e.resources;s&&n.sort((function(e,t){return s.indexOf(e)-s.indexOf(t)}));for(var c=0;c<n.length;c++){var u=e[i=n[c]];if("features"in u){var l=u.features,p=Number(i),f=l[0];if(f&&(r={featureId:f.id,resourceId:p,feature:f},o.push(r),!t))break}}return o}function _e(e){var t=e.connector,r=e.identify;for(var n in r){var o=Number(n);if(!isNaN(o)){var i=r[n];if("features"in i){var a=i.features.find((function(e){return e.geom}));if(a&&a.geom){var s=a.geom;return l.Z.resolve(b(we(we({},a),{geom:s})))}}}}var c=ge(r);return c&&c.length?h(we({connector:t},c[0])):l.Z.resolve(void 0)}function Oe(e){var t=e.connector,r=ge(e.identify);return r&&r.length?f(we(we({connector:t},e.requestOptions),r[0])):l.Z.resolve(void 0)}function Le(e,t){(0,o.Vc)(e);var r=e.lngLat,n=r[0],i=r[1],a=(0,o.Wp)(n,i,t.radius),s=[];a.forEach((function(e){var t=e[0],r=e[1],n=(0,o.Qm)(t,r),i=n[0],a=n[1];s.push(i+" "+a)}));var c={geom:"POLYGON(("+s.join(", ")+"))",srs:3857,layers:t.layers};return t.connector.post("feature_layer.identify",{data:c})}function xe(e,t){var r,n,o,i,a;return n=this,o=void 0,a=function(){var n,o,i,a,s,c,u;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(l){switch(l.label){case 0:return[4,e.get("pyramid.settings",null,{component:"pyramid"})];case 1:if(!((n=l.sent())&&n.company_logo&&n.company_logo.enabled))return[3,6];(o=document.createElement("a")).style.position="absolute",o.style.bottom="0",o.style.right="0",o.style.padding=null!==(r=null==t?void 0:t.padding)&&void 0!==r?r:"10px",o.className="ngw-map-logo",t&&t.cssClass&&(o.className+=" "+t.cssClass),(i=new Image).style.maxHeight="100px",i.style.maxWidth="100px",i.src="",l.label=2;case 2:return l.trys.push([2,4,,5]),[4,e.get("pyramid.company_logo",{responseType:"blob"})];case 3:return a=l.sent(),s=window.URL||window.webkitURL,c=s.createObjectURL(a),i.src=c,[3,5];case 4:return u=l.sent(),console.log(u),[3,5];case 5:return null!==n.company_logo.link&&""!==n.company_logo.link.trim()&&(o.href=n.company_logo.link,o.target="_blank",-1!==n.company_logo.link.search(/:\/\/nextgis/)&&(i.alt="Get your own Web GIS at nextgis.com")),o.appendChild(i),[2,o];case 6:return[2]}}))},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,s)}c((a=a.apply(n,o||[])).next())}))}},79408:function(e,t,r){"use strict";r.d(t,{Z8:function(){return g}});var n=r(17187),o=r(43590),i=r(40203),a=r(7466),s=r(57836),c=r(81129),u=function(){return(u=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function l(e,t,r,n){if("number"==typeof t||"string"==typeof t)t=Number(t),e.push(u(u({},r),{resource:t}));else if(Array.isArray(t)){var o=t[0],i=t[1];e.push(u(u(u({},r),{resource:o,id:i}),n))}else"object"==typeof t&&e.push(u(u(u({},r),t),n))}var p,f=r(56018),h=r(33258),y=function(){return(y=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},d={target:"map",baseUrl:"",whitlabel:!1,controls:["ZOOM","ATTRIBUTION"],controlsOptions:{ZOOM:{position:"top-left"},ATTRIBUTION:{position:"bottom-right",customAttribution:['<a href="https://nextgis.com" target="_blank">©NextGIS</a>']}},pixelRadius:10},v=(p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),b=function(){return(b=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},m=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},w=function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},g=function(e){function t(t){var r=e.call(this,function(e){var t=[new h.WL];return e.starterKits&&e.starterKits.forEach((function(e){t.push(e)})),e.connector?e.connector&&(e.baseUrl=e.connector.options.baseUrl):e.connector=new f.Z({baseUrl:e.baseUrl||"",auth:e.auth}),(e=(0,i.vb)(d,e)).center||e.bounds||(e.bounds=[-179,-90,180,90],e.maxBounds=e.bounds),e.connector&&t.push(new s.lO({connector:e.connector,auth:e.auth})),y(y({},e),{starterKits:t,create:!1})}(t))||this;return r.emitter=new n.EventEmitter,r._ngwLayers={},r._promises={select:[],identify:[]},t.connector&&(r.connector=t.connector),r._createWebMap().then((function(){var e=r.getContainer();e&&e.classList.add("ngw-map-container"),r.options.whitlabel&&r._whiteLabel()})),r}return v(t,e),t.prototype.addControl=function(t,r,n){return m(this,void 0,void 0,(function(){return w(this,(function(o){switch(o.label){case 0:return[4,this.onLoad("controls:create")];case 1:return o.sent(),[2,e.prototype.addControl.call(this,t,r,n)]}}))}))},t.prototype.addNgwLayer=function(e){return m(this,void 0,void 0,(function(){var t,r,n,o,a,c,u,l;return w(this,(function(p){switch(p.label){case 0:return[4,this.onMapLoad()];case 1:if(p.sent(),t=e.keyname,r=e.resourceId,(t||void 0!==r)&&(0,i.vF)("set `resource` options instead of `keyname` or `resourceId`"),n=e.resource,!t&&!r&&!n)throw new Error("resource, resourceId or keyname is required parameter to add NGW layer");if(!this.options.baseUrl&&""!==this.options.baseUrl)return[3,5];p.label=2;case 2:return p.trys.push([2,4,,5]),(0,i.ri)(this.options.setViewDelay)&&(e.adapterOptions=e.adapterOptions||{},(0,i.ri)(e.adapterOptions.setViewDelay)||(e.adapterOptions.setViewDelay=this.options.setViewDelay)),o=(0,s.Zj)(e,this,this.connector),[4,this.addLayer(o,b(b({visibility:!0},e),e.adapterOptions))];case 3:return a=p.sent(),c=a&&this.getLayerId(a),a&&c&&(this._ngwLayers[c]={layer:a,resourceId:a.resourceId},a.options.baselayer&&this.getActiveBaseLayer()),[2,a];case 4:return u=p.sent(),l=(0,i.Kn)(n)&&"id"in n?n.id:t||r||n,console.error("Can't add NGW layer "+l+".",u),[3,5];case 5:return[2]}}))}))},t.prototype.fit=function(){var e=this.options,t=e.center,r=e.zoom,n=e.bounds;t?(this.setCenter(t),r&&this.setZoom(r)):n&&this.fitBounds(n)},t.prototype.fetchNgwLayerItem=function(e){return(0,s.vS)(b({connector:this.connector},e))},t.prototype.fetchNgwLayerItems=function(e){return(0,s.nm)(b({connector:this.connector},e))},t.prototype.fetchNgwLayerFeature=function(e){return(0,s.Cg)(b({connector:this.connector},e))},t.prototype.fetchNgwLayerFeatures=function(e){return(0,s.UJ)(b({connector:this.connector},e))},t.prototype.fetchIdentifyItem=function(e,t){var r=(0,s.K1)({identify:e,connector:this.connector,requestOptions:t});return this._addPromise("identify",r),r},t.prototype.fetchIdentifyGeoJson=function(e,t){void 0===t&&(t=!1);var r=(0,s.D1)({identify:e,connector:this.connector,multiple:t});return r&&"then"in r?(this._addPromise("identify",r),r):o.Z.resolve(r)},t.prototype.getIdentifyGeoJson=function(e,t){return void 0===t&&(t=!1),this.fetchIdentifyGeoJson(e,t)},t.prototype.getNgwLayers=function(){return m(this,void 0,void 0,(function(){return w(this,(function(e){switch(e.label){case 0:return[4,this.onLoad()];case 1:return e.sent(),[2,this._ngwLayers]}}))}))},t.prototype.getNgwLayerByResourceId=function(e){return m(this,void 0,void 0,(function(){var t,r,n,o,i,a,s,c;return w(this,(function(u){switch(u.label){case 0:for(r in t=[],this._ngwLayers)t.push(r);n=0,u.label=1;case 1:return n<t.length?(o=t[n],(i=this._ngwLayers[o]).resourceId!==e?[3,2]:[2,i&&i.layer]):[3,6];case 2:return i.layer.getIdentificationIds?[4,i.layer.getIdentificationIds()]:[3,4];case 3:if((a=u.sent())&&a.some((function(t){return t===e})))return[2,i.layer];u.label=4;case 4:if(i.layer.getDependLayers&&(s=i.layer.getDependLayers(),c=s.find((function(t){return t.item&&t.item.parentId===e}))))return[2,c.layer];u.label=5;case 5:return n++,[3,1];case 6:return[2]}}))}))},t.prototype.fitLayer=function(t,r){return m(this,void 0,void 0,(function(){var n,o,i,a,c,u=this;return w(this,(function(l){switch(l.label){case 0:return n="string"==typeof t||"number"==typeof t?String(n):t.id,(o=n&&this._ngwLayers[n])?o.layer.getExtent?[4,o.layer.getExtent()]:[3,2]:[3,7];case 1:return(i=l.sent())&&this.fitBounds(i,r),[3,6];case 2:return a=void 0,o.layer.item?(a=o.layer.item,[3,5]):[3,3];case 3:return c=o.resourceId,[4,this.connector.getResource(c)];case 4:a=l.sent(),l.label=5;case 5:a&&(0,s.U2)(a,this.connector).then((function(e){e&&u.fitBounds(e,r)})),l.label=6;case 6:return[3,8];case 7:e.prototype.fitLayer.call(this,t,r),l.label=8;case 8:return[2]}}))}))},t.prototype.zoomToLayer=function(e){return m(this,void 0,void 0,(function(){return w(this,(function(t){return[2,this.fitLayer(e)]}))}))},t.prototype.onLoad=function(t){return void 0===t&&(t="ngw-map:create"),e.prototype.onLoad.call(this,t)},t.prototype.removeLayer=function(t){var r=this.getLayer(t);if(r){var n=this.getLayerId(r);n&&delete this._ngwLayers[n],e.prototype.removeLayer.call(this,r)}},t.prototype.enableSelection=function(){var e=this;this.$$selectFromNgwRaster||(this.$$selectFromNgwRaster=function(t){e.emitter.listenerCount("ngw:select")&&e._selectFromNgwRaster(t)},this.$$selectFromNgwVector=function(t){e.emitter.listenerCount("ngw:select")&&e._selectFromNgwVector(t)},this.emitter.on("click",this.$$selectFromNgwRaster),this.emitter.on("layer:click",this.$$selectFromNgwVector))},t.prototype.disableSelection=function(){this.$$selectFromNgwRaster&&(this.emitter.removeListener("click",this.$$selectFromNgwRaster),this.emitter.removeListener("click",this._selectFromNgwVector),this.$$selectFromNgwRaster=void 0,this.$$selectFromNgwVector=void 0)},t.prototype.getNgwLayerItem=function(e){return this.fetchNgwLayerItem(e)},t.prototype.getNgwLayerItems=function(e){return this.fetchNgwLayerItems(e)},t.prototype.getNgwLayerFeature=function(e){return this.fetchNgwLayerFeature(e)},t.prototype.getNgwLayerFeatures=function(e){return this.fetchNgwLayerFeatures(e)},t.prototype.cancelPromise=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.cancelPromises.apply(this,e)},t.prototype.cancelPromises=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];t.length||(t=Object.keys(this._promises)),t.forEach((function(t){var r=e._promises[t];r&&(r.forEach((function(e){return e.cancel()})),e._promises[t]=[])}))},t.prototype._addPromise=function(e,t){var r=this._promises[e];if(r&&-1===r.indexOf(t)){var n=function(){var e=r.indexOf(t);-1!==e&&r.splice(e,1)};t.then(n),t.catch(n),r.push(t)}},t.prototype._isFitFromResource=function(){var e=this._initMapState;return!e.zoom||!e.center},t.prototype._createWebMap=function(){return m(this,void 0,void 0,(function(){var e,t,r,n,o,i;return w(this,(function(a){switch(a.label){case 0:return[4,this.create()];case 1:a.sent(),this.options.qmsId&&this.addQmsBaseLayer(),this.options.osm&&this.addOsmBaseLayer(),e=[],t=this._isFitFromResource(),this.options.webmapId&&l(e,this.options.webmapId,{fit:t}),this.options.resources&&Array.isArray(this.options.resources)&&this.options.resources.forEach((function(r){var n={};t||(n.fit=!1),l(e,r,{},n)})),r=0,n=e,a.label=2;case 2:if(!(r<n.length))return[3,7];o=n[r],a.label=3;case 3:return a.trys.push([3,5,,6]),[4,this.addNgwLayer(o)];case 4:return a.sent(),[3,6];case 5:return i=a.sent(),console.log(i),[3,6];case 6:return r++,[3,2];case 7:return this._emitStatusEvent("ngw-map:create",this),this.enableSelection(),[2]}}))}))},t.prototype.addOsmBaseLayer=function(){this.addBaseLayer("OSM")},t.prototype.addQmsBaseLayer=function(){var e,t;Array.isArray(this.options.qmsId)?(e=this.options.qmsId[0],t=this.options.qmsId[1]):e=Number(this.options.qmsId);var r={qmsId:e};t&&(r.id=t),this.addBaseLayer("QMS",r)},t.prototype._selectFromNgwVector=function(e){var t,r=e.layer,n=r.item&&r.item.resource.id,o=e.feature;if(void 0!==n&&o){var i=o.id;if(i){var a={id:Number(i),fields:o.properties,label:"#"+n,layerId:Number(n),parent:"",geom:o.geometry},s=((t={featureCount:1})[n]={featureCount:1,features:[a]},t);return this._emitStatusEvent("ngw:select",b(b({},s),{resources:[n],sourceType:"vector"})),s}}},t.prototype._selectFromNgwRaster=function(e){return m(this,void 0,void 0,(function(){var t,r,n,o,i,a,c,u,l,p,f=this;return w(this,(function(h){switch(h.label){case 0:return this._emitStatusEvent("ngw:preselect"),t=[],(r=Object.values(this._ngwLayers)).sort((function(e,t){return e.layer.order&&t.layer.order?t.layer.order-e.layer.order:1})),r.forEach((function(e){var r=e.layer;r.getIdentificationIds&&r.options.selectable&&t.push(r.getIdentificationIds())})),[4,Promise.all(t)];case 1:return n=h.sent(),o=[],n.forEach((function(e){e&&e.forEach((function(e){return o.push(e)}))})),o.length?(i=this.options.pixelRadius||10,a=this.getCenter(),c=void 0!==(c=this.getZoom())?c:20,a&&c?(u=40075016.686*Math.abs(Math.cos(180*a[1]/Math.PI))/Math.pow(2,c+8),l=i*u*5e-4,p=(0,s.PA)(e,{layers:o,connector:this.connector,radius:l}).then((function(t){return f._emitStatusEvent("ngw:select",b(b({},t),{resources:o,sourceType:"raster",event:e})),t})),this._addPromise("select",p),[2,p]):(this._emitStatusEvent("ngw:select",null),[2])):(this._emitStatusEvent("ngw:select",null),[2])}}))}))},t.prototype._whiteLabel=function(){return m(this,void 0,void 0,(function(){var e,t;return w(this,(function(r){switch(r.label){case 0:return(e=this.getContainer())?[4,(0,s.GW)(this.connector,this.options.companyLogoOptions)]:[3,2];case 1:(t=r.sent())&&e.appendChild(t),r.label=2;case 2:return[2]}}))}))},t.getIcon=c.q,t}(a.y9)},69261:function(e,t,r){"use strict";function n(e){return"[object Object]"===Object.prototype.toString.call(e)}function o(e){return"function"==typeof e}r.d(t,{GY:function(){return n},UY:function(){return o},Yx:function(){return f}});var i=function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a={get:function(e,t){var r=t[0];return e.properties&&e.properties[r]},match:function(e,t){var r=t[0],n=t.slice(1),o=r;Array.isArray(r)&&(o=s(e,r));for(var i=n.splice(-1,n.length%2)[0],a=0;a<n.length-1;a+=2)if(n[a]===o)return n[a+1];return i}};function s(e,t){var r=t[0],n=t.slice(1),o=a[r];if(o)return o(e,n)}function c(e){return function(t){return s(t,e)}}var u=["iconSize","iconAnchor"],l=r(97060),p=function(){return(p=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function f(e,t,r){if(!e)throw new Error("paint is empty");var n=p({},t);if(o(e)){var a=function(n){var o=f(e(n),t,r);return o.type=e.type,o};return a.type=e.type,a}if(function(e){return!!Array.isArray(e)}(e))return function(n){return f((o={},i=[],e.forEach((function(e){e&&(Array.isArray(e)?i.push(e):o=e)})),function(e){var t=i.find((function(t){return(0,l.TE)(e,t[0])}));return t?p(p({},o),t[1]):o})(n),t,r);var o,i};if("get-paint"===e.type){var s=function(e,t){if("function"==typeof e.from)return e.from(e.options);if("string"==typeof e.from&&t){var r=t[e.from];if(r)return r(e.options)}}(e,r);s&&(n=f(s,t,r))}else{if("icon"===e.type)return e;var h=function(e){var t,r=!1,n={};for(var o in e)if(-1===u.indexOf(o)){var a=o,s=e[a];t=s,Array.isArray(t)&&(r=!0,n[a]=c(s))}if(r)return function(t){var r={};for(var o in n)r[o]=n[o](t);return i(i({},e),r)}}(e);if(h)return function(e){return f(h(e),t,r)};(n=p(p({},n),e)).fill=void 0===n.fill||n.fill,n.stroke=void 0!==n.stroke?n.stroke:!n.fill||!(!n.strokeColor&&!n.strokeOpacity)}return o(n)||("color"in n&&(n.strokeColor||(n.strokeColor=n.color),n.fillColor||(n.fillColor=n.color)),"opacity"in n&&(void 0===n.strokeOpacity&&(n.strokeOpacity=n.opacity),void 0===n.fillOpacity&&(n.fillOpacity=n.opacity))),n}}}]);
//# sourceMappingURL=main-7db0a515f299dae.js.map