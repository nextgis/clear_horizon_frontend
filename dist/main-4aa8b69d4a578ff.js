/*! For license information please see main-4aa8b69d4a578ff.js.LICENSE.txt */
"use strict";(self.webpackChunkclear_horizon=self.webpackChunkclear_horizon||[]).push([[185],{8907:(e,t,r)=>{r.d(t,{q:()=>n});const i={brill:'<path d="m6 0-5 6 5 6 5-6z"/>',circle:'<circle cx="6" cy="6" r="6"/>',rect:'<rect width="12" height="12"/>',marker:'<path d="m6 0c-1.85 0-4 1.19-4 4.22 0 2.05 3.08 6.59 4 7.78 0.821-1.19 4-5.62 4-7.78 0-3.03-2.15-4.22-4-4.22z"/>',cross:'<path d="M 2.4,12 6,8.4 9.6,12 12,9.6 8.4,6 12,2.4 9.6,0 6,3.6 2.4,0 0,2.4 3.6,6 0,9.6 Z"/>',star:'<path d="m6 0.25 1.71 4.18 4.29-1.04e-4 -3.43 3.14 0.857 4.18-3.43-3.14-3.43 3.14 0.857-4.18-3.43-3.14 4.29-0.209z"/>',triangle:'<path d="m12 11.7h-12l6-11.2z"/>',plus:'<path d="m7.5 12v-4.5h4.5v-3h-4.5v-4.5h-3v4.5h-4.5v3h4.5v4.5z"/>',minus:'<path d="m12 7.5v-3h-12v3z"/>',asterisk:'<path d="m7.59 12v-3.27l2.83 1.64 1.58-2.74-2.85-1.64 2.83-1.64-1.56-2.74-2.83 1.64v-3.24h-3.17v3.24l-2.85-1.64-1.57 2.74 2.84 1.64-2.84 1.64 1.57 2.74 2.85-1.64v3.27z"/>'},o=12,s=.8;function n(){var e,t,r,n,a,c;let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const u=null!==(e=l.shape)&&void 0!==e?e:"circle",p=null!==(t=l.color)&&void 0!==t?t:"blue",h=null!==(r=l.strokeColor)&&void 0!==r?r:"white",d=null!==(n=l.size)&&void 0!==n?n:o,m=null!==(a=l.rotate)&&void 0!==a?a:0,f=null!==(c=l.anchor)&&void 0!==c?c:[d/2,d/2],y=void 0!==l.stroke?Number(l.stroke):s,v=l.p||i[u]||"circle",g="string"==typeof v?v:v(l),_=function(e){return(new DOMParser).parseFromString(e,"image/svg+xml").documentElement}(l.svg||function(e){let{width:t,height:r,stroke:i=0,content:s}=e;const n=i/2;return'<svg\n    version="1.1"\n    xmlns="http://www.w3.org/2000/svg"\n    width="'.concat(t,'"\n    height="').concat(r,'"\n    viewBox="-').concat(n," -").concat(n," ").concat(o+i," ").concat(o+i,'"\n  >').concat(s,"</svg>")}({width:d,height:d,stroke:y,content:g}));return _.setAttribute("width",String(d)),_.setAttribute("height",String(d)),_.setAttribute("fill",p),y&&(_.setAttribute("stroke",h),_.setAttribute("stroke-width",String(y))),{type:"icon",iconSize:[d,d],iconAnchor:f,html:(new XMLSerializer).serializeToString(_),rotate:m,svg:_}}},6719:(e,t,r)=>{r.d(t,{Z:()=>Z}),r(6265),r(7267);var i=r(7187),o=r(5243);class s extends o.Control.Attribution{constructor(e){super(e);const t=e&&e.customAttribution;if(t){let e=[];Array.isArray(t)?e=t:t&&(e=[t]),e.forEach((e=>this.addAttribution(e)))}}}function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return new(o.Control.extend({onAdd(){const i=document.createElement("div"),s=e.onAdd(r);return i.classList.add("leaflet-control"),t.bar&&i.classList.add("leaflet-bar"),t.addClass&&i.classList.add(t.addClass),t.margin||t.bar||(i.style.marginBottom="0px",i.style.marginTop="0px",i.style.marginLeft="0px",i.style.marginRight="0px"),s&&i.appendChild(s),o.DomEvent.disableClickPropagation(i),i},onRemove(){e.onRemove()}}))}var a=r(7450),c=r(8651);function l(e){const t=e.getNorthEast(),r=e.getSouthWest();return[r.lng,r.lat,t.lng,t.lat]}function u(e){const t={};for(let r=0;r<e.length;r++)t[e[r]]=1+(t[e[r]]||0);let r="";for(const e in t){const i=r?t[r]:0;t[e]>i&&(r=e)}return r}const p={Point:"point",LineString:"line",MultiPoint:"point",Polygon:"polygon",MultiLineString:"line",MultiPolygon:"polygon",GeometryCollection:"polygon"},h={stroke:!1,opacity:1},d={};for(const e in p){const t=p[e],r=d[t]||[];r.push(e),d[t]=r}function m(e,t){return-1!==(d[t]||[]).indexOf(e)}function f(e){const t=new o.GeoJSON;return(Array.isArray(e)?e:[e]).forEach((e=>t.addData(e))),t.getBounds()}function y(e){return{getBounds:()=>function(e){return l(f(e))}(e),getCenter:()=>function(e){const{lat:t,lng:r}=f(e).getCenter();return[r,t]}(e)}}function v(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class g{constructor(e,t){if(this.map=e,this.options=t,v(this,"layer",void 0),v(this,"pane","order-0"),void 0!==t.order){const r="order-"+t.order;let i=e.getPane(r);i||(i=e.createPane(r)),i.style.zIndex=String(Math.round(100*t.order)),this.pane=r}}addLayer(e){Object.assign(this.options,e)}}function _(e){const t=e.containerPoint,r=e.latlng,{lat:i,lng:o}=r;return{latLng:r,lngLat:[o,i],pixel:{left:t.x,top:t.y},source:e}}function b(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class w{constructor(e){b(this,"layer",void 0),b(this,"_onclick",void 0),b(this,"_mouseout",void 0),b(this,"_mouseover",void 0),this.layer=e}handleMouseEvents(e){const{onClick:t,onLayerClick:r,onMouseOut:i,onMouseOver:o}=this.layer.options,s=t||r;s&&(this._onclick=t=>{const r=!!this.layer._getSelected(e);s({selected:r,...this._createMouseEvent(t)})},e.on("click",this._onclick,this)),i&&(this._mouseout=e=>{i(this._createMouseEvent(e))},e.on("mouseout",this._mouseout,this)),o&&(this._mouseover=e=>{o(this._createMouseEvent(e))},e.on("mouseover",this._mouseover,this))}stopMouseEvents(e){this._mouseover&&e.off("mouseover",this._mouseover,this),this._mouseout&&e.off("mouseout",this._mouseout,this),this._onclick&&e.off("click",this._onclick,this)}_createMouseEvent(e){return function(e){let{layer:t,source:r}=e;const i=r.target.feature;return{layer:t,feature:i,event:_(r),source:r,...y(i)}}({layer:this.layer,source:e})}}var L=r(9443);class O{constructor(e){var t,r,i,o;t=this,i=void 0,(r="symbol"==typeof(o=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r="layer"))?o:String(o))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,this.layer=e}setPaintEachLayer(e){this.layer._layers.forEach((t=>{this.setPaint(t,e)}))}setPaint(e,t){let r;const{layer:i,feature:o}=e;if(i&&o&&((0,L.UY)(t)?r=t(o):(0,L.GY)(t)&&(r=t),r))if("point"===this.layer.type&&"icon"===r.type){const e=i,t=this._createDivIcon(r);setTimeout((()=>{e.setIcon(t)}),10)}else"setStyle"in i&&i.setStyle(this.preparePaint(r))}preparePaint(e){if("get-paint"!==e.type){const t=[["color","strokeColor"],["opacity","strokeOpacity"],["stroke","stroke"],["fillColor","fillColor"],["fillOpacity","fillOpacity"],["fill","fill"],["weight","weight"]],r="line"===this.layer.type?[["color","strokeColor"],["opacity","strokeOpacity"],["weight","weight"]]:t,i={};"radius"in e&&"number"==typeof e.radius&&(i.radius=e.radius);for(const[t,o]of r){const r=this.layer.options.opacity;let s=e[o];(0,c.r)(r)&&-1!==o.toLowerCase().indexOf("opacity")&&(s=Number(s)*r),void 0!==s&&Object.defineProperty(i,t,{enumerable:!0,value:s})}return i}return h}_createDivIcon(e){const{html:t,rotate:r,className:i,...s}=e,n=document.createElement("div");return i&&(n.className=i),r&&(n.style.transform="rotateZ(".concat(r,"deg)")),t&&(n.innerHTML=t),new o.DivIcon({className:"",...s,html:n})}createPaintToLayer(e){if(e&&e.type)if("icon"===e.type){const t=e.className,r=e.html;if(t||r)return(t,r)=>{const i=this._createDivIcon(e);return new o.Marker(r,{icon:i})}}else if("pin"===e.type)return(e,t)=>new o.Marker(t);return(t,r)=>{const i=h;return new o.CircleMarker(r,this.preparePaint({...i,...e}))}}createPaintOptions(e){const t={},r=this.preparePaint(e);return e&&(t.style=()=>r),"point"===this.layer.type?t.pointToLayer=this.createPaintToLayer(e):"line"===this.layer.type&&(r.stroke=!0),t}}function P(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function I(e,t,r){const i=new XMLHttpRequest;i.open("GET",e),i.responseType="arraybuffer";for(const e in r)i.setRequestHeader(e,r[e]);return i.onload=function(){const e=new Uint8Array(this.response),r=new Blob([e],{type:"image/png"}),i=(window.URL||window.webkitURL).createObjectURL(r);t(i)},i.send(),()=>{i.abort()}}r(8607),r(9943),r(1638),r(3356),r(8730),r(9307);class S extends o.ImageOverlay{constructor(e,t,r){var i,o,s,n;super(e,t,r),i=this,s=[],(o="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o="_abort"))?n:String(n))in i?Object.defineProperty(i,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[o]=s}cancelLoad(){this._abort&&(this._abort.forEach((e=>e())),this._abort=[])}_initImage(){super._initImage();const e=this.options.headers;if(e){const t=this._image,r=t.src;t.src="",this._abort.push(I(r,(e=>{t.src=e}),e))}}}function x(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class E extends o.Layer{constructor(e,t){super(t),x(this,"defaultWmsParams",{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1}),x(this,"options",{crs:null,uppercase:!1,attribution:"",opacity:1,isBack:!1,minZoom:0,pane:"tilePane",headers:null,viewPortBuffer:0,setViewDelay:100}),x(this,"wmsParams",void 0),x(this,"_url",void 0),x(this,"_currentUrl",void 0),x(this,"_currentOverlay",void 0),this._url=e;const r={},i={};let s;for(s in t)s in this.options?i[s]=t[s]:r[s]=t[s];o.Util.setOptions(this,i),this.wmsParams=o.Util.extend({},this.defaultWmsParams,r)}setParams(e){o.Util.extend(this.wmsParams,e),this.update()}getAttribution(){return this.options.attribution||""}onAdd(){return this.update(),this}onRemove(e){return this._currentOverlay&&(this._currentOverlay.cancelLoad(),e.removeLayer(this._currentOverlay),delete this._currentOverlay),this._currentUrl&&delete this._currentUrl,this}getEvents(){return{moveend:(0,a.D)(this.update,this.options.setViewDelay)}}update(){if(!this._map)return;this.updateWmsParams();const e=this.getImageUrl();if(this._currentUrl===e)return;this._currentUrl=e;const t=this.options.viewPortBuffer||0,r=this._map.getBounds().pad(t),i=new S(e,r,{opacity:0,pane:this.options.pane,headers:this.options.headers});i.addTo(this._map),this._currentOverlay&&this._currentOverlay.cancelLoad(),i.once("load",(()=>{this._map&&(i._url===this._currentUrl?(this._currentOverlay&&this._map.removeLayer(this._currentOverlay),this._currentOverlay=i,i.setOpacity(void 0!==this.options.opacity?this.options.opacity:1),!0===this.options.isBack&&i.bringToBack(),!1===this.options.isBack&&i.bringToFront(),void 0!==this.options.zIndex&&i.setZIndex(this.options.zIndex)):this._map.removeLayer(i))}),this);const{minZoom:o,maxZoom:s}=this.options;(o&&this._map.getZoom()<o||s&&this._map.getZoom()>s)&&this._map.removeLayer(i)}setOpacity(e){this.options.opacity=e,this._currentOverlay&&this._currentOverlay.setOpacity(e)}bringToBack(){this.options.isBack=!0,this._currentOverlay&&this._currentOverlay.bringToBack()}bringToFront(){this.options.isBack=!1,this._currentOverlay&&this._currentOverlay.bringToFront()}setZIndex(e){this.options.zIndex=e,this._currentOverlay&&this._currentOverlay.setZIndex(e)}updateWmsParams(e){e||(e=this._map);const t=this.options.viewPortBuffer||0,r=e.getBounds().pad(t),i=e.getSize();if(0!==this.options.viewPortBuffer){const e=t+1;i.x=Math.ceil(i.x*e),i.y=Math.ceil(i.y*e)}const s=parseFloat(this.wmsParams.version),n=this.options.crs||e.options.crs,a=s>=1.3?"crs":"srs";if(n){const e=n.project(r.getNorthWest()),t=n.project(r.getSouthEast()),c={width:i.x,height:i.y};c[a]=n.code,c.bbox=(s>=1.3&&n===o.CRS.EPSG4326?[t.y,e.x,e.y,t.x]:[e.x,t.y,t.x,e.y]).join(","),o.Util.extend(this.wmsParams,c)}}getImageUrl(){const e=this.options.uppercase||!1,t=o.Util.getParamString(this.wmsParams,this._url,e);return this._url+t}}function M(e){return class extends e{constructor(){var e;super(...arguments),e=this,this.options.setViewDelay&&(this._update=(0,a.D)((function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];o.GridLayer.prototype._update.call(e,...r)}),this.options.setViewDelay))}createTile(e,t){const r=this.getTileUrl(e),i=document.createElement("img");return i.abort=I(r,(e=>{i.src=e,t(null,i)}),this.options.headers),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i.alt="",i.setAttribute("role","presentation"),i}_abortLoading(){const e=this._tiles,t=this._tileZoom;for(const r in e)if(e[r].coords.z!==t){const t=e[r].el;t.onload=o.Util.falseFn,t.onerror=o.Util.falseFn,t.complete||(t.abort&&t.abort(),t.src=o.Util.emptyImageUrl,o.DomUtil.remove(t),delete e[r])}}}}class C extends o.TileLayer{constructor(e,t){super(e,t),Object.assign(this.options,t)}}const k=M(C);class T extends g{addLayer(e){if(this.options=Object.assign(this.options,e),e){const{url:t,...r}=e;if(t){const e={pane:this.pane,attribution:r.attribution,minZoom:r.minZoom,maxZoom:r.maxZoom,...r.nativeOptions};let i;return r.subdomains&&(e.subdomains=r.subdomains),i=r.headers?new k(t,{...e,headers:r.headers,setViewDelay:r.setViewDelay}):new o.TileLayer(t,e),i}}}}class j extends o.TileLayer.WMS{constructor(e,t){super(e,t)}}const A=M(j);function B(e){const t=e;return[[t[3],t[0]],[t[1],t[2]]]}function N(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class R{constructor(){N(this,"options",{target:"map"}),N(this,"layerAdapters",R.layerAdapters),N(this,"controlAdapters",R.controlAdapters),N(this,"emitter",new i.EventEmitter),N(this,"map",void 0),N(this,"_resizeObserver",void 0),N(this,"_unselectCb",[]),N(this,"_universalEvents",["move","zoom","zoomend","zoomstart","moveend","movestart"]),N(this,"_positionEvents",["mousemove","mouseout","mouseover"])}create(e){if(this.options={...e},this.options.target){const{zoom:e,center:t,maxZoom:r,minZoom:i,maxBounds:s,mapAdapterOptions:n}=this.options;this.map=this.options.map||new o.Map(this.options.target,{attributionControl:!1,zoomControl:!1,maxBounds:s?B(s):void 0,maxZoom:r,minZoom:i,center:t&&[t[1],t[0]],zoom:e,...n});const a=this.map.createPane("order-0");this.map._addUnselectCb=e=>{this._addUnselectCb(e)},a.style.zIndex=String(0),this.emitter.emit("create",this),this._addMapListeners()}}destroy(){this.map&&this.map.remove(),this._stopWatchSizeChangeToUpdateMinZoom()}getContainer(){return this.map&&this.map.getContainer()}getControlContainer(){const e=this.map&&this.map._controlContainer;if(e)return e;throw new Error("Leaflet Map is not initialized yet")}setCursor(e){this.map&&(this.map.getContainer().style.cursor=e)}setView(e,t){const r=this.map;if(r)if(Array.isArray(e)){const r=e,[i,o]=r;this.map&&("number"==typeof t?this.map.setView([o,i],t,{animate:!1}):this.setCenter([i,o]))}else{const{zoom:t,center:i,maxBounds:o,bounds:s,minZoom:n,maxZoom:a}=e;if(i&&void 0!==t?this.setView(i,t):(void 0!==t&&this.setZoom(t),i&&this.setCenter(i)),s&&this.fitBounds(s),void 0!==o)if(o){const e=B(o);r.setMaxBounds(e),r.setMinZoom(r.getBoundsZoom(e)),this._watchSizeChangeToUpdateMinZoom(e)}else r.setMaxBounds(null),this._stopWatchSizeChangeToUpdateMinZoom();void 0!==a&&r.setMaxZoom(a),void 0!==n&&(this._stopWatchSizeChangeToUpdateMinZoom(),r.setMinZoom(n))}}setCenter(e){const[t,r]=e;this.map&&this.map.panTo([r,t])}getCenter(){const e=this.map;if(e){const t=e.getBounds().getCenter();return[t.lng,t.lat]}}setZoom(e){this.map&&this.map.setZoom(e)}getZoom(){var e;return null!==(e=this.map&&this.map.getZoom())&&void 0!==e?e:void 0}getBounds(){if(!this.map)return;const e=this.map.getBounds(),t=e.getSouthWest(),r=e.getNorthEast();return[t.lng,t.lat,r.lng,r.lat]}fitBounds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.map){const{maxZoom:r,offset:i,padding:o}=t,s={};r&&(s.maxZoom=r),o&&(s.padding=[o,o]),i&&(s.padding=i),this.map.fitBounds(B(e),s)}}getLayerAdapter(e){return R.layerAdapters[e]}createControl(e,t){return n(e,t,this)}createButtonControl(e){return function(e,t){const r=document.createElement("a"),i=e.title||"";r.href="#",r.title=i,r.setAttribute("role","button"),r.setAttribute("aria-label",i),e.addClass&&r.classList.add(e.addClass),o.DomEvent.disableClickPropagation(r),o.DomEvent.on(r,"click",o.DomEvent.stop),e.html instanceof HTMLElement?r.appendChild(e.html):"string"==typeof e.html&&(r.innerHTML=e.html);const s=t=>{t.stopPropagation(),e.onClick()};return n({onAdd:()=>(void 0!==e.onClick&&r.addEventListener("click",s),r),onRemove(){const t=r.parentNode;t&&t.removeChild(r),void 0!==e.onClick&&r.removeEventListener("click",s)}},{bar:!0},t)}(e,this)}addControl(e,t){if(e.options.position=t.replace("-",""),this.map)return this.map.addControl(e),e}removeControl(e){this.map&&this.map.removeControl(e)}removeLayer(e){e&&e.remove&&e.remove()}showLayer(e){this.map&&e.addTo(this.map)}hideLayer(e){e.remove()}setLayerOpacity(e,t){"setOpacity"in e&&e.setOpacity(t)}setLayerOrder(e,t,r){}onMapClick(e){const t=_(e);this.emitter.emit("preclick",t),this.emitter.emit("click",t)}locate(e,t){const r=this.map;if(r&&(r.locate(e),t)){const{locationfound:e,locationerror:i}=t,o=t=>{const r=t,i=[r.latlng.lng,r.latlng.lat];e({lngLat:i})};return void 0!==e&&r.on("locationfound",o,this),i&&r.on("locationerror",i,this),{stop:()=>{void 0!==e&&r.off("locationfound",o),i&&r.off("locationerror",i)}}}return{stop:()=>{}}}_addUnselectCb(e){for(const e of this._unselectCb)e();this._unselectCb.length=0,this._unselectCb.push(e)}_watchSizeChangeToUpdateMinZoom(e){this._stopWatchSizeChangeToUpdateMinZoom();const t=this.getContainer(),r=this.map;t&&r&&window.ResizeObserver&&(this._resizeObserver=new ResizeObserver((()=>{r.setMinZoom(r.getBoundsZoom(e))})),this._resizeObserver.observe(t))}_stopWatchSizeChangeToUpdateMinZoom(){const e=this.map;e&&e.setMinZoom(0),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0)}_addMapListeners(){const e=this.map;if(e){e.on("click",(e=>{this.onMapClick(e)}));for(const t of this._universalEvents)e.on(t,(()=>this.emitter.emit(t,this)),e);for(const t of this._positionEvents)e.on(t,(e=>this.emitter.emit(t,_(e))),e)}}}N(R,"layerAdapters",{GEOJSON:class extends g{constructor(e,t){super(e,t),P(this,"layer",void 0),P(this,"selected",!1),P(this,"type",void 0),P(this,"_layers",[]),P(this,"_events",void 0),P(this,"paint",void 0),P(this,"selectedPaint",void 0),P(this,"_selectedLayers",[]),P(this,"_filteredLayers",[]),P(this,"_filterFun",void 0),P(this,"_openedPopup",[]),P(this,"_paint",void 0),P(this,"$updateTooltip",(0,a.D)((()=>{this.updateTooltip()}),300)),P(this,"$unselect",(()=>{this.unselect()})),this._events=new w(this),this._paint=new O(this)}addLayer(e){return Object.assign(this.options,e),this.paint=e.paint,this.layer=new o.FeatureGroup([],{...e.nativeOptions,pane:this.pane}),this.selectedPaint=e.selectedPaint,e.paint=this.paint,e.data&&this.addData(e.data),this._addMapListener(),this.layer}beforeRemove(){this._removeMapListener()}select(e){if(this.unselect(),e){const t=this._layers.filter(e);for(const e of t)this._selectLayer(e,"api")}else this.selected||(this.selected=!0,this.selectedPaint&&this._paint.setPaintEachLayer(this.selectedPaint))}unselect(e){if(e)this._layers.filter(e).forEach((e=>{this._unSelectLayer(e)}));else if(this.selected){for(const e of this._openedPopup)this._removePopup(e[0]);this.paint&&this._paint.setPaintEachLayer(this.paint),this._selectedLayers.length=0,this.selected=!1}}getSelected(){return this._selectedLayers.map((e=>({target:this,feature:e.feature,layer:e,...y(e.feature)})))}getFiltered(){return this._filteredLayers}filter(e){this._filterFun=e;const t=this.layer,r=t&&t._map;if(t&&r){t.remove();const i=[];this._layers.forEach((r=>{let{feature:o,layer:s}=r;s&&(!e||e({target:this,feature:o,layer:s,...y(o)})?(t.addLayer(s),i.push({target:this,feature:o,layer:s,...y(o)})):t.removeLayer(s))})),this._filteredLayers=i,t.addTo(r)}return this._filteredLayers}cleanFilter(){this.filter()}getLayers(){return this._layers.map((e=>{let{layer:t,feature:r}=e;return{feature:r,layer:t,visible:t&&!!t._map,target:this,...y(r)}}))}clearLayer(e){this.unselect();const t=this.layer;if(t)if(e)for(let r=this._layers.length;r--;){const i=this._layers[r];if(i){const{feature:o,layer:s}=i;o&&s&&e(o)&&(t.removeLayer(s),this._layers.splice(r,1))}}else t.clearLayers(),this._layers=[]}setData(e){this.clearLayer(),this.addData(e)}addData(e){const t=this.options;let r;if(t){if(e){let i;if(t.type)i=t.type;else{const t=function(e){let t;return t="FeatureCollection"===e.type?u(e.features.map((e=>e.geometry.type))):"GeometryCollection"===e.type?u(e.geometries.map((e=>e.type))):"Feature"===e.type?e.geometry.type:e.type,t}(e);i=p[t]}if(this.type&&this.type!==i)return void console.warn("no other data type than layer can be added");this.type=i,e=function(e,t){if("FeatureCollection"===e.type){const r=e;r.features=r.features.filter((e=>m(e.geometry.type,t)))}else if("Feature"===e.type){if(!m(e.geometry.type,t))return!1}else if("GeometryCollection"===e.type){const r=e;r.geometries=r.geometries.filter((e=>m(e.type,t)))}return e}(e,i),e&&(r=this._getGeoJsonOptions(t,i))}new o.GeoJSON(e||void 0,r)}}openPopup(e,t){e&&this._layers.filter(e).forEach((e=>{this._openPopup(e,t,"api")}))}closePopup(e){(e?this._openedPopup.filter((t=>e(t[2]))):this._openedPopup).forEach((e=>{this._removePopup(e[0])}))}updateTooltip(e){e?this._updateTooltip(e):this.getLayers().forEach((e=>this._updateTooltip({feature:e.feature,layer:e.layer})))}getExtent(){return this.getBounds()}getBounds(){if(this.layer){const e=this.layer.getBounds();if(e.isValid())return l(e)}}setOpacity(e){this.options.opacity=e,this.setPaint(this.paint),this.setSelectedPaint(this.selectedPaint)}setPaint(e){if(e){this.paint=e;for(const t of this._layers)this._paint.setPaint(t,e)}}setSelectedPaint(e){if(e){this.selectedPaint=e;for(const t of this._selectedLayers)this._paint.setPaint(t,e)}}updatePaint(e){this.paint={...this.paint,...e};for(const e of this._layers)this._paint.setPaint(e,this.paint)}updateSelectedPaint(e){this.selectedPaint={...this.selectedPaint,...e};for(const e of this._selectedLayers)this._paint.setPaint(e,this.selectedPaint)}_getSelected(e){return this._selectedLayers.find((t=>t.layer===e))}_updateTooltip(e){const{feature:t,layer:r}=e,{label:i,labelField:o,labelOnHover:s}=this.options;if(r){let n;if(r.unbindTooltip(),t.properties&&o?n=t.properties[o]:i&&(n=i({target:this,...e,...y(t)})),n){const e=!s;r.bindTooltip(String(n),{permanent:e,sticky:!1})}}}async _openPopup(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;const{feature:o,layer:s}=e,{minWidth:n,autoPan:a,maxWidth:l,closeButton:u}={minWidth:300,...t},p=null!=u?u:!this.options.selectOnHover;let h;const d=[],m=()=>{h&&this._removePopup(h)};let f;if(f=t.createPopupContent?await t.createPopupContent({layer:s,feature:o,target:this,type:r,close:m,onClose:e=>{d.push(e)},...y(o)}):t.popupContent,f&&s){var v,g;const t={minWidth:n,autoPan:a,closeButton:p,closeOnClick:!1,autoClose:!1};if((0,c.r)(l)&&(t.maxWidth=l),h=s.bindPopup(f,t),null===(v=null===(g=this.options.popupOptions)||void 0===g?void 0:g.unselectOnClose)||void 0===v||v){const e=s.getPopup();e&&e.once("remove",(()=>{m()}),this)}this._openedPopup.push([h,d,e]),h.openPopup(i)}}_removePopup(e){if(this.map){e.closePopup().unbindPopup();const i=this._openedPopup.findIndex((t=>t[0]===e));if(-1!==i){var t,r;const e=null===(t=null===(r=this.options.popupOptions)||void 0===r?void 0:r.unselectOnClose)||void 0===t||t,[,o,s]=this._openedPopup[i];for(const e of o)e(s);o.length=0,e&&this._unSelectLayer(s),this._openedPopup.splice(i,1)}}}_getGeoJsonOptions(e,t){const r=e.paint;let i={};return"function"==typeof r?"point"===t?i.pointToLayer=(e,t)=>{const i=r(e);return this._paint.createPaintToLayer(i)(e,t)}:i={style:e=>e?this._paint.preparePaint({...h,...r(e)}):this._paint.preparePaint({...h,type:"path"})}:i=this._paint.createPaintOptions(r),i.onEachFeature=(e,t)=>{this._onEachFeature(e,t)},i}_onEachFeature(e,t){const r=this.layer;if(r){const i={target:this,feature:e,layer:t,...y(e)};t.options.pane=this.pane,this._layers.push(i);let o=!0;if(this._filterFun&&(o=this._filterFun(i)),o){const{popup:o,popupOptions:s,selectable:n,interactive:a,selectOnHover:l}=this.options;t.options.interactive=!(0,c.r)(a)||a,r.addLayer(t),n&&(l?(t.on("mouseover",(()=>{this._selectLayer(i,"hover")})),t.on("mouseout",(()=>{this._unSelectLayer(i)}))):t.on("click",(e=>this._selectOnLayerClick(e)),this)),this._events.handleMouseEvents(t),setTimeout((()=>{o&&this._openPopup({target:this,layer:t,feature:e,...y(e)},s,"api"),this._updateTooltip({layer:t,feature:e})}))}}}_selectOnLayerClick(e){o.DomEvent.stopPropagation(e);const t=e.target,r=t.feature,i={target:this,layer:t,feature:r,...y(r)},s=this._getSelected(t);s?this.options&&this.options.unselectOnSecondClick&&this._unSelectLayer(s):this._selectLayer(i,"click",e.latlng)}_selectLayer(e,t,r){const{multiselect:i}=this.options;i||(this.map._addUnselectCb((()=>{this._unSelectLayer(e)})),this._selectedLayers.forEach((e=>this._unSelectLayer(e)))),this._selectedLayers.push(e),this.selected=!0;const{selectedPaint:o,popupOnSelect:s,popupOptions:n}=this.options;if(o&&e.layer&&this._paint.setPaint(e,o),s&&this._openPopup(e,n,t,r),this.options.onSelect){const r=e.feature?[e.feature]:[];this.options.onSelect({type:t,layer:this,features:r,...y(r)})}}_unSelectLayer(e){const t=this._selectedLayers.indexOf(e);-1!==t&&(this._selectedLayers.splice(t,1),this.options&&(this.options.paint&&this._paint.setPaint(e,this.options.paint),this.options.popupOnSelect&&e.layer&&this._removePopup(e.layer))),this.selected=this._selectedLayers.length>0}_addMapClickListener(){const e=this.map;if(e){const{unselectOnClick:t}=this.options;(null==t||t)&&e.on("click",this.$unselect)}}_removeMapClickListener(){this.map.off("zoomend",this.$updateTooltip),this.map.off("moveend",this.$updateTooltip),this.map.off("click",this.$unselect)}_addMapListener(){const e=this.map;if(e){const{label:t,labelField:r,labelOnHover:i}=this.options;this._addMapClickListener(),!r&&!t||i||(e.on("zoomend",this.$updateTooltip),e.on("moveend",this.$updateTooltip))}}_removeMapListener(){this._removeMapClickListener(),this.map.off("zoomend",this.$updateTooltip),this.map.off("moveend",this.$updateTooltip)}},IMAGE:class extends g{constructor(){var e,t,r,i;super(...arguments),e=this,r=void 0,(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t="layer"))?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}addLayer(e){const t=e&&e.url;if(t){const r=(e={transparent:!0,...e}).updateWmsParams;if(this.layer=new E(t,{pane:this.pane,headers:e.headers,setViewDelay:e.setViewDelay,...e,...e.params,...e.nativeOptions}),r){const e=this.layer.updateWmsParams;this.layer.updateWmsParams=function(t){e.call(this,t),this.wmsParams=r(this.wmsParams)}}return this.layer}}},TILE:T,WMS:class extends g{addLayer(e){Object.assign(this.options,e);const{url:t,...r}=e;if(t){const i={pane:this.pane,attribution:r.attribution,minZoom:r.minZoom,maxZoom:r.maxZoom,layers:e.layers,format:e.format,...e.nativeOptions};let s;return s=r.headers?new A(t,{...i,headers:r.headers}):new o.TileLayer.WMS(t,i),s}}},OSM:class extends T{addLayer(e){return super.addLayer({name:"OpenStreetMap",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',...e,url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"})}}}),N(R,"controlAdapters",{ZOOM:o.Control.Zoom,ATTRIBUTION:s}),N(R,"Map",o.Map);const Z=R},5360:(e,t,r)=>{r.d(t,{Ct:()=>y,Jx:()=>d,Ok:()=>p,_R:()=>h,v2:()=>u}),r(6265),r(7267);var i=r(1521),o=r(8133),s=r(8651),n=r(1895),a=r(1088),c=r(3123),l=r(584);const u={srs:4326,geom_format:"geojson"};function p(e){return{geometry:e.geom,id:e.id,type:"Feature",properties:e.fields}}function h(e,t){const{extensions:r,geom:i,fields:o,srs:n,ilike:a,like:c}=t,l=r?r.join(","):"";"*"!==l&&(e.extensions=l),void 0!==o&&(e.fields=Array.isArray(o)?o.join(","):""),void 0!==i&&(e.geom=i?"yes":"no",i||(delete e.srs,delete e.geom_format)),(0,s.r)(a)?e.ilike=a:(0,s.r)(c)&&(e.like=c),(0,s.r)(n)&&(e.srs=n)}function d(e){const t=f(e);return i.Z.all(t).then((t=>{const r=[],i=[];for(const e of t)for(const t of e)r.includes(t.id)||(i.push(t),r.push(t.id));const o=void 0!==e.offset?e.offset:0,s=void 0!==e.limit?e.limit:i.length;return e.offset||e.limit?i.splice(o,s):i}))}function m(e){const[t,r,i]=e,o="id"!==t?"fld_":"";let s="",n="";const a=String(t).trim().replace(/^(%?)(.+?)(%?)$/,((e,t,r,i)=>(s=t,n=i,r))),c=s+i+n;return["".concat(o).concat(a,"__").concat(r),c]}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const{filters:i}=e,s="string"==typeof i[0]?i[0]:"all",n=i.filter((e=>Array.isArray(e)));if("any"===s)for(const i of n)(0,o.aN)(i)?t.push(y({...e,paramList:[...r,m(i)]})):f({...e,filters:i},t,[...r]);else if("all"===s){const i=[],s=[];for(const e of n)(0,o.aN)(e)?i.push(m(e)):s.push(e);if(s.length)for(const o of s)f({...e,filters:o},t,[...r,...i]);else t.push(y({...e,paramList:[...r,...i]}))}return t}function y(e){const t={...u},{limit:r,cache:i,signal:o,offset:s,orderBy:p,paramList:d,connector:m,geomFormat:f,intersects:y,resourceId:v}=e;if(r?r!==Number.POSITIVE_INFINITY&&(t.limit=r):t.limit=7e3,s&&(t.offset=s),f&&(t.geom_format=f),h(t,e),p&&(t.order_by=p.join(",")),Array.isArray(y)){const e=(0,c.T)(y)?(0,l.dy)(y):y;t.intersects=function(e){const t=e.map((e=>{let[t,r]=e;const[i,o]=(0,n.Qm)(t,r).map((e=>(0,a.N)(e)));return i+" "+o}));return"POLYGON((".concat(t.join(", "),"))")}(e)}else"string"==typeof y&&(t.intersects=y);d&&(t.paramList=d);const g={id:v,...t};return m.get("feature_layer.feature.collection",{cache:i,signal:o},g)}},9528:(e,t,r)=>{r.d(t,{n:()=>a});var i=r(8133),o=r(2476),s=r(5360),n=r(8948);function a(e){const t=e.filters;return t?(0,s.Jx)({...e,filters:t}).then((r=>{var o;return(null!==(o=e.clientFilterValidate)&&void 0!==o?o:c(t))&&(r=r.filter((e=>{const r=(0,n.f)({...e.fields,id:e.id});return(0,i.Ml)(r,t)}))),r})):(0,s.Ct)(e)}function c(e){if("any"===e[0])return!0;for(let t=1;t<e.length;t++){const r=e[t];if((0,o.kJ)(r)&&c(r))return!0}return!1}},8948:(e,t,r)=>{r.d(t,{f:()=>s}),r(6265);var i=r(2476),o=r(8651);function s(e){let t;for(t in e){const r=e[t];if((0,i.Kn)(r)){const i=r;if((0,o.r)(i.year)&&(0,o.r)(i.month)&&(0,o.r)(i.day)){const r=[i.year,i.month-1,i.day];"hour"in i&&[i.hour,i.minute,i.second].forEach((e=>{r.push(e)})),e[t]=new Date(...r).toISOString()}}else"id"===t&&"string"==typeof r&&(e[t]=r.split(",").map(Number))}return e}},732:(e,t,r)=>{r.d(t,{Z8:()=>nt}),r(6265);var i=r(7187),o=r(1521),s=r(8651),n=r(2476),a=r(1827),c=r(8786),l=r(9528),u=r(77),p=r(5360);function h(e){const t={...p.v2};(0,p._R)(t,e);const r={id:e.resourceId,fid:e.featureId,...t},i=e.cache||!0;return e.connector.get("feature_layer.feature.item",{cache:i},r).then((t=>({...t,toGeojson:()=>t.geom?o.Z.resolve((0,p.Ok)(t)):h({...e,geom:!0,fields:null,extensions:null}).then((e=>{const r=e.geom;return(0,p.Ok)({...t,geom:r})}))})))}function d(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class m{constructor(e){this.options=e,d(this,"name",void 0),d(this,"resourceId",void 0),d(this,"item",void 0),d(this,"_extent",void 0),this.resourceId=e.resourceId;const t=e.item;this.item=t,e.labelField&&t.fields?this.name=t.fields[e.labelField]:this.name=String(t.id)}extent(){return this._extent?o.Z.resolve(this._extent):this.options.connector.get("feature_layer.feature.item_extent",null,{id:this.resourceId,fid:this.item.id}).then((e=>{const{minLat:t,minLon:r,maxLat:i,maxLon:o}=e.extent,s=[r,t,o,i];return this._extent=s,s}))}geoJson(){return this.item.geom?o.Z.resolve((0,p.Ok)(this.item)):h({resourceId:this.resourceId,featureId:this.item.id,connector:this.options.connector,geom:!0,fields:null,extensions:null}).then((e=>{const t=e.geom;return this.item.geom=t,(0,p.Ok)(this.item)}))}}var f,y,v,g,_=r(8133);function b(e,t,r,i){return!!O(e,t,r,P,i)}function w(e,t,r,i){return O(e,t,r,I,i)}function L(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"children",r=[];const i=("function"==typeof t?t:e=>e[t])(e);return i&&(Array.isArray(i)?r=i:r.push(i)),i?r:void 0}function O(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>!!e,r=arguments.length>4?arguments[4]:void 0;const i="function"==typeof t?t:e=>(0,_.Ml)(e,t);return(arguments.length>3?arguments[3]:void 0)(e,r?e=>i(r(e)):i,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"children")}function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>!!e,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=[];if(Array.isArray(e))o=e;else{if(t(e))return e;const i=L(e,r);i&&(o=i)}for(let e=0;e<o.length;e++)if(o[e]){const s=P(o[e],t,r,i);if(s)return s}}function I(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>!!e,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=[];if(Array.isArray(e))o=e;else{t(e)&&i.push(e);const s=L(e,r);s&&(o=s)}for(let e=0;e<o.length;e++)o[e]&&I(o[e],t,r,i);return i}function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>!!e,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=[];if(Array.isArray(e))o=e;else{if(!t(e))return!1;const i=L(e,r);i&&(o=i)}for(let e=0;e<o.length;e++)if(o[e]&&!S(o[e],t,r,i))return!1;return!0}function x(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class E{constructor(e){x(this,"item",void 0),x(this,"_children",[]),x(this,"_parent",void 0),this.item=e}setParent(e){this._parent=e}addChild(e){this._children.push(e)}getParent(){return this._parent}getParents(e){const t=this.getParent();return t?w(t,e,(e=>e.tree.getParent())):[]}getRoot(){let e=this.getParent(),t=e;for(;e;)e=e.tree.getParent(),e&&(t=e);return t}find(e){return O(this._children,e,(e=>e.tree.getChildren()),P,undefined)}every(e){return!!O(this._children,e,(e=>e.tree.getChildren()),S,undefined)}some(e){return b(this._children,e,(e=>e.tree.getChildren()))}all(e){return this.getDescendants(e)}getDescendants(e){return w(this._children,e,(e=>e.tree.getChildren()))}getChildren(){return[...this._children]}}function M(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class C{constructor(e,t,r){M(this,"options",void 0),M(this,"emitter",new i.EventEmitter),M(this,"name",void 0),M(this,"item",void 0),M(this,"_blocked",!1),M(this,"_container",void 0),M(this,"_value",void 0),M(this,"_removeEventsListener",void 0),this.item=t,this.options=Object.assign({},r),this.name=e,this._value=this.getProperty()}getProperty(){return"function"==typeof this.options.getProperty?this.options.getProperty.call(this,this.item):this.options.value}getParents(){return this.item.tree.getParents()||[]}getParent(){return this.item.tree.getParent()}getChildren(){return this.item.tree.getChildren()}isGroup(){return this.item.tree.getDescendants().length}isBlocked(){if(void 0!==this._blocked)return this._blocked;const e=this.item.tree.getParents();return this._blocked=this._calculateBlockedStatus(e),this._blocked}set(e,t){this._value=this._prepareValue(e),this.update(this._value,t),this._fireChangeEvent(this._value,t)}get(){return this.getValue()}update(e,t){this._callOnSet(e,t)}getContainer(){return this._container}destroy(){if(this._container){const e=this._container.parentNode;e&&e.removeChild(this._container)}this._removeEventsListener&&this._removeEventsListener()}getValue(){return void 0!==this._value?this._value:this.getProperty()}_prepareValue(e){return e}_callOnSet(e,t){this.options.onSet&&this.options.onSet.call(this,e,t,this.item)}_fireChangeEvent(e,t){this.emitter&&(e=void 0!==e?e:this.getValue(),this.emitter.emit("change",{value:e,options:t}),this.item.tree.getParents().forEach((r=>{const i=r.properties&&r.properties.property(this.name);i&&i.emitter.emit("change-tree",{value:e,options:t,item:this.item})})))}_calculateBlockedStatus(e){return e.some((e=>{var t;const r=null===(t=e.properties)||void 0===t?void 0:t.property(this.name);return!!r&&!r.get()}))}}class k extends C{constructor(e,t,r){super(e,t,{...k.options,...r}),this.set(this.get())}update(e,t){if(e){if(t&&t.bubble||this.options.bubble){this.unBlock(t);const r=this.getParent(),i=r&&r.properties&&r.properties.property(this.name);i&&i.set(e,Object.assign({},t,{bubble:!0,propagation:!1}))}this.isBlocked()||this._turnOn(t)}else this._turnOff(t);(t&&t.propagation||this.options.propagation)&&this._propagation(e,t)}getHierarchyValue(){return this.get()&&this.getParents().every((e=>{const t=e.properties&&e.properties.get(this.name);return t&&t.get()}))}block(e){this._blocked=!0,this._block(e)}unBlock(e){this._blocked=!1,this.getValue()&&this._unBlock(e)}blockChild(e){this.item.tree.getDescendants().forEach((t=>this._blockChild(t,e)))}unblockChild(e){this.item.tree.getChildren().forEach((t=>this._unBlockChild(t,e)))}_prepareValue(e){return e}_turnOff(e){this.options.turnOff&&this.options.turnOff.call(this,e),this._callOnSet(!1,e),this.options.hierarchy&&this.isGroup()&&this.blockChild(e)}_turnOn(e){this.options.turnOn&&this.options.turnOn.call(this,e),this._callOnSet(!0,e),this.options.hierarchy&&this.isGroup()&&this.unblockChild(e)}_block(e){this._turnOff(e)}_unBlock(e){this._turnOn(e)}_blockChild(e,t){const r=e.properties&&e.properties.property(this.name);r&&r.block&&r.block(t)}_unBlockChild(e,t){const r=e.properties&&e.properties.property(this.name);r&&r.unBlock&&r.unBlock(t)}_propagation(e,t){if(this.isGroup()){const r=this.item.tree.getChildren();for(let i=0;i<r.length;i++){const o=r[i],s=o.properties&&o.properties.property(this.name);s&&s.set(e,{...t,propagation:!0,bubble:!1})}}}}function T(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}f=k,v={hierarchy:!0,bubble:!1,propagation:!1,label:"Toggle"},(y="symbol"==typeof(g=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(y="options"))?g:String(g))in f?Object.defineProperty(f,y,{value:v,enumerable:!0,configurable:!0,writable:!0}):f[y]=v;class j{constructor(e,t){this.item=e,T(this,"options",{}),T(this,"_properties",{}),T(this,"_propertiesList",[]),t&&t.forEach(this._setPropertyHandler.bind(this))}add(e){this._setPropertyHandler(e)}update(){this.list().forEach((e=>e.update()))}get(e){const t=this.property(e);return t?t.get():void 0}set(e,t,r){const i=this.property(e);i&&i.getValue()!==t&&i.set(t,r)}property(e){return this._properties[e]}list(){return this._propertiesList.map((e=>this._properties[e]))}destroy(){for(const e in this._properties){const t=this.property(e);t&&t.destroy&&t.destroy()}this._properties={},this._propertiesList=[]}_setPropertyHandler(e){const t=this._getHandler(e);if(t&&e.name){const r={...e};this._properties[e.name]=new t(e.name,this.item,r),this._propertiesList.push(e.name)}}_getHandler(e){const t=e.handler;return!t&&e.type?"boolean"===e.type?j.handlers.CheckProperty:j.handlers.BaseProperty:t}}function A(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}T(j,"handlers",{CheckProperty:k});let B=0;class N{constructor(e){A(this,"options",{}),A(this,"properties",void 0),A(this,"tree",void 0),A(this,"id",B),B+=1,this.options={...e},this.tree=new E(this)}initProperties(){this.properties=new j(this,this.options.properties)}}function R(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Z extends N{constructor(e,t,r,o,s,n){if(super({...Z.options,...r}),this.webMap=e,R(this,"item",void 0),R(this,"connector",void 0),R(this,"layer",void 0),R(this,"emitter",new i.EventEmitter),R(this,"_rootDescendantsCount",0),o&&(this.connector=o),s&&this.tree.setParent(s),this.item=t,"root"===this.item.item_type)this._rootDescendantsCount=this._sumUp(this.item.children);else{const e=this.tree.getRoot();e&&(this._rootDescendantsCount=e._rootDescendantsCount)}this.initProperties(),n||this._init(t)}static async create(e,t,r,i,o){const s=new Z(e,t,r,i,o,!0);return await s._init(t),s}initItem(e){return"group"===e.item_type||"root"===e.item_type?this.initGroupItem(e):this.initLayerItem(e)}bringToFront(){}fit(){this.item.item_type}getLayer(){return this.layer}async getLegend(e){var t;const r=null===(t=this.layer)||void 0===t?void 0:t.id;if(void 0!==r){const t=this.connector;if(t)return[{layerId:r,legend:(await t.get("render.legend_symbols",{params:{id:this.item.resourceId},cache:!0,...e})).map((e=>{let{display_name:t,icon:r}=e;return{name:t,symbol:r}}))}]}return[]}getItemOptions(e){const t="layer"===e.item_type&&e.layer_transparency,r="number"==typeof t?(100-t)/100:void 0,i={visibility:!1,name:e.display_name,headers:this.options.headers,crossOrigin:this.options.crossOrigin,setViewDelay:this.options.setViewDelay,params:{resource:this.item.resourceId,item:this.item}};if(this.options.order){const t=this.options.drawOrderEnabled&&"draw_order_position"in e?this._rootDescendantsCount-e.draw_order_position:this.id,r=String(t).padStart(4,"0");i.order=Number((0|this.options.order)+"."+r)}if(this.options.popupOptions&&(i.popupOptions=this.options.popupOptions),"layer"===e.item_type){const{maxZoom:t,minZoom:r}=this._getZoomRange(e);Object.assign(i,{updateWmsParams:e.updateWmsParams,url:e.url,headers:this.options.headers,ratio:this.options.ratio,maxZoom:t,minZoom:r,minScale:e.layer_min_scale_denom,maxScale:e.layer_max_scale_denom,interactive:e.layer_identifiable})}return void 0!==r&&(i.opacity=r),i}getChildren(e){return[...e.children].reverse()}_mapScaleToZoomLevel(e){return function(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=function(){if(void 0===be){const e=document.createElement("div");e.style.cssText="position: absolute;  left: -100%;  top: -100%;  width: 100cm;",document.body.appendChild(e);const t=e.offsetWidth;document.body.removeChild(e),be=t}return be}()*function(e){return 12756274*Math.PI*Math.cos(e*Math.PI/180)}(t)/e;return function(e){return Math.log(e/256)/Math.LN2}(r)}(e)}initGroupItem(e){if(e.children&&e.children.length){const t=this.getChildren(e);for(const e of t){const t=new this.constructor(this.webMap,e,this.options,this.connector,this);this.tree.addChild(t)}}return Promise.resolve()}initLayerItem(e){const t=this.getItemOptions(e),r=r=>{e._layer=r,this.layer=r,this.properties.get("visibility")&&this.properties.set("visibility",!0),void 0!==t.opacity&&this.webMap.setLayerOpacity(r,t.opacity)};let i;return"layer"===e.item_type?i=e.adapter||e.layer_adapter.toUpperCase():Z.GetAdapterFromLayerType[e.item_type]&&(i=(0,Z.GetAdapterFromLayerType[e.item_type])(e,t,this.webMap,this.connector)),i?this.webMap.addLayer(i,t).then((e=>{r(e)})):e._layer?Promise.resolve(r(e._layer)):Promise.reject("No layer added")}_getZoomRange(e){const t=this.options.minZoom,r=this.options.maxZoom,i=e.layer_min_scale_denom?this._mapScaleToZoomLevel(e.layer_min_scale_denom):void 0,o=e.layer_max_scale_denom?this._mapScaleToZoomLevel(e.layer_max_scale_denom):void 0,s=[t,i].filter(Boolean),n=[r,o].filter(Boolean);return{minZoom:s.length?Math.max(...s):void 0,maxZoom:n.length?Math.min(...n):void 0}}_init(e){this.initItem(e).then((()=>{this.emitter.emit("init")}))}_sumUp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(const r of e)"layer"===r.item_type?(t+=1,r.draw_order_position=r.draw_order_position||t):"group"===r.item_type&&(t=this._sumUp(r.children,t));return t}}R(Z,"GetAdapterFromLayerType",{}),R(Z,"options",{properties:[{type:"boolean",name:"visibility",getProperty(e){if(e){if("group"===e.item.item_type||"root"===e.item.item_type)return b(e.item,(e=>"layer_enabled"in e&&e.layer_enabled),(e=>e.children));if("layer"===e.item.item_type)return e.item.layer_enabled}return!1},onSet(e,t,r){r&&"layer"===r.item.item_type&&(r.layer&&(e?r.webMap.showLayer(r.layer):r.webMap.hideLayer(r.layer)),r.item.layer_enabled=e)}},{name:"opacity",handler:class extends C{getProperty(){const e=this.item.layer;return e&&e&&e.options&&void 0!==e.options.opacity?e.options.opacity:1}update(e,t){if(t=t||{},this.isGroup()){this._value=this._prepareValue(e,t);const r=this.getChildren();for(const i of r){const r=i.properties.property(this.name);r&&(t.propagation?r.set(e,t):r.update(r.get(),t))}}const r=this.item.layer;if(r){const t=e*this.getParents().reduce(((e,t)=>{const r=t.properties.property(this.name);return e*(r?r.getValue():1)}),1);this.item.webMap.setLayerOpacity(r,this._prepareValue(t))}}_prepareValue(e,t){return t&&t.propagation&&this.isGroup()?1:Number(e)}}}]});var F=r(4019);function U(e){const t=e.extent_bottom,r=e.extent_left,i=e.extent_top,o=e.extent_right;if(t&&r&&i&&o){const e=[r,t,o,i];return e[3]>82&&(e[3]=82),e[1]<-82&&(e[1]=-82),e}}function D(e){let{resourceId:t,connector:r,cache:i=!0}=e;return r.get("layer.extent",{cache:i},{id:t}).then((e=>{if(e){const{maxLat:t,maxLon:r,minLat:i,minLon:o}=e.extent;return[o,i,r,t]}}))}function q(e){return e.connector.getResource(e.resourceId).then((t=>{if(t)return z(t,e.connector,e)}))}function z(e,t,r){if(e.webmap)return o.Z.resolve(U(e.webmap));{const i=e.resource;return i.cls&&-1!==i.cls.indexOf("style")?t.getResource(i.parent.id).then((e=>{if(e)return D({...r,resourceId:e.resource.id,connector:t})})):D({...r,resourceId:i.id,connector:t})}}function G(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class V{constructor(){G(this,"item",void 0),G(this,"connector",void 0),G(this,"_extent",void 0)}async getExtent(){return this.getBounds()}async getBounds(e){return this._extent?this._extent:this.item?(this._extent=await z(this.item,this.connector,e),this._extent):void 0}}async function W(e,t){const r=e.resource,i=r;let{keyname:o,resourceId:s}=e;if(r&&("string"==typeof r?o=r:s="number"==typeof r?r:i.resource&&void 0!==i.resource&&"resource"in i?r.resource.id:await W(r,t)),!s&&o){const e=await t.getResource(o);e&&(s=e.resource.id)}return s}r(7267);const $={tms:"TILE"};function H(e){const t=("https:"===location.protocol?"https":"http")+"://";let r=e.url.replace(/^(https?|ftp):\/\//,t);return e.y_origin_top||(r=r.replace("{y}","{-y}")),{url:r,name:e.name,attribution:e.copyright_text,maxZoom:e.z_max,minZoom:e.z_min}}function J(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Q="https://qms.nextgis.com";function Y(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("webMap"in e){const{webMap:o,url:s,...n}=e;t=o,s&&(r=s),n&&(i=n)}else t=e;r||(r=Q);class o{constructor(e,t){J(this,"qms",void 0),J(this,"options",void 0),J(this,"map",void 0),this.map=e;const r={...i,...t};this.options=r,this.options.baselayer=!0,r.qms&&(this.qms=r.qms)}async addLayer(e){if(!this.qms&&e.qmsId)try{this.qms=await function(e){return new Promise(((t,r)=>{const i=new XMLHttpRequest;i.onreadystatechange=()=>{if(4===i.readyState&&200===i.status&&i.responseText)try{t(JSON.parse(i.responseText))}catch(e){r(e)}},i.open("GET",(0,u.n)(e),!0),i.send()}))}(r+"/api/v1/geoservices/"+e.qmsId)}catch(e){console.error(e)}const i=this.qms;if(i){const r=$[i.type||"tms"],s=t.mapAdapter.layerAdapters[r];if(s&&((0,F.FR)(o,s,["showLayer","hideLayer"]),"TILE"===r)){if(e={order:0,maxZoom:t.options.maxZoom,minZoom:t.options.minZoom,...this.options,...H(i)},i.origin_url){const[t,r]=function(e){const t=[];return[e=e.replace(/{switch:(.*?)}/,((e,r)=>("string"==typeof r&&r.split(",").forEach((e=>t.push(e))),"{s}"))),t]}(i.origin_url);r.length&&(e.subdomains=r,e.url=t)}return this.options=e,new s(this.map,e).addLayer(e)}}}}return o}function X(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class K{constructor(e){X(this,"options",{url:"https://qms.nextgis.com"}),X(this,"url",void 0),this.options={...this.options,...e},this.url=this.options.url}getLayerAdapters(){return Promise.resolve([{name:"QMS",createAdapter:e=>Promise.resolve(this._createAdapter(e))}])}_createAdapter(e){return Y({webMap:e,url:this.url})}}X(K,"utils",{createQmsAdapter:Y});var ee=r(7450);function te(e){return function(e){return(0,l.n)(e).then((e=>{const t=[];return e.forEach((e=>{t.push((0,p.Ok)(e))})),t}))}(e).then((e=>({type:"FeatureCollection",features:e})))}const re=["fields","intersects","limit","orderBy","strategy"];function ie(e){const t={};return re.forEach((r=>{const i=e[r];void 0!==i&&(t[r]=i)})),t}var oe=r(8948);function se(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}async function ne(e){var t;const{item:r,webMap:o,Adapter:s,connector:n,layerOptions:a,addLayerOptionsPriority:c}=e,l=null==c||c,u=a,p=s||o.mapAdapter.layerAdapters.GEOJSON,h=[];let d,m,f=!1;const y=await W(u,n);null!==(t=u.adapterOptions)&&void 0!==t&&null!==(t=t.popupOptions)&&void 0!==t&&t.fromProperties&&(u.adapterOptions.popupOptions.createPopupContent=e=>{let{feature:t}=e;return t&&function(e,t){{const r=document.createElement("div");if(t&&t.feature_layer)t.feature_layer.fields.forEach((t=>{if(t.grid_visibility){const i=e.properties&&e.properties[t.keyname];if(i){const e=document.createElement("div");r.appendChild(e),e.innerHTML="<span>".concat(t.display_name,"</span>: ").concat(i,"<span></span>")}}}));else if(e.properties)for(const t in e.properties){const i=document.createElement("div");r.appendChild(i),i.innerHTML="<span>".concat(t,"</span>: ").concat(e.properties[t],"<span></span>")}return r}}(t,r)});const v=async(e,t)=>(b(),d={filters:e,options:t},m=te({resourceId:y,filters:e,connector:n,cache:!0,...t}),await m);let g=!1;const b=()=>{m&&(m.cancel(),m=void 0)};return class extends p{constructor(){super(...arguments),se(this,"emitter",new i.EventEmitter),se(this,"__onMapMove",void 0),se(this,"__onMapMoveStart",void 0),se(this,"__enableMapMoveListener",void 0),se(this,"__disableMapMoveListener",void 0)}async addLayer(e){let t=!e.data;const i=void 0===e.waitFullLoad||e.waitFullLoad;void 0!==u.id&&(e.id=u.id),r&&r.vector_layer&&(e.type=_e[r.vector_layer.geometry_type]),u.adapterOptions&&(e=l?{...u.adapterOptions,...e}:{...e,...u.adapterOptions}),e.data&&0===Object.keys(e.data).length&&(e.data=void 0,t=!1);const o=e.strategy||void 0;this.options.strategy=o;const s=super.addLayer(e);let n;return d={filters:e.propertiesFilter,options:ie(e)},t&&(n=this.updateLayer()),i&&n&&await n,o&&o.startsWith("BBOX")&&!f&&this._addBboxEventListener(),s}getExtent(){return this.getBounds()}async getBounds(){const e=this.getLayers&&this.getLayers().length,t=this.options.strategy;return null!=t&&t.startsWith("BBOX")||e?q({connector:n,resourceId:r.resource.id}):super.getBounds?super.getBounds():void 0}beforeRemove(){g=!0,this._removeMoveEventListener(),this._removeBboxEventListener(),this.__disableMapMoveListener=void 0,this.__enableMapMoveListener=void 0,this.__onMapMove=void 0,this.__onMapMoveStart=void 0,b()}getCount(){return function(e){let{connector:t,resourceId:r,cache:i=!0}=e;return t.get("feature_layer.feature.count",{cache:i},{id:r}).then((e=>e.total_count))}({connector:n,resourceId:y,cache:!0})}async updateLayer(e){var t;if(e=e||d||{},null!==(t=this.options.strategy)&&void 0!==t&&t.startsWith("BBOX")){await o.onLoad("create"),e.options=e.options||{},e.options.intersects=o.getBounds();const{minZoom:t,maxZoom:r}=this.options,i=o.getZoom();if(void 0!==i){if(void 0!==t&&i<t)return;if(void 0!==r&&i>r)return;if(f)return}}if(!g){try{this.emitter.emit("preupdate",e),o._emitLayerEvent("layer:preupdate",u.id||"",e);const t=await v(e.filters,{...e.options,srs:this.options.srs});let r=t;const i=await this.getCount();if("BBOX+"===this.options.strategy){r={type:"FeatureCollection",features:[]};for(const e of t.features)-1===h.indexOf(String(e.id))&&(h.push(String(e.id)),r.features.push(e));f=void 0!==i&&h.length>=i,await o.addLayerData(this,r)}else f=void 0!==i&&t.features.length>=i,await o.setLayerData(this,t);this.emitter.emit("updated",t),o._emitLayerEvent("layer:updated",u.id||"",{data:t,newData:r,isFull:f})}catch(e){if(e instanceof Error&&"CancelError"!==e.name)throw e}super.updateLayer&&super.updateLayer()}}async propertiesFilter(e,t){if(b(),this.filter&&f)this.filter((t=>{const r=t.feature&&t.feature.properties&&(0,oe.f)({...t.feature.properties});return!r||(0,_.Ml)(r,e)}));else if(this.setData){this.clearLayer&&this.clearLayer();const r=await v(e,{...t,srs:this.options.srs});this.setData(r)}}removeFilter(){d=void 0,this.propertiesFilter([]),this.filter&&this.filter((()=>!0))}_addBboxEventListener(){this.__enableMapMoveListener=e=>{e===this&&(this._removeMoveEventListener(),this.updateLayer(),this._addMoveEventListener())},this.__disableMapMoveListener=e=>{e===this&&this._removeMoveEventListener()},o.emitter.on("layer:show",this.__enableMapMoveListener),o.emitter.on("layer:hide",this.__disableMapMoveListener),this.__enableMapMoveListener(this)}_removeBboxEventListener(){this.__enableMapMoveListener&&o.emitter.on("layer:show",this.__enableMapMoveListener),this.__disableMapMoveListener&&o.emitter.on("layer:hide",this.__disableMapMoveListener)}_addMoveEventListener(){this.__onMapMove=(0,ee.D)((()=>this.updateLayer())),this.__onMapMoveStart=b,o.emitter.on("movestart",this.__onMapMoveStart),o.emitter.on("moveend",this.__onMapMove)}_removeMoveEventListener(){this.__onMapMove&&o.emitter.removeListener("moveend",this.__onMapMove),this.__onMapMoveStart&&o.emitter.removeListener("movestart",this.__onMapMoveStart)}}}function ae(e){let t,{options:r,webMap:i,baseUrl:o}=e,s=r.adapter||"IMAGE";const n=i&&i.getLayerAdapters(),a=!n||n.IMAGE,c=r.resource,l=r.tileNoData?r.tileNoData:200;if("number"==typeof c){if("IMAGE"===s){if(a)return function(e){let{resourceId:t,baseUrl:r,nd:i,headers:o}=e;const s=r+"/api/component/render/image",n={resource:t};return i&&(n.nd=i),{url:s,resourceId:t,headers:o,params:n,updateWmsParams:e=>(i&&(e.nd=i),ge(e,t))}}({resourceId:c,headers:r.headers,nd:l,baseUrl:o});s="TILE"}if("WMS"===s){t="".concat(o,"/api/resource/").concat(c,"/wms");const e=r.adapterOptions;return{url:t,format:"image/png",version:"1.1.1",layers:e&&e.layers,headers:r.headers}}var u;if("MVT"===s)return t=o+"/api/component/feature_layer/mvt?x={x}&y={y}&z={z}&resource="+c+"&simplification="+(null!==(u=r.simplification)&&void 0!==u?u:6),{url:t,sourceLayer:"ngw:"+c,featureIdName:"$id"};if("TERRAIN"===s)return t=o+"/api/resource/".concat(c,"/terrain_provider"),{url:t,adapter:s};if("MODEL_3D"===s)return t=o+"/api/component/model_3d/".concat(c,"/data.glb"),{url:t};if("TILE"===s)return t=o+"/api/component/render/tile?z={z}&x={x}&y={y}&resource="+c+"&nd="+l,{url:t,adapter:s}}else{if(void 0!==c)throw new Error("Option `resource` must be number, not "+typeof c);console.log("Option `resource` not set")}}function ce(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}async function le(e){let{layerOptions:t,webMap:r,connector:i,item:o}=e;const n=o.resource.cls;let a=t.adapter||n&&{wmsserver_service:"WMS",tmsclient_layer:"IMAGE"}[n]||"IMAGE";if(void 0!==a&&(t.adapter=a),"IMAGE"===a){const e=r.getLayerAdapters();!e||e.IMAGE||(a="TILE")}const c=r.mapAdapter.layerAdapters[a];if(c){const e=await W(t,i);return class extends c{constructor(n,a){super(n,a),this.map=n,ce(this,"item",o),ce(this,"resourceId",e);const c=ae({options:t,webMap:r,baseUrl:i.options.baseUrl||""});if(c){const r={...c,...t.adapterOptions,params:{resource:e},layers:c.layers||String(e),resourceId:e};t.adapterOptions&&(0,s.r)(t.adapterOptions.setViewDelay)&&(r.setViewDelay=t.adapterOptions.setViewDelay),this.options={...this.options,...r}}}addLayer(e){return super.addLayer({...this.options,...e})}async getLegend(t){const r=await i.get("render.legend_symbols",{params:{id:e},cache:!0,...t}),o=this.options.id;return void 0!==o?[{layerId:o,legend:r.map((e=>{let{display_name:t,icon:r}=e;return{name:t,symbol:r}}))}]:[]}async getIdentificationIds(){if(this.item){if("MVT"===a)return[this.item.resource.id];const e=this.item.resource.parent.id;if((0,s.r)(e))return[e]}return[]}}}throw new Error(a+" not supported yet. Only TILE")}const ue={},pe=["mapserver_style","qgis_vector_style","qgis_raster_style","wmsserver_service","raster_style","basemap_layer","vector_layer","raster_layer","postgis_layer","webmap","tmsclient_layer"];async function he(e){let{layerOptions:t,webMap:r,connector:i,item:o}=e;const s=o.resource.id,n=await i.getResourceChildren(s),a=n&&n[0];if(a)return de({...t,resource:a.resource.id},r,i)}async function de(e,t,r){let i,o;const s=e.adapter,n=await W(e,r);if(n){const a=e.resource;if(o=a&&a.resource&&void 0!==a.resource.id?a:await r.getResource(n),!o)throw"Resource item is not found";{const a=o.resource.cls,c={layerOptions:{...e,resource:n},webMap:t,connector:r,item:o};if(-1!==pe.indexOf(a))if("webmap"===a)i=async function(e){let{layerOptions:t,webMap:r,connector:i}=e;const o=await W(t,i);return class extends ve{constructor(e){super(e,{url:"",webMap:r,resourceId:o,connector:i})}}}(c);else if("vector_layer"===a||"postgis_layer"===a){const t=o.vector_layer&&_e[o.vector_layer.geometry_type],r=c.layerOptions.adapterOptions||{};if(r.type=r.type||t,c.layerOptions.adapterOptions=r,e.adapterOptions=c,void 0!==s&&"GEOJSON"!==s){if("MVT"!==s)return he(c);i=le(c)}else i=ne(c)}else{if("raster_layer"===a)return he(c);if("basemap_layer"===a)i=async function(e){let{webMap:t,item:r}=e;if(r.basemap_layer){const e=r.basemap_layer.qms,i=r.basemap_layer.url;if(e){const r=JSON.parse(e);return Promise.resolve(K.utils.createQmsAdapter(t,void 0,{qms:r,baselayer:!0}))}if(i){const e=t.mapAdapter.layerAdapters.TILE;if(e){class t extends e{async addLayer(e){return super.addLayer({...e,url:i})}}return t}}}}(c);else if("GEOJSON"===s){const t=await r.getResource(o.resource.parent.id);if(t){const r={...e,resource:o.resource.parent.id};i=ne({...c,item:t,layerOptions:r})}}else i=le(c)}else{if(!ue[a])throw"Resource class '".concat(a,"' not yet supported.");{const e=ue[a];let t;t=s&&"function"!=typeof t?e[s]:e,t&&(i=t(c))}}}}if(i)return i.then((e=>{if(e){const t=e;return o&&(t.prototype.item=o,t.prototype.resourceId=o.resource.id,t.prototype.connector=r),(0,F.ef)(t,[V],{replace:!1}),t}}))}function me(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}async function fe(e){let{webMap:t,connector:r,item:i,adapterOptions:o={},idPrefix:s="first-show-adapter"}=e;const n=async function(e){let{webMap:t,adapterOptions:r={},onLayerAdded:i,createAdapter:o}=e;return class{constructor(){me(this,"options",{}),me(this,"layer",[]),me(this,"_removed",!1),me(this,"_creatingInProgress",!1)}addLayer(){return this.layer}removeLayer(){this._removed=!0;for(const e of this.layer)t.removeLayer(e)}destroyed(){return this._removed}async showLayer(){if(this.options.visibility=!0,this.layer.length)for(const e of this.layer)await t.showLayer(e);else await this.loadLayer()}async hideLayer(){if(this.options.visibility=!1,this.layer)for(const e of this.layer)await t.hideLayer(e)}async loadLayer(){if(!this.layer.length&&!this._creatingInProgress){this._creatingInProgress=!0;const e=await o(this);if(e){const o=new e(t.mapAdapter.map,{...r}),s=await o.addLayer({order:this.options.order,headers:this.options.headers,baselayer:this.options.baselayer});i&&i(o),Object.assign(o.options,r),o.layer=s,this._removed&&t.removeLayer(o),this.layer.push(o),this.options.visibility&&await t.showLayer(o),this._creatingInProgress=!1}}return this.layer}}}({webMap:t,adapterOptions:o,onLayerAdded:e=>{e.options.baselayer=!1,e.id=s+"-"+i.resource_id},createAdapter:()=>de({resource:i.resource_id,adapterOptions:{name:i.display_name,opacity:i.opacity}},t,r)});return n}function ye(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ve{constructor(e,t){this.map=e,this.options=t,ye(this,"layer",void 0),ye(this,"NgwWebmapItem",Z),ye(this,"pixelRadius",10),ye(this,"resourceId",void 0),ye(this,"webmapClassName","webmap"),ye(this,"emitter",new i.EventEmitter),ye(this,"_extent",void 0),ye(this,"response",void 0),ye(this,"_webmapLayersIds",void 0),ye(this,"_webmapBaselayersIds",[]),ye(this,"_lastActiveBaselayer",void 0);const r=t.resourceId;if(Array.isArray(r)?(this.resourceId=r[0],this.options.id=r[1]):this.resourceId=r,!this.resourceId)throw new Error("NGW `resourceId` is not defined")}async addLayer(e){var t;this.options={...this.options,...e},this.layer=await this._getWebMapLayerItem();const r=null===(t=this.response)||void 0===t||null===(t=t.webmap)||void 0===t?void 0:t.extent_constrained;return this.options.useExtentConstrained&&this._extent&&r&&this.options.webMap.setView({maxBounds:this._extent}),this.layer}removeLayer(){const e=this.options.webMap.mapAdapter;if(this.getDependLayers().forEach((t=>{"layer"in t&&e.removeLayer(t.layer.layer)})),this._webmapBaselayersIds.length){for(const e of this._webmapBaselayersIds)this.options.webMap.removeLayer(e);this._lastActiveBaselayer&&this.options.webMap.showLayer(this._lastActiveBaselayer)}this.options.useExtentConstrained&&this._extent&&this.options.webMap.setView({maxBounds:null}),delete this.layer,delete this.response,delete this._webmapLayersIds}async showLayer(){if(this.layer&&this.layer.properties)return this.layer.properties.property("visibility").set(!0)}async hideLayer(){if(this.layer&&this.layer.properties)return this.layer.properties.property("visibility").set(!1)}async setOpacity(e){if(this.layer&&this.layer.properties)return this.layer.properties.property("opacity").set(e)}getExtent(){return this.getBounds()}getBounds(){const e=this.response&&this.response.webmap;if(e)return U(e)}getDependLayers(){return this.layer&&this.layer.tree.getDescendants()||[]}getBookmarksResourceId(){const e=this.response&&this.response.webmap;if(e)return e.bookmark_resource.id}fetchBookmarks(){const e=this.getBookmarksResourceId(),t=this.options.connector;if(e)return t.getResourceOrFail(e).then((r=>{var i;const o=null===(i=r.feature_layer)||void 0===i?void 0:i.fields.find((e=>e.label_field)),s=o&&o.keyname;return(0,l.n)({connector:t,resourceId:e,geom:!1,fields:s?[s]:void 0}).then((r=>{const i=[];for(const o of r){const r=new m({item:o,resourceId:e,labelField:s,connector:t});i.push(r)}return i}))}));throw new Error("Webmap was not loaded correctly, it is impossible to extract bookmarks")}async getLegend(){const e=[];let t=this.getDependLayers();t=t.sort(((e,t)=>t.id-e.id));for(const r of t){const t=await r.getLegend();e.push(...t)}return e}async getIdentificationIds(){const e=[];let t=this._webmapLayersIds;if(t||(t=await this._getWebMapIds(),this._webmapLayersIds=t),t&&t.length){let t=this.getDependLayers();t=t.sort(((e,t)=>t.id-e.id)),t.forEach((t=>{const r=t.item,i=r.parentId;if(void 0!==i&&"layer"===r.item_type&&r.layer_identifiable){const r=t.properties.property("visibility");r.get()&&!r.isBlocked()&&e.push(i)}}))}return e}async _getWebMapLayerItem(){if(this.resourceId){const e=await this.getWebMapConfig(this.resourceId);if(e&&e.root_item)return new Promise((t=>{const r={};if(this.options.connector&&this.options.connector.options.auth){const e=this.options.connector.getAuthorizationHeaders();e&&(r.headers=e)}r.setViewDelay=this.options.setViewDelay,r.order=this.options.order,r.ratio=this.options.ratio,r.crossOrigin=this.options.crossOrigin,r.minZoom=this.options.minZoom,r.maxZoom=this.options.maxZoom,r.drawOrderEnabled=e.draw_order_enabled,r.popupOptions=this.options.popupOptions;const i=new this.NgwWebmapItem(this.options.webMap,e.root_item,r,this.options.connector);i.emitter.on("init",(()=>t(i)))}))}}async getWebMapConfig(e){const t=await this.options.connector.getResource(e);if(t){this.response=t;const e=t[this.webmapClassName];if(this._setupBaselayers(t),e)return this._extent=[e.extent_left,e.extent_bottom,e.extent_right,e.extent_top],this._updateItemsParams(e.root_item,this.options.webMap,t),e}}_setupBaselayers(e){var t;const r=this.options.webMap;if(null===(t=this.options.useBasemap)||void 0===t||t)if(e.basemap_webmap&&e.basemap_webmap.basemaps.length){const t=r.getActiveBaseLayer();this._lastActiveBaselayer=t?t.id:void 0,this._setBasemaps(e.basemap_webmap)}else this.options.defaultBasemap&&r.addBaseLayer("OSM",{id:"webmap-default-baselayer",name:"OpenStreetMap"})}_setBasemaps(e){const t=this.options.webMap;let r=!1;for(const i of e.basemaps)fe({webMap:t,connector:this.options.connector,item:i,adapterOptions:{crossOrigin:this.options.crossOrigin}}).then((e=>{const o=!r&&i.enabled;return i.enabled&&(r=!0),t.addBaseLayer(e,{id:"webmap-baselayer"+i.resource_id,name:i.display_name,opacity:i.opacity,visibility:o}).then((e=>{e.id&&this._webmapBaselayersIds.push(e.id)}))}))}_updateItemsParams(e,t,r){if(e)if("group"===e.item_type||"root"===e.item_type)e.children&&(e.children=e.children.map((e=>this._updateItemsParams(e,t,r)))),"root"===e.item_type&&(e.display_name=r.resource.display_name);else if("layer"===e.item_type){const r=(0,u.n)(this.options.connector.options.baseUrl+"/api/component/render/image"),i=e.layer_style_id;e.url=r,e.resourceId=i,e.updateWmsParams=e=>ge(e,i);const o=ae({options:{adapter:e.layer_adapter.toUpperCase(),resource:i},webMap:t,baseUrl:this.options.connector.options.baseUrl||""});e={...e,...o}}return e}async _getWebMapIds(){const e=this.layer;if(e&&"root"===e.item.item_type){const t=e.tree.getDescendants(),r=[];for(const e of t){const t=e.item;if("layer"===t.item_type){const e=t.layer_style_id,i=this.options.connector.getResource(e).then((e=>{if(e){const r=Number(e.resource.parent.id);return t.parentId=r,r}}));r.push(i)}}return(await Promise.all(r)).filter((e=>void 0!==e))}}}function ge(e,t){const{bbox:r,width:i,height:o,nd:s}=e;return{resource:Array.isArray(t)?t.join(","):t,extent:r,size:i+","+o,timestamp:Date.now(),nd:null!=s?s:200}}const _e={POINT:"point",LINESTRING:"line",POLYGON:"polygon",MULTIPOINT:"point",MULTILINESTRING:"line",MULTIPOLYGON:"polygon",POINTZ:"point",LINESTRINGZ:"line",POLYGONZ:"polygon",MULTIPOINTZ:"point",MULTILINESTRINGZ:"line",MULTIPOLYGONZ:"polygon"};let be;function we(e){return h(e).then((e=>(0,p.Ok)(e)))}var Le=r(1895),Oe=r(3614),Pe=r(5034);function Ie(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Se{constructor(e){Ie(this,"id",void 0),Ie(this,"label",void 0),Ie(this,"layerId",void 0),Ie(this,"parent",void 0),Ie(this,"fields",void 0),Ie(this,"geom",void 0),Ie(this,"extensions",void 0),Ie(this,"connector",void 0),Ie(this,"_item",void 0),Ie(this,"_geojson",void 0),Ie(this,"_resource",void 0),Ie(this,"_extent",void 0);const t=e.feature;this.id=t.id,this.geom=t.geom,this.label=t.label,this.parent=t.parent,this.fields=t.fields,this.layerId=t.layerId,this.connector=e.connector}identify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._item?o.Z.resolve(this._item):h({connector:this.connector,featureId:this.id,resourceId:this.layerId,fields:null,extensions:["attachment","description"],...e}).then((e=>(this._item=e,this.geom=e.geom,this.extensions=e.extensions,e)))}resource(){return this._resource?o.Z.resolve(this._resource.feature_layer):this.connector.getResource(this.layerId).then((e=>(this._resource=e,this._resource.feature_layer)))}getBounds(){return this._extent?o.Z.resolve(this._extent):function(e){let{resourceId:t,featureId:r,connector:i,cache:o=!0}=e;return i.get("feature_layer.feature.item_extent",{cache:o},{id:t,fid:r}).then((e=>{if(e){const{maxLat:t,maxLon:r,minLat:i,minLon:o}=e.extent;return[o,i,r,t]}}))}({connector:this.connector,featureId:this.id,resourceId:this.layerId})}geojson(){return this._geojson?o.Z.resolve(this._geojson):this.identify().then((e=>e.toGeojson().then((e=>(this._geojson=e,e)))))}}function xe(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=[],i=[];for(const t in e){const e=Number(t);isNaN(e)||r.push(e)}const o=e.resources;o&&r.sort(((e,t)=>o.indexOf(e)-o.indexOf(t)));for(let o=0;o<r.length;o++){const s=r[o],n=e[s];if("features"in n){const e=Ee(n.features,Number(s),t);if(e.length&&(i.push(...e),!t))break}}return i}function Ee(e,t,r){const i=[];for(const o of e){const e={featureId:o.id,resourceId:t,feature:o};if(i.push(e),!r)break}return i}r(8730),r(9307);var Me=r(9788),Ce=r(8907);function ke(e,t,r,i){if("number"==typeof t||"string"==typeof t)t=Number(t),e.push({...r,resource:t});else if(Array.isArray(t)){const[o,s]=t;e.push({...r,resource:o,id:s,...i})}else"object"==typeof t&&e.push({...r,...t,...i})}var Te=r(390),je=r(3746),Ae=r(1102);function Be(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r(9012);class Ne extends Error{constructor(e){super(),Be(this,"name","NgwError"),Be(this,"title",void 0),Be(this,"message",void 0),Be(this,"detail",void 0),Be(this,"exception",void 0),Be(this,"status_code",void 0),Be(this,"data",void 0),Be(this,"guru_meditation",void 0),Object.assign(this,e),Object.setPrototypeOf(this,Ne.prototype)}}function Re(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Ze extends Ne{constructor(e){super(e),Re(this,"name","ResourceNotFoundError"),Re(this,"exception","nextgisweb.resource.exception.ResourceNotFound"),Object.setPrototypeOf(this,Ze.prototype)}}function Fe(e){return"[object Object]"===Object.prototype.toString.call(e)}var Ue=r(5189);const De=["description"];function qe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t=t?t+"__":"";const r={};for(const[i,o]of Object.entries(e))if(-1===De.indexOf(i))if(Fe(o))if("owner_user"===i){const e=qe(o,i);Object.assign(r,e)}else"parent"===i&&"id"in o&&(r.parent_id=o.id);else(0,s.r)(o)&&(r[t+i]=o);return r}class ze{constructor(e){this.connector=e,function(e,t,r){t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"cache",new je.Z)}getOne(e,t){const r=new je.Z,i={},s={...t,cache:!1};return"string"==typeof e?i.keyname=e:"number"==typeof e?i.id=e:Fe(e)&&(void 0!==e.id?i.id=e.id:e.keyname&&(i.keyname=e.keyname)),r.addFull("resource",(()=>"string"==typeof e?this._fetchResourceBy({keyname:e},s):"number"==typeof e?this._fetchResourceById(e,s):Fe(e)?this._fetchResourceBy(e,s):o.Z.resolve(void 0)),i)}getOneOrFail(e,t){return this.getOne(e,t).then((e=>{if(e)return e;throw new Ze}))}getId(e,t){return"number"==typeof e?o.Z.resolve(e):"string"==typeof e||Fe(e)?this.getOne(e,t).then((e=>{if(e)return e.resource.id})):o.Z.resolve(void 0)}getIdOrFail(e,t){return this.getId(e,t).then((e=>{if(void 0===e)throw new Error;return e}))}getMany(e,t){return this._resourceCacheFilter(e).then((r=>{if(!r.length){const r={};return e.keyname?r.keyname=e.keyname:Object.assign(r,qe(e)),this.connector.get("resource.search",t,{serialization:"full",...r}).then((e=>{if(e)for(const t of e)this.cache.add("resource.item",o.Z.resolve(t),{id:t.resource.id});return e}))}return r}))}getParent(e,t){return this.getOne(e,t).then((e=>e?this.getOne(e.resource.parent.id,t):o.Z.resolve(void 0)))}getChildrenOf(e,t){return this.getIdOrFail(e).then((e=>this._getChildrenOf(e,t)))}update(e,t){return this.getId(e).then((e=>{if(void 0!==e)return this.connector.put("resource.item",{data:t},{id:e})}))}delete(e){return this.getId(e).then((e=>{if(void 0!==e)return this.connector.delete("resource.item",null,{id:e}).then((()=>{this._cleanResourceItemCache(e)}))}))}_getChildrenOf(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.connector.get("resource.collection",{cache:!0,...t},{parent:e}).then((e=>{const i=[];for(const s of e)this.cache.add("resource.item",o.Z.resolve(s),{id:s.resource.id}),r.push(s),null!=t&&t.recursive&&s.resource.children&&i.push(this._getChildrenOf(s.resource.id,t,r));return i.length?o.Z.all(i).then((()=>r)):r}))}async _cleanResourceItemCache(e){const t=this.cache.all(),r=[];for(const i of t){const t=i.options&&i.options.id;["resource.item","resource"].includes(i.key)&&void 0!==t&&("number"==typeof t?t===e&&r.push(i):await this.getId(t)===e&&r.push(i))}for(const e of r)this.cache.delete(e)}_fetchResourceById(e,t){return this.cache.add("resource.item",(()=>this.connector.get("resource.item",t,{id:e})),{id:e}).catch((e=>{if(!(e instanceof Ze))throw e}))}_fetchResourceBy(e,t){return this.getMany(e,t).then((e=>e[0]))}_resourceCacheFilter(e){return o.Z.all(this.cache.matchAll("resource.item")).then((t=>(t.filter((t=>{if(t)return e.keyname&&t.resource.keyname?e.keyname===t.resource.keyname:(0,s.r)(e.id)&&(0,s.r)(t.resource.id)?e.id===t.resource.id:(r=e,i=t.resource,(0,Ue.v)(r,i));var r,i})),[])))}}const Ge=[];function Ve(e){Ge.push(e)}function We(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class $e extends Ne{constructor(e){super(e),We(this,"name","InsufficientPermissionsError"),We(this,"exception","nextgisweb.core.exception.InsufficientPermissions"),Object.setPrototypeOf(this,$e.prototype)}}const He=/\{ *([\w_-]+) *\}/g;function Je(e,t){return e.replace(He,((e,r)=>{let i=t[r];if(void 0===i)throw new Error("No value provided for letiable "+e);return"function"==typeof i&&(i=i(t)),i}))}class Qe extends Error{constructor(e){super(),function(e,t,r){t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"name","NetworkError"),Object.setPrototypeOf(this,Qe.prototype),this.message="Unable to request ".concat(e,".\n    Possibly invalid NGW URL entered or CORS not configured to get request from ").concat(location.origin)}}let Ye;function Xe(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Ye=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;r.method=r.method||"GET";const s=new XMLHttpRequest;s.open(r.method||"GET",e,!0),"blob"===r.responseType&&(s.responseType=r.responseType);const n=()=>{try{return JSON.parse(s.responseText)}catch(e){return s.responseText}};s.onload=()=>{-1!==[401,403,404,422,500].indexOf(s.status)&&i(new Ne(n())),function(){const e=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?i:t;"blob"===r.responseType?e(s.response):s.responseText?e(n()):i({message:""})}()},s.onerror=t=>{0===s.status?i(new Qe(e)):i(t)},s.upload.onprogress=function(e){if(e.lengthComputable){const t=e.loaded/e.total*100;r.onProgress&&r.onProgress(t,e)}};const a=r.headers;if(a)for(const e in a){const t=a[e];"string"==typeof t&&s.setRequestHeader(e,t)}let c;if(void 0!==r.withCredentials&&(s.withCredentials=r.withCredentials),r.file){if(c=new FormData,c.append("file",r.file),r.data)for(const e in r.data)c.append(e,c[e])}else c=r.data?"string"==typeof r.data?r.data:JSON.stringify(r.data):null;o&&o((()=>{s.abort()})),s.send(c)};let Ke=0;class et{constructor(e){this.options=e,Xe(this,"id",Ke++),Xe(this,"emitter",new i.EventEmitter),Xe(this,"user",void 0),Xe(this,"resources",void 0),Xe(this,"routeStr","/api/component/pyramid/route"),Xe(this,"activeRequests",[]),Xe(this,"requestTransform",void 0);const t=function(e){return Ge.find((t=>{if(t.options.baseUrl===e.baseUrl){if(!e.auth)return!0;if(t.options.auth)return(0,Ue.v)(t.options.auth,e.auth)}}))}(e);if(t)return t;this.options.route&&(this.routeStr=this.options.route),this.options.requestTransform&&(this.requestTransform=this.options.requestTransform),this.resources=new ze(this),Ve(this)}static create(e){return new this(e)}setRequestTransform(e){this.requestTransform=e}setNgw(e){this.logout(),this.options.baseUrl=e,Ve(this)}connect(){const e=new je.Z,t=this.options.auth;return e.add("route",(()=>new o.Z(((e,r)=>{const i=()=>this.makeQuery(this.routeStr,{},{}).then((t=>{e(t)})).catch((e=>{r(e)}));if(t){const{login:e,password:o}=t;if(e&&o)return this._login({login:e,password:o}).then((()=>i())).catch((e=>r(e)))}return i()}))),{id:this.id,auth:t,baseUrl:this.options.baseUrl})}login(e,t){return this.logout(),Ve(this),this._login(e,t)}logout(){this.abort(),function(e){const t=Ge.indexOf(e);-1!==t&&Ge.splice(t,1)}(this),this.options.auth=void 0,this.user=void 0,this.emitter.emit("logout"),this.resources.cache.clean()}getUserInfo(e,t){if(this.user&&this.user.id)return o.Z.resolve(this.user);e&&(this.options.auth=e);const r={headers:this.getAuthorizationHeaders(e),...t};return this.makeQuery("/api/component/auth/current_user",{},r)}getAuthorizationHeaders(e){const t=this.makeClientId(e);if(t)return{Authorization:"Basic "+t}}makeClientId(e){if(e=e||this.options.auth){const{login:t,password:r}=e,i=unescape(encodeURIComponent("".concat(t,":").concat(r)));return window.btoa(i)}}abort(){for(const e of this.activeRequests)e.cancel();this.activeRequests=[]}getActiveApiRequests(){return[...this.activeRequests]}apiRequest(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{method:s,headers:n,withCredentials:a,responseType:c}=i;r=null!==(t=i.params)&&void 0!==t?t:r;const l=(0,Ae.d)(r),u=()=>function(e){const t=e.params;return new o.Z(((r,i)=>{e.connector.connect().then((o=>{let s=o&&o[e.name];if(s){s=[...s];let o=s.shift();if(s.length){const e={};for(let r=0;r<s.length;r++){const i=s[r];if(e[r]="{"+i+"}",void 0===t[i])throw new Error("`"+i+"` url api argument is not specified")}o&&(o=Je(o,e))}if(t){const e=[],r=t.paramList;Array.isArray(r)&&(delete t.paramList,r.forEach((t=>{e.push("".concat(t[0],"=").concat(t[1]))})));for(const r in t)-1===s.indexOf(r)&&e.push("".concat(r,"=").concat(t[r]));e.length&&(o=o+"?"+e.join("&"))}o?r(e.connector.makeQuery(o,t,e.requestOptions)):i(new Error("request url is not set"))}else r(void 0)})).catch((e=>{i(e)}))}))}({name:e,params:l,requestOptions:i,connector:this});var p;return i.cache&&"GET"===s?(new je.Z).add(e,u,{params:l,...(0,Ae.d)({headers:n,withCredentials:a,responseType:c,baseUrl:this.options.baseUrl,userId:null===(p=this.user)||void 0===p?void 0:p.id})}):u()}post(e,t,r){return(t=t||{}).method="POST",this.apiRequest(e,r,t)}get(e,t,r){return(t=t||{}).method="GET",this.apiRequest(e,r,t)}patch(e,t,r){return(t=t||{}).method="PATCH",this.apiRequest(e,r,t)}put(e,t,r){return(t=t||{}).method="PUT",this.apiRequest(e,r,t)}delete(e,t,r){return(t=t||{}).method="DELETE",this.apiRequest(e,r,t)}makeQuery(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e=(this.options.baseUrl?this.options.baseUrl:"")+e)return t&&(e=Je(e,t)),e=encodeURI((0,u.n)(e)),this._loadData(e,r);throw new Error("Empty `url` not allowed")}getResource(e,t){return this.resources.getOne(e,t)}getResourceOrFail(e,t){return this.resources.getOneOrFail(e,t)}getResourceBy(e){return this.resources.getOne(e)}getResourceByKeyname(e){return this.resources.getOne(e)}getResourceById(e){return this.resources.getOne(e)}getResourceId(e,t){return this.resources.getId(e,t)}getResourceIdOrFail(e,t){return this.resources.getIdOrFail(e,t)}getResourcesBy(e,t){return this.resources.getMany(e,t)}getResourceParent(e,t){return this.resources.getParent(e,t)}getResourceChildren(e,t){return this.resources.getChildrenOf(e,t)}updateResource(e,t){return this.resources.update(e,t)}deleteResource(e){return this.resources.delete(e)}_loadData(e,t){t.responseType=t.responseType||"json";const r=new o.Z(((r,i,o)=>{if(this.user&&((t=t||{}).headers={...this.getAuthorizationHeaders(),...t.headers}),this.requestTransform){const[r,i]=this.requestTransform(e,t);e=r,t=i}Ye(e,r,t,i,o)})).then((e=>(this._cleanActiveRequests(r),e))).catch((e=>{if(this._cleanActiveRequests(r),e instanceof o.Z.CancelError);else{const t=this._handleHttpError(e);if(t)throw t}}));return t.signal&&"function"==typeof t.signal.addEventListener&&t.signal.addEventListener("abort",(()=>{r.cancel(),this._cleanActiveRequests(r)})),this.activeRequests.push(r),r}_login(e,t){return this.getUserInfo(e,t).then((e=>(this.user=e,this.emitter.emit("login",e),e))).catch((e=>{throw this.emitter.emit("login:error",e),e}))}_cleanActiveRequests(e){const t=this.activeRequests.indexOf(e);-1!==t&&this.activeRequests.splice(t,1)}_handleHttpError(e){if(e&&e instanceof Ne){if("nextgisweb.resource.exception.ResourceNotFound"===e.exception)throw new Ze(e);if("nextgisweb.core.exception.InsufficientPermissions"===e.exception)throw new $e(e)}return e}}Xe(et,"errors",{NgwError:Ne,ResourceNotFoundError:Ze});const tt=et;function rt(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class it{constructor(e){if(this.options=e,rt(this,"url",void 0),rt(this,"connector",void 0),rt(this,"webMap",void 0),this.options.connector)this.url=this.options.connector.options.baseUrl||"",this.connector=this.options.connector;else{if(!this.options.baseUrl)throw new Error("url is not defined");this.url=this.options.baseUrl,this.connector=new tt({baseUrl:this.url,auth:this.options.auth})}}static addClassAdapters(e,t){ue[e]=t}async onLoadSync(e){if(this.options.resourceId&&this.url){const t=[this.options.resourceId];if(t.length)for(const r of t){const t={resourceId:r,connector:this.connector,webMap:e};return await e.addLayer(ve,{visibility:!0,fit:!0,pixelRadius:this.options.pixelRadius,...t})}}}getLayerAdapters(){return Promise.resolve([this._getLayerAdapter()])}_getLayerAdapter(){return{name:"WEBMAP",createAdapter:e=>Promise.resolve(this._createAdapter(e))}}_createAdapter(e){const t=this.connector,r=this.url;return i={webMap:e,connector:t,baseUrl:r},class extends ve{constructor(e,t){super(e,t={...i,...t})}};var i}}const ot={target:"map",baseUrl:"",whitlabel:!1,controls:(0,c.c5)(),controlsOptions:{ZOOM:{position:"top-left"},ATTRIBUTION:{position:"bottom-right",customAttribution:['<a href="https://nextgis.com" target="_blank">NextGIS</a>']}},pixelRadius:10};function st(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class nt extends c.y9{constructor(e){super(function(e){const t=[new K];return e.starterKits&&e.starterKits.forEach((e=>{t.push(e)})),e.connector?e.connector&&(e.baseUrl=e.connector.options.baseUrl):e.connector=new tt({baseUrl:e.baseUrl||"",auth:e.auth}),(e=(0,Te.v)(ot,e)).center||e.bounds||(e.bounds=[-179,-90,180,90]),e.connector&&t.push(new it({connector:e.connector,auth:e.auth})),{...e,starterKits:t,create:!1}}(e)),st(this,"emitter",new i.EventEmitter),st(this,"connector",void 0),st(this,"_ngwLayers",{}),st(this,"$$selectFromNgwRaster",void 0),st(this,"$$selectFromNgwVector",void 0),st(this,"_promises",{select:[],identify:[]}),e.connector&&(this.connector=e.connector),this._createWebMap().then((()=>{const e=this.getContainer();e&&e.classList.add("ngw-map-container"),this.options.whitlabel&&this._whiteLabel()}))}async addControl(e,t,r){return await this.onLoad("controls:create"),super.addControl(e,t,r)}async addNgwLayer(e){await this.onMapLoad();const{keyname:t,resourceId:r}=e;(t||void 0!==r)&&(0,Me.v)("set `resource` options instead of `keyname` or `resourceId`");const i=e.resource;if(!t&&!r&&!i)throw new Error("resource, resourceId or keyname is required parameter to add NGW layer");if((0,s.r)(this.options.baseUrl))try{(0,s.r)(this.options.setViewDelay)&&(e.adapterOptions=e.adapterOptions||{},(0,s.r)(e.adapterOptions.setViewDelay)||(e.adapterOptions.setViewDelay=this.options.setViewDelay));const t=function(e,t,r){const i=r.getAuthorizationHeaders();return i&&(e.headers=i),de(e,t,r)}(e,this,this.connector),r={visibility:!0,...e,...e.adapterOptions},i=await this.addLayer(t,r),o=i&&this.getLayerId(i);return i&&o&&(this._ngwLayers[o]={layer:i,resourceId:i.resourceId},i.options.name=i.options.name||i.item&&i.item.resource.display_name,i.options.baselayer)&&this.getActiveBaseLayer(),i}catch(e){const o=(0,n.Kn)(i)&&"id"in i?i.id:t||r||i;console.error("Can't add NGW layer ".concat(o,"."),e)}}fit(){const{center:e,zoom:t,bounds:r}=this.options;e?(this.setCenter(e),t&&this.setZoom(t)):r&&this.fitBounds(r)}fetchNgwLayerItem(e){return h({connector:this.connector,...e})}fetchNgwLayerItems(e){return(0,l.n)({connector:this.connector,...e})}fetchNgwLayerFeature(e){return we({connector:this.connector,...e})}fetchNgwLayerFeatures(e){return te({connector:this.connector,...e})}fetchIdentifyItem(e,t){const r=function(e){const{connector:t,identify:r}=e,i=xe(r);return i&&i.length?h({connector:t,...e.requestOptions,...i[0]}):o.Z.resolve(void 0)}({identify:e,connector:this.connector,requestOptions:t});return this._addPromise("identify",r),r}fetchIdentifyGeoJson(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=function(e){const{connector:t,identify:r,requestOptions:i}=e;for(const e in r){const t=Number(e);if(!isNaN(t)){const t=r[e];if("features"in t){const e=t.features.find((e=>e.geom));if(e&&e.geom){const t=e.geom;return o.Z.resolve((0,p.Ok)({...e,geom:t}))}}}}const s=xe(r);return s&&s.length?we({...i,connector:t,...s[0]}):o.Z.resolve(void 0)}({identify:e,connector:this.connector,multiple:t});return r&&"then"in r?(this._addPromise("identify",r),r):o.Z.resolve(r)}getIdentifyGeoJson(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.fetchIdentifyGeoJson(e,t)}async getNgwLayers(){return await this.onLoad(),this._ngwLayers}async getNgwLayerByResourceId(e){for(const t in this._ngwLayers){const r=this._ngwLayers[t];if(r.resourceId===e)return r&&r.layer;if(r.layer.getIdentificationIds){const t=await r.layer.getIdentificationIds();if(t&&t.some((t=>t===e)))return r.layer}if(r.layer.getDependLayers){const t=r.layer.getDependLayers().find((t=>t.item&&t.item.parentId===e));if(t)return t.layer}}}async fitLayer(e,t){let r;r="string"==typeof e||"number"==typeof e?String(r):e.id;const i=r&&this._ngwLayers[r];if(i)if(i.layer.getBounds){const e=await i.layer.getBounds();e&&this.fitBounds(e,t)}else{let e;if(i.layer.item)e=i.layer.item;else{const t=i.resourceId;e=await this.connector.getResource(t)}e&&q({resourceId:e.resource.id,connector:this.connector}).then((e=>{e&&this.fitBounds(e,t)}))}else super.fitLayer("number"==typeof e?String(e):e,t)}async zoomToLayer(e){return this.fitLayer(e)}onLoad(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ngw-map:create";return super.onLoad(e)}removeLayer(e){const t=this.getLayer(e);if(t){const e=this.getLayerId(t);e&&delete this._ngwLayers[e],super.removeLayer(t)}}enableSelection(){this.$$selectFromNgwRaster||(this.$$selectFromNgwRaster=e=>{this._getSelectListenersCount()&&this.selectFromNgwRaster(e)},this.$$selectFromNgwVector=e=>{this._getSelectListenersCount()&&this._selectFromNgwVector(e)},this.emitter.on("click",this.$$selectFromNgwRaster),this.emitter.on("layer:click",this.$$selectFromNgwVector))}disableSelection(){this.$$selectFromNgwRaster&&(this.emitter.removeListener("click",this.$$selectFromNgwRaster),this.$$selectFromNgwRaster=void 0),this.$$selectFromNgwVector&&(this.emitter.removeListener("layer:click",this.$$selectFromNgwVector),this.$$selectFromNgwVector=void 0)}getNgwLayerItem(e){return this.fetchNgwLayerItem(e)}getNgwLayerItems(e){return this.fetchNgwLayerItems(e)}getNgwLayerFeature(e){return this.fetchNgwLayerFeature(e)}getNgwLayerFeatures(e){return this.fetchNgwLayerFeatures(e)}cancelPromise(){this.cancelPromises(...arguments)}cancelPromises(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.length||(t=Object.keys(this._promises)),t.forEach((e=>{const t=this._promises[e];t&&(t.forEach((e=>e.cancel())),this._promises[e]=[])}))}async selectFromNgwRaster(e){this._emitStatusEvent("ngw:preselect");const t=[],r=Object.values(this._ngwLayers);r.sort(((e,t)=>e.layer.order&&t.layer.order?t.layer.order-e.layer.order:1));for(const e of r){var i;const r=e.layer,o="function"==typeof r.getIdentificationIds&&r.getIdentificationIds,s=null===(i=r.options.interactive)||void 0===i||i;o&&r.options.selectable&&s&&this.isLayerVisible(r)&&t.push(o.call(r))}const o=Promise.all(t),s=await o,n=[];for(const e of s)e&&n.push(...e);if(!n.length)return void this._emitStatusEvent("ngw:select",null);const c=this.options.pixelRadius||10,l=this.getCenter();let u=this.getZoom();if(u=void 0!==u?u:20,!l||!u)return void this._emitStatusEvent("ngw:select",null);const p=(0,a.P)(l,u,c),h=function(e,t){(0,Oe.V)(e);const[r,i]=e.lngLat,{geom:o,radius:s,signal:n,cache:a}=t,c=null!=o?o:(0,Pe.W)(r,i,s);return function(e){const{geom:t,signal:r,cache:i,layers:o}=e,s="string"==typeof t?t:function(e){const t=function(e){return Array.isArray(e)?e:"Feature"===e.type?null===(t=e.geometry)||void 0===t?void 0:t.coordinates[0]:"Polygon"===e.type?e.coordinates[0]:null;var t}(e);if(!t)return null;const r=t.map((e=>{let[t,r]=e;const[i,o]=(0,Le.Qm)(t,r);return"".concat(i," ").concat(o)}));return"POLYGON((".concat(r.join(","),"))")}(t);if(!s)throw new Error("Not valid geometry format to make intersection");const n={geom:s,srs:3857,layers:o};return e.connector.post("feature_layer.identify",{data:n,signal:r,cache:i})}({...t,geom:c,signal:n,cache:a})}(e,{layers:n,connector:this.connector,radius:p}).then((t=>{const r={...t,resources:n,sourceType:"raster",event:e},i=this._prepareToIdentify(r);return this._emitStatusEvent("ngw:select",i),i}));return this._addPromise("select",h),h}_addPromise(e,t){const r=this._promises[e];if(r&&-1===r.indexOf(t)){const e=()=>{const e=r.indexOf(t);-1!==e&&r.splice(e,1)};t.then(e),t.catch(e),r.push(t)}}_isFitFromResource(){const e=this._initMapState;return!e.zoom||!e.center}async _createWebMap(){await this.create(),this.options.qmsId&&this._addQmsBaseLayer(),this.options.osm&&this._addOsmBaseLayer();const e=[],t=this._isFitFromResource();if(this.options.webmapId&&ke(e,this.options.webmapId,{fit:t}),this.options.resources&&Array.isArray(this.options.resources))for(const r of this.options.resources){const i={};t||(i.fit=!1),ke(e,r,{},i)}for(const t of e)try{await this.addNgwLayer(t)}catch(e){console.warn(e)}this._emitStatusEvent("ngw-map:create",this),this.enableSelection()}_addOsmBaseLayer(){this.addBaseLayer("OSM")}_addQmsBaseLayer(){let e,t;Array.isArray(this.options.qmsId)?(e=this.options.qmsId[0],t=this.options.qmsId[1]):e=Number(this.options.qmsId);const r={qmsId:e};t&&(r.id=t),this.addBaseLayer("QMS",r)}_selectFromNgwVector(e){const t=e.layer;if(!t.options.selectable||!this.isLayerVisible(t))return;const r=t.item&&t.item.resource.id,i=e.feature;if(void 0!==r&&i){const e=i.id;if(e){const t={featureCount:1,[r]:{featureCount:1,features:[{id:Number(e),fields:i.properties||{},label:"#".concat(r),layerId:Number(r),parent:"",geom:i.geometry}]}};return this._emitStatusEvent("ngw:select",this._prepareToIdentify({...t,resources:[r],sourceType:"vector"})),t}}}_prepareToIdentify(e){return{...e,getIdentifyItems:()=>xe(e,!0).map((e=>{return t={feature:e.feature,connector:this.connector},new Se(t);var t}))}}_getSelectListenersCount(){return this.emitter.listenerCount("ngw:select")}async _whiteLabel(){const e=this.getContainer();if(e){const t=await async function(e,t){const r=await e.get("pyramid.settings",null,{component:"pyramid"});if(r&&r.company_logo&&r.company_logo.enabled){var i;const o=document.createElement("a");o.style.position="absolute",o.style.bottom="0",o.style.right="0",o.style.padding=null!==(i=null==t?void 0:t.padding)&&void 0!==i?i:"10px",o.className="ngw-map-logo",t&&t.cssClass&&(o.className+=" "+t.cssClass);const s=new Image;s.style.maxHeight="100px",s.style.maxWidth="100px",s.src="";try{const t=await e.get("pyramid.company_logo",{responseType:"blob"}),r=(window.URL||window.webkitURL).createObjectURL(t);s.src=r}catch(e){console.warn(e)}return null!==r.company_logo.link&&""!==r.company_logo.link.trim()&&(o.href=r.company_logo.link,o.target="_blank",-1!==r.company_logo.link.search(/:\/\/nextgis/)&&(s.alt="Get your own Web GIS at nextgis.com")),o.appendChild(s),o}}(this.connector,this.options.companyLogoOptions);t&&e.appendChild(t)}}}st(nt,"getIcon",Ce.q)},9443:(e,t,r)=>{function i(e){return"[object Object]"===Object.prototype.toString.call(e)}function o(e){return"function"==typeof e}r.d(t,{GY:()=>i,UY:()=>o,Yx:()=>p});var s=r(9807);function n(e){return t=>{const r=t.properties;return!!r&&(0,s.k)(e,r)}}const a=["iconSize","iconAnchor"];r(6265);var c=r(8133);function l(e){let t={};const r=[];for(const i of e)i&&(Array.isArray(i)?r.push(i):t=i);return e=>{const i=r.find((t=>(0,c.TE)(e,t[0])));return i?{...t,...i[1]}:t}}function u(e){var t;let{paint:r,defaultPaint:i}=e,o={...i};return o={...o,...r},o.fill=null===(t=o.fill)||void 0===t||t,o.stroke=void 0!==o.stroke?o.stroke:!o.fill||!(!o.strokeColor&&!o.strokeOpacity),o}function p(e){let{paint:t,defaultPaint:r,getPaintFunctions:i}=e;if(!t)throw new Error("paint is empty");let c={...r};if(o(t)){const e=e=>{const o=p({paint:t(e),defaultPaint:r,getPaintFunctions:i});return o.type=t.type,o};return e.type=t.type,e}if(function(e){return!!Array.isArray(e)}(t))return e=>p({paint:l(t)(e),defaultPaint:r,getPaintFunctions:i});if("get-paint"===t.type){const e=function(e,t){if("function"==typeof e.from)return e.from(e.options);if("string"==typeof e.from&&t){const r=t[e.from];if(r)return r(e.options)}}(t,i);e&&(c=p({paint:e,defaultPaint:r,getPaintFunctions:i}))}else{if("icon"===t.type)return t;c=function(e){let{paint:t,defaultPaint:r}=e;const i=function(e){let t=!1;const r={};for(const i in e)if(-1===a.indexOf(i)){const o=i,a=e[o];(0,s.U)(a)&&(t=!0,r[o]=n(a))}if(t)return t=>{const i={};for(const e in r)i[e]=r[e](t);return{...e,...i}}}(t);if(i){const e=e=>p({paint:i(e),defaultPaint:r});return e.paint=u({paint:t,defaultPaint:r}),e}return u({paint:t,defaultPaint:r})}({paint:t,defaultPaint:r})}return o(c)||("color"in c&&(c.strokeColor||(c.strokeColor=c.color),c.fillColor||(c.fillColor=c.color)),"opacity"in c&&(void 0===c.strokeOpacity&&(c.strokeOpacity=c.opacity),void 0===c.fillOpacity&&(c.fillOpacity=c.opacity))),c}},8133:(e,t,r)=>{function i(e,t,r){if((t=String(t))===(e=String(e)))return!0;if(r&&t.toUpperCase()===e.toUpperCase())return!0;const i="^".concat((o=t,o.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")),"$").replace(/%/g,".*").replace("_",".");var o;return null!==new RegExp(i,r?"i":"").exec(e)}r.d(t,{TE:()=>n,aN:()=>s,Ml:()=>a}),r(7267),r(6265);const o={gt:(e,t)=>e>t,lt:(e,t)=>e<t,ge:(e,t)=>e>=t,le:(e,t)=>e<=t,eq:(e,t)=>e===t,ne:(e,t)=>e!==t,in:(e,t)=>-1!==t.indexOf(e),notin:(e,t)=>-1===t.indexOf(e),like:(e,t)=>i(e,t),ilike:(e,t)=>i(e,t,!0)};function s(e){const t=e;return 3===t.length&&"string"==typeof t[0]&&"string"==typeof t[1]}function n(e,t){const r={...e.properties};return!!r&&(r.$id=e.id,a(r,t))}function a(e,t){const r="string"==typeof t[0]?t[0]:"all",i=t=>{if(s(t)){const[r,i,s]=t,n=o[i];if(n){if(("like"===i||"ilike"===i)&&"string"==typeof r){let t="";const i=r.replace(/^%?(\w+)%?$/,((i,o)=>(t=e[o],r.replace(o,s))));return n(t,i)}return n(e[r],s)}return!1}return a(e,t)},n=t.filter((e=>Array.isArray(e)));return"any"===r?n.some(i):n.every(i)}}}]);
//# sourceMappingURL=main-4aa8b69d4a578ff.js.map