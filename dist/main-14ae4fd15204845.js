"use strict";(self.webpackChunkclear_horizon=self.webpackChunkclear_horizon||[]).push([[712],{7731:function(e,t,r){r.d(t,{Z8:function(){return Z}}),r(5666),r(1539),r(8674),r(8309),r(9826),r(6992),r(3948),r(7941),r(4747),r(561),r(9653),r(2479),r(2707),r(8783),r(1249),r(489),r(2419),r(4819),r(5003),r(2526),r(7327),r(9337),r(1817),r(2165);var n=r(7187),o=r(1521),i=r(8651),a=r(2476),s=r(9256),c=r(560),u=r(6818),f=r(9528),l=r(7644),p=r(447),y=r(1757),h=r(4049),d=r(3314),m=r(9788),b=r(8907);function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){k(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function k(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function L(e,t,r,n){if("number"==typeof t||"string"==typeof t)t=Number(t),e.push(O(O({},r),{},{resource:t}));else if(Array.isArray(t)){var o=(c=2,function(e){if(Array.isArray(e))return e}(s=t)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(s)throw o}}return i}}(s,c)||function(e,t){if(e){if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}}(s,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],a=o[1];e.push(O(O({},r),{},{resource:i,id:a},n))}else"object"===v(t)&&e.push(O(O(O({},r),t),n));var s,c}r(7042),r(1038);var x=r(390),I=r(7869),_=r(9847),j=r(4482);function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){N(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function N(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var S={target:"map",baseUrl:"",whitlabel:!1,controls:["ZOOM","ATTRIBUTION"],controlsOptions:{ZOOM:{position:"top-left"},ATTRIBUTION:{position:"bottom-right",customAttribution:['<a href="https://nextgis.com" target="_blank">Â©NextGIS</a>']}},pixelRadius:10};function E(e,t,r){var n;return(r=null!==(n=r)&&void 0!==n?n:10)*(40075016.686*Math.abs(Math.cos(180*e[1]/Math.PI))/Math.pow(2,t+8))*5e-4}function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function $(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$(Object(r),!0).forEach((function(t){G(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function A(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function B(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){A(i,n,o,a,s,"next",e)}function s(e){A(i,n,o,a,s,"throw",e)}a(void 0)}))}}function C(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function T(e,t,r){return T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=q(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}},T(e,t,r||e)}function M(e,t){return M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},M(e,t)}function V(e,t){if(t&&("object"===F(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return U(e)}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(e){return q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},q(e)}function G(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(Z,e);var t,r,s,b,v,g,w,O,k,P,N,F,$,A=(F=Z,$=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=q(F);if($){var r=q(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return V(this,e)});function Z(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Z),t=A.call(this,function(e){var t=[new _.WL];return e.starterKits&&e.starterKits.forEach((function(e){t.push(e)})),e.connector?e.connector&&(e.baseUrl=e.connector.options.baseUrl):e.connector=new I.Z({baseUrl:e.baseUrl||"",auth:e.auth}),(e=(0,x.v)(S,e)).center||e.bounds||(e.bounds=[-179,-90,180,90],e.maxBounds=e.bounds),e.connector&&t.push(new j.l({connector:e.connector,auth:e.auth})),R(R({},e),{},{starterKits:t,create:!1})}(e)),G(U(t),"emitter",new n.EventEmitter),G(U(t),"connector",void 0),G(U(t),"_ngwLayers",{}),G(U(t),"$$selectFromNgwRaster",void 0),G(U(t),"$$selectFromNgwVector",void 0),G(U(t),"_promises",{select:[],identify:[]}),e.connector&&(t.connector=e.connector),t._createWebMap().then((function(){var e=t.getContainer();e&&e.classList.add("ngw-map-container"),t.options.whitlabel&&t._whiteLabel()})),t}return t=Z,r=[{key:"addControl",value:(N=B(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.onLoad("controls:create");case 2:return e.abrupt("return",T(q(Z.prototype),"addControl",this).call(this,t,r,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return N.apply(this,arguments)})},{key:"addNgwLayer",value:(P=B(regeneratorRuntime.mark((function e(t){var r,n,o,s,u,f,l,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.onMapLoad();case 2:if(r=t.keyname,n=t.resourceId,(r||void 0!==n)&&(0,m.v)("set `resource` options instead of `keyname` or `resourceId`"),o=t.resource,r||n||o){e.next=7;break}throw new Error("resource, resourceId or keyname is required parameter to add NGW layer");case 7:if(!(0,i.r)(this.options.baseUrl)){e.next=30;break}return e.prev=8,(0,i.r)(this.options.setViewDelay)&&(t.adapterOptions=t.adapterOptions||{},(0,i.r)(t.adapterOptions.setViewDelay)||(t.adapterOptions.setViewDelay=this.options.setViewDelay)),s=(0,c.Sy)(t,this,this.connector),u=D(D({visibility:!0},t),t.adapterOptions),e.next=14,this.addLayer(s,u);case 14:if(f=e.sent,l=f&&this.getLayerId(f),!f||!l){e.next=23;break}if(this._ngwLayers[l]={layer:f,resourceId:f.resourceId},f.options.name=f.options.name||f.item&&f.item.resource.display_name,!f.options.baselayer){e.next=23;break}if(!this.getActiveBaseLayer()){e.next=23;break}return e.abrupt("return",f);case 23:return e.abrupt("return",f);case 26:e.prev=26,e.t0=e.catch(8),p=(0,a.Kn)(o)&&"id"in o?o.id:r||n||o,console.error("Can't add NGW layer ".concat(p,"."),e.t0);case 30:case"end":return e.stop()}}),e,this,[[8,26]])}))),function(e){return P.apply(this,arguments)})},{key:"fit",value:function(){var e=this.options,t=e.center,r=e.zoom,n=e.bounds;t?(this.setCenter(t),r&&this.setZoom(r)):n&&this.fitBounds(n)}},{key:"fetchNgwLayerItem",value:function(e){return(0,u.v)(D({connector:this.connector},e))}},{key:"fetchNgwLayerItems",value:function(e){return(0,f.n)(D({connector:this.connector},e))}},{key:"fetchNgwLayerFeature",value:function(e){return(0,l.C)(D({connector:this.connector},e))}},{key:"fetchNgwLayerFeatures",value:function(e){return(0,p.U)(D({connector:this.connector},e))}},{key:"fetchIdentifyItem",value:function(e,t){var r=(0,y.K1)({identify:e,connector:this.connector,requestOptions:t});return this._addPromise("identify",r),r}},{key:"fetchIdentifyGeoJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=(0,y.D1)({identify:e,connector:this.connector,multiple:t});return r&&"then"in r?(this._addPromise("identify",r),r):o.Z.resolve(r)}},{key:"getIdentifyGeoJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.fetchIdentifyGeoJson(e,t)}},{key:"getNgwLayers",value:(k=B(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.onLoad();case 2:return e.abrupt("return",this._ngwLayers);case 3:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"getNgwLayerByResourceId",value:(O=B(regeneratorRuntime.mark((function e(t){var r,n,o,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=regeneratorRuntime.keys(this._ngwLayers);case 1:if((e.t1=e.t0()).done){e.next=21;break}if(r=e.t1.value,(n=this._ngwLayers[r]).resourceId!==t){e.next=8;break}return e.abrupt("return",n&&n.layer);case 8:if(!n.layer.getIdentificationIds){e.next=14;break}return e.next=11,n.layer.getIdentificationIds();case 11:if(!(o=e.sent)||!o.some((function(e){return e===t}))){e.next=14;break}return e.abrupt("return",n.layer);case 14:if(!n.layer.getDependLayers){e.next=19;break}if(i=n.layer.getDependLayers(),!(a=i.find((function(e){return e.item&&e.item.parentId===t})))){e.next=19;break}return e.abrupt("return",a.layer);case 19:e.next=1;break;case 21:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"fitLayer",value:(w=B(regeneratorRuntime.mark((function e(t,r){var n,o,i,a,s,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="string"==typeof t||"number"==typeof t?String(n):t.id,!(o=n&&this._ngwLayers[n])){e.next=21;break}if(!o.layer.getBounds){e.next=10;break}return e.next=6,o.layer.getBounds();case 6:(i=e.sent)&&this.fitBounds(i,r),e.next=19;break;case 10:if(!o.layer.item){e.next=14;break}a=o.layer.item,e.next=18;break;case 14:return s=o.resourceId,e.next=17,this.connector.getResource(s);case 17:a=e.sent;case 18:a&&(0,h.U2)(a,this.connector).then((function(e){e&&c.fitBounds(e,r)}));case 19:e.next=22;break;case 21:T(q(Z.prototype),"fitLayer",this).call(this,t,r);case 22:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"zoomToLayer",value:(g=B(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fitLayer(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"onLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ngw-map:create";return T(q(Z.prototype),"onLoad",this).call(this,e)}},{key:"removeLayer",value:function(e){var t=this.getLayer(e);if(t){var r=this.getLayerId(t);r&&delete this._ngwLayers[r],T(q(Z.prototype),"removeLayer",this).call(this,t)}}},{key:"enableSelection",value:function(){var e=this;this.$$selectFromNgwRaster||(this.$$selectFromNgwRaster=function(t){e.emitter.listenerCount("ngw:select")&&e._selectFromNgwRaster(t)},this.$$selectFromNgwVector=function(t){e.emitter.listenerCount("ngw:select")&&e._selectFromNgwVector(t)},this.emitter.on("click",this.$$selectFromNgwRaster),this.emitter.on("layer:click",this.$$selectFromNgwVector))}},{key:"disableSelection",value:function(){this.$$selectFromNgwRaster&&(this.emitter.removeListener("click",this.$$selectFromNgwRaster),this.emitter.removeListener("click",this._selectFromNgwVector),this.$$selectFromNgwRaster=void 0,this.$$selectFromNgwVector=void 0)}},{key:"getNgwLayerItem",value:function(e){return this.fetchNgwLayerItem(e)}},{key:"getNgwLayerItems",value:function(e){return this.fetchNgwLayerItems(e)}},{key:"getNgwLayerFeature",value:function(e){return this.fetchNgwLayerFeature(e)}},{key:"getNgwLayerFeatures",value:function(e){return this.fetchNgwLayerFeatures(e)}},{key:"cancelPromise",value:function(){this.cancelPromises.apply(this,arguments)}},{key:"cancelPromises",value:function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.length||(r=Object.keys(this._promises)),r.forEach((function(t){var r=e._promises[t];r&&(r.forEach((function(e){return e.cancel()})),e._promises[t]=[])}))}},{key:"_addPromise",value:function(e,t){var r=this._promises[e];if(r&&-1===r.indexOf(t)){var n=function(){var e=r.indexOf(t);-1!==e&&r.splice(e,1)};t.then(n),t.catch(n),r.push(t)}}},{key:"_isFitFromResource",value:function(){var e=this._initMapState;return!e.zoom||!e.center}},{key:"_createWebMap",value:(v=B(regeneratorRuntime.mark((function e(){var t,r,n,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.create();case 2:this.options.qmsId&&this._addQmsBaseLayer(),this.options.osm&&this._addOsmBaseLayer(),t=[],r=this._isFitFromResource(),this.options.webmapId&&L(t,this.options.webmapId,{fit:r}),this.options.resources&&Array.isArray(this.options.resources)&&this.options.resources.forEach((function(e){var n={};r||(n.fit=!1),L(t,e,{},n)})),n=0,o=t;case 9:if(!(n<o.length)){e.next=22;break}return i=o[n],e.prev=11,e.next=14,this.addNgwLayer(i);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(11),console.log(e.t0);case 19:n++,e.next=9;break;case 22:this._emitStatusEvent("ngw-map:create",this),this.enableSelection();case 24:case"end":return e.stop()}}),e,this,[[11,16]])}))),function(){return v.apply(this,arguments)})},{key:"_addOsmBaseLayer",value:function(){this.addBaseLayer("OSM")}},{key:"_addQmsBaseLayer",value:function(){var e,t;Array.isArray(this.options.qmsId)?(e=this.options.qmsId[0],t=this.options.qmsId[1]):e=Number(this.options.qmsId);var r={qmsId:e};t&&(r.id=t),this.addBaseLayer("QMS",r)}},{key:"_selectFromNgwVector",value:function(e){var t=e.layer,r=t.item&&t.item.resource.id,n=e.feature;if(void 0!==r&&n){var o=n.id;if(o){var i=G({featureCount:1},r,{featureCount:1,features:[{id:Number(o),fields:n.properties||{},label:"#".concat(r),layerId:Number(r),parent:"",geom:n.geometry}]});return this._emitStatusEvent("ngw:select",this._prepareToIdentify(D(D({},i),{},{resources:[r],sourceType:"vector"}))),i}}}},{key:"_selectFromNgwRaster",value:(b=B(regeneratorRuntime.mark((function e(t){var r,n,o,i,a,s,c,u,f,l,p=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._emitStatusEvent("ngw:preselect"),r=[],(n=Object.values(this._ngwLayers)).sort((function(e,t){return e.layer.order&&t.layer.order?t.layer.order-e.layer.order:1})),n.forEach((function(e){var t=e.layer,n="function"==typeof t.getIdentificationIds&&t.getIdentificationIds;n&&t.options.selectable&&p.isLayerVisible(t)&&r.push(n.call(t))})),o=Promise.all(r),e.next=8,o;case 8:if(i=e.sent,a=[],i.forEach((function(e){e&&e.forEach((function(e){return a.push(e)}))})),a.length){e.next=14;break}return this._emitStatusEvent("ngw:select",null),e.abrupt("return");case 14:if(s=this.options.pixelRadius||10,c=this.getCenter(),u=void 0!==(u=this.getZoom())?u:20,c&&u){e.next=21;break}return this._emitStatusEvent("ngw:select",null),e.abrupt("return");case 21:return f=E(c,u,s),l=(0,y.PA)(t,{layers:a,connector:this.connector,radius:f}).then((function(e){return p._emitStatusEvent("ngw:select",p._prepareToIdentify(D(D({},e),{},{resources:a,sourceType:"raster",event:t}))),e})),this._addPromise("select",l),e.abrupt("return",l);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"_prepareToIdentify",value:function(e){var t=this;return D(D({},e),{},{getIdentifyItems:function(){return(0,y.RP)(e,!0).map((function(e){return(0,y.u4)({feature:e.feature,connector:t.connector})}))}})}},{key:"_whiteLabel",value:(s=B(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.getContainer())){e.next=6;break}return e.next=4,(0,d.G)(this.connector,this.options.companyLogoOptions);case 4:(r=e.sent)&&t.appendChild(r);case 6:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})}],r&&C(t.prototype,r),Z}(s.y9);G(Z,"getIcon",b.q)}}]);
//# sourceMappingURL=main-14ae4fd15204845.js.map