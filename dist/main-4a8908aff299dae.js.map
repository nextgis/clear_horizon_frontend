{"version":3,"sources":["webpack://clear_horizon/./@nextgis/packages/tree/src/treeFilter.ts","webpack://clear_horizon/./@nextgis/packages/tree/src/Tree.ts","webpack://clear_horizon/./@nextgis/packages/url-runtime-params/src/UrlRuntimeParams.ts","webpack://clear_horizon/./@nextgis/packages/url-runtime-params/src/index.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/applyMixins.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/defined.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/deepmerge.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/deprecated/deprecatedMapClick.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/deprecated/deprecatedWarn.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/debounce.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/geom/getBoundsPolygon.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/platform.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/events.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/geom/constants.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/geom/getCirclePolygon.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/geom/coordTransform.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/object/assign.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/object/equal.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/re/reEscape.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/url.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/Clipboard.ts","webpack://clear_horizon/./@nextgis/packages/utils/src/index.ts","webpack://clear_horizon/./@nextgis/packages/webmap/src/components/keys/KeysCodes.ts","webpack://clear_horizon/./@nextgis/packages/webmap/src/components/keys/Keys.ts","webpack://clear_horizon/./@nextgis/packages/webmap/src/components/mapStates/StateItem.ts","webpack://clear_horizon/./@nextgis/packages/webmap/src/components/mapStates/CenterState.ts","webpack://clear_horizon/./@nextgis/packages/webmap/src/components/mapStates/ZoomState.ts","webpack://clear_horizon/./@nextgis/packages/webmap/src/WebMapMain.ts","webpack://clear_horizon/./@nextgis/packages/webmap/src/utils/clearObject.ts","webpack://clear_horizon/./@nextgis/packages/webmap/src/utils/geometryTypes.ts","webpack://clear_horizon/./@nextgis/packages/webmap/src/utils/updateGeoJsonAdapterOptions.ts","webpack://clear_horizon/./@nextgis/packages/webmap/src/WebMapLayers.ts","webpack://clear_horizon/./@nextgis/packages/webmap/src/components/controls/createToggleControl.ts","webpack://clear_horizon/./@nextgis/packages/webmap/src/WebMapControls.ts","webpack://clear_horizon/./@nextgis/packages/webmap/src/WebMap.ts"],"names":["treeEvery","item","filter","relation","itemPrepare","treeWrapper","treeEvery_","treeSome","treeFind_","treeFind","treeFilter","treeFilter_","getChildren","children","relChild","i","Array","isArray","push","undefined","treeFunction","x","filterFunction","filterFunc","_filtered","relChildren","fry","length","result","options","this","forEach","addChild","treeItem","childTreeItem","Tree","Object","defineProperty","value","getParents","every","t","some","find","_params","get","name","params","window","location","href","replace","m","key","decodeURIComponent","set","search","urlComponent","encodeURIComponent","RegExp","data","state","url","_pushState","remove","paramsArr","sourceUrl","rtn","split","queryString","indexOf","splice","join","type","history","replaceState","document","title","applyMixins","derivedCtor","baseCtors","opt","derivedProperties","obj","_props","getPrototypeOf","op","getOwnPropertyNames","_allProperties","prototype","baseCtor","isSomeProp","descriptor","getOwnPropertyDescriptor","mixinProperties","properties","defined","val","deepmerge","target","src","mergeArray","target_","src_","array","dst","concat","e","keys","deprecatedMapClick","ev","lngLat","latLng","lat","lng","deprecatedWarn","message","console","warn","debounce","cb","wait","timeoutId","wrapper","clear","setTimeout","apply","args","clearTimeout","getBoundsPolygon","b","coordinates","getBoundsCoordinates","westNorth","getBoundsFeature","geometry","emitter","_eventsStatus","setEventStatus","event","status","onLoad","promises","map","Promise","res","getEventStatus","once","all","then","_eventName","d2r","Math","PI","r2d","getCirclePolygonCoordinates","radius","points","rlat","rlng","cos","extp","theta","ex","ey","sin","degrees2meters","y","log","tan","sources","source","prop","deepEqual","obj1","obj2","keys1","keys2","val1","val2","areObjects","reEscape","s","fixUrlStr","text","silent","copy","clipboard","Clipboard","navigator","writeText","clipboardData","setData","copyToClipboard","input","createElement","body","appendChild","copyNodeContentsToClipboard","removeChild","select","setSelectionRange","execCommand","toString","call","keyCodeAlias","KeyCodes","_windowOnFocus","windowOnFocus","bind","_keysPressed","keysPressed","_keysReleased","keysReleased","addKeyboardEventsListener","pressed","keyName","code","addEventListener","removeKeyboardEventsListener","removeEventListener","stopPropagation","keyCode","webMap","setValue","getValue","getCenter","setCenter","d","toFixed","parse","str","Number","StateItem","zoom","getZoom","round","setZoom","String","ID","WEB_MAP_CONTAINER","OPTIONS","minZoom","maxZoom","paint","color","opacity","strokeOpacity","stroke","weight","selectedPaint","create","mapOptions","EventEmitter","WebMapMain","runtimeParams","getPaintFunctions","mapState","CenterState","ZoomState","id","_initMapState","_mapState","_mapEvents","mapAdapter","_starterKits","starterKits","_addEventsListeners","tileJson","_setTileJsonOptions","getId","_setInitMapState","_setupMap","_emitStatusEvent","setRuntimeParams","destroy","_removeEventListeners","member","clearObject","getState","getRuntimeParams","getContainer","HTMLElement","element","getElementById","setCursor","cursor","getCursor","container","style","getBounds","bounds","zoomIn","toZoom","zoomOut","setView","fitBounds","onMapLoad","_resolve","isLoaded","getLayerAdapters","layerAdapters","getLayerAdapter","locate","events","stop","stopGetCoordFromMapClick","_coordFromMapClickPromise","cancel","getCoordFromMapClick","resolve","reject","onCancel","include","onCancel_","off","onMapClick","eventName","emit","_addLayerProviders","_onLoadSync","Error","_zoomToInitialExtent","center","maxzoom","minzoom","_extent","states","X","configurable","enumerable","includes","r","mapEvent","on","entries","removeListener","Keys","findMostFrequentGeomType","arr","maxName","counts","c","count","paintTypeAlias","polygon","line","point","typeAlias","Point","LineString","MultiPoint","Polygon","MultiLineString","MultiPolygon","_layersIdCounter","_layersOrderCounter","_baselayers","_layers","_selectedLayers","addTileJsonLayer","fitLayer","layerDef","layer","getLayer","getExtent","extent","isBaseLayer","getBaseLayers","baselayers","baselayer","getBaseLayersIds","getLayerId","getLayers","allLayers","findLayer","l","layerAdapter","isLayerVisible","visibility","addBaseLayer","adapter","addLayer","order","_order","reserveOrder","adapterEngine","geoJsonOptions","_updateGeoJsonOptions","onBeforeAddLayer","modified","_adapter","layerId","filterLayer","showLayer","setLayerOpacity","fit","addLayerFromAsyncAdapter","removeLayers","allowCb","allow","removeLayer","removeOverlays","beforeRemove","index","addGeoJsonLayer","multiselect","unselectOnSecondClick","geomType","geojson","features","f","geometries","g","p","updateGeoJsonAdapterOptions","toggleLayer","hideLayer","onMap","toStatus","preEventName","anotherVisibleLayerBaseLayer","setLayerOrder","action","updateLayer","selectLayer","findFeatureFun","unSelectLayer","unselect","propertiesFilter","filters","feature","removeLayerFilter","removeFilter","setLayerData","clearLayer","addData","addLayerData","clearLayerData","getAttributions","attributions","layerCache","useLayerAttr","onlyVisible","onlyBaselayer","attr","attribution","getActiveBaseLayer","visibleLayerBaseLayer","tiles","subdomains","scheme","_onLayerClick","_onLayerSelect","onLayerClickFromOpt","onLayerClick","onLayerSelectFromOpt","onLayerSelect","nativePaint","createToggleControl","createButtonControl","link","getStatus","html","setTitle","setAttribute","_setHtml","htmlDef","innerHTML","setHtml","_setClass","addClass","impact","classList","add","setClass","addClassOn","addClassOff","changeStatus","status_","onClick","afterClick","catch","buttonControl","_loadControlQueue","_isControlLoading","addControl","controlDef","position","control","getControl","_setControlQueue","_control","createControl","removeControl","engine","controlAdapters","createFun","WebMapControls","controls","_applyControls","controlCb","CONTROL","BUTTON","TOGGLE","WebMapLayers","_addControls","WebMap","kit","adapters","createAdapter","newAdapter","onLoadSync","error","controlAdapterName","controlOptions","controlsOptions"],"mappings":"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","file":"main-4a8908aff299dae.js","sourcesContent":["import { propertiesFilter, PropertyFilter } from '@nextgis/properties-filter';\nimport {\n  DefaultTreeItem,\n  RelationFunction,\n  SelfFilter,\n  TreeRelation,\n} from './interfaces';\n\ntype D = DefaultTreeItem;\n\ntype TreeFunction<X extends D> = (\n  item: X | X[],\n  filter: SelfFilter<X>,\n  relation: TreeRelation<X>\n) => X | X[] | boolean | undefined;\n\ntype ItemPrepareFunction<F extends D> = (item: D) => F;\n\nexport function treeEvery<F extends D = D>(\n  item: F | F[],\n  filter?: PropertyFilter | SelfFilter<F>,\n  relation?: TreeRelation<F>,\n  itemPrepare?: ItemPrepareFunction<F>\n): boolean {\n  return !!treeWrapper<F>(item, filter, relation, treeEvery_, itemPrepare);\n}\n\nexport function treeSome<F extends D = D>(\n  item: F | F[],\n  filter?: PropertyFilter | SelfFilter<F>,\n  relation?: TreeRelation<F>,\n  itemPrepare?: ItemPrepareFunction<F>\n): boolean {\n  return !!treeWrapper<F>(item, filter, relation, treeFind_, itemPrepare);\n}\n\nexport function treeFind<F extends D = D>(\n  item: F | F[],\n  filter?: PropertyFilter | SelfFilter<F>,\n  relation?: TreeRelation<F>,\n  itemPrepare?: ItemPrepareFunction<F>\n): F | undefined {\n  return treeWrapper<F>(item, filter, relation, treeFind_, itemPrepare) as F;\n}\n\nexport function treeFilter<F extends D = D>(\n  item: F | F[],\n  filter?: PropertyFilter | SelfFilter<F>,\n  relation?: TreeRelation<F>,\n  itemPrepare?: ItemPrepareFunction<F>\n): F[] {\n  return treeWrapper<F>(\n    item,\n    filter,\n    relation,\n    treeFilter_,\n    itemPrepare\n  ) as F[];\n}\n\nexport function getChildren<F extends D = D>(\n  item: F,\n  relation: TreeRelation<F> = 'children'\n): F[] | undefined {\n  let children: F[] = [];\n  const relationFunction: RelationFunction<F> =\n    typeof relation === 'function' ? relation : (i): F[] => i[relation];\n  const relChild = relationFunction(item);\n  if (relChild) {\n    if (Array.isArray(relChild)) {\n      children = relChild;\n    } else {\n      children.push(relChild);\n    }\n  }\n  return relChild ? children : undefined;\n}\n\nfunction treeWrapper<F extends D = D>(\n  item: F | F[],\n  filter: PropertyFilter | SelfFilter<F> = (x: F): boolean => !!x,\n  relation: TreeRelation<F> = 'children',\n  treeFunction: TreeFunction<F>,\n  itemPrepare?: ItemPrepareFunction<F>\n): F[] | F | boolean | undefined {\n  const filterFunction: SelfFilter<F> =\n    typeof filter === 'function'\n      ? filter\n      : (i: F): boolean => propertiesFilter(i, filter);\n  if (itemPrepare) {\n    return treeFunction(\n      item,\n      (i: F): boolean => filterFunction(itemPrepare(i)),\n      relation\n    );\n  }\n  return treeFunction(item, filterFunction, relation);\n}\n\nfunction treeFind_<F extends D = D>(\n  item: F | F[],\n  filterFunc: SelfFilter<F> = (x: F): boolean => !!x,\n  relation: TreeRelation<F>,\n  _filtered: F[] = []\n): F | undefined {\n  let children: F[] = [];\n  if (Array.isArray(item)) {\n    children = item;\n  } else {\n    const filter = filterFunc(item);\n    if (filter) {\n      return item;\n    }\n    const relChildren = getChildren(item, relation);\n    if (relChildren) {\n      children = relChildren;\n    }\n  }\n\n  for (let fry = 0; fry < children.length; fry++) {\n    if (children[fry]) {\n      const result = treeFind_(children[fry], filterFunc, relation, _filtered);\n      if (result) {\n        return result;\n      }\n    }\n  }\n}\n\nfunction treeFilter_<F extends D = D>(\n  item: F | F[],\n  filterFunc: SelfFilter<F> = (x: F): boolean => !!x,\n  relation: TreeRelation<F>,\n  _filtered: F[] = []\n): F[] {\n  let children: F[] = [];\n  if (Array.isArray(item)) {\n    children = item;\n  } else {\n    const filter = filterFunc(item);\n    if (filter) {\n      _filtered.push(item);\n    }\n    const relChildren = getChildren(item, relation);\n    if (relChildren) {\n      children = relChildren;\n    }\n  }\n\n  for (let fry = 0; fry < children.length; fry++) {\n    if (children[fry]) {\n      treeFilter_(children[fry], filterFunc, relation, _filtered);\n    }\n  }\n\n  return _filtered;\n}\n\nfunction treeEvery_<F extends D = D>(\n  item: F | F[],\n  filterFunc: SelfFilter<F> = (x: F): boolean => !!x,\n  relation: TreeRelation<F>,\n  _filtered: F[] = []\n): boolean {\n  let children: F[] = [];\n  if (Array.isArray(item)) {\n    children = item;\n  } else {\n    const filter = filterFunc(item);\n    if (!filter) {\n      return false;\n    }\n    const relChildren = getChildren(item, relation);\n    if (relChildren) {\n      children = relChildren;\n    }\n  }\n\n  for (let fry = 0; fry < children.length; fry++) {\n    if (children[fry]) {\n      const res = treeEvery_(children[fry], filterFunc, relation, _filtered);\n      if (!res) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\n","import { PropertyFilter } from '@nextgis/properties-filter';\nimport {\n  DefaultTreeItem,\n  SelfFilter,\n  TreeOptions,\n  TreeRelation,\n} from './interfaces';\nimport {\n  getChildren,\n  treeEvery,\n  treeFilter,\n  treeFind,\n  treeSome,\n} from './treeFilter';\n\nexport class Tree<TREE_ITEM = any> {\n  relation: TreeRelation = 'children';\n  children: Tree<TREE_ITEM>[] = [];\n\n  protected _parent?: Tree<TREE_ITEM>;\n\n  constructor(\n    public item: DefaultTreeItem = { children: [] },\n    options: TreeOptions<any> = {}\n  ) {\n    if (options.relation) {\n      this.relation = options.relation;\n    }\n    const children = getChildren(item, options.relation);\n    if (children && children.length) {\n      children.forEach((x) => {\n        this.addChild(x);\n      });\n    }\n  }\n\n  addChild(treeItem: TREE_ITEM): void {\n    const childTreeItem = new Tree(treeItem, { relation: this.relation });\n    Object.defineProperty(childTreeItem, '_parent', { value: this });\n    this.children.push(childTreeItem);\n  }\n\n  getParents(): Tree[] {\n    return treeFilter(this, (x) => !!x, '_parent');\n  }\n\n  every(filter?: PropertyFilter | SelfFilter): boolean {\n    return !!treeEvery(this, filter, this.relation, (t) => t.item);\n  }\n\n  some(filter?: PropertyFilter | SelfFilter): boolean {\n    return !!treeSome(this, filter, this.relation, (t) => t.item);\n  }\n\n  find(filter?: PropertyFilter | SelfFilter<TREE_ITEM>): Tree {\n    return treeFind<any>(this, filter, this.relation, (t) => t.item);\n  }\n\n  filter(filter?: PropertyFilter | SelfFilter<TREE_ITEM>): Tree[] {\n    return treeFilter<any>(this, filter, this.relation, (t) => t.item);\n  }\n}\n","import { RuntimeParams } from '@nextgis/webmap';\nimport { Params, StateData } from './interfaces';\n\nexport class UrlRuntimeParams implements RuntimeParams {\n  private _params: Params = {};\n\n  get(name: string): any {\n    return this.params()[name];\n  }\n\n  params(): Record<string, string> {\n    // if (this._params) {\n    //   return this._params;\n    // }\n    const params: Params = {};\n    window.location.href.replace(/[?&]+(\\w+)([^&]*)/gi, function (m, key) {\n      params[key] = true;\n      return ''; // does not matter\n    });\n    window.location.href.replace(\n      /[?&]+([^=&]+)=([^&]*)/gi,\n      function (m, key, value) {\n        params[key] = decodeURIComponent(value);\n        return ''; // does not matter\n      }\n    );\n    this._params = params;\n    return params;\n  }\n\n  set(name: string, value: string): StateData {\n    if (value) {\n      let search: string;\n      const urlComponent = encodeURIComponent(value);\n      const existUrlParam = this.get(name);\n      if (existUrlParam) {\n        search = location.search.replace(\n          new RegExp('([?|&]' + name + '=)' + '(.+?)(&|$)'),\n          '$1' + urlComponent + '$3'\n        );\n      } else if (location.search.length) {\n        search = location.search + '&' + name + '=' + urlComponent;\n      } else {\n        search = '?' + name + '=' + urlComponent;\n      }\n      const params: Params = {};\n      params[name] = value;\n      this._params[name] = value;\n      const data: StateData = { state: { url: search, params }, url: search };\n      this._pushState(data);\n      return data;\n    } else {\n      return this.remove(name);\n    }\n  }\n\n  remove(name: string): StateData {\n    const sourceUrl = location.search;\n    let rtn = sourceUrl.split('?')[0];\n    let param: string;\n    let paramsArr: string[];\n    const queryString =\n      sourceUrl.indexOf('?') !== -1 ? sourceUrl.split('?')[1] : '';\n    if (queryString !== '') {\n      paramsArr = queryString.split('&');\n      for (let i = paramsArr.length - 1; i >= 0; i -= 1) {\n        param = paramsArr[i].split('=')[0];\n        if (param === name) {\n          paramsArr.splice(i, 1);\n        }\n      }\n      rtn = rtn + '?' + paramsArr.join('&');\n    }\n\n    delete this._params[name];\n\n    const data: StateData = { state: { url: rtn, type: 'remove' }, url: rtn };\n    this._pushState(data);\n\n    return data;\n  }\n\n  private _pushState(data: StateData): void {\n    if (history) {\n      history.replaceState(null, document.title, data.url);\n    }\n  }\n}\n","import { UrlRuntimeParams } from './UrlRuntimeParams';\n\nexport * from './interfaces';\n\nexport default UrlRuntimeParams;\n","export interface ApplyMixinOptions {\n  replace?: boolean;\n}\n\ntype Ctor = any;\n\nexport function applyMixins(\n  derivedCtor: Ctor,\n  baseCtors: Ctor[],\n  opt: ApplyMixinOptions = {}\n): void {\n  const derivedProperties = allProperties(derivedCtor.prototype);\n  const replace = opt.replace !== undefined ? opt.replace : true;\n  baseCtors.forEach((baseCtor) => {\n    Object.getOwnPropertyNames(baseCtor.prototype).forEach((name) => {\n      const isSomeProp = derivedProperties.indexOf(name) !== -1;\n      if ((!replace && !isSomeProp) || replace) {\n        const descriptor = Object.getOwnPropertyDescriptor(\n          baseCtor.prototype,\n          name\n        );\n        if (descriptor) {\n          Object.defineProperty(derivedCtor.prototype, name, descriptor);\n        }\n      }\n    });\n  });\n}\n\nexport function allProperties(obj: Record<string, unknown>): string[] {\n  return _allProperties(obj);\n}\n\nexport function _allProperties(\n  obj: Record<string, unknown>,\n  _props: string[] = []\n): string[] {\n  for (; obj !== null; obj = Object.getPrototypeOf(obj)) {\n    const op = Object.getOwnPropertyNames(obj);\n    for (let i = 0; i < op.length; i++) {\n      if (_props.indexOf(op[i]) == -1) {\n        _props.push(op[i]);\n      }\n    }\n  }\n  return _props;\n}\n\nexport function mixinProperties(\n  derivedCtor: Ctor,\n  baseCtor: Ctor,\n  properties: string[]\n): void {\n  properties.forEach((name) => {\n    const descriptor = Object.getOwnPropertyDescriptor(\n      baseCtor.prototype,\n      name\n    );\n    if (descriptor) {\n      Object.defineProperty(derivedCtor.prototype, name, descriptor);\n    }\n  });\n}\n","/**\n * from https://github.com/CesiumGS/cesium/blob/master/Source/Core/defined.js\n *\n * @param val - The object.\n * @returns Returns true if the object is defined, returns false otherwise.\n *\n * @example\n * ```javascript\n * if (defined(positions)) {\n *   doSomething();\n * } else {\n *   doSomethingElse();\n * }\n * ```\n */\nexport function defined<T>(val: T): val is Exclude<T, null | undefined> {\n  return val !== undefined && val !== null;\n}\n\n/**\n * from https://github.com/CesiumGS/cesium/blob/master/Source/Core/defined.js\n *\n * @param val - The object.\n * @returns Returns true if the object is defined and not empty string, returns false otherwise.\n *\n * @example\n * ```javascript\n * full('foo') // true\n * full('') // false\n * full(undefined) // false\n * full(0) // true\n * ```\n */\nexport function full<T>(val: T): val is Exclude<T, null | undefined> {\n  return typeof val === 'string' ? !!val : defined(val);\n}\n","export function deepmerge<T>(\n  x: Partial<T>,\n  y: Partial<T>,\n  mergeArray?: boolean\n): T;\nexport function deepmerge<T1, T2>(\n  target: Partial<T1>,\n  src: Partial<T2>,\n  mergeArray = false\n): T1 & T2 {\n  let target_ = target as any;\n  const src_ = src as any;\n  const array = Array.isArray(src_);\n  let dst: any = (array && []) || {};\n\n  if (array && Array.isArray(src_)) {\n    if (mergeArray) {\n      target_ = target_ || [];\n      dst = dst.concat(target_);\n      src_.forEach((e: any, i: number) => {\n        if (typeof dst[i] === 'undefined') {\n          dst[i] = e;\n        } else if (typeof e === 'object') {\n          dst[i] = deepmerge(target_[i], e, mergeArray);\n        } else {\n          if (target_.indexOf(e) === -1) {\n            dst.push(e);\n          }\n        }\n      });\n    } else {\n      // Replace array. Do not merge by default\n      dst = src_;\n    }\n  } else {\n    if (target_ && typeof target_ === 'object') {\n      Object.keys(target_).forEach(function (key) {\n        dst[key] = target_[key];\n      });\n    }\n    Object.keys(src_).forEach(function (key) {\n      if (typeof src_[key] !== 'object' || !src_[key]) {\n        dst[key] = src_[key];\n      } else {\n        if (typeof target_[key] === 'object' && typeof src_[key] === 'object') {\n          dst[key] = deepmerge(target_[key], src_[key], mergeArray);\n        } else {\n          dst[key] = src_[key];\n        }\n      }\n    });\n  }\n  return dst;\n}\n","import { debugLog } from '../debug/debugLog';\nimport { LatLng } from '../geom/interfaces';\nimport { LngLatArray } from '../geom/interfaces';\n\ninterface DeprecatedMapClickEvent {\n  lngLat: LngLatArray;\n  latLng?: LatLng;\n}\n\n/**\n *\n * @param ev @deprecated\n */\nexport function deprecatedMapClick<\n  T extends DeprecatedMapClickEvent = DeprecatedMapClickEvent\n>(ev: T): T {\n  if (!ev.lngLat && ev.latLng) {\n    debugLog('deprecated use of latLng in MapClickEvent, use lngLat instead');\n    const lat = ev.latLng.lat;\n    const lng = ev.latLng.lng;\n    ev.lngLat = [lng, lat];\n  }\n  return ev;\n}\n","export function deprecatedWarn(message: string): void {\n  console.warn(`DEPRECATED WARN: ${message}`);\n}\n","// based on https://github.com/bvaughn/debounce-decorator\n\nexport function debounce<T extends (...args: any[]) => void>(\n  cb: T,\n  wait = 10\n): T & { clear: () => void } {\n  let timeoutId: any;\n\n  function wrapper(this: any, ...args: any[]) {\n    wrapper.clear();\n\n    timeoutId = setTimeout(() => {\n      timeoutId = null;\n      cb.apply(this, args);\n    }, wait);\n  }\n\n  wrapper.clear = function () {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n      timeoutId = null;\n    }\n  };\n\n  return wrapper as T & { clear: () => void };\n}\n\nexport function DebounceDecorator(wait = 10) {\n  return function (\n    target: unknown,\n    key: string,\n    descriptor: PropertyDescriptor\n  ): PropertyDescriptor {\n    return {\n      configurable: true,\n      enumerable: descriptor.enumerable,\n      get: function getter() {\n        // Attach this function to the instance (not the class)\n        Object.defineProperty(this, key, {\n          configurable: true,\n          enumerable: descriptor.enumerable,\n          value: debounce(descriptor.value, wait),\n        });\n        // @ts-ignore\n        return this[key];\n      },\n    };\n  };\n}\n","import { Feature, Polygon } from 'geojson';\nimport { LngLatBoundsArray } from './interfaces';\n\n/**\n * @public\n */\nexport function getBoundsPolygon(b: LngLatBoundsArray): Polygon {\n  const polygon: Polygon = {\n    type: 'Polygon',\n    coordinates: [getBoundsCoordinates(b)],\n  };\n  return polygon;\n}\n\nexport function getBoundsCoordinates(b: LngLatBoundsArray): number[][] {\n  const westNorth = [b[0], b[1]];\n  const eastNorth = [b[2], b[1]];\n  const eastSouth = [b[2], b[3]];\n  const westSouth = [b[0], b[3]];\n\n  return [westNorth, eastNorth, eastSouth, westSouth, westNorth];\n}\n\n/**\n * @public\n */\nexport function getBoundsFeature(b: LngLatBoundsArray): Feature<Polygon> {\n  const feature: Feature<Polygon> = {\n    type: 'Feature',\n    properties: {},\n    geometry: getBoundsPolygon(b),\n  };\n  return feature;\n}\n","export const isBrowser =\n  typeof window !== 'undefined' && typeof window.document !== 'undefined';\n\nexport const type: 'browser' | 'node' = isBrowser ? 'browser' : 'node';\n\nexport function getGlobalVariable(): any {\n  if (isBrowser) {\n    return window;\n  } else {\n    // NativeScript uses global, not window\n    return global;\n  }\n}\n","import { EventEmitter } from 'events';\n\nexport class Events<E = any> {\n  private readonly _eventsStatus: { [key in keyof E]?: boolean } = {};\n\n  constructor(private emitter: EventEmitter) {}\n\n  setEventStatus(event: keyof E, status: boolean): void {\n    this._eventsStatus[event] = status;\n  }\n\n  onLoad(event: keyof E | (keyof E)[]): Promise<this> {\n    const events: (keyof E)[] = Array.isArray(event) ? event : [event];\n    const promises = events.map(\n      (x) =>\n        new Promise((res) => {\n          if (this.getEventStatus(x)) {\n            res(this);\n          } else {\n            const e = x as string | symbol;\n            this.emitter.once(e, () => {\n              this.setEventStatus(x, true);\n              res(this);\n            });\n          }\n        })\n    );\n    return Promise.all(promises).then(() => this);\n  }\n\n  getEventStatus(event: keyof E): boolean {\n    // ugly hack to disable type checking error\n    const _eventName = event as keyof E;\n    const status = this._eventsStatus[_eventName];\n    return status !== undefined ? !!status : false;\n  }\n}\n","/**\n * Radius of the earth in kilometers\n */\nexport const EARTHS_RADIUS = 6371;\n","import { Feature, Polygon } from 'geojson';\nimport { EARTHS_RADIUS } from './constants';\n\nconst d2r = Math.PI / 180; // degrees to radians\nconst r2d = 180 / Math.PI; // radians to degrees\n\nexport function getCirclePolygonCoordinates(\n  lng: number,\n  lat: number,\n  radius = 10,\n  points = 6\n): number[][] {\n  // find the radius in lat/lon\n  const rlat = (radius / EARTHS_RADIUS) * r2d;\n  const rlng = rlat / Math.cos(lat * d2r);\n\n  const extp = [];\n  for (let i = 0; i < points + 1; i++) {\n    // one extra here makes sure we connect the\n\n    const theta = Math.PI * (i / (points / 2));\n    const ex = lng + rlng * Math.cos(theta); // center a + radius x * cos(theta)\n    const ey = lat + rlat * Math.sin(theta); // center b + radius y * sin(theta)\n    extp.push([ex, ey]);\n  }\n\n  return extp;\n}\n\n/**\n * @public\n */\nexport function getCircleFeature(\n  lng: number,\n  lat: number,\n  radius = 10,\n  points = 6\n): Feature<Polygon> {\n  const polygon = getCirclePolygonCoordinates(lng, lat, radius, points);\n  const feature: Feature<Polygon> = {\n    type: 'Feature',\n    properties: {},\n    geometry: {\n      type: 'Polygon',\n      coordinates: [polygon],\n    },\n  };\n  return feature;\n}\n","import { LngLatArray } from './interfaces';\n\nexport function degrees2meters(lng: number, lat: number): [number, number] {\n  lat = lat > 85.06 ? 85.06 : lat < -85.06 ? -85.06 : lat;\n\n  const x = (lng * 20037508.34) / 180;\n  let y = Math.log(Math.tan(((90 + lat) * Math.PI) / 360)) / (Math.PI / 180);\n  y = (y * 20037508.34) / 180;\n  return [x, y];\n}\n\nexport function meters2degrees(x: number, y: number): LngLatArray {\n  const lon = (x * 180) / 20037508.34;\n  const lat =\n    (Math.atan(Math.exp((y * Math.PI) / 20037508.34)) * 360) / Math.PI - 90;\n  return [lon, lat];\n}\n\n// export function degrees2meters2(lon: number, lat: number): [number, number] {\n//   const radius = 6378137.0;\n//   const x = (radius * lon * Math.PI) / 180.0;\n//   const y =\n//     radius * Math.log(Math.tan(Math.PI / 4.0 + (lat * Math.PI) / 360.0));\n//   return [x, y];\n// }\n\n// export function meters2degress2(x: number, y: number): LngLatArray {\n//   const radius = 6378137.0;\n//   const lon = (180 / Math.PI) * (x / radius);\n//   const lat = (360 / Math.PI) * (Math.atan(Math.exp(y / radius)) - Math.PI / 4);\n//   return [lon, lat];\n// }\n\n// const lon = -77.035974;\n// const lat = 38.898717;\n\n// console.log(degrees2meters(lon, lat), degrees2meters2(lon, lat));\n\n// const x = -8575605.398443861;\n// const y = 4707174.018280405;\n\n// console.log(meters2degress(x, y), meters2degress2(x, y));\n","export function assign<T, U>(target: T, source: U): T & U;\n\n/**\n * Copy the values of all of the enumerable own properties from one or more source objects to a\n * target object. Returns the target object.\n * @param target - The target object to copy to.\n * @param source1 - The first source object from which to copy properties.\n * @param source2 - The second source object from which to copy properties.\n */\nexport function assign<T, U, V>(target: T, source1: U, source2: V): T & U & V;\n\n/**\n * Copy the values of all of the enumerable own properties from one or more source objects to a\n * target object. Returns the target object.\n * @param target - The target object to copy to.\n * @param source1 - The first source object from which to copy properties.\n * @param source2 - The second source object from which to copy properties.\n * @param source3 - The third source object from which to copy properties.\n */\nexport function assign<T, U, V, W>(\n  target: T,\n  source1: U,\n  source2: V,\n  source3: W\n): T & U & V & W;\n\n/**\n * Copy the values of all of the enumerable own properties from one or more source objects to a\n * target object. Returns the target object.\n * @param target - The target object to copy to.\n * @param sources - One or more source objects from which to copy properties\n */\nexport function assign(\n  target: Record<string, unknown>,\n  ...sources: any[]\n): any {\n  for (const source of sources) {\n    for (const prop of Object.getOwnPropertyNames(source)) {\n      (target as any)[prop] = source[prop];\n    }\n  }\n}\n","import { isObject } from '..';\n\nexport function deepEqual<T extends Record<string, any> = Record<string, any>>(\n  obj1: T,\n  obj2: T\n): boolean {\n  const keys1 = Object.keys(obj1);\n  const keys2 = Object.keys(obj2);\n\n  if (keys1.length !== keys2.length) {\n    return false;\n  }\n\n  for (const key of keys1) {\n    const val1 = obj1[key];\n    const val2 = obj2[key];\n    const areObjects = isObject(val1) && isObject(val2);\n    if (\n      (areObjects && !deepEqual(val1, val2)) ||\n      (!areObjects && val1 !== val2)\n    ) {\n      return false;\n    }\n  }\n\n  return true;\n}\n","export function reEscape(s: string): string {\n  return s.replace(/[-/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n}\n","export function fixUrlStr(url: string): string {\n  // remove double slash\n  return url.replace(/([^:]\\/)\\/+/g, '$1');\n}\n","export class Clipboard {\n  silent = true;\n\n  constructor(text?: string) {\n    if (text) {\n      this.copy(text);\n    }\n  }\n\n  static copy(text: string): Clipboard {\n    const clipboard = new Clipboard();\n    clipboard.copy(text);\n    return clipboard;\n  }\n\n  copy(text: string): void {\n    try {\n      if ((navigator as any).clipboard) {\n        (navigator as any).clipboard.writeText(text);\n      } else if ((window as any).clipboardData) {\n        (window as any).clipboardData.setData('text', text);\n      } else {\n        this.copyToClipboard(text);\n      }\n      !this.silent && console.log('Copied to Clipboard');\n    } catch (e) {\n      !this.silent && console.log('Please copy coupon manually');\n    }\n  }\n\n  private copyToClipboard(text: string) {\n    const input = document.createElement('input') as HTMLInputElement;\n    input.value = text;\n    try {\n      document.body.appendChild(input);\n      this.copyNodeContentsToClipboard(input);\n    } finally {\n      document.body.removeChild(input);\n    }\n  }\n\n  private copyNodeContentsToClipboard(input: HTMLInputElement) {\n    input.select();\n    input.setSelectionRange(0, 99999); /*For mobile devices*/\n    document.execCommand('copy');\n  }\n}\n","export * from './platform';\n\nexport * from './applyMixins';\nexport * from './array';\nexport * from './defined';\nexport * from './deepmerge';\nexport * from './deprecated';\nexport * from './debounce';\nexport * from './debug';\nexport * from './events';\nexport * from './geom';\nexport * from './object';\nexport * from './flatten';\nexport * from './unflatten';\nexport * from './re';\nexport * from './sleep';\nexport * from './string';\nexport * from './number';\nexport * from './typeHelpers';\nexport * from './url';\nexport * from './Clipboard';\nexport * from './tileJson';\n/**\n * Given an array of member function names as strings, replace all of them\n * with bound versions that will always refer to `context` as `this`. This\n * is useful for classes where otherwise event bindings would reassign\n * `this` to the evented object or some other value: this lets you ensure\n * the `this` value always.\n * Taken from: https://github.com/mapbox/mapbox-gl-js/blob/v1.0.0/src/util/util.js#L243\n */\nexport function bindAll(\n  fns: string[],\n  context: { [method: string]: (...args: any[]) => any }\n): void {\n  fns.forEach((fn) => {\n    if (!context[fn]) {\n      return;\n    }\n    context[fn] = context[fn].bind(context);\n  });\n}\n\nexport function isObject(val: unknown): val is Record<string | number, any> {\n  return Object.prototype.toString.call(val) === '[object Object]';\n}\n\nexport function isArray(val: unknown): val is [] {\n  return Object.prototype.toString.call(val) === '[object Array]';\n}\n","export class KeyCodes {\n  'backspace' = 8;\n  'tab' = 9;\n  'enter' = 13;\n  'shift' = 16;\n  'ctrl' = 17;\n  'alt' = 18;\n  'pause/break' = 19;\n  'caps_lock' = 20;\n  'escape' = 27;\n  'page_up' = 33;\n  'page_down' = 34;\n  'end' = 35;\n  'home' = 36;\n  'left_arrow' = 37;\n  'up_arrow' = 38;\n  'right_arrow' = 39;\n  'down_arrow' = 40;\n  'insert' = 45;\n  'delete' = 46;\n  'left_window_key' = 91;\n  'right_window_key' = 92;\n  'select_key' = 93;\n  'numpad_0' = 96;\n  'numpad_1' = 97;\n  'numpad_2' = 98;\n  'numpad_3' = 99;\n  'numpad_4' = 100;\n  'numpad_5' = 101;\n  'numpad_6' = 102;\n  'numpad_7' = 103;\n  'numpad_8' = 104;\n  'numpad_9' = 105;\n  'multiply' = 106;\n  'add' = 107;\n  'subtract' = 109;\n  'decimal_point' = 110;\n  'divide' = 111;\n  'f1' = 112;\n  'f2' = 113;\n  'f3' = 114;\n  'f4' = 115;\n  'f5' = 116;\n  'f6' = 117;\n  'f7' = 118;\n  'f8' = 119;\n  'f9' = 120;\n  'f10' = 121;\n  'f11' = 122;\n  'f12' = 123;\n  'num_lock' = 144;\n  'scroll_lock' = 145;\n  'semi-colon' = 186;\n  'equal_sign' = 187;\n  ',' = 188; // \"comma\";\n  '-' = 189; // \"dash\";\n  '.' = 190; // \"period\";\n  '/' = 191; // \"forward slash\";\n  '`' = 192; // \"grave accent\";\n  '[' = 219; // \"open bracket\";\n  '\\\\' = 220; // \"back slash\";\n  ']' = 221; // \"close braket\";\n  \"'\" = 222; // \"single quote\"\n}\n","import { KeyCodes } from './KeysCodes';\n\n/**\n * @param {string} key - key symbol\n * @param {string} func - action on key press\n * @param {number} [keyCode] - key code for special button like tab\n *\n * @export\n * @interface KeyControl\n */\nexport interface KeyControl {\n  key?: string;\n  keyCode?: number;\n  func: () => void;\n}\n\nexport class Keys {\n  keyCodeAlias = new KeyCodes();\n\n  keys: { [keyCode: number]: boolean } = {};\n\n  private _windowOnFocus: () => void;\n  private _keysPressed: (e: KeyboardEvent) => void;\n  private _keysReleased: (e: KeyboardEvent) => void;\n\n  constructor() {\n    this._windowOnFocus = this.windowOnFocus.bind(this);\n    this._keysPressed = this.keysPressed.bind(this);\n    this._keysReleased = this.keysReleased.bind(this);\n    this.addKeyboardEventsListener();\n  }\n\n  pressed(keyName: keyof KeyCodes): boolean {\n    const code = this.keyCodeAlias[keyName];\n    return !!code && this.keys[code];\n  }\n\n  addKeyboardEventsListener(): void {\n    if (typeof window !== 'undefined') {\n      window.addEventListener('focus', this._windowOnFocus, false);\n      window.addEventListener('keydown', this._keysPressed, false);\n      window.addEventListener('keyup', this._keysReleased, false);\n    }\n  }\n\n  removeKeyboardEventsListener(): void {\n    if (typeof window !== 'undefined') {\n      window.removeEventListener('focus', this._windowOnFocus, false);\n      window.removeEventListener('keydown', this._keysPressed, false);\n      window.removeEventListener('keyup', this._keysReleased, false);\n    }\n  }\n\n  private keysPressed(e: KeyboardEvent) {\n    e.stopPropagation();\n    if (!this.keys[e.keyCode]) {\n      this.keys[e.keyCode] = true;\n    }\n  }\n\n  private keysReleased(e: KeyboardEvent) {\n    e.stopPropagation();\n    this.keys[e.keyCode] = false;\n  }\n\n  private windowOnFocus() {\n    this.keys = {};\n  }\n}\n","import { MapStateItem } from '../../interfaces/MapState';\nimport { WebMapEvents } from '../../interfaces/Events';\nimport { WebMap } from '../../WebMap';\nimport { MapOptions } from '../../interfaces/MapOptions';\n\nexport abstract class StateItem<V extends any | undefined = any | undefined>\n  implements MapStateItem<V | undefined> {\n  name!: keyof MapOptions;\n  event!: keyof WebMapEvents;\n  protected value?: V;\n\n  constructor(\n    protected webMap: WebMap,\n    opt?: { name?: keyof MapOptions; event?: keyof WebMapEvents; value?: V }\n  ) {\n    if (opt) {\n      if (opt.value) {\n        this.setValue(opt.value);\n      }\n      if (opt.name) {\n        this.name = opt.name;\n      }\n      if (opt.event) {\n        this.event = opt.event;\n      }\n    }\n  }\n\n  getValue(): V | undefined {\n    return this.value;\n  }\n\n  setValue(val: V): void {\n    this.value = val;\n  }\n\n  abstract toString(data: unknown): string;\n  abstract parse(str: string): V;\n}\n","import { StateItem } from './StateItem';\nimport { WebMapEvents } from '../../interfaces/Events';\nimport { LngLatArray } from '../../interfaces/BaseTypes';\nimport { MapOptions } from '../../interfaces/MapOptions';\n\nexport class CenterState extends StateItem<LngLatArray> {\n  name: keyof MapOptions = 'center';\n  event: keyof WebMapEvents = 'moveend';\n\n  getValue(): LngLatArray | undefined {\n    return this.webMap.getCenter();\n  }\n  setValue(val: LngLatArray): void {\n    this.webMap.setCenter(val);\n  }\n  toString(data: LngLatArray): string {\n    const d = data.map((x) => x.toFixed(5));\n    return d[0] + '_' + d[1];\n  }\n  parse(str: string): LngLatArray {\n    const lngLat = str.split('_').map(Number) as LngLatArray;\n    return lngLat;\n  }\n}\n","import { StateItem } from './StateItem';\nimport { WebMapEvents } from '../../interfaces/Events';\nimport { MapOptions } from '../../interfaces/MapOptions';\n\nexport class ZoomState extends StateItem<number> {\n  name: keyof MapOptions = 'zoom';\n  event: keyof WebMapEvents = 'zoomend';\n  getValue(): number | undefined {\n    const zoom = this.webMap.getZoom();\n    return zoom !== undefined ? Math.round(zoom) : undefined;\n  }\n  setValue(val: number): void {\n    this.webMap.setZoom(val);\n  }\n  toString(val: number): string {\n    return String(val);\n  }\n  parse(str: string): number {\n    return Number(str);\n  }\n}\n","import { EventEmitter } from 'events';\nimport StrictEventEmitter from 'strict-event-emitter-types';\nimport { Feature, Polygon } from 'geojson';\n\nimport {\n  deepmerge,\n  defined,\n  Type,\n  getBoundsFeature,\n  TileJson,\n} from '@nextgis/utils';\nimport { GetPaintFunction } from '@nextgis/paint';\nimport CancelablePromise from '@nextgis/cancelable-promise';\nimport { deprecatedMapClick } from '@nextgis/utils';\n\nimport { LngLatBoundsArray, Cursor, LngLatArray } from './interfaces/BaseTypes';\nimport {\n  Locate,\n  MapAdapter,\n  FitOptions,\n  LocateOptions,\n  LocationEvents,\n  MapClickEvent,\n} from './interfaces/MapAdapter';\nimport { StarterKit } from './interfaces/StarterKit';\nimport { LayerAdapter } from './interfaces/LayerAdapter';\nimport { RuntimeParams } from './interfaces/RuntimeParams';\nimport { MapOptions } from './interfaces/MapOptions';\nimport { WebMapEvents, MainMapEvents } from './interfaces/Events';\n\nimport { Keys } from './components/keys/Keys';\nimport { CenterState } from './components/mapStates/CenterState';\nimport { StateItem } from './components/mapStates/StateItem';\nimport { ZoomState } from './components/mapStates/ZoomState';\n\nimport { clearObject } from './utils/clearObject';\n\ntype EmitStatusEventData = any;\n\nlet ID = 0;\n\n/**\n * @internal\n */\nexport const WEB_MAP_CONTAINER: Record<number, any> = {};\n\nconst OPTIONS: MapOptions = {\n  minZoom: 0,\n  maxZoom: 21,\n  paint: {\n    color: 'blue',\n    opacity: 0.4,\n    strokeOpacity: 1,\n    stroke: true,\n    radius: 8,\n    weight: 1,\n  },\n  selectedPaint: {\n    color: 'darkblue',\n    opacity: 0.4,\n    strokeOpacity: 1,\n    stroke: true,\n    radius: 12,\n    weight: 1,\n  },\n  create: true,\n};\n\ninterface AddEventsListenersOptions {\n  include: (keyof MainMapEvents)[];\n}\n\n/**\n * @public\n */\nexport class WebMapMain<\n  M = any,\n  E extends WebMapEvents = WebMapEvents,\n  O extends MapOptions = MapOptions\n> {\n  static keys: Keys = new Keys();\n\n  static getPaintFunctions: { [name: string]: GetPaintFunction };\n\n  options: O = OPTIONS as O;\n  // `WebMapEvents` must be `E` but its not work correct\n  readonly emitter: StrictEventEmitter<\n    EventEmitter,\n    WebMapEvents\n  > = new EventEmitter();\n  readonly keys = WebMapMain.keys;\n\n  readonly mapAdapter: MapAdapter<M>;\n  readonly runtimeParams: RuntimeParams[] = [];\n\n  getPaintFunctions = WebMapMain.getPaintFunctions;\n  mapState: Type<StateItem>[] = [CenterState, ZoomState];\n  id = ID++;\n\n  /**\n   * From runtime params\n   */\n  protected _initMapState: Record<string, any> = {};\n  protected readonly _starterKits: StarterKit[];\n  private _mapState: StateItem[] = [];\n  private _extent?: LngLatBoundsArray;\n  private readonly _eventsStatus: { [key in keyof E]?: boolean } = {};\n  private _coordFromMapClickPromise?: CancelablePromise<LngLatArray>;\n\n  private readonly _mapEvents: {\n    [key in keyof MainMapEvents]?: (...args: any[]) => void;\n  } = {};\n\n  constructor(mapOptions: O) {\n    WEB_MAP_CONTAINER[this.id] = this;\n    this.mapAdapter = mapOptions.mapAdapter as MapAdapter<M>;\n    this._starterKits = mapOptions.starterKits || [];\n    if (mapOptions) {\n      this.options = deepmerge((OPTIONS as O) || {}, mapOptions) as O;\n    }\n    if (this.options.runtimeParams) {\n      this.runtimeParams = this.options.runtimeParams;\n    }\n    this._addEventsListeners();\n\n    if (this.options.tileJson) {\n      this._setTileJsonOptions(this.options.tileJson);\n    }\n    if (this.options.create) {\n      this.create();\n    }\n  }\n\n  getId(): number {\n    return this.id;\n  }\n\n  /**\n   * Manual way to create a map (If {@link MapOptions.create} is `false`).\n   * @example\n   * ```javascript\n   * const webMap = new WebMap(options);\n   * webMap.create().then(() => doSomething());\n   * ```\n   */\n  async create(): Promise<this> {\n    if (!this.getEventStatus('create')) {\n      await this._setInitMapState(this.mapState);\n      await this._setupMap();\n      this._emitStatusEvent('create', this);\n    }\n    return this;\n  }\n\n  setRuntimeParams(params: RuntimeParams): void {\n    this.runtimeParams.push(params);\n  }\n\n  /**\n   * Destroys WebMap, MapAdapter, clears all layers and turn off all event listeners\n   */\n  destroy(): void {\n    this._removeEventListeners();\n    clearObject(this._emitStatusEvent);\n    if (this.mapAdapter.destroy) {\n      this.mapAdapter.destroy();\n    }\n  }\n\n  getState(): Record<string, any> {\n    const state: Record<string, any> = {};\n    this._mapState.forEach((x) => {\n      state[x.name] = x.getValue();\n    });\n    return state;\n  }\n\n  getRuntimeParams(): Record<string, any> {\n    const state: Record<string, any> = {};\n    this._mapState.forEach((x) => {\n      for (const r of this.runtimeParams) {\n        const val = r.get(x.name);\n        if (val !== undefined) {\n          state[x.name] = x.parse(val);\n          break;\n        }\n      }\n    });\n    return state;\n  }\n\n  /**\n   * Returns the HTML element that contains the map.\n   * @returns The map's container\n   */\n  getContainer(): HTMLElement | undefined {\n    if (this.mapAdapter.getContainer) {\n      return this.mapAdapter.getContainer();\n    } else if (this.options.target) {\n      if (this.options.target instanceof HTMLElement) {\n        return this.options.target;\n      } else if (typeof this.options.target === 'string') {\n        const element = document.getElementById(this.options.target);\n        if (element) {\n          return element;\n        }\n      }\n    }\n  }\n\n  /**\n   * Set the cursor icon to be displayed when hover icon on the map container.\n   * @param cursor - Available cursor name from https://developer.mozilla.org/ru/docs/Web/CSS/cursor\n   */\n  setCursor(cursor: Cursor): void {\n    if (this.mapAdapter.setCursor) {\n      this.mapAdapter.setCursor(cursor);\n    }\n  }\n\n  getCursor(): Cursor | undefined {\n    if (this.mapAdapter.getCursor) {\n      return this.mapAdapter.getCursor() as Cursor;\n    }\n    const container = this.getContainer();\n    if (container) {\n      return container.style.cursor as Cursor;\n    }\n  }\n\n  /**\n   * Set the center of the current view.\n   * @param lngLat - Array of two numbers representing longitude and latitude of the center of the map view.\n   *\n   * @example\n   * ```javascript\n   * // Mount Everest 27° 59′ 17″ N, 86° 55′ 31″ E\n   * webMap.setCenter([86.925278, 27.988056]);\n   * ```\n   */\n  setCenter(lngLat: LngLatArray): this {\n    this.mapAdapter.setCenter(lngLat);\n    return this;\n  }\n\n  /**\n   * Returns the map's geographical centerpoint.\n   * @return lngLat Array of two numbers representing longitude and latitude of the center of the map view.\n   *\n   * @example\n   * ```javascript\n   * // Mount Everest 27° 59′ 17″ N, 86° 55′ 31″ E\n   * webMap.getCenter(); // [86.925278, 27.988056]\n   * ```\n   */\n  getCenter(): LngLatArray | undefined {\n    return this.mapAdapter.getCenter();\n  }\n\n  getBounds(): LngLatBoundsArray | undefined {\n    if (this.mapAdapter.getBounds) {\n      return this.mapAdapter.getBounds();\n    }\n  }\n\n  getBoundsPolygon(): Feature<Polygon> | undefined {\n    const bounds = this.getBounds();\n    if (bounds) {\n      const feature = getBoundsFeature(bounds);\n      return feature;\n    }\n  }\n\n  /**\n   * Zoom to a specific zoom level.\n   * @param zoom - The zoom level to set (0-24).\n   */\n  setZoom(zoom: number): this {\n    this.mapAdapter.setZoom(zoom);\n    return this;\n  }\n\n  /**\n   * Returns the map's current zoom level.\n   * @return The map's current zoom level (0-24).\n   */\n  getZoom(): number | undefined {\n    return this.mapAdapter.getZoom();\n  }\n\n  zoomIn(): void {\n    if (this.mapAdapter.zoomIn) {\n      this.mapAdapter.zoomIn();\n    } else {\n      const zoom = this.getZoom();\n      if (zoom) {\n        const toZoom = zoom + 1;\n        this.setZoom(toZoom);\n      }\n    }\n  }\n\n  zoomOut(): void {\n    if (this.mapAdapter.zoomOut) {\n      this.mapAdapter.zoomOut();\n    } else {\n      const zoom = this.getZoom();\n      if (zoom) {\n        const toZoom = zoom - 1;\n        this.setZoom(toZoom);\n      }\n    }\n  }\n\n  /**\n   * Sets the view of the map geographical center and zoom\n   * @param lngLat - Array of two numbers representing longitude and latitude of the center of the map view.\n   * @param zoom - The zoom level to set (0-24).\n   *\n   * @example\n   * ```javascript\n   * // Mount Everest 27° 59′ 17″ N, 86° 55′ 31″ E\n   * webMap.setView([86.925278, 27.988056], 12)\n   * ```\n   */\n  setView(lngLat?: LngLatArray, zoom?: number): void {\n    if (this.mapAdapter.setView && lngLat && defined(zoom)) {\n      this.mapAdapter.setView(lngLat, zoom);\n    } else {\n      if (lngLat) {\n        this.mapAdapter.setCenter(lngLat);\n      }\n      if (defined(zoom)) {\n        this.mapAdapter.setZoom(zoom);\n      }\n    }\n  }\n\n  /**\n   * Sets a map view that contains the given geographical bounds.\n   * @param bounds - Array of coordinates, measured in degrees, in [west, south, east, north] order.\n   *\n   * @example\n   * ```javascript\n   * // Whole world\n   * webMap.fitBounds([0, -90, 180, 90]);\n   * ```\n   */\n  fitBounds(bounds: LngLatBoundsArray, options?: FitOptions): this {\n    if (bounds.every((x) => defined(x))) {\n      if (bounds[1] < -85.06) {\n        bounds[1] = -85.06;\n      }\n      if (bounds[3] > 85.06) {\n        bounds[3] = 85.06;\n      }\n      this.mapAdapter.fitBounds(bounds, options);\n    }\n    return this;\n  }\n\n  /**\n   * Checking the status of any asynchronous operation\n   * @param event - The name of the event whose status is checked\n   *\n   * @example\n   * ```javascript\n   * var webMap = new WebMap(options);\n   * webMap.getEventStatus('create'); // false\n   * webMap.emitter.on('create', function () {\n   *   webMap.getEventStatus('create'); // true\n   * })\n   * ```\n   */\n  getEventStatus(event: keyof E): boolean {\n    // ugly hack to disable type checking error\n    const _eventName = event as keyof WebMapEvents;\n    const status = this._eventsStatus[_eventName];\n    return status ?? false;\n  }\n\n  /**\n   * helper method to wait for events to load. By default, card creation is tracked\n   * @param event - The name of the event whose status is checked\n   *\n   * @example\n   * ```javascript\n   * var webMap = new WebMap(options);\n   * webMap.onLoad().then(function () {\n   *   webMap.getEventStatus('create'); // true\n   * })\n   *\n   * // use async/await syntax\n   * async function () {\n   *   await webMap.onLoad();\n   *   doSomething();\n   * }\n   *\n   * ```\n   */\n  onLoad(event: keyof WebMapEvents = 'create'): Promise<this> {\n    return new Promise((res) => {\n      if (this.getEventStatus(event)) {\n        res(this);\n      } else {\n        this.emitter.once(event, () => {\n          res(this);\n        });\n      }\n    });\n  }\n\n  onMapLoad(cb?: (mapAdapter: MapAdapter) => void): Promise<MapAdapter> {\n    return new Promise((res) => {\n      const _resolve = () => {\n        const mapAdapter = this.mapAdapter;\n        if (cb) {\n          cb(mapAdapter);\n        }\n        if (mapAdapter) {\n          res(mapAdapter);\n        }\n      };\n      const isLoaded = this.mapAdapter.isLoaded ?? true;\n      if (this.mapAdapter.map && isLoaded) {\n        _resolve();\n      } else {\n        this.mapAdapter.emitter.once('create', () => {\n          _resolve();\n        });\n      }\n    });\n  }\n\n  getLayerAdapters(): { [name: string]: Type<LayerAdapter> } {\n    return this.mapAdapter.layerAdapters;\n  }\n\n  getLayerAdapter(name: string): Type<LayerAdapter> {\n    const adapter = this.mapAdapter.layerAdapters[name];\n    return adapter;\n  }\n\n  locate(opt: LocateOptions, events?: LocationEvents): Locate {\n    if (this.mapAdapter && this.mapAdapter.locate) {\n      return this.mapAdapter.locate(opt, events);\n    }\n    const stop = () => ({});\n    return { stop };\n  }\n\n  stopGetCoordFromMapClick(): void {\n    if (this._coordFromMapClickPromise) {\n      this._coordFromMapClickPromise.cancel();\n    }\n  }\n\n  getCoordFromMapClick(): CancelablePromise<LngLatArray> {\n    if (!this._coordFromMapClickPromise) {\n      this._coordFromMapClickPromise = new CancelablePromise(\n        (resolve, reject, onCancel) => {\n          const cursor: Cursor = this.getCursor() || 'grab';\n          this._removeEventListeners({ include: ['click'] });\n          this.setCursor('crosshair');\n          const onCancel_ = (): void => {\n            this.setCursor(cursor);\n            this._addEventsListeners({ include: ['click'] });\n            this.mapAdapter.emitter.off('click', onMapClick);\n            this._coordFromMapClickPromise = undefined;\n          };\n          const onMapClick = (e: MapClickEvent) => {\n            onCancel_();\n            deprecatedMapClick(e);\n            resolve(e.lngLat);\n          };\n          this.mapAdapter.emitter.once('click', onMapClick);\n          onCancel(onCancel_);\n        }\n      );\n    } else {\n      return this.getCoordFromMapClick();\n    }\n    return this._coordFromMapClickPromise;\n  }\n\n  protected _emitStatusEvent(\n    eventName: keyof E,\n    data?: EmitStatusEventData\n  ): void {\n    // ugly hack to disable type checking error\n    const _eventName = eventName as keyof WebMapEvents;\n    this._eventsStatus[_eventName] = true;\n    this.emitter.emit(_eventName, data);\n  }\n\n  protected async _addLayerProviders(): Promise<void> {\n    //\n  }\n\n  protected async _onLoadSync(): Promise<void> {\n    //\n  }\n\n  private async _setupMap(): Promise<this> {\n    if (!this.mapAdapter) {\n      throw new Error('WebMap `mapAdapter` option is not set');\n    }\n    await this.mapAdapter.create(this.options);\n    this._zoomToInitialExtent();\n\n    await this._addLayerProviders();\n    await this._onLoadSync();\n\n    this._emitStatusEvent('build-map', this.mapAdapter);\n    return this;\n  }\n\n  private _setTileJsonOptions(tileJson: TileJson): void {\n    if (tileJson.center) {\n      this.options.center = tileJson.center;\n    }\n    if (tileJson.bounds) {\n      this.options.bounds = tileJson.bounds;\n    }\n    if (defined(tileJson.maxzoom)) {\n      this.options.maxZoom = tileJson.maxzoom;\n      this.options.zoom = tileJson.maxzoom;\n    }\n    if (defined(tileJson.minzoom)) {\n      this.options.minZoom = tileJson.minzoom;\n      this.options.zoom = tileJson.minzoom;\n    }\n    if (defined(tileJson.maxzoom) && defined(tileJson.minzoom)) {\n      this.options.zoom = (tileJson.maxzoom + tileJson.minzoom) / 2;\n    }\n  }\n\n  private _zoomToInitialExtent(): void {\n    const { center, zoom, bounds } = this.options;\n    if (this._extent) {\n      this.fitBounds(this._extent);\n    } else if (center && zoom) {\n      this.setView(center, zoom);\n    } else if (bounds) {\n      this.fitBounds(bounds);\n    }\n  }\n\n  private _setInitMapState(states: Type<StateItem>[]): void {\n    for (const X of states) {\n      const state = new X(this);\n      this._mapState.push(state);\n      for (const r of this.runtimeParams) {\n        const str = r.get(state.name);\n        if (str !== undefined) {\n          const val = state.parse(str);\n          // state.setValue(val);\n          this._initMapState[state.name] = val;\n          Object.defineProperty(this.options, state.name, {\n            value: val,\n            configurable: true,\n            enumerable: true,\n          });\n          break;\n        }\n      }\n    }\n  }\n\n  private _addEventsListeners(opt?: AddEventsListenersOptions): void {\n    let events: (keyof MainMapEvents)[] = [\n      'preclick',\n      'click',\n      'zoomstart',\n      'zoom',\n      'zoomend',\n      'movestart',\n      'move',\n      'moveend',\n    ];\n\n    if (opt && opt.include) {\n      events = events.filter((x) => opt.include.includes(x));\n    }\n    events.forEach((x) => {\n      this._mapEvents[x] = (data): void => {\n        if (this.runtimeParams.length) {\n          const mapStatusEvent = this._mapState.find((y) => y.event === x);\n          if (mapStatusEvent) {\n            const value = mapStatusEvent.toString(mapStatusEvent.getValue());\n            this.runtimeParams.forEach((r) => {\n              r.set(mapStatusEvent.name, value);\n            });\n          }\n        }\n        if (this._eventsStatus) {\n          this.emitter.emit(x, data);\n        }\n      };\n      const mapEvent = this._mapEvents[x];\n      if (mapEvent) {\n        this.mapAdapter.emitter.on(x, mapEvent);\n      }\n    });\n  }\n\n  private _removeEventListeners(opt?: AddEventsListenersOptions): void {\n    let events = Object.entries(this._mapEvents) as [\n      keyof MainMapEvents,\n      ((...args: any[]) => void) | undefined\n    ][];\n    if (opt && opt.include) {\n      events = events.filter((x) => opt.include.includes(x[0]));\n    }\n    events.forEach(([x, event]) => {\n      if (event) {\n        this.mapAdapter.emitter.removeListener(x as keyof MainMapEvents, event);\n      }\n    });\n  }\n}\n","/**\n * @internal\n */\nexport function clearObject(obj: Record<any, any>): void {\n  for (const member in obj) {\n    delete obj[member];\n  }\n}\n","import {\n  GeoJsonObject,\n  GeoJsonGeometryTypes,\n  FeatureCollection,\n  GeometryCollection,\n  Feature,\n} from 'geojson';\n\n/**\n * @internal\n */\nexport function findMostFrequentGeomType(\n  arr: GeoJsonGeometryTypes[]\n): GeoJsonGeometryTypes {\n  const counts: { [x: string]: number } = {};\n  for (let fry = 0; fry < arr.length; fry++) {\n    counts[arr[fry]] = 1 + (counts[arr[fry]] || 0);\n  }\n  let maxName;\n  for (const c in counts) {\n    const count = maxName !== undefined ? counts[maxName] : 0;\n    if (counts[c] > (count || 0)) {\n      maxName = c;\n    }\n  }\n  return maxName as GeoJsonGeometryTypes;\n}\n\n/**\n * @internal\n */\nexport function detectGeometryType(\n  geojson: GeoJsonObject\n): GeoJsonGeometryTypes {\n  let geometry: GeoJsonGeometryTypes;\n  if (geojson.type === 'FeatureCollection') {\n    const featuresTypes = (geojson as FeatureCollection).features.map(\n      (f) => f.geometry.type\n    );\n    geometry = findMostFrequentGeomType(featuresTypes);\n  } else if (geojson.type === 'GeometryCollection') {\n    const geometryTypes = (geojson as GeometryCollection).geometries.map(\n      (g) => g.type\n    );\n    geometry = findMostFrequentGeomType(geometryTypes);\n  } else if (geojson.type === 'Feature') {\n    geometry = (geojson as Feature).geometry.type;\n  } else {\n    geometry = geojson.type;\n  }\n  return geometry;\n}\n","import { isPaint } from '@nextgis/paint';\nimport {\n  GeoJsonAdapterOptions,\n  VectorAdapterLayerType,\n} from '../interfaces/LayerAdapter';\nimport { detectGeometryType } from './geometryTypes';\n\n/**\n * @internal\n */\nexport const paintTypeAlias: Record<VectorAdapterLayerType, any> = {\n  polygon: 'path',\n  line: 'path',\n  point: 'circle',\n};\n\n/**\n * @internal\n */\nexport const typeAlias: { [x: string]: VectorAdapterLayerType } = {\n  Point: 'point',\n  LineString: 'line',\n  MultiPoint: 'point',\n  Polygon: 'polygon',\n  MultiLineString: 'line',\n  MultiPolygon: 'polygon',\n};\n\n/**\n * @internal\n */\nexport function updateGeoJsonAdapterOptions(\n  opt: GeoJsonAdapterOptions\n): GeoJsonAdapterOptions {\n  if (opt.data) {\n    const geomType = typeAlias[detectGeometryType(opt.data)];\n    const p = opt.paint;\n    if (p && isPaint(p)) {\n      // define parameter if not specified\n      p.type = p.type\n        ? p.type\n        : geomType === 'polygon' || geomType === 'line'\n        ? 'path'\n        : 'html' in p || 'className' in p\n        ? 'icon'\n        : paintTypeAlias[geomType];\n    }\n    opt.type = opt.type || geomType;\n  }\n  return opt;\n}\n","import { Feature, GeoJsonObject } from 'geojson';\nimport { preparePaint } from '@nextgis/paint';\nimport { TileJson, Type } from '@nextgis/utils';\nimport { PropertiesFilter, propertiesFilter } from '@nextgis/properties-filter';\n\nimport {\n  LayerAdapter,\n  LayerAdapters,\n  AdapterConstructor,\n  LayerAdaptersOptions,\n  AdapterOptions,\n  GeoJsonAdapterOptions,\n  VectorLayerAdapter,\n  DataLayerFilter,\n  OnLayerClickOptions,\n  FilterOptions,\n  LayerDefinition,\n  LayerAdapterDefinition,\n  OnLayerSelectOptions,\n  MainLayerAdapter,\n  TileAdapterOptions,\n} from './interfaces/LayerAdapter';\n\nimport { LayerDef } from './interfaces/BaseTypes';\n\nimport { updateGeoJsonAdapterOptions } from './utils/updateGeoJsonAdapterOptions';\nimport { WebMapMain } from './WebMapMain';\n\nimport {\n  GetAttributionsOptions,\n  MapOptions,\n  ToggleLayerOptions,\n} from './interfaces/MapOptions';\nimport { WebMapEvents } from './interfaces/Events';\nimport { FitOptions } from './interfaces/MapAdapter';\n\ntype AddedLayers = { [id: string]: LayerAdapter };\n\n/**\n * @public\n */\nexport class WebMapLayers<\n  M = any,\n  L = any,\n  E extends WebMapEvents = WebMapEvents,\n  O extends MapOptions = MapOptions\n> extends WebMapMain<M, E, O> {\n  private _layersIdCounter = 1;\n  private _layersOrderCounter = 1;\n  private readonly _baselayers: string[] = [];\n  private readonly _layers: AddedLayers = {};\n  private readonly _selectedLayers: string[] = [];\n\n  constructor(mapOptions: O) {\n    super(mapOptions);\n    const tileJson = this.options.tileJson;\n    if (tileJson) {\n      this.emitter.once('build-map', () => this.addTileJsonLayer(tileJson));\n    }\n  }\n\n  /**\n   * Try to fit map view by given layer bounds.\n   * But not all layers have borders\n   */\n  async fitLayer(layerDef: LayerDef, options?: FitOptions): Promise<void> {\n    const layer = this.getLayer(layerDef);\n    if (layer && layer.getExtent) {\n      const extent = await layer.getExtent();\n      if (extent) {\n        this.fitBounds(extent, options);\n      }\n    }\n  }\n\n  /**\n   * Check if given layer is baselayer\n   */\n  isBaseLayer(layerDef: LayerDef): boolean | undefined {\n    const layer = this.getLayer(layerDef);\n    if (layer && layer.id) {\n      return this._baselayers.indexOf(layer.id) !== -1;\n    }\n    return undefined;\n  }\n\n  getBaseLayers(): LayerAdapter[] {\n    const baselayers: LayerAdapter[] = [];\n    this._baselayers.forEach((x) => {\n      const baselayer = this._layers[x];\n      if (baselayer) {\n        baselayers.push(baselayer);\n      }\n    });\n    return baselayers;\n  }\n\n  getBaseLayersIds(): string[] {\n    return this._baselayers;\n  }\n\n  /**\n   * Helper method to return added layer object by any definition type.\n   */\n  getLayer<LA extends LayerAdapter = LayerAdapter>(\n    layerDef: LayerDef\n  ): LA | undefined {\n    if (typeof layerDef === 'string') {\n      return this._layers[layerDef] as LA;\n    }\n    return layerDef as LA;\n  }\n\n  /**\n   * Helper method to return added layer identificator by any definition type.\n   */\n  getLayerId(layerDef: LayerDef): string | undefined {\n    const layer = this.getLayer(layerDef);\n    if (layer && layer.options) {\n      return layer.options.id;\n    } else {\n      throw new Error('No id for layer');\n    }\n  }\n\n  /**\n   * Return array of all added layer identifications.\n   */\n  getLayers(): string[] {\n    return Object.keys(this._layers);\n  }\n\n  // TODO: rename to getLayers, getLayers rename to getLayersIds\n  allLayers(): AddedLayers {\n    return this._layers;\n  }\n\n  findLayer<T extends LayerAdapter = LayerAdapter>(\n    filter: (adapter: T) => boolean\n  ): T | undefined {\n    for (const l in this._layers) {\n      const layerAdapter = this._layers[l] as T;\n      const isFit = filter(layerAdapter);\n      if (isFit) {\n        return layerAdapter;\n      }\n    }\n  }\n\n  /**\n   * Check if the given layer on the map\n   */\n  isLayerVisible(layerDef: LayerDef): boolean {\n    const layer = this.getLayer(layerDef);\n    return layer && layer.options.visibility !== undefined\n      ? layer.options.visibility\n      : false;\n  }\n\n  /**\n   * Shortcut method to create base layer\n   */\n  async addBaseLayer<\n    K extends keyof LayerAdapters,\n    O extends AdapterOptions = AdapterOptions\n  >(\n    adapter: K | Type<LayerAdapters[K]>,\n    options?: O | LayerAdaptersOptions[K]\n  ): Promise<LayerAdapter> {\n    const layer = await this.addLayer(adapter, {\n      ...options,\n      baselayer: true,\n    });\n\n    return layer;\n  }\n\n  /**\n   * Registration of map layer.\n   *\n   * @param adapter - The name of layer adapter from [MapAdapter.layerAdapters](webmap#MapAdapter.layerAdapters).\n   *                May be custom object or class implemented by [MainLayerAdapter](webmap#MainLayerAdapter).\n   * @param options - Specific options for given adapter\n   *\n   * @example\n   * ```javascript\n   * webMap.addLayer('TILE', options).then((layer) => webMap.showLayer(layer));\n   *\n   * webMap.addLayer(CustomLayerAdapter, options);\n   * ```\n   */\n  async addLayer<\n    K extends keyof LayerAdapters,\n    O extends AdapterOptions = AdapterOptions\n  >(\n    adapter: LayerAdapterDefinition<K>,\n    options: O | LayerAdaptersOptions[K] = {},\n    order?: number\n  ): Promise<LayerAdapter> {\n    const id = this._layersIdCounter++;\n    const _order =\n      order !== undefined\n        ? order\n        : options.order !== undefined\n        ? options.order\n        : this.reserveOrder();\n    let adapterEngine: Type<LayerAdapter> | undefined;\n    if (typeof adapter === 'string') {\n      adapterEngine = this.getLayerAdapter(adapter);\n    } else if (typeof adapter === 'function') {\n      adapterEngine = adapter as Type<LayerAdapter>;\n    } else if (\n      'then' in (adapter as Promise<Type<LayerAdapters[K]> | undefined>)\n    ) {\n      adapterEngine = (await adapter) as Type<LayerAdapters[K]>;\n    }\n\n    const geoJsonOptions = options as GeoJsonAdapterOptions;\n\n    this._updateGeoJsonOptions(geoJsonOptions);\n\n    const { maxZoom, minZoom } = this.options;\n\n    options = {\n      id: String(id),\n      order: _order,\n      maxZoom,\n      minZoom,\n      ...options,\n    };\n\n    // options.visibility is a layer global state\n    const visibility = options.visibility ?? true;\n    options.visibility = false;\n\n    if (options.baselayer) {\n      options.order = 0;\n    }\n    if (this.options.onBeforeAddLayer) {\n      const modified = this.options.onBeforeAddLayer({\n        options,\n        adapter: adapterEngine,\n      });\n      if (modified) {\n        if (modified.options) {\n          options = modified.options;\n        }\n        if (modified.adapter) {\n          adapterEngine = modified.adapter;\n        }\n      }\n    }\n    if (adapterEngine !== undefined) {\n      const _adapter = new adapterEngine(this.mapAdapter.map, options);\n      _adapter.options = { ...options, ..._adapter.options };\n\n      if (_adapter.options.baselayer) {\n        options.baselayer = true;\n        options.order = 0;\n        _adapter.options.order = 0;\n      }\n\n      let layerId: string | undefined;\n      if (_adapter.options.id) {\n        layerId = String(_adapter.options.id);\n        this._layers[layerId] = _adapter;\n      }\n      this.emitter.emit('layer:preadd', _adapter);\n      await this.onMapLoad();\n      _adapter.map = this.mapAdapter.map;\n      const layer = await _adapter.addLayer(_adapter.options);\n      // checking that the original layer was inserted into the adapter anyway\n      _adapter.layer = layer;\n      // think about how to move `id` to the adapter's constructor,\n      // but that it is not required in the options\n      _adapter.id = _adapter.options.id || String(id);\n      _adapter.options.id = _adapter.id;\n      if (options.baselayer) {\n        _adapter.options.order = 0;\n      }\n      _adapter.order = _adapter.options.order ?? _order;\n      if (layerId) {\n        delete this._layers[layerId];\n      }\n      layerId = String(_adapter.id);\n      if (this._layers[layerId]) {\n        throw Error(`layer with id '${layerId}' already exist`);\n      }\n      if (layerId) {\n        this._layers[layerId] = _adapter;\n        if (geoJsonOptions.filter) {\n          this.filterLayer(_adapter, geoJsonOptions.filter);\n        }\n        if (options.baselayer) {\n          this._baselayers.push(layerId);\n        }\n\n        if (visibility) {\n          await this.showLayer(layerId);\n        }\n      }\n      const opacity = options.opacity;\n      if (opacity !== undefined && opacity <= 1) {\n        this.setLayerOpacity(_adapter, opacity);\n      }\n      if (options.fit && _adapter.getExtent) {\n        const extent = await _adapter.getExtent();\n        if (extent) {\n          await this.fitBounds(extent);\n        }\n      }\n      this.emitter.emit('layer:add', _adapter);\n      return _adapter;\n    }\n    return Promise.reject('No adapter');\n  }\n\n  async addLayerFromAsyncAdapter<\n    K extends keyof LayerAdapters,\n    O extends AdapterOptions = AdapterOptions\n  >(\n    adapter: AdapterConstructor,\n    options: O | LayerAdaptersOptions[K],\n    order?: number\n  ): Promise<LayerAdapter> {\n    const _order =\n      order || options.order !== undefined\n        ? options.order\n        : 0 || this.reserveOrder();\n    const adapterConstructor = adapter as AdapterConstructor;\n    const adapterConstructorPromise = adapterConstructor();\n    const adapterEngine = await adapterConstructorPromise;\n    if (adapterEngine) {\n      return this.addLayer(adapterEngine, options, _order);\n    }\n    return Promise.reject('No adapter');\n  }\n\n  /**\n   * Remove all layer from map and memory.\n   */\n  removeLayers(\n    allowCb?: (layer: string, adapter: LayerAdapter) => boolean\n  ): void {\n    for (const l in this._layers) {\n      let allow = true;\n      if (allowCb) {\n        allow = allowCb(l, this._layers[l]);\n      }\n      if (allow) {\n        this.removeLayer(l);\n        delete this._layers[l];\n      }\n    }\n  }\n\n  reserveOrder(): number {\n    return this._layersOrderCounter++;\n  }\n\n  /**\n   * Remove all layers but not remove basemap.\n   */\n  removeOverlays(): void {\n    this.removeLayers((layerId, layer) => {\n      if (layer && layer.options && layer.options.baselayer) {\n        return false;\n      }\n      return true;\n    });\n  }\n\n  /**\n   * Remove specific layer from map and memory by its definition.\n   */\n  removeLayer(layerDef: LayerDef): void {\n    const layer = this.getLayer(layerDef);\n    const layerId = layer && this.getLayerId(layer);\n    if (layer && layerId) {\n      this.emitter.emit('layer:preremove', layer);\n      if (layer.beforeRemove) {\n        layer.beforeRemove();\n      }\n      if (layer.removeLayer) {\n        layer.removeLayer();\n      } else {\n        this.mapAdapter.removeLayer(layer.layer);\n      }\n      if (layer.options && layer.options.baselayer) {\n        const index = this._baselayers.indexOf(layerId);\n        if (index) {\n          this._baselayers.splice(index, 1);\n        }\n      }\n      delete this._layers[layerId];\n      this.emitter.emit('layer:remove', layer);\n    }\n  }\n\n  /**\n   * Create layer from GeoJson data. Set style and behavior for selection.\n   *\n   * @example\n   * ```javascript\n   * // Add simple layer\n   * webMap.addGeoJsonLayer({ data: geojson, paint: { color: 'red' } });\n   *\n   * // Add styled by feature property layer with selection behavior\n   * webMap.addGeoJsonLayer({\n   *   data: geojson,\n   *   paint: function (feature) {\n   *     return { color: feature.properties.color, opacity: 0.5 }\n   *   },\n   *  selectedPaint: function (feature) {\n   *    return { color: feature.properties.selcolor, opacity: 1 }\n   *  },\n   *  selectable: true,\n   *  multiselect: true\n   * });\n   *\n   * // Add marker layer styled with use [Icons](icons)\n   * webMap.addGeoJsonLayer({ data: geojson, paint: webMap.getIcon({ color: 'orange' })});\n   *\n   * // work with added layer\n   * const layer = webMap.addGeoJsonLayer({ data: geojson, id: 'my_layer_name'});\n   * // access layer by id\n   * webMap.showLayer('my_layer_name');\n   * // or access layer by instance\n   * webMap.showLayer(layer);\n   * ```\n   */\n  // @onMapLoad()\n  async addGeoJsonLayer<K extends keyof LayerAdaptersOptions>(\n    opt: GeoJsonAdapterOptions,\n    adapter?: K | Type<LayerAdapter>\n  ): Promise<VectorLayerAdapter<any, any, AdapterOptions>> {\n    opt = opt || {};\n    opt.multiselect = opt.multiselect !== undefined ? opt.multiselect : false;\n    opt.unselectOnSecondClick =\n      opt.unselectOnSecondClick !== undefined\n        ? opt.unselectOnSecondClick\n        : true;\n    if (!adapter) {\n      opt = updateGeoJsonAdapterOptions(opt);\n    }\n    opt.paint = opt.paint || {};\n    const layer = await this.addLayer(adapter || 'GEOJSON', opt);\n    this.showLayer(layer);\n    return layer;\n  }\n\n  /**\n   * Show added layer on the map by it definition.\n   */\n  showLayer(\n    layerDef: LayerDef,\n    options: ToggleLayerOptions = {}\n  ): Promise<void> {\n    return this.toggleLayer(layerDef, true, options);\n  }\n\n  /**\n   * Hide added layer on the map by it definition.\n   */\n  hideLayer(\n    layerDef: LayerDef,\n    options: ToggleLayerOptions = {}\n  ): Promise<void> {\n    return this.toggleLayer(layerDef, false, options);\n  }\n\n  /**\n   * Change added layer visibility on the map by given status or inverse current status.\n   *\n   * @example\n   * ```javascript\n   * webMap.addLayer('TILE', {id: 'my_layer', url: ''}).then((layer) => {\n   *   webMap.toggleLayer(layer, true);\n   *   webMap.toggleLayer('my_layer', false);\n   *   webMap.toggleLayer('my_layer');\n   *   webMap.isLayerVisible(layer); // true\n   * });\n   * ```\n   */\n  toggleLayer(\n    layerDef: LayerDef,\n    status?: boolean,\n    options: ToggleLayerOptions = {}\n  ): Promise<void> {\n    const layer = this.getLayer(layerDef);\n    const onMap = layer && layer.options.visibility;\n    const toStatus = status !== undefined ? status : !onMap;\n    const silent = options.silent !== undefined ? options.silent : false;\n    const action = (l: LayerAdapter) => {\n      const preEventName = toStatus ? 'layer:preshow' : 'layer:prehide';\n      const eventName = toStatus ? 'layer:show' : 'layer:hide';\n      if (!silent) {\n        this.emitter.emit(preEventName, l);\n        this.emitter.emit('layer:pretoggle', l);\n      }\n      if (toStatus && this.mapAdapter) {\n        const order = l.options.baselayer ? 0 : l.options.order;\n\n        // do not show baselayer if another on the map\n        if (l.options.baselayer && this._baselayers.length) {\n          const anotherVisibleLayerBaseLayer = this._baselayers.find((x) => {\n            return x !== l.id && this.isLayerVisible(x);\n          });\n          if (anotherVisibleLayerBaseLayer) {\n            this.hideLayer(anotherVisibleLayerBaseLayer);\n          }\n        }\n\n        if (l.showLayer) {\n          l.showLayer.call(l, l.layer);\n        } else if (l.layer !== undefined) {\n          this.mapAdapter.showLayer(l.layer);\n        }\n        if (order !== undefined) {\n          this.mapAdapter.setLayerOrder(l.layer, order, this._layers);\n        }\n      } else {\n        if (l.hideLayer) {\n          l.hideLayer.call(l, l.layer);\n        } else if (l.layer !== undefined) {\n          this.mapAdapter.hideLayer(l.layer);\n        }\n      }\n      if (!silent) {\n        this.emitter.emit(eventName, l);\n        this.emitter.emit('layer:toggle', l);\n      }\n      l.options.visibility = toStatus;\n    };\n    if (layer && layer.options.visibility !== toStatus) {\n      return this.onMapLoad().then(() => action(layer));\n    }\n    return Promise.resolve();\n  }\n\n  updateLayer(layerDef: LayerDef): void {\n    const layer = this.getLayer(layerDef);\n    if (layer) {\n      if (layer.updateLayer) {\n        layer.updateLayer();\n      } else if (this.isLayerVisible(layer)) {\n        this.hideLayer(layer, { silent: true });\n        this.showLayer(layer, { silent: true });\n      }\n    }\n  }\n\n  /**\n   * Set transparency for a given layer by number from 0 to 1\n   */\n  setLayerOpacity(layerDef: LayerDef, value: number): void {\n    const layer = this.getLayer(layerDef);\n    if (layer) {\n      if (this.mapAdapter.setLayerOpacity) {\n        if (layer) {\n          this.mapAdapter.setLayerOpacity(layer.layer, value);\n        }\n      }\n    }\n  }\n\n  // requestGeomString(pixel: Pixel, pixelRadius: number) {\n  //   if (this.mapAdapter.requestGeomString) {\n  //     return this.mapAdapter.requestGeomString(pixel, pixelRadius);\n  //   }\n  // }\n\n  /**\n   * Mark the layer as selected.\n   * If the adapter is a vector layer and supports data selection,\n   * you can pass a callback function to specify which data will be selected.\n   *\n   * @example\n   * ```javascript\n   * const layer = webMap.addLayer('GEOJSON', {data: geojson}).then((layer) => {\n   *   webMap.selectLayer(layer, ({feature}) => feature.id === '42');\n   * });\n   * ```\n\n   */\n  selectLayer(layerDef: LayerDef, findFeatureFun?: DataLayerFilter): void {\n    const layer = this.getLayer(layerDef);\n    if (layer) {\n      const adapter = layer as VectorLayerAdapter;\n      if (adapter && adapter.select) {\n        adapter.select(findFeatureFun);\n      }\n      const layerId = this.getLayerId(layer);\n      if (layerId) {\n        this._selectedLayers.push(layerId);\n      }\n    }\n  }\n\n  /**\n   * Unselect the given layer.\n   * If the adapter is a vector layer and supports data selection,\n   * you can pass a callback function to specify which data will be unselected.\n   *\n   * @example\n   * ```javascript\n   * const layer = webMap.addLayer('GEOJSON', {data: geojson}).then((layer) => {\n   *   webMap.unSelectLayer(layer, ({feature}) => feature.id === '42');\n   * });\n   * ```\n   *\n   */\n  unSelectLayer(layerDef: LayerDef, findFeatureFun?: DataLayerFilter): void {\n    const layer = this.getLayer(layerDef);\n    if (layer) {\n      const adapter = layer && (layer as VectorLayerAdapter);\n      if (adapter.unselect) {\n        adapter.unselect(findFeatureFun);\n      }\n      const layerId = this.getLayerId(layer);\n      if (layerId) {\n        const index = this._selectedLayers.indexOf(layerId);\n        if (index !== -1) {\n          this._selectedLayers.splice(index, 1);\n        }\n      }\n    }\n  }\n\n  /**\n   * Hide features from a vector layer using a callback function.\n   *\n   * @example\n   * ```javascript\n   * const layer = webMap.addLayer('GEOJSON', {data: geojson}).then((layer) => {\n   *   webMap.filterLayer(layer, ({feature}) => feature.id === '42');\n   * });\n   * ```\n   *\n   */\n  filterLayer(\n    layerDef: LayerDef,\n    filter: DataLayerFilter<Feature, L>\n  ): LayerDefinition<Feature, L>[] {\n    const layer = this.getLayer(layerDef);\n    const adapter = layer as VectorLayerAdapter;\n    if (adapter.filter) {\n      return adapter.filter(filter);\n    }\n    return [];\n  }\n\n  propertiesFilter(\n    layerDef: LayerDef,\n    filters: PropertiesFilter,\n    options?: FilterOptions\n  ): void {\n    const layer = this.getLayer(layerDef);\n    const adapter = layer as VectorLayerAdapter;\n    if (adapter.propertiesFilter) {\n      adapter.propertiesFilter(filters, options);\n    } else if (adapter.filter) {\n      this.filterLayer(adapter, (e) => {\n        if (e.feature && e.feature.properties) {\n          return propertiesFilter(e.feature.properties, filters);\n        }\n        return true;\n      });\n    }\n  }\n\n  removeLayerFilter(layerDef: LayerDef): void {\n    const layer = this.getLayer(layerDef);\n    const adapter = layer as VectorLayerAdapter;\n    if (adapter.removeFilter) {\n      adapter.removeFilter();\n    } else if (adapter.filter) {\n      adapter.filter(() => {\n        return true;\n      });\n    }\n  }\n\n  /**\n   * Sets the GeoJSON data for given vector layer.\n   *\n   * @example\n   * ```javascript\n   * const layer = webMap.addLayer('GEOJSON').then((layer) => {\n   *   webMap.setLayerData(layer, geojson);\n   * });\n   * ```\n   */\n  setLayerData(layerDef: LayerDef, data: GeoJsonObject): void | Promise<void> {\n    const vectorAdapter = this.getLayer(layerDef);\n    const adapter = vectorAdapter as VectorLayerAdapter;\n    if (adapter) {\n      if (adapter.setData) {\n        return adapter.setData(data);\n      } else if (adapter.clearLayer && adapter.addData) {\n        adapter.clearLayer();\n        return adapter.addData(data);\n      }\n    }\n    return Promise.resolve();\n  }\n\n  /**\n   * Push new the GeoJSON features into given vector layer.\n   *\n   * @example\n   * ```javascript\n   * const layer = webMap.addLayer('GEOJSON', {data: geojson_features_5}).then((layer) => {\n   *   console.log(layer.getLayers().length) // > 5;\n   *   webMap.addLayerData(layer, geojson_features_3);\n   *   console.log(layer.getLayers().length) // > 8;\n   * });\n   * ```\n   */\n  addLayerData(layerDef: LayerDef, data: GeoJsonObject): void {\n    const layerMem = this.getLayer(layerDef);\n    const adapter = layerMem as VectorLayerAdapter;\n    if (adapter.addData) {\n      adapter.addData(data);\n    }\n  }\n\n  /**\n   * Remove from vector layer all features.\n   * it is possible to remove only some objects if you specify a callback function.\n   *\n   * @example\n   * ```javascript\n   * const layer = webMap.addLayer('GEOJSON', {data: geojson}).then((layer) => {\n   *   webMap.clearLayerData(layer, (feture) => feture.id === 42);\n   *   webMap.clearLayerData(layer);\n   * });\n   * ```\n   */\n  clearLayerData(layerDef: LayerDef, cb?: (feature: Feature) => boolean): void {\n    const layerMem = this.getLayer(layerDef);\n    const adapter = layerMem as VectorLayerAdapter;\n    if (adapter && adapter.clearLayer) {\n      adapter.clearLayer(cb);\n    }\n  }\n\n  getAttributions(options: GetAttributionsOptions): string[] {\n    const attributions: string[] = [];\n    for (const l in this._layers) {\n      const layerCache = this._layers[l];\n      const onlyVisible =\n        options.onlyVisible !== undefined ? options.onlyVisible : true;\n      let useLayerAttr = onlyVisible ? layerCache.options.visibility : true;\n      if (useLayerAttr && options.onlyBaselayer) {\n        useLayerAttr = this._baselayers.includes(l);\n      }\n      if (useLayerAttr) {\n        const attr = layerCache.options && layerCache.options.attribution;\n        if (attr) {\n          attributions.push(attr);\n        }\n      }\n    }\n\n    return attributions;\n  }\n\n  getActiveBaseLayer(): MainLayerAdapter<M, any, AdapterOptions> | undefined {\n    const visibleLayerBaseLayer = this.getBaseLayers().find((x) => {\n      return this.isLayerVisible(x);\n    });\n    if (visibleLayerBaseLayer) {\n      return this.getLayer(visibleLayerBaseLayer);\n    }\n  }\n\n  addTileJsonLayer(\n    tileJson: TileJson\n  ): Promise<MainLayerAdapter<M, any, TileAdapterOptions>> {\n    // if (this.mapAdapter.createTileJsonlayer) {\n    // } else {\n\n    const url = tileJson.tiles[0];\n    return this.addLayer('TILE', {\n      url,\n      maxZoom: tileJson.maxzoom,\n      minZoom: tileJson.minzoom,\n      subdomains: tileJson.scheme,\n      attribution: tileJson.attribution,\n    }) as Promise<MainLayerAdapter<M, any, TileAdapterOptions>>;\n  }\n\n  private async _onLayerClick(options: OnLayerClickOptions) {\n    this.emitter.emit('layer:click', options);\n    return Promise.resolve(options);\n  }\n\n  private async _onLayerSelect(options: OnLayerSelectOptions) {\n    this.emitter.emit('layer:select', options);\n    return Promise.resolve(options);\n  }\n\n  private _updateGeoJsonOptions(options: GeoJsonAdapterOptions) {\n    const onLayerClickFromOpt = options.onLayerClick;\n    options.onLayerClick = (e) => {\n      if (onLayerClickFromOpt) {\n        onLayerClickFromOpt(e);\n      }\n      return this._onLayerClick(e);\n    };\n\n    const onLayerSelectFromOpt = options.onLayerSelect;\n    options.onLayerSelect = (e) => {\n      if (onLayerSelectFromOpt) {\n        onLayerSelectFromOpt(e);\n      }\n      return this._onLayerSelect(e);\n    };\n\n    if (!options.nativePaint) {\n      if (this.options.paint) {\n        options.paint = preparePaint(\n          options.paint || {},\n          this.options.paint,\n          this.getPaintFunctions\n        );\n      }\n      if (options.selectedPaint && this.options.selectedPaint) {\n        options.selectedPaint = preparePaint(\n          options.selectedPaint,\n          this.options.selectedPaint,\n          this.getPaintFunctions\n        );\n      }\n    }\n  }\n}\n","import {\n  ToggleControlOptions,\n  ToggleControl,\n  ButtonControlOptions,\n} from '../../interfaces/MapControl';\n\n/**\n * The toggle is a button with status.\n * @internal\n */\nexport function createToggleControl<C = any>(\n  createButtonControl: (options: ButtonControlOptions) => C,\n  options: ToggleControlOptions\n): C & ToggleControl {\n  const link = document.createElement('div');\n\n  let status = false;\n  if (options.getStatus) {\n    status = options.getStatus();\n  } else if (options.status) {\n    status = options.status;\n  }\n\n  const title = options.title || '';\n  const html = options.html;\n\n  function setTitle() {\n    if (title) {\n      if (typeof title === 'string') {\n        link.title = title;\n      } else {\n        link.title = status ? title.on : title.off;\n      }\n      link.setAttribute('aria-label', link.title);\n    }\n  }\n  setTitle();\n\n  // DomEvent.disableClickPropagation(link);\n  // DomEvent.on(link, 'click', DomEvent.stop);\n\n  function _setHtml(htmlDef: string | HTMLElement) {\n    if (htmlDef instanceof HTMLElement) {\n      link.innerHTML = '';\n      link.appendChild(htmlDef);\n    } else if (typeof htmlDef === 'string') {\n      link.innerHTML = htmlDef;\n    }\n  }\n  function setHtml() {\n    if (html) {\n      if (typeof html === 'string' || html instanceof HTMLElement) {\n        _setHtml(html);\n      } else {\n        _setHtml(status ? html.on : html.off);\n      }\n      link.setAttribute('aria-label', link.title);\n    }\n  }\n  setHtml();\n\n  function _setClass(addClass: string, impact: boolean) {\n    addClass.split(' ').forEach((x) => {\n      if (impact) {\n        link.classList.add(x);\n      } else {\n        link.classList.remove(x);\n      }\n    });\n  }\n\n  function setClass() {\n    if (options.addClassOn) {\n      _setClass(options.addClassOn, status);\n    }\n    if (options.addClassOff) {\n      _setClass(options.addClassOff, !status);\n    }\n  }\n\n  if (options.addClass) {\n    _setClass(options.addClass, true);\n  }\n  setClass();\n\n  const changeStatus = (status_?: boolean) => {\n    if (status_ !== undefined) {\n      status = status_;\n    }\n    setHtml();\n    setTitle();\n    setClass();\n  };\n\n  const onClick = (status_?: boolean) => {\n    status = status_ !== undefined ? status_ : !status;\n    if (options.onClick) {\n      const afterClick = options.onClick(status);\n      Promise.resolve(afterClick)\n        .then(() => changeStatus())\n        .catch(() => (status = !status));\n    } else {\n      changeStatus();\n    }\n  };\n\n  const buttonControl = createButtonControl({\n    html: link,\n    onClick,\n  }) as C & ToggleControl;\n  buttonControl.onClick = onClick;\n  buttonControl.changeStatus = changeStatus;\n  return buttonControl;\n}\n","import { WebMapEvents } from './interfaces/Events';\n\nimport {\n  MapControl,\n  CreateControlOptions,\n  ButtonControlOptions,\n  ToggleControlOptions,\n  ToggleControl,\n  MapControls,\n} from './interfaces/MapControl';\n\nimport { ControlPosition } from './interfaces/MapAdapter';\nimport { WebMapLayers } from './WebMapLayers';\nimport { WebMapMain } from './WebMapMain';\nimport { createToggleControl } from './components/controls/createToggleControl';\nimport { MapOptions } from './interfaces/MapOptions';\n\n/**\n * Collection of methods for managing map controls\n * @public\n */\nexport class WebMapControls<\n    M = any,\n    L = any,\n    C = any,\n    E extends WebMapEvents = WebMapEvents,\n    O extends MapOptions = MapOptions\n  >\n  extends WebMapLayers<M, L, E, O>\n  implements WebMapLayers, WebMapMain {\n  static controls: {\n    [name: string]: (webMap: WebMapControls, options?: any) => any;\n  } = {\n    CONTROL: (\n      webMap: WebMapControls,\n      options: {\n        control: MapControl;\n        options?: CreateControlOptions;\n      }\n    ) => {\n      return webMap.createControl(options.control, options.options);\n    },\n    BUTTON: (webMap: WebMapControls, options: ButtonControlOptions) => {\n      return webMap.createButtonControl(options);\n    },\n    TOGGLE: (webMap: WebMapControls, options: ToggleControlOptions) => {\n      return webMap.createToggleControl(options);\n    },\n  };\n\n  private _loadControlQueue: {\n    [key in ControlPosition]: (() => Promise<any>)[];\n  } = {\n    'top-right': [],\n    'bottom-right': [],\n    'top-left': [],\n    'bottom-left': [],\n  };\n  private _isControlLoading: { [key in ControlPosition]: boolean } = {\n    'top-right': false,\n    'bottom-right': false,\n    'top-left': false,\n    'bottom-left': false,\n  };\n\n  async addControl<K extends keyof MapControls>(\n    controlDef: K | C,\n    position: ControlPosition,\n    options?: MapControls[K]\n  ): Promise<any> {\n    let control: C | undefined;\n    position = position ?? 'top-left';\n    if (typeof controlDef === 'string') {\n      control = this.getControl(controlDef, options);\n    } else {\n      control = controlDef as C;\n    }\n    if (control) {\n      return new Promise<() => Promise<any>>((resolve) => {\n        const promise = async () => {\n          const _control = await control;\n          const c = this.mapAdapter.addControl(_control, position);\n          resolve(c);\n        };\n        this._setControlQueue(position, promise);\n      });\n    }\n  }\n\n  /**\n   * Creating a universal map layout control element. Can be used with any map adapter.\n   *\n   * @example\n   * ```javascript\n   * const control = webMap.createControl({\n   *   onAdd() {\n   *     return document.createElement('div');\n   *   }\n   * });\n   * ```\n   */\n  async createControl(\n    control: MapControl,\n    options?: CreateControlOptions\n  ): Promise<C | undefined> {\n    await this.onLoad('build-map');\n    if (this.mapAdapter.createControl) {\n      return this.mapAdapter.createControl(control, options);\n    }\n  }\n\n  async createButtonControl(\n    options: ButtonControlOptions\n  ): Promise<C | undefined> {\n    await this.onLoad('build-map');\n    if (this.mapAdapter.createButtonControl) {\n      return this.mapAdapter.createButtonControl(options);\n    }\n  }\n\n  /**\n   * Create any toggler control button\n   * @param options - Options for control layout customization and assigning a callback function\n   *\n   * @example\n   * ```javascript\n   * const toggleControl = ngwMap.createToggleControl({\n   *   getStatus: () => webMap.isLayerVisible('any-layer-id'),\n   *   onClick: (status) => ngwMap.toggleLayer('webmap', status),\n   *   html: {\n   *     on: 'ON',\n   *     off: 'OFF'\n   *   },\n   *   title: 'Toggle layer visibility'\n   * });\n   * webMap.addControl(toggleControl, 'top-right');\n   * ```\n   * {@link http://code.nextgis.com/demo-examples-toggle-control | Toggle button control example}\n   * @public\n   */\n  async createToggleControl(\n    options: ToggleControlOptions\n  ): Promise<(C & ToggleControl) | undefined> {\n    await this.onLoad('build-map');\n    if (this.mapAdapter.createToggleControl) {\n      return this.mapAdapter.createToggleControl(options);\n    } else {\n      if (this.mapAdapter.createButtonControl) {\n        return createToggleControl<C>(\n          this.mapAdapter.createButtonControl,\n          options\n        );\n      }\n    }\n  }\n\n  /**\n   *\n   * @param control - Instance of WEB-GIS framework control.\n   *                  What is returned by the {@Link WebMapControls.createControl | create} method\n   * @public\n   */\n  removeControl(control: C): void {\n    if ('remove' in control) {\n      // @ts-ignore TODO: ugly code, rewrite\n      control.remove();\n    } else if (this.mapAdapter.removeControl) {\n      Promise.resolve(control).then((c) => {\n        this.mapAdapter.removeControl(c);\n      });\n    }\n  }\n\n  /**\n   * Get instance of registered control\n   * @param control - Any registered control string name\n   * @param options - Custom control options\n   * @public\n   */\n  getControl<K extends keyof MapControls>(\n    control: K,\n    options?: MapControls[K]\n  ): C | undefined {\n    const engine = this.mapAdapter.controlAdapters[control];\n    if (engine) {\n      return new engine(options);\n    } else {\n      const createFun = WebMapControls.controls[control];\n      if (createFun) {\n        return createFun(this, options);\n      }\n    }\n  }\n\n  private _setControlQueue(position: ControlPosition, cb: () => Promise<any>) {\n    this._loadControlQueue[position].push(cb);\n    if (!this._isControlLoading[position]) {\n      this._applyControls(position);\n    }\n  }\n\n  private async _applyControls(position: ControlPosition) {\n    if (this._loadControlQueue[position].length) {\n      this._isControlLoading[position] = true;\n      const controlCb = this._loadControlQueue[position][0];\n      await controlCb();\n      this._loadControlQueue[position].splice(0, 1);\n      this._applyControls(position);\n    } else {\n      this._isControlLoading[position] = false;\n    }\n  }\n}\n","/**\n * @privateRemarks\n * Since it was not possible to split the code through mixins, inheritance was used.\n * The `ts-mixin` plugin worked fine, but led to errors in IE.\n *\n * Now inheritance is as follow:\n * BaseWebMap > WebMapLayers > WebMap\n *\n * Will need to be done this way:\n * class WebMap extend mixin(WebMapLayers, WebMapControls) {}\n *\n * This approach can also be considered\n *\n * class WebMap {\n *   layers: WebMapLayers;\n *   controls  WebMapControls\n * }\n *\n * and then\n *\n * const webMap = new WebMap(...);\n * webMap.layers.addLayer(...)\n *\n * looks good, but will add difficulty in inheriting from WebMap\n *\n * old:\n *\n * class NgwMap extends WebMap {\n *   addLayer(...) {\n *      super.addLayer(...)\n *   }\n * }\n *\n * new:\n *\n * class NgwLayers extends WebMapLayers {\n *   addLayer(...) {\n *     super.addLayer(...)\n *   }\n * }\n *\n * class NgwMap extends WebMap {\n *   layersClass = NgwLayers\n * }\n *\n * ...and there will be compatibility issues\n */\n\nimport { WebMapEvents } from './interfaces/Events';\n\nimport { WebMapLayers } from './WebMapLayers';\nimport { WebMapMain, WEB_MAP_CONTAINER } from './WebMapMain';\nimport { WebMapControls } from './WebMapControls';\nimport { MapOptions } from './interfaces/MapOptions';\nimport { ControlOptions } from './interfaces/MapControl';\n\n/**\n * The core component for managing map adapters.\n * It contains methods for adding and manipulation with\n * {@link WebMapMain | map}, {@link WebMapLayers | layers} and {@link WebMapControls | controls}.\n *\n * @example\n * ```javascript\n * import { WebMap } from '@nextgis/webmap';\n * import MapAdapter from '@nextgis/ol-map-adapter';\n *\n * const webMap = new WebMap({\n *   mapAdapter: new MapAdapter(),\n *   target: 'map',\n * });\n * ```\n *\n * @typeParam M - Interactive Map used in the adapter\n * @typeParam L - Layer\n * @typeParam C - Control\n * @typeParam E - Events\n *\n * @public\n */\nexport class WebMap<\n    M = any,\n    L = any,\n    C = any,\n    E extends WebMapEvents = WebMapEvents,\n    O extends MapOptions = MapOptions\n  >\n  extends WebMapControls<M, L, C, E, O>\n  implements WebMapControls, WebMapLayers, WebMapMain {\n  constructor(mapOptions: O) {\n    super(mapOptions);\n    this._addControls();\n  }\n\n  static get<T extends WebMap = WebMap>(id: number): T {\n    return WEB_MAP_CONTAINER[id];\n  }\n\n  /**\n   * @internal\n   */\n  protected async _addLayerProviders(): Promise<void> {\n    try {\n      for await (const kit of this._starterKits) {\n        if (kit.getLayerAdapters) {\n          const adapters = await kit.getLayerAdapters.call(kit);\n          if (adapters) {\n            for await (const adapter of adapters) {\n              const newAdapter = await adapter.createAdapter(this);\n              if (newAdapter) {\n                this.mapAdapter.layerAdapters[adapter.name] = newAdapter;\n              }\n            }\n          }\n        }\n      }\n    } catch (er) {\n      throw new Error(er);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  protected async _onLoadSync(): Promise<void> {\n    for await (const kit of this._starterKits) {\n      if (kit.onLoadSync) {\n        try {\n          await kit.onLoadSync.call(kit, this);\n        } catch (er) {\n          console.error(er);\n        }\n      }\n    }\n  }\n\n  private _addControls(): void {\n    if (this.options.controls) {\n      this.options.controls.forEach((x) => {\n        let controlAdapterName = x;\n        let controlOptions: ControlOptions = {};\n        if (typeof x === 'string' && this.options.controlsOptions) {\n          if (this.options.controlsOptions[x]) {\n            controlOptions = this.options.controlsOptions[x];\n            if (controlOptions.control !== undefined) {\n              controlAdapterName = controlOptions.control;\n            }\n          }\n        }\n        const { position, ...options } = controlOptions;\n        this.addControl(controlAdapterName, position || 'top-left', options);\n      });\n    }\n    this._emitStatusEvent('controls:create');\n  }\n}\n"],"sourceRoot":""}