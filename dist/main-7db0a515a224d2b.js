(self.webpackChunkclear_horizon=self.webpackChunkclear_horizon||[]).push([[367],{18195:function(t,e,r){"use strict";r.d(e,{lO:function(){return wt},Zj:function(){return mt},Ok:function(){return m},u4:function(){return Mt},D1:function(){return Lt},K1:function(){return xt},Cg:function(){return h},UJ:function(){return x},vS:function(){return f},nm:function(){return L},U2:function(){return E},GW:function(){return Et},RP:function(){return Ot},PA:function(){return It}});var n=r(56018),o=r(39871),i=r(17187),a=r(97060),s=["fields","intersects","limit","orderBy","strategy"];function u(t){var e={};return s.forEach((function(r){var n=t[r];void 0!==n&&(e[r]=n)})),e}function c(t,e){return r=this,n=void 0,i=function(){var r,n,o,i,a;return function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(s){switch(s.label){case 0:return r=t.resource,n=r,o=t.keyname,i=t.resourceId,r?"string"!=typeof r?[3,1]:(o=r,[3,5]):[3,5];case 1:return"number"!=typeof r?[3,2]:(i=r,[3,5]);case 2:return n.resource&&void 0!==n.resource&&"resmeta"in n?(i=r.resource.id,[3,5]):[3,3];case 3:return[4,c(r,e)];case 4:i=s.sent(),s.label=5;case 5:return i||!o?[3,7]:[4,e.getResource(o)];case 6:(a=s.sent())&&(i=a.resource.id),s.label=7;case 7:return[2,i]}}))},new((o=void 0)||(o=Promise))((function(t,e){function a(t){try{u(i.next(t))}catch(t){e(t)}}function s(t){try{u(i.throw(t))}catch(t){e(t)}}function u(e){var r;e.done?t(e.value):(r=e.value,r instanceof o?r:new o((function(t){t(r)}))).then(a,s)}u((i=i.apply(r,n||[])).next())}));var r,n,o,i}var l=r(43590),p=function(){return(p=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function f(t){var e=p({},v);return b(e,t),t.connector.get("feature_layer.feature.item",null,p({id:t.resourceId,fid:t.featureId},e)).then((function(e){return p(p({},e),{toGeojson:function(){return e.geom?l.Z.resolve(m(e)):f(p(p({},t),{geom:!0,fields:null,extensions:null})).then((function(t){var r=t.geom;return m(p(p({},e),{geom:r}))}))}})}))}function h(t){return f(t).then((function(t){return m(t)}))}var y=function(){return(y=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},d=function(t,e){for(var r=0,n=e.length,o=t.length;r<n;r++,o++)t[o]=e[r];return t},v={srs:4326,geom_format:"geojson"};function m(t){var e=t.geom;return{id:t.id,type:"Feature",properties:t.fields,geometry:e}}function b(t,e){var r=e.extensions,n=e.geom,i=e.fields,a=e.srs;t.extensions=r?r.join(","):"",void 0!==i&&(t.fields=Array.isArray(i)?i.join(","):""),void 0!==n&&(t.geom=n?"yes":"no",n||(delete t.srs,delete t.geom_format)),(0,o.ri)(a)&&(t.srs=a)}function w(t){var e=t.filterById[2],r="number"==typeof e?[e]:e.split(",").map((function(t){return Number(t)}));if("eq"!==t.filterById[1]&&"in"!==t.filterById[1])throw new Error("Unable to filter by object id. Except `eq` or `in` operator");var n=r.map((function(e){return f({connector:t.connector,resourceId:t.resourceId,featureId:e})}));return l.Z.all(n)}function g(t,e,r){void 0===e&&(e=[]),void 0===r&&(r=[]);var n=t.filters,o=t.connector,i=t.resourceId,s="string"==typeof n[0]?n[0]:"all",u=n.filter((function(t){return Array.isArray(t)})),c=function(t){return["fld_"+t[0]+"__"+t[1],t[2]]};if("any"===s)u.forEach((function(n){"id"===n[0]&&e.push(w({filterById:n,connector:o,resourceId:i})),(0,a.a$)(n)?e.push(_(y(y({},t),{paramList:d(d([],r),[c(n)])}))):g(y(y({},t),{filters:n}),e,d([],r))}));else if("all"===s){var p=u.find((function(t){return"id"===t[0]}));if(p)e.push(w({filterById:p,connector:o,resourceId:i}));else{var f=[],h=[];u.forEach((function(t){(0,a.a$)(t)?f.push(c(t)):h.push(t)})),h.length?h.forEach((function(n){g(y(y({},t),{filters:n}),e,d(d([],r),f))})):e.push(_(y(y({},t),{paramList:d(d([],r),f)})))}}return l.Z.all(e).then((function(e){var r=e.reduce((function(t,e){return t.concat(e)}),[]),n=void 0!==t.offset?t.offset:0,o=void 0!==t.limit?t.limit:r.length;return t.offset||t.limit?r.splice(n,o):r}))}function _(t){var e=y({},v),r=t.connector,n=t.limit,o=t.offset,i=t.intersects,a=t.orderBy,s=t.resourceId,u=t.paramList;return n&&(e.limit=n),o&&(e.offset=o),b(e,t),a&&(e.order_by=a.join(",")),i&&(e.intersects=i),u&&(e.paramList=u),r.get("feature_layer.feature.collection",null,y({id:s},e))}var O=function(){return(O=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function L(t){var e=t.filters;return e?g(O(O({},t),{filters:e})):_(t).then((function(t){return e?t.filter((function(t){var r=t.fields;r&&(0,a.Ml)(r,e)})):t}))}function x(t){return function(t){return L(t).then((function(t){var e=[];return t.forEach((function(t){e.push(m(t))})),e}))}(t).then((function(t){return{type:"FeatureCollection",features:t}}))}function I(t){var e=t.extent_bottom,r=t.extent_left,n=t.extent_top,o=t.extent_right;if(e&&r&&n&&o){var i=[r,e,o,n];return i[3]>82&&(i[3]=82),i[1]<-82&&(i[1]=-82),i}}function M(t,e){return e.get("layer.extent",null,{id:t}).then((function(t){if(t){var e=t.extent,r=e.maxLat,n=e.maxLon,o=e.minLat;return[e.minLon,o,n,r]}}))}function E(t,e){return r=this,n=void 0,i=function(){var r;return function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(n){return t.webmap?[2,I(t.webmap)]:(r=t.resource).cls&&-1!==r.cls.indexOf("style")?[2,e.getResource(r.parent.id).then((function(t){if(t)return M(t.resource.id,e)}))]:[2,M(r.id,e)]}))},new((o=void 0)||(o=Promise))((function(t,e){function a(t){try{u(i.next(t))}catch(t){e(t)}}function s(t){try{u(i.throw(t))}catch(t){e(t)}}function u(e){var r;e.done?t(e.value):(r=e.value,r instanceof o?r:new o((function(t){t(r)}))).then(a,s)}u((i=i.apply(r,n||[])).next())}));var r,n,o,i}var k,P=(k=function(t,e){return(k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}k(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),j=function(){return(j=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},S=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},N=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function A(t){return S(this,void 0,void 0,(function(){var e,r,n,s,l,p,f,h,y,d,v,m,b,w=this;return N(this,(function(g){switch(g.label){case 0:return e=t.webMap,r=t.connector,n=t.item,s=void 0===t.addLayerOptionsPriority||t.addLayerOptionsPriority,l=t.layerOptions,p=t.Adapter||e.mapAdapter.layerAdapters.GEOJSON,h=!1,[4,c(l,r)];case 1:return d=g.sent(),l.adapterOptions&&l.adapterOptions.popupOptions&&l.adapterOptions.popupOptions.fromProperties&&(l.adapterOptions.popupOptions.createPopupContent=function(t){var e=t.feature;return e&&function(t,e){var r=document.createElement("div");if(e&&e.feature_layer)e.feature_layer.fields.forEach((function(e){if(e.grid_visibility){var n=t.properties&&t.properties[e.keyname];if(n){var o=document.createElement("div");r.appendChild(o),o.innerHTML="<span>"+e.display_name+"</span>: "+n+"<span></span>"}}}));else if(t.properties)for(var n in t.properties){var o=document.createElement("div");r.appendChild(o),o.innerHTML="<span>"+n+"</span>: "+t.properties[n]+"<span></span>"}return r}(e,n)}),v=function(t,e){return S(w,void 0,void 0,(function(){return N(this,(function(n){switch(n.label){case 0:return b(),y={filters:t,options:e},[4,f=x(j(j({resourceId:d,filters:t,connector:r},e),{limit:void 0!==(null==e?void 0:e.limit)?e.limit:3e3}))];case 1:return[2,n.sent()]}}))}))},m=!1,b=function(){f&&(f.cancel(),f=void 0)},[2,function(t){function c(){var e=null!==t&&t.apply(this,arguments)||this;return e.emitter=new i.EventEmitter,e}return P(c,t),c.prototype.addLayer=function(e){return S(this,void 0,void 0,(function(){var r,o,i,a;return N(this,(function(c){switch(c.label){case 0:return r=!e.data,o=void 0===e.waitFullLoad||e.waitFullLoad,void 0!==l.id&&(e.id=l.id),n&&n.vector_layer&&(e.type=vt[n.vector_layer.geometry_type]),l.adapterOptions&&(e=s?j(j({},l.adapterOptions),e):j(j({},e),l.adapterOptions)),e.data&&0===Object.keys(e.data).length&&(e.data=void 0,r=!1),i=t.prototype.addLayer.call(this,e),this.options.strategy=e.strategy||void 0,y={filters:e.propertiesFilter,options:u(e)},r&&(a=this.updateLayer()),o&&a?[4,a]:[3,2];case 1:c.sent(),c.label=2;case 2:return"BBOX"===this.options.strategy&&this._addBboxEventListener(),[2,i]}}))}))},c.prototype.getExtent=function(){var e=this.getLayers&&this.getLayers().length;return"BBOX"===this.options.strategy||e?E(n,r):t.prototype.getExtent?t.prototype.getExtent.call(this):void 0},c.prototype.beforeRemove=function(){m=!0,this._removeMoveEventListener(),this._removeBboxEventListener(),this.__disableMapMoveListener=void 0,this.__enableMapMoveListener=void 0,this.__onMapMove=void 0,this.__onMapMoveStart=void 0,b()},c.prototype.getCount=function(){var t=this;return void 0!==this._count?this._count:r.get("feature_layer.feature.count",null,{id:d}).then((function(e){e&&(t._count=e.total_count)}))},c.prototype.updateLayer=function(r){return S(this,void 0,void 0,(function(){var n,o;return N(this,(function(i){switch(i.label){case 0:return r=r||y||{},"BBOX"!==this.options.strategy?[3,2]:[4,e.onLoad("create")];case 1:i.sent(),r.options=r.options||{},r.options.intersects=this._getMapBbox(),i.label=2;case 2:if(m)return[2];i.label=3;case 3:return i.trys.push([3,6,,7]),[4,v(r.filters,r.options)];case 4:return n=i.sent(),[4,e.setLayerData(this,n)];case 5:return i.sent(),this.emitter.emit("updated"),[3,7];case 6:if("CancelError"!==(o=i.sent()).name)throw o;return[3,7];case 7:return t.prototype.updateLayer&&t.prototype.updateLayer.call(this),[2]}}))}))},c.prototype.propertiesFilter=function(t,e){return S(this,void 0,void 0,(function(){var r;return N(this,(function(n){switch(n.label){case 0:return b(),this.filter&&h?(this.filter((function(e){return!e.feature||!e.feature.properties||(0,a.Ml)(e.feature.properties,t)})),[3,3]):[3,1];case 1:return this.setData?(this.clearLayer&&this.clearLayer(),[4,v(t,e)]):[3,3];case 2:r=n.sent(),this.setData(r),n.label=3;case 3:return[2]}}))}))},c.prototype.removeFilter=function(){y=void 0,this.propertiesFilter([]),this.filter&&this.filter((function(){return!0}))},c.prototype._addBboxEventListener=function(){var t=this;this.__enableMapMoveListener=function(e){e===t&&(t._removeMoveEventListener(),t.updateLayer(),t._addMoveEventListener())},this.__disableMapMoveListener=function(e){e===t&&t._removeMoveEventListener()},e.emitter.on("layer:show",this.__enableMapMoveListener),e.emitter.on("layer:hide",this.__disableMapMoveListener),this.__enableMapMoveListener(this)},c.prototype._removeBboxEventListener=function(){this.__enableMapMoveListener&&e.emitter.on("layer:show",this.__enableMapMoveListener),this.__disableMapMoveListener&&e.emitter.on("layer:hide",this.__disableMapMoveListener)},c.prototype._addMoveEventListener=function(){var t=this;this.__onMapMove=(0,o.Ds)((function(){return t.updateLayer()})),this.__onMapMoveStart=b,e.emitter.on("movestart",this.__onMapMoveStart),e.emitter.on("moveend",this.__onMapMove)},c.prototype._removeMoveEventListener=function(){this.__onMapMove&&e.emitter.removeListener("moveend",this.__onMapMove),this.__onMapMoveStart&&e.emitter.removeListener("movestart",this.__onMapMoveStart)},c.prototype._getMapBbox=function(){var t=e.getBounds();if(t){var r=t[0],n=t[1],i=t[2],a=t[3];return"POLYGON(("+[[r,n],[i,n],[i,a],[r,a],[r,n]].map((function(t){var e=t[0],r=t[1],n=(0,o.Qm)(e,r);return n[0]+" "+n[1]})).join(", ")+"))"}},c}(p)]}}))}))}var T=function(){return(T=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function C(t,e,r){var n,o=t.adapter||"IMAGE",i=e.getLayerAdapters(),a=!i||i.IMAGE,s=t.resource,u=t.tileNoData?t.tileNoData:200;if("number"==typeof s){if("IMAGE"===o){if(a)return{url:n=r+"/api/component/render/image",resourceId:s,headers:t.headers,params:{resource:s,nd:u},updateWmsParams:function(t){return yt(T({nd:u},t),s)}};o="TILE"}if("WMS"===o){n=r+"/api/resource/"+s+"/wms";var c=t.adapterOptions;return{url:n,format:"image/png",version:"1.1.1",layers:c&&c.layers,headers:t.headers}}if("MVT"===o)return{url:n=r+"/api/component/feature_layer/mvt?x={x}&y={y}&z={z}&resource="+s+"&simplification="+(t.simplification||0)};if("TERRAIN"===o)return{url:n=r+"/api/resource/"+s+"/terrain_provider",adapter:o};if("MODEL_3D"===o)return{url:n=r+"/api/component/model_3d/"+s+"/data.glb"};if("TILE"===o)return{url:n=r+"/api/component/render/tile?z={z}&x={x}&y={y}&resource="+s+"&nd="+u,adapter:o}}else{if(void 0!==s)throw new Error("Option `resource` must be number, not "+typeof s);console.log("Option `resource` not set")}}var G=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),R=function(){return(R=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},B=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},F=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function Z(t){var e=t.layerOptions,r=t.webMap,n=t.connector,i=t.item;return B(this,void 0,void 0,(function(){var t,a,s,u,l,p;return F(this,(function(f){switch(f.label){case 0:return t=i.resource.cls,a={wmsserver_service:"WMS",tmsclient_layer:"IMAGE"},void 0!==(s=e.adapter||t&&a[t]||"IMAGE")&&(e.adapter=s),"IMAGE"===s&&(!(u=r.getLayerAdapters())||u.IMAGE||(s="TILE")),(l=r.mapAdapter.layerAdapters[s])?[4,c(e,n)]:[3,2];case 1:return p=f.sent(),[2,function(t){function a(a,s){var u,c=t.call(this,a,s)||this;c.map=a,c.item=i,c.resourceId=p;var l=C(e,r,n.options.baseUrl||"");if(l){var f=R(R({},l),{setViewDelay:null===(u=e.adapterOptions)||void 0===u?void 0:u.setViewDelay,params:{resource:p},layers:String(p),resourceId:p});e.adapterOptions&&(0,o.ri)(e.adapterOptions.setViewDelay)&&(f.setViewDelay=e.adapterOptions.setViewDelay),c.options=R(R({},c.options),f)}return c}return G(a,t),a.prototype.addLayer=function(e){return t.prototype.addLayer.call(this,R(R({},this.options),e))},a.prototype.getIdentificationIds=function(){return B(this,void 0,void 0,(function(){var t;return F(this,(function(e){return(t=this.item&&this.item.resource.parent.id)?[2,[t]]:[2]}))}))},a}(l)];case 2:throw new Error(s+" not supported yet. Only TILE")}}))}))}var U=r(87187),D=r(14949),W=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),q=function(){return(q=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},$=function(t){function e(r,n,o,a,s,u){var c=t.call(this,q(q({},e.options),o))||this;if(c.webMap=r,c.emitter=new i.EventEmitter,c._rootDescendantsCount=0,a&&(c.connector=a),s&&c.tree.setParent(s),c.item=n,"root"===c.item.item_type)c._rootDescendantsCount=c._sumUp(c.item.children);else{var l=c.tree.getRoot();l&&(c._rootDescendantsCount=l._rootDescendantsCount)}return c.initProperties(),u||c._init(n),c}return W(e,t),e.create=function(t,r,n,o,i){return a=this,s=void 0,c=function(){var a;return function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(s){switch(s.label){case 0:return[4,(a=new e(t,r,n,o,i,!0))._init(r)];case 1:return s.sent(),[2,a]}}))},new((u=void 0)||(u=Promise))((function(t,e){function r(t){try{o(c.next(t))}catch(t){e(t)}}function n(t){try{o(c.throw(t))}catch(t){e(t)}}function o(e){var o;e.done?t(e.value):(o=e.value,o instanceof u?o:new u((function(t){t(o)}))).then(r,n)}o((c=c.apply(a,s||[])).next())}));var a,s,u,c},e.prototype.initItem=function(t){var r=this,n=t,o=this.getItemOptions(t),i=function(t){n._layer=t,r.layer=t,r.properties.get("visibility")&&r.properties.set("visibility",!0),void 0!==o.opacity&&r.webMap.setLayerOpacity(t,o.opacity)};if("group"===t.item_type||"root"===t.item_type)return t.children&&t.children.length&&this.getChildren(t).forEach((function(t){var n=new e(r.webMap,t,r.options,r.connector,r);r.tree.addChild(n)})),Promise.resolve();var a=void 0;return"layer"===t.item_type?a=t.adapter||t.layer_adapter.toUpperCase():e.GetAdapterFromLayerType[t.item_type]&&(a=(0,e.GetAdapterFromLayerType[t.item_type])(t,o,this.webMap,this.connector)),a?this.webMap.addLayer(a,o).then((function(t){i(t)})):t._layer?Promise.resolve(i(t._layer)):Promise.reject("No layer added")},e.prototype.bringToFront=function(){},e.prototype.fit=function(){this.item.item_type},e.prototype.getItemOptions=function(t){var e="layer"===t.item_type&&t.layer_transparency,r="number"==typeof e?(100-e)/100:void 0,n={visibility:!1,headers:this.options.headers,crossOrigin:this.options.crossOrigin,setViewDelay:this.options.setViewDelay,params:{resource:this.item.resourceId}};if(this.options.order){var i=this.options.drawOrderEnabled&&"draw_order_position"in t?this._rootDescendantsCount-t.draw_order_position:this.id,a=String(i).padStart(4,"0");n.order=Number((0|this.options.order)+"."+a)}if("layer"===t.item_type){var s=t.layer_max_scale_denom?this._mapScaleToZoomLevel(t.layer_max_scale_denom):this.webMap.options.maxZoom,u=t.layer_min_scale_denom?this._mapScaleToZoomLevel(t.layer_min_scale_denom):this.webMap.options.minZoom;(0,o.wB)(n,{updateWmsParams:t.updateWmsParams,url:t.url,headers:this.options.headers,ratio:this.options.ratio,maxZoom:s,minZoom:u,minScale:t.layer_min_scale_denom,maxScale:t.layer_max_scale_denom})}return void 0!==r&&(n.opacity=r),n},e.prototype.getChildren=function(t){return function(t,e){for(var r=0,n=e.length,o=t.length;r<n;r++,o++)t[o]=e[r];return t}([],t.children).reverse()},e.prototype._mapScaleToZoomLevel=function(t){return function(t,e){void 0===e&&(e=0);var r=e;return function(t){return Math.log(t/256)/Math.LN2}(function(){if(void 0===dt){var t=document.createElement("div");t.style.cssText="position: absolute;  left: -100%;  top: -100%;  width: 100cm;",document.body.appendChild(t);var e=t.offsetWidth;document.body.removeChild(t),dt=e}return dt}()*function(t){return 12756274*Math.PI*Math.cos(t*Math.PI/180)}(r)/t)}(t)},e.prototype._init=function(t){var e=this;this.initItem(t).then((function(){e.emitter.emit("init")}))},e.prototype._sumUp=function(t,e){void 0===e&&(e=0);for(var r=0,n=t;r<n.length;r++){var o=n[r];"layer"===o.item_type?(e+=1,o.draw_order_position=o.draw_order_position||e):"group"===o.item_type&&(e=this._sumUp(o.children,e))}return e},e.GetAdapterFromLayerType={},e.options={properties:[{type:"boolean",name:"visibility",getProperty:function(t){if(t){if("group"===t.item.item_type||"root"===t.item.item_type)return(0,D.cC)(t.item,(function(t){return"layer_enabled"in t&&t.layer_enabled}),(function(t){return t.children}));if("layer"===t.item.item_type)return t.item.layer_enabled}return!1},onSet:function(t,e,r){r&&"layer"===r.item.item_type&&(r.layer&&(t?r.webMap.showLayer(r.layer):r.webMap.hideLayer(r.layer)),r.item.layer_enabled=t)}}]},e}(U.ck),V=function(){return(V=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},z=function(){function t(t){this.options=t,this.resourceId=t.resourceId;var e=t.item;this.item=e,t.labelField&&e.fields?this.name=e.fields[t.labelField]:this.name=String(e.id)}return t.prototype.extent=function(){var t=this;return this._extent?l.Z.resolve(this._extent):this.options.connector.get("feature_layer.feature.item_extent",null,{id:this.resourceId,fid:this.item.id}).then((function(e){var r=e.extent,n=r.minLat,o=r.minLon,i=r.maxLat,a=[o,n,r.maxLon,i];return t._extent=a,a}))},t.prototype.geoJson=function(){var t=this;return this.item.geom?l.Z.resolve(m(this.item)):f({resourceId:this.resourceId,featureId:this.item.id,connector:this.options.connector,geom:!0,fields:null,extensions:null}).then((function(e){var r=e.geom;return t.item.geom=r,m(t.item)}))},t}(),J=function(){return(J=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Y=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},H=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Q=function(){function t(t,e){this.map=t,this.options=e,this.NgwWebmapItem=$,this.pixelRadius=10,this.webmapClassName="webmap",this.emitter=new i.EventEmitter;var r=e.resourceId;if(Array.isArray(r)?(this.resourceId=r[0],this.options.id=r[1]):this.resourceId=r,!this.resourceId)throw new Error("NGW `resourceId` is not defined")}return t.prototype.addLayer=function(t){return Y(this,void 0,void 0,(function(){var e;return H(this,(function(r){switch(r.label){case 0:return this.options=J(J({},this.options),t),e=this,[4,this._getWebMapLayerItem()];case 1:return e.layer=r.sent(),[2,this.layer]}}))}))},t.prototype.removeLayer=function(){var t=this.options.webMap.mapAdapter;this.getDependLayers().forEach((function(e){"layer"in e&&t.removeLayer(e.layer.layer)})),delete this.layer,delete this.response,delete this._webmapLayersIds},t.prototype.showLayer=function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!0)},t.prototype.hideLayer=function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!1)},t.prototype.getExtent=function(){var t=this.response&&this.response.webmap;if(t)return I(t)},t.prototype.getDependLayers=function(){return this.layer&&this.layer.tree.getDescendants()||[]},t.prototype.getBookmarksResourceId=function(){var t=this.response&&this.response.webmap;if(t)return t.bookmark_resource.id},t.prototype.fetchBookmarks=function(){var t=this.getBookmarksResourceId(),e=this.options.connector;if(t)return e.getResourceOrFail(t).then((function(r){var n,o=null===(n=r.feature_layer)||void 0===n?void 0:n.fields.find((function(t){return t.label_field})),i=o&&o.keyname;return L({connector:e,resourceId:t,geom:!1,fields:i?[i]:void 0}).then((function(r){for(var n=[],o=0,a=r;o<a.length;o++){var s=a[o],u=new z({item:s,resourceId:t,labelField:i,connector:e});n.push(u)}return n}))}));throw new Error("Webmap was not loaded correctly, it is impossible to extract bookmarks")},t.prototype.getIdentificationIds=function(){return Y(this,void 0,void 0,(function(){var t,e;return H(this,(function(r){switch(r.label){case 0:return t=[],(e=this._webmapLayersIds)?[3,2]:[4,this._getWebMapIds()];case 1:e=r.sent(),this._webmapLayersIds=e,r.label=2;case 2:return e&&e.length&&this.getDependLayers().sort((function(t,e){return e.id-t.id})).forEach((function(e){var r=e.item,n=r.parentId;if(void 0!==n&&"layer"===r.item_type){var o=e.properties.property("visibility");o.get()&&!o.isBlocked()&&t.push(n)}})),[2,t]}}))}))},t.prototype._getWebMapLayerItem=function(){return Y(this,void 0,void 0,(function(){var t,e=this;return H(this,(function(r){switch(r.label){case 0:return this.resourceId?[4,this.getWebMapConfig(this.resourceId)]:[3,2];case 1:if((t=r.sent())&&t.root_item)return[2,new Promise((function(r){var n={};if(e.options.connector&&e.options.connector.options.auth){var o=e.options.connector.getAuthorizationHeaders();o&&(n.headers=o)}n.setViewDelay=e.options.setViewDelay,n.order=e.options.order,n.ratio=e.options.ratio,n.crossOrigin=e.options.crossOrigin,n.drawOrderEnabled=t.draw_order_enabled;var i=new e.NgwWebmapItem(e.options.webMap,t.root_item,n,e.options.connector);i.emitter.on("init",(function(){return r(i)}))}))];r.label=2;case 2:return[2]}}))}))},t.prototype.getWebMapConfig=function(t){return Y(this,void 0,void 0,(function(){var e,r;return H(this,(function(n){switch(n.label){case 0:return[4,this.options.connector.getResource(t)];case 1:return(e=n.sent())&&(this.response=e,r=e[this.webmapClassName],e.basemap_webmap&&e.basemap_webmap.basemaps.length?this._setBasemaps(e.basemap_webmap):this.options.defaultBasemap&&this.options.webMap.addBaseLayer("OSM",{id:"webmap-default-baselayer",name:"OpenStreetMap"}),r)?(this._extent=[r.extent_left,r.extent_bottom,r.extent_right,r.extent_top],this._updateItemsParams(r.root_item,this.options.webMap,e),[2,r]):[2]}}))}))},t.prototype._setBasemaps=function(t){var e=this,r=this.options.webMap,n=!1;t.basemaps.forEach((function(t){(function(t){var e,r,n,o,i=t.webMap,a=t.connector,s=t.item,u=t.adapterOptions,c=void 0===u?{}:u,l=t.idPrefix,p=void 0===l?"basemapwebmap":l;return e=this,r=void 0,o=function(){return function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(t){return[2,function(){function t(){this.options={},this.layer=[],this._removed=!1}return t.prototype.addLayer=function(){return this.layer},t.prototype.removeLayer=function(){this._removed=!0,this.layer.forEach((function(t){return i.removeLayer(t)}))},t.prototype.showLayer=function(){var t=this;this.options.visibility=!0,this.layer.length?this.layer.forEach((function(t){i.showLayer(t)})):pt({resource:s.resource_id,adapterOptions:{name:s.display_name,opacity:s.opacity}},i,a).then((function(e){if(e){var r=new e(i.mapAdapter.map,V(V({},c),{baselayer:!1}));r.addLayer({}).then((function(e){r.options.baselayer=!1,Object.assign(r.options,c),r.id=p+"-"+s.resource_id,r.layer=e,t._removed&&i.removeLayer(r),t.options.visibility&&i.showLayer(r),t.layer.push(r)}))}}))},t.prototype.hideLayer=function(){this.options.visibility=!1,this.layer&&this.layer.forEach((function(t){return i.hideLayer(t)}))},t}()]}))},new((n=void 0)||(n=Promise))((function(t,i){function a(t){try{u(o.next(t))}catch(t){i(t)}}function s(t){try{u(o.throw(t))}catch(t){i(t)}}function u(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(t){t(r)}))).then(a,s)}u((o=o.apply(e,r||[])).next())}))})({webMap:r,connector:e.options.connector,item:t,adapterOptions:{crossOrigin:e.options.crossOrigin}}).then((function(e){var o=!n&&t.enabled;r.addBaseLayer(e,{name:t.display_name,opacity:t.opacity,visibility:o}),t.enabled&&(n=!0)}))}))},t.prototype._updateItemsParams=function(t,e,r){var n=this;if(t)if("group"===t.item_type||"root"===t.item_type)t.children&&(t.children=t.children.map((function(t){return n._updateItemsParams(t,e,r)}))),"root"===t.item_type&&(t.display_name=r.resource.display_name);else if("layer"===t.item_type){var i=(0,o.nH)(this.options.connector.options.baseUrl+"/api/component/render/image"),a=t.layer_style_id;t.url=i,t.resourceId=a,t.updateWmsParams=function(t){return yt(t,a)};var s=C({adapter:t.layer_adapter.toUpperCase(),resource:a},e,this.options.connector.options.baseUrl||"");t=J(J({},t),s)}return t},t.prototype._getWebMapIds=function(){return Y(this,void 0,void 0,(function(){var t,e,r,n=this;return H(this,(function(o){switch(o.label){case 0:return(t=this.layer)&&"root"===t.item.item_type?(e=t.tree.getDescendants(),r=[],e.forEach((function(t){var e=t.item;if("layer"===e.item_type){var o=e.layer_style_id,i=n.options.connector.getResource(o).then((function(t){if(t){var r=Number(t.resource.parent.id);return e.parentId=r,r}}));r.push(i)}})),[4,Promise.all(r)]):[3,2];case 1:return[2,o.sent().filter((function(t){return void 0!==t}))];case 2:return[2]}}))}))},t}(),K=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),X=function(){function t(){}return t.prototype.getExtent=function(){return t=this,e=void 0,n=function(){var t;return function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(e){switch(e.label){case 0:return this._extent?[2,this._extent]:this.item?(t=this,[4,E(this.item,this.connector).then()]):[3,2];case 1:return t._extent=e.sent(),[2,this._extent];case 2:return[2]}}))},new((r=void 0)||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}));var t,e,r,n},t}(),tt=r(33258),et=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),rt=function(){return(rt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},nt=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},ot=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},it=function(){return(it=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},at=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},st=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},ut={},ct=["mapserver_style","qgis_vector_style","qgis_raster_style","wmsserver_service","raster_style","basemap_layer","vector_layer","raster_layer","webmap","tmsclient_layer"];function lt(t){var e=t.layerOptions,r=t.webMap,n=t.connector,o=t.item;return at(this,void 0,void 0,(function(){var t,i,a;return st(this,(function(s){switch(s.label){case 0:return t=o.resource.id,[4,n.get("resource.collection",null,{parent:t})];case 1:return i=s.sent(),(a=i&&i[0])?[2,pt(it(it({},e),{resource:a.resource.id}),r,n)]:[2]}}))}))}function pt(t,e,r){return at(this,void 0,void 0,(function(){var n,i,a,s,u,l,p,f,h,y,d,v;return st(this,(function(m){switch(m.label){case 0:return a=t.adapter,[4,c(t,r)];case 1:return(s=m.sent())?(u=t.resource)&&u.resource&&void 0!==u.resource.id?(i=u,[3,4]):[3,2]:[3,15];case 2:return[4,r.getResource(s)];case 3:i=m.sent(),m.label=4;case 4:return i?(l=i.resource.cls,p=it(it({},t),{resource:s}),f={layerOptions:p,webMap:e,connector:r,item:i},-1===ct.indexOf(l)?[3,12]:"webmap"!==l?[3,5]:(n=function(t){var e,r,n,o,i=t.layerOptions,a=t.webMap,s=t.connector;return e=this,r=void 0,o=function(){var t;return function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(e){switch(e.label){case 0:return[4,c(i,s)];case 1:return t=e.sent(),[2,function(e){function r(r){return e.call(this,r,{url:"",webMap:a,resourceId:t,connector:s})||this}return K(r,e),r}(Q)]}}))},new((n=void 0)||(n=Promise))((function(t,i){function a(t){try{u(o.next(t))}catch(t){i(t)}}function s(t){try{u(o.throw(t))}catch(t){i(t)}}function u(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(t){t(r)}))).then(a,s)}u((o=o.apply(e,r||[])).next())}))}(f),[3,11])):[3,14];case 5:if("vector_layer"!==l)return[3,6];if(void 0!==a&&"GEOJSON"!==a){if("MVT"!==a)return[2,lt(f)];n=Z(f)}else n=A(f);return[3,11];case 6:return"raster_layer"!==l?[3,7]:[2,lt(f)];case 7:return"basemap_layer"!==l?[3,8]:(n=function(t){var e=t.webMap,r=t.item;return nt(this,void 0,void 0,(function(){var t,n,o,i;return ot(this,(function(a){if(r.basemap_layer){if(t=r.basemap_layer.qms,n=r.basemap_layer.url,t)return(o=Promise.resolve(tt.WL.utils.createQmsAdapter(e))).then((function(e){if(e&&r){var n=JSON.parse(t);e.prototype.qms=n,e.prototype.baselayer=!0}})),[2,o];if(n&&(i=e.mapAdapter.layerAdapters.TILE))return[2,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return et(e,t),e.prototype.addLayer=function(e){return nt(this,void 0,void 0,(function(){return ot(this,(function(r){return[2,t.prototype.addLayer.call(this,rt(rt({},e),{url:n}))]}))}))},e}(i)]}return[2]}))}))}(f),[3,11]);case 8:return"GEOJSON"!==a?[3,10]:[4,r.getResource(i.resource.parent.id)];case 9:return(h=m.sent())&&(y=it(it({},t),{resource:i.resource.parent.id}),n=A(it(it({},f),{item:h,layerOptions:y}))),[3,11];case 10:n=Z(f),m.label=11;case 11:return[3,13];case 12:if(!ut[l])throw"Resource class '"+l+"' not yet supported.";d=ut[l],v=void 0,(v=a&&"function"!=typeof v?d[a]:d)&&(n=v(f)),m.label=13;case 13:return[3,15];case 14:throw"Resource item is not found";case 15:return n?[2,n.then((function(t){if(t){var e=t;return i&&(e.prototype.item=i,e.prototype.resourceId=i.resource.id,e.prototype.connector=r),(0,o.ef)(e,[X],{replace:!1}),e}}))]:[2]}}))}))}var ft=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ht=function(){return(ht=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function yt(t,e){var r=t.bbox,n=t.width,o=t.height,i=t.nd;return{resource:e,extent:r,size:n+","+o,timestamp:Date.now(),nd:i}}var dt,vt={POINT:"point",LINESTRING:"line",POLYGON:"polygon",MULTIPOINT:"point",MULTILINESTRING:"line",MULTIPOLYGON:"polygon",POINTZ:"point",LINESTRINGZ:"line",POLYGONZ:"polygon",MULTIPOINTZ:"point",MULTILINESTRINGZ:"line",MULTIPOLYGONZ:"polygon"};function mt(t,e,r){var n=r.getAuthorizationHeaders();return n&&(t.headers=n),pt(t,e,r)}var bt=function(){return(bt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},wt=function(){function t(t){if(this.options=t,this.options.connector)this.url=this.options.connector.options.baseUrl||"",this.connector=this.options.connector;else{if(!this.options.baseUrl)throw new Error("url is not defined");this.url=this.options.baseUrl,this.connector=new n.Z({baseUrl:this.url,auth:this.options.auth})}}return t.addClassAdapters=function(t,e){ut[t]=e},t.prototype.onLoadSync=function(t){return e=this,r=void 0,o=function(){var e,r,n,o,i;return function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(a){switch(a.label){case 0:if(!this.options.resourceId||!this.url)return[3,4];if(!(e=[this.options.resourceId]).length)return[3,4];r=0,n=e,a.label=1;case 1:return r<n.length?(o=n[r],i={resourceId:o,connector:this.connector,webMap:t},[4,t.addLayer(Q,bt({visibility:!0,fit:!0,pixelRadius:this.options.pixelRadius},i))]):[3,4];case 2:return[2,a.sent()];case 3:return r++,[3,1];case 4:return[2]}}))},new((n=void 0)||(n=Promise))((function(t,i){function a(t){try{u(o.next(t))}catch(t){i(t)}}function s(t){try{u(o.throw(t))}catch(t){i(t)}}function u(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(t){t(r)}))).then(a,s)}u((o=o.apply(e,r||[])).next())}));var e,r,n,o},t.prototype.getLayerAdapters=function(){return Promise.resolve([this._getLayerAdapter()])},t.prototype._getLayerAdapter=function(){var t=this;return{name:"WEBMAP",createAdapter:function(e){return Promise.resolve(t._createAdapter(e))}}},t.prototype._createAdapter=function(t){var e,r=this.connector,n=this.url;return e={webMap:t,connector:r,baseUrl:n},function(t){function r(r,n){return n=ht(ht({},e),n),t.call(this,r,n)||this}return ft(r,t),r}(Q)},t}(),gt=function(){function t(t){var e=t.feature;this.id=e.id,this.label=e.label,this.layerId=e.layerId,this.parent=e.parent,this.fields=e.fields,this.geom=e.geom,this.connector=t.connector}return t.prototype.identify=function(){var t=this;return this._item?l.Z.resolve(this._item):f({connector:this.connector,featureId:this.id,resourceId:this.layerId,fields:null,extensions:["attachment","description"]}).then((function(e){return t._item=e,t.geom=e.geom,t.extensions=e.extensions,e}))},t.prototype.resource=function(){var t=this;return this._resource?l.Z.resolve(this._resource.feature_layer):this.connector.getResource(this.layerId).then((function(e){return t._resource=e,t._resource.feature_layer}))},t.prototype.geojson=function(){var t=this;return this._geojson?l.Z.resolve(this._geojson):this.identify().then((function(e){return e.toGeojson().then((function(e){return t._geojson=e,e}))}))},t}(),_t=function(){return(_t=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function Ot(t,e){var r;void 0===e&&(e=!1);var n=[],o=[];for(var i in t){var a=Number(i);isNaN(a)||n.push(a)}var s=t.resources;s&&n.sort((function(t,e){return s.indexOf(t)-s.indexOf(e)}));for(var u=0;u<n.length;u++){var c=t[i=n[u]];if("features"in c){var l=c.features,p=Number(i),f=l[0];if(f&&(r={featureId:f.id,resourceId:p,feature:f},o.push(r),!e))break}}return o}function Lt(t){var e=t.connector,r=t.identify;for(var n in r){var o=Number(n);if(!isNaN(o)){var i=r[n];if("features"in i){var a=i.features.find((function(t){return t.geom}));if(a&&a.geom){var s=a.geom;return l.Z.resolve(m(_t(_t({},a),{geom:s})))}}}}var u=Ot(r);return u&&u.length?h(_t({connector:e},u[0])):l.Z.resolve(void 0)}function xt(t){var e=t.connector,r=Ot(t.identify);return r&&r.length?f(_t(_t({connector:e},t.requestOptions),r[0])):l.Z.resolve(void 0)}function It(t,e){(0,o.Vc)(t);var r=t.lngLat,n=r[0],i=r[1],a=[];if(e.geom){var s="Feature"===e.geom.type?e.geom.geometry:"Polygon"===e.geom.type&&e.geom;s&&(a=s.coordinates[0])}a.length||(a=(0,o.Wp)(n,i,e.radius));var u=[];a.forEach((function(t){var e=t[0],r=t[1],n=(0,o.Qm)(e,r),i=n[0],a=n[1];u.push(i+" "+a)}));var c={geom:"POLYGON(("+u.join(", ")+"))",srs:3857,layers:e.layers};return e.connector.post("feature_layer.identify",{data:c})}function Mt(t){return new gt(t)}function Et(t,e){var r,n,o,i,a;return n=this,o=void 0,a=function(){var n,o,i,a,s,u,c;return function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(l){switch(l.label){case 0:return[4,t.get("pyramid.settings",null,{component:"pyramid"})];case 1:if(!((n=l.sent())&&n.company_logo&&n.company_logo.enabled))return[3,6];(o=document.createElement("a")).style.position="absolute",o.style.bottom="0",o.style.right="0",o.style.padding=null!==(r=null==e?void 0:e.padding)&&void 0!==r?r:"10px",o.className="ngw-map-logo",e&&e.cssClass&&(o.className+=" "+e.cssClass),(i=new Image).style.maxHeight="100px",i.style.maxWidth="100px",i.src="",l.label=2;case 2:return l.trys.push([2,4,,5]),[4,t.get("pyramid.company_logo",{responseType:"blob"})];case 3:return a=l.sent(),s=window.URL||window.webkitURL,u=s.createObjectURL(a),i.src=u,[3,5];case 4:return c=l.sent(),console.log(c),[3,5];case 5:return null!==n.company_logo.link&&""!==n.company_logo.link.trim()&&(o.href=n.company_logo.link,o.target="_blank",-1!==n.company_logo.link.search(/:\/\/nextgis/)&&(i.alt="Get your own Web GIS at nextgis.com")),o.appendChild(i),[2,o];case 6:return[2]}}))},new((i=void 0)||(i=Promise))((function(t,e){function r(t){try{u(a.next(t))}catch(t){e(t)}}function s(t){try{u(a.throw(t))}catch(t){e(t)}}function u(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(r,s)}u((a=a.apply(n,o||[])).next())}))}},79408:function(t,e,r){"use strict";r.d(e,{Z8:function(){return g}});var n=r(17187),o=r(43590),i=r(39871),a=r(20080),s=r(18195),u=r(81129),c=function(){return(c=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function l(t,e,r,n){if("number"==typeof e||"string"==typeof e)e=Number(e),t.push(c(c({},r),{resource:e}));else if(Array.isArray(e)){var o=e[0],i=e[1];t.push(c(c(c({},r),{resource:o,id:i}),n))}else"object"==typeof e&&t.push(c(c(c({},r),e),n))}var p,f=r(56018),h=r(33258),y=function(){return(y=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},d={target:"map",baseUrl:"",whitlabel:!1,controls:["ZOOM","ATTRIBUTION"],controlsOptions:{ZOOM:{position:"top-left"},ATTRIBUTION:{position:"bottom-right",customAttribution:['<a href="https://nextgis.com" target="_blank">NextGIS</a>']}},pixelRadius:10},v=(p=function(t,e){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),m=function(){return(m=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},b=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},w=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},g=function(t){function e(e){var r=t.call(this,function(t){var e=[new h.WL];return t.starterKits&&t.starterKits.forEach((function(t){e.push(t)})),t.connector?t.connector&&(t.baseUrl=t.connector.options.baseUrl):t.connector=new f.Z({baseUrl:t.baseUrl||"",auth:t.auth}),(t=(0,i.vb)(d,t)).center||t.bounds||(t.bounds=[-179,-90,180,90],t.maxBounds=t.bounds),t.connector&&e.push(new s.lO({connector:t.connector,auth:t.auth})),y(y({},t),{starterKits:e,create:!1})}(e))||this;return r.emitter=new n.EventEmitter,r._ngwLayers={},r._promises={select:[],identify:[]},e.connector&&(r.connector=e.connector),r._createWebMap().then((function(){var t=r.getContainer();t&&t.classList.add("ngw-map-container"),r.options.whitlabel&&r._whiteLabel()})),r}return v(e,t),e.prototype.addControl=function(e,r,n){return b(this,void 0,void 0,(function(){return w(this,(function(o){switch(o.label){case 0:return[4,this.onLoad("controls:create")];case 1:return o.sent(),[2,t.prototype.addControl.call(this,e,r,n)]}}))}))},e.prototype.addNgwLayer=function(t){return b(this,void 0,void 0,(function(){var e,r,n,o,a,u,c,l;return w(this,(function(p){switch(p.label){case 0:return[4,this.onMapLoad()];case 1:if(p.sent(),e=t.keyname,r=t.resourceId,(e||void 0!==r)&&(0,i.vF)("set `resource` options instead of `keyname` or `resourceId`"),n=t.resource,!e&&!r&&!n)throw new Error("resource, resourceId or keyname is required parameter to add NGW layer");if(!this.options.baseUrl&&""!==this.options.baseUrl)return[3,5];p.label=2;case 2:return p.trys.push([2,4,,5]),(0,i.ri)(this.options.setViewDelay)&&(t.adapterOptions=t.adapterOptions||{},(0,i.ri)(t.adapterOptions.setViewDelay)||(t.adapterOptions.setViewDelay=this.options.setViewDelay)),o=(0,s.Zj)(t,this,this.connector),[4,this.addLayer(o,m(m({visibility:!0},t),t.adapterOptions))];case 3:return a=p.sent(),u=a&&this.getLayerId(a),a&&u&&(this._ngwLayers[u]={layer:a,resourceId:a.resourceId},a.options.baselayer&&this.getActiveBaseLayer()),[2,a];case 4:return c=p.sent(),l=(0,i.Kn)(n)&&"id"in n?n.id:e||r||n,console.error("Can't add NGW layer "+l+".",c),[3,5];case 5:return[2]}}))}))},e.prototype.fit=function(){var t=this.options,e=t.center,r=t.zoom,n=t.bounds;e?(this.setCenter(e),r&&this.setZoom(r)):n&&this.fitBounds(n)},e.prototype.fetchNgwLayerItem=function(t){return(0,s.vS)(m({connector:this.connector},t))},e.prototype.fetchNgwLayerItems=function(t){return(0,s.nm)(m({connector:this.connector},t))},e.prototype.fetchNgwLayerFeature=function(t){return(0,s.Cg)(m({connector:this.connector},t))},e.prototype.fetchNgwLayerFeatures=function(t){return(0,s.UJ)(m({connector:this.connector},t))},e.prototype.fetchIdentifyItem=function(t,e){var r=(0,s.K1)({identify:t,connector:this.connector,requestOptions:e});return this._addPromise("identify",r),r},e.prototype.fetchIdentifyGeoJson=function(t,e){void 0===e&&(e=!1);var r=(0,s.D1)({identify:t,connector:this.connector,multiple:e});return r&&"then"in r?(this._addPromise("identify",r),r):o.Z.resolve(r)},e.prototype.getIdentifyGeoJson=function(t,e){return void 0===e&&(e=!1),this.fetchIdentifyGeoJson(t,e)},e.prototype.getNgwLayers=function(){return b(this,void 0,void 0,(function(){return w(this,(function(t){switch(t.label){case 0:return[4,this.onLoad()];case 1:return t.sent(),[2,this._ngwLayers]}}))}))},e.prototype.getNgwLayerByResourceId=function(t){return b(this,void 0,void 0,(function(){var e,r,n,o,i,a,s,u;return w(this,(function(c){switch(c.label){case 0:for(r in e=[],this._ngwLayers)e.push(r);n=0,c.label=1;case 1:return n<e.length?(o=e[n],(i=this._ngwLayers[o]).resourceId!==t?[3,2]:[2,i&&i.layer]):[3,6];case 2:return i.layer.getIdentificationIds?[4,i.layer.getIdentificationIds()]:[3,4];case 3:if((a=c.sent())&&a.some((function(e){return e===t})))return[2,i.layer];c.label=4;case 4:if(i.layer.getDependLayers&&(s=i.layer.getDependLayers(),u=s.find((function(e){return e.item&&e.item.parentId===t}))))return[2,u.layer];c.label=5;case 5:return n++,[3,1];case 6:return[2]}}))}))},e.prototype.fitLayer=function(e,r){return b(this,void 0,void 0,(function(){var n,o,i,a,u,c=this;return w(this,(function(l){switch(l.label){case 0:return n="string"==typeof e||"number"==typeof e?String(n):e.id,(o=n&&this._ngwLayers[n])?o.layer.getExtent?[4,o.layer.getExtent()]:[3,2]:[3,7];case 1:return(i=l.sent())&&this.fitBounds(i,r),[3,6];case 2:return a=void 0,o.layer.item?(a=o.layer.item,[3,5]):[3,3];case 3:return u=o.resourceId,[4,this.connector.getResource(u)];case 4:a=l.sent(),l.label=5;case 5:a&&(0,s.U2)(a,this.connector).then((function(t){t&&c.fitBounds(t,r)})),l.label=6;case 6:return[3,8];case 7:t.prototype.fitLayer.call(this,e,r),l.label=8;case 8:return[2]}}))}))},e.prototype.zoomToLayer=function(t){return b(this,void 0,void 0,(function(){return w(this,(function(e){return[2,this.fitLayer(t)]}))}))},e.prototype.onLoad=function(e){return void 0===e&&(e="ngw-map:create"),t.prototype.onLoad.call(this,e)},e.prototype.removeLayer=function(e){var r=this.getLayer(e);if(r){var n=this.getLayerId(r);n&&delete this._ngwLayers[n],t.prototype.removeLayer.call(this,r)}},e.prototype.enableSelection=function(){var t=this;this.$$selectFromNgwRaster||(this.$$selectFromNgwRaster=function(e){t.emitter.listenerCount("ngw:select")&&t._selectFromNgwRaster(e)},this.$$selectFromNgwVector=function(e){t.emitter.listenerCount("ngw:select")&&t._selectFromNgwVector(e)},this.emitter.on("click",this.$$selectFromNgwRaster),this.emitter.on("layer:click",this.$$selectFromNgwVector))},e.prototype.disableSelection=function(){this.$$selectFromNgwRaster&&(this.emitter.removeListener("click",this.$$selectFromNgwRaster),this.emitter.removeListener("click",this._selectFromNgwVector),this.$$selectFromNgwRaster=void 0,this.$$selectFromNgwVector=void 0)},e.prototype.getNgwLayerItem=function(t){return this.fetchNgwLayerItem(t)},e.prototype.getNgwLayerItems=function(t){return this.fetchNgwLayerItems(t)},e.prototype.getNgwLayerFeature=function(t){return this.fetchNgwLayerFeature(t)},e.prototype.getNgwLayerFeatures=function(t){return this.fetchNgwLayerFeatures(t)},e.prototype.cancelPromise=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cancelPromises.apply(this,t)},e.prototype.cancelPromises=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];e.length||(e=Object.keys(this._promises)),e.forEach((function(e){var r=t._promises[e];r&&(r.forEach((function(t){return t.cancel()})),t._promises[e]=[])}))},e.prototype._addPromise=function(t,e){var r=this._promises[t];if(r&&-1===r.indexOf(e)){var n=function(){var t=r.indexOf(e);-1!==t&&r.splice(t,1)};e.then(n),e.catch(n),r.push(e)}},e.prototype._isFitFromResource=function(){var t=this._initMapState;return!t.zoom||!t.center},e.prototype._createWebMap=function(){return b(this,void 0,void 0,(function(){var t,e,r,n,o,i;return w(this,(function(a){switch(a.label){case 0:return[4,this.create()];case 1:a.sent(),this.options.qmsId&&this.addQmsBaseLayer(),this.options.osm&&this.addOsmBaseLayer(),t=[],e=this._isFitFromResource(),this.options.webmapId&&l(t,this.options.webmapId,{fit:e}),this.options.resources&&Array.isArray(this.options.resources)&&this.options.resources.forEach((function(r){var n={};e||(n.fit=!1),l(t,r,{},n)})),r=0,n=t,a.label=2;case 2:if(!(r<n.length))return[3,7];o=n[r],a.label=3;case 3:return a.trys.push([3,5,,6]),[4,this.addNgwLayer(o)];case 4:return a.sent(),[3,6];case 5:return i=a.sent(),console.log(i),[3,6];case 6:return r++,[3,2];case 7:return this._emitStatusEvent("ngw-map:create",this),this.enableSelection(),[2]}}))}))},e.prototype.addOsmBaseLayer=function(){this.addBaseLayer("OSM")},e.prototype.addQmsBaseLayer=function(){var t,e;Array.isArray(this.options.qmsId)?(t=this.options.qmsId[0],e=this.options.qmsId[1]):t=Number(this.options.qmsId);var r={qmsId:t};e&&(r.id=e),this.addBaseLayer("QMS",r)},e.prototype._selectFromNgwVector=function(t){var e,r=t.layer,n=r.item&&r.item.resource.id,o=t.feature;if(void 0!==n&&o){var i=o.id;if(i){var a={id:Number(i),fields:o.properties,label:"#"+n,layerId:Number(n),parent:"",geom:o.geometry},s=((e={featureCount:1})[n]={featureCount:1,features:[a]},e);return this._emitStatusEvent("ngw:select",this._prepareToIdentify(m(m({},s),{resources:[n],sourceType:"vector"}))),s}}},e.prototype._selectFromNgwRaster=function(t){return b(this,void 0,void 0,(function(){var e,r,n,o,i,a,u,c,l,p,f=this;return w(this,(function(h){switch(h.label){case 0:return this._emitStatusEvent("ngw:preselect"),e=[],(r=Object.values(this._ngwLayers)).sort((function(t,e){return t.layer.order&&e.layer.order?e.layer.order-t.layer.order:1})),r.forEach((function(t){var r=t.layer,n="function"==typeof r.getIdentificationIds&&r.getIdentificationIds;n&&r.options.selectable&&f.isLayerVisible(r)&&e.push(n.call(r))})),[4,Promise.all(e)];case 1:return n=h.sent(),o=[],n.forEach((function(t){t&&t.forEach((function(t){return o.push(t)}))})),o.length?(i=this.options.pixelRadius||10,a=this.getCenter(),u=void 0!==(u=this.getZoom())?u:20,a&&u?(c=40075016.686*Math.abs(Math.cos(180*a[1]/Math.PI))/Math.pow(2,u+8),l=i*c*5e-4,p=(0,s.PA)(t,{layers:o,connector:this.connector,radius:l}).then((function(e){return f._emitStatusEvent("ngw:select",f._prepareToIdentify(m(m({},e),{resources:o,sourceType:"raster",event:t}))),e})),this._addPromise("select",p),[2,p]):(this._emitStatusEvent("ngw:select",null),[2])):(this._emitStatusEvent("ngw:select",null),[2])}}))}))},e.prototype._prepareToIdentify=function(t){var e=this;return m(m({},t),{getIdentifyItems:function(){return(0,s.RP)(t,!0).map((function(t){return(0,s.u4)({feature:t.feature,connector:e.connector})}))}})},e.prototype._whiteLabel=function(){return b(this,void 0,void 0,(function(){var t,e;return w(this,(function(r){switch(r.label){case 0:return(t=this.getContainer())?[4,(0,s.GW)(this.connector,this.options.companyLogoOptions)]:[3,2];case 1:(e=r.sent())&&t.appendChild(e),r.label=2;case 2:return[2]}}))}))},e.getIcon=u.q,e}(a.y9)},69261:function(t,e,r){"use strict";function n(t){return"[object Object]"===Object.prototype.toString.call(t)}function o(t){return"function"==typeof t}r.d(e,{GY:function(){return n},UY:function(){return o},Yx:function(){return f}});var i=function(){return(i=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},a={get:function(t,e){var r=e[0];return t.properties&&t.properties[r]},match:function(t,e){var r=e[0],n=e.slice(1),o=r;Array.isArray(r)&&(o=s(t,r));for(var i=n.splice(-1,n.length%2)[0],a=0;a<n.length-1;a+=2)if(n[a]===o)return n[a+1];return i}};function s(t,e){var r=e[0],n=e.slice(1),o=a[r];if(o)return o(t,n)}function u(t){return function(e){return s(e,t)}}var c=["iconSize","iconAnchor"],l=r(97060),p=function(){return(p=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function f(t,e,r){if(!t)throw new Error("paint is empty");var n=p({},e);if(o(t)){var a=function(n){var o=f(t(n),e,r);return o.type=t.type,o};return a.type=t.type,a}if(function(t){return!!Array.isArray(t)}(t))return function(n){return f((o={},i=[],t.forEach((function(t){t&&(Array.isArray(t)?i.push(t):o=t)})),function(t){var e=i.find((function(e){return(0,l.TE)(t,e[0])}));return e?p(p({},o),e[1]):o})(n),e,r);var o,i};if("get-paint"===t.type){var s=function(t,e){if("function"==typeof t.from)return t.from(t.options);if("string"==typeof t.from&&e){var r=e[t.from];if(r)return r(t.options)}}(t,r);s&&(n=f(s,e,r))}else{if("icon"===t.type)return t;var h=function(t){var e,r=!1,n={};for(var o in t)if(-1===c.indexOf(o)){var a=o,s=t[a];e=s,Array.isArray(e)&&(r=!0,n[a]=u(s))}if(r)return function(e){var r={};for(var o in n)r[o]=n[o](e);return i(i({},t),r)}}(t);if(h)return function(t){return f(h(t),e,r)};(n=p(p({},n),t)).fill=void 0===n.fill||n.fill,n.stroke=void 0!==n.stroke?n.stroke:!n.fill||!(!n.strokeColor&&!n.strokeOpacity)}return o(n)||("color"in n&&(n.strokeColor||(n.strokeColor=n.color),n.fillColor||(n.fillColor=n.color)),"opacity"in n&&(void 0===n.strokeOpacity&&(n.strokeOpacity=n.opacity),void 0===n.fillOpacity&&(n.fillOpacity=n.opacity))),n}},97060:function(t,e,r){"use strict";r.d(e,{a$:function(){return s},TE:function(){return u},Ml:function(){return c}});var n=r(39871),o=function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function i(t,e,r){if((e=String(e))===(t=String(t)))return!0;if(r&&e.toUpperCase()===t.toUpperCase())return!0;var o=("^"+(0,n.Fz)(e)+"$").replace(/%/g,".*").replace("_",".");return null!==new RegExp(o,r?"i":"").exec(t)}var a={gt:function(t,e){return t>e},lt:function(t,e){return t<e},ge:function(t,e){return t>=e},le:function(t,e){return t<=e},eq:function(t,e){return t===e},ne:function(t,e){return t!==e},in:function(t,e){return-1!==e.indexOf(t)},notin:function(t,e){return-1===e.indexOf(t)},like:function(t,e){return i(t,e)},ilike:function(t,e){return i(t,e,!0)}};function s(t){var e=t;return 3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]}function u(t,e){var r=o({},t.properties);return!!r&&(r.$id=t.id,c(r,e))}function c(t,e){var r="string"==typeof e[0]?e[0]:"all",n=function(e){if(s(e)){var r=e[0],n=e[1],o=e[2],i=a[n];if(i){if(("like"===n||"ilike"===n)&&"string"==typeof r){var u="",l=r.replace(/^%?(\w+)%?$/,(function(e,n){return u=t[n],r.replace(n,o)}));return i(u,l)}return i(t[r],o)}return!1}return c(t,e)},o=e.filter((function(t){return Array.isArray(t)}));return"any"===r?o.some(n):o.every(n)}},33258:function(t,e,r){"use strict";r.d(e,{WL:function(){return c}});var n=r(39871),o={tms:"TILE"};function i(t){return new Promise((function(e,r){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState&&200===o.status&&o.responseText)try{e(JSON.parse(o.responseText))}catch(t){r(t)}},o.open("GET",(0,n.nH)(t),!0),o.send()}))}var a=function(){return(a=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function s(t,e){return void 0===e&&(e="https://qms.nextgis.com"),function(){function r(t,e){this.map=t,this.options=e,this.options.baselayer=!0}return r.prototype.addLayer=function(s){return u=this,c=void 0,p=function(){var u,c,l,p,f,h,y,d;return function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(v){switch(v.label){case 0:if(this.qms||!s.qmsId)return[3,4];v.label=1;case 1:return v.trys.push([1,3,,4]),u=this,[4,i(e+"/api/v1/geoservices/"+s.qmsId)];case 2:return u.qms=v.sent(),[3,4];case 3:return c=v.sent(),console.error(c),[3,4];case 4:return(l=this.qms)&&(p=o[l.type||"tms"],(f=t.mapAdapter.layerAdapters[p])&&((0,n.FR)(r,f,["showLayer","hideLayer"]),"TILE"===p))?(s=a(a({order:0,maxZoom:t.options.maxZoom,minZoom:t.options.minZoom},this.options),function(t){var e=("https:"===location.protocol?"https":"http")+"://",r=t.url.replace(/^(https?|ftp):\/\//,e);return t.y_origin_top||(r=r.replace("{y}","{-y}")),{url:r,name:t.name,attribution:t.copyright_text,maxZoom:t.z_max,minZoom:t.z_min}}(l)),l.origin_url&&(m=l.origin_url,b=[],h=[m=m.replace(/{switch:(.*?)}/,(function(t,e){return"string"==typeof e&&e.split(",").forEach((function(t){return b.push(t)})),"{s}"})),b],y=h[0],(d=h[1]).length&&(s.subdomains=d,s.url=y)),this.options=s,[2,new f(this.map,s).addLayer(s)]):[2]}var m,b}))},new((l=void 0)||(l=Promise))((function(t,e){function r(t){try{o(p.next(t))}catch(t){e(t)}}function n(t){try{o(p.throw(t))}catch(t){e(t)}}function o(e){var o;e.done?t(e.value):(o=e.value,o instanceof l?o:new l((function(t){t(o)}))).then(r,n)}o((p=p.apply(u,c||[])).next())}));var u,c,l,p},r}()}var u=function(){return(u=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},c=function(){function t(t){this.options={url:"https://qms.nextgis.com"},this.options=u(u({},this.options),t),this.url=this.options.url}return t.prototype.getLayerAdapters=function(){var t=this;return Promise.resolve([{name:"QMS",createAdapter:function(e){return Promise.resolve(t._createAdapter(e))}}])},t.prototype._createAdapter=function(t){return s(t,this.url)},t.utils={createQmsAdapter:s},t}()}}]);
//# sourceMappingURL=main-7db0a515a224d2b.js.map