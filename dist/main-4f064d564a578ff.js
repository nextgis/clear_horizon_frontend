(self.webpackChunkclear_horizon=self.webpackChunkclear_horizon||[]).push([[42],{7285:()=>{document.addEventListener("DOMContentLoaded",(()=>{const t=Array.prototype.slice.call(document.querySelectorAll(".navbar-burger"),0);t.length>0&&t.forEach((t=>{t.addEventListener("click",(()=>{const e=t.dataset.target,n=document.getElementById(e);t.classList.toggle("is-active"),n&&n.classList.toggle("is-active")}))}))}))},4252:(t,e,n)=>{"use strict";n(5666),n(6265);var i=n(1521),o=n(8907),s=n(6719),a=n(732),r=n(5502),l=n(2010),c=n.n(l);const h=[[24,"1 день"],[48,"2 дня"],[72,"3 дня"],[96,"4 дня"],[120,"5 дней"],[144,"6 дней"],[168,"неделя"]];let d=new Date;function p(t,e){const n=e?e.getTime():Date.now();return[n-1e3*Number(t)*60*60,n].map((t=>new Date(t)))}function u(t,e,n){const{timeUnit:i,dateField:o}=e.props,s=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"s";return p(t,arguments.length>2?arguments[2]:void 0).map((t=>"ISO"===e?new Date(t).toISOString():"s"===e?Math.ceil(t.getTime())/1e3:t.getTime()))}(t,i,n);return s.map(((t,e)=>[o,e?"le":"ge",t]))}setInterval((()=>{d=new Date}),36e5);var m=n(7187),g=n(4705);function _(t,e,n){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(e))?i:String(i))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class f{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.actionMap=t,_(this,"html",'<i class="fas fa-map-pin btn-control-icon "></i>'),_(this,"title",{off:"Полученить координаты с карты",on:"Выключить режим получения координат с карты"}),_(this,"addClass","toggle-control webmap-tree-control"),_(this,"addClassOn","active"),_(this,"status",!1),_(this,"emitter",new m.EventEmitter),_(this,"_toggle",void 0),_(this,"__onMapClick",void 0),_(this,"_layer",void 0),this._toggle=e.toggle,this.actionMap.ngwMap.addFeatureLayer({id:"show-coordinate-click",visibility:!0,paint:{radius:6},popup:!0,popupOptions:{createPopupContent:t=>{if(t.feature)return this._createPopupContent(t.feature.geometry.coordinates.map((t=>t.toFixed(5))))}}}).then((t=>{t&&(this._layer=t)}))}onClick(t){this.toggleControl(t)}show(){this.actionMap.ngwMap.setCursor("crosshair"),this._removeClickListener(),this.__onMapClick=t=>this._onMapClick(t),this.actionMap.ngwMap.emitter.on("click",this.__onMapClick)}hide(){this.actionMap.ngwMap.setCursor("default"),this._removeClickListener(),this.actionMap.ngwMap.clearLayerData(this._layer)}_removeClickListener(){this.__onMapClick&&(this.actionMap.ngwMap.emitter.off("click",this.__onMapClick),this.__onMapClick=void 0)}_onMapClick(t){const e={type:"Feature",properties:{},geometry:{type:"Point",coordinates:t.lngLat}};this.actionMap.ngwMap.setLayerData(this._layer,e)}toggleControl(t){(t=void 0!==t?t:!this.status)?this.show():this.hide(),this.status=t,this._toggle&&this._toggle(t),this.emitter.emit("status",this.status)}_createPopupContent(t){let[e,n]=t;const i=document.createElement("div"),o="".concat(n,", ").concat(e);return i.innerHTML='\n    <span>Широта/Долгота:</span>\n    <span class="lat-lng-coord"> '.concat(o,'</span>\n    <a href="#" class="copy-to-clipboard">\n    <i class="far fa-clipboard"></i>\n    </a>'),i.getElementsByClassName("copy-to-clipboard")[0].onclick=()=>{g.T.copy(o)},i}}var v=n(6273),y=n.n(v),b=n(9528);function w(t,e,n){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(e))?i:String(i))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class M{constructor(t){this.options=t,w(this,"ngwMap",void 0),w(this,"_container",void 0),w(this,"_baseMapsContainer",void 0),this.ngwMap=t.ngwMap,this._container=this._createContainer(),this.ngwMap.emitter.on("layer:add",(t=>{this.ngwMap.isBaseLayer(t)&&this._updateBaseMapContainer()}))}getContainer(){return this._container}_createContainer(){const t=document.createElement("div");t.className="basemaps-contentainer panel-content-padding control";const e=document.createElement("div");return e.className="basemaps-contentainer__layers",this._baseMapsContainer=e,t.appendChild(e),this._updateBaseMapContainer(),t}_updateBaseMapContainer(){this._baseMapsContainer&&(this._baseMapsContainer.innerHTML=""),this._createBaseMapItem(),this.ngwMap.getBaseLayers().forEach((t=>{const e=this.ngwMap.getLayer(t);e&&this._createBaseMapItem(e)}))}_createBaseMapItem(t){const e=document.createElement("div");e.className="control";const n=document.createElement("label");n.className="radio basemap-container__item";const i=document.createElement("input");i.setAttribute("type","radio"),i.setAttribute("name","basemap"),i.checked=!!t&&this.ngwMap.isLayerVisible(t),i.onclick=()=>{if(t&&t.id)this.ngwMap.toggleLayer(t.id,i.checked);else{const t=this.ngwMap.getActiveBaseLayer();t&&this.ngwMap.hideLayer(t)}};const o=t&&(t.name||t.options.name)||"Blank",s=document.createTextNode(o);n.appendChild(i),n.appendChild(s),e.appendChild(n),this._baseMapsContainer&&this._baseMapsContainer.appendChild(e)}}var C=n(5243);function L(t,e,n){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(e))?i:String(i))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class k{constructor(t){this.options=t,L(this,"ngwMap",void 0),L(this,"_container",void 0),this.ngwMap=t.ngwMap,this._container=this._createContainer()}getContainer(){return this._container}_createContainer(){const t=document.createElement("div");t.className="bookmarks-contentainer panel-content-padding ";const e=document.createElement("div");return e.className="bookmarks-contentainer__layers",this.options.bookmarks.forEach((e=>{this.ngwMap.connector.get("resource.item",null,{id:e.id}).then((n=>{if(n.feature_layer){const i=n.feature_layer.fields.find((t=>t.label_field));i&&this.ngwMap.fetchNgwLayerItems({resourceId:e.id}).then((e=>{e.forEach((e=>{const n=this._createBookmarkItem(e,i.keyname);t.appendChild(n)}))}))}}))})),t.appendChild(e),t}_createBookmarkItem(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"name";const n=document.createElement("div");n.className="tree-container__item bookmark";const i=document.createElement("div"),o=t.fields[e];return i.innerHTML=String(o),i.onclick=()=>{const e=new C.GeoJSON(t.geom),n=this.ngwMap.mapAdapter.map;n&&n.fitBounds(e.getBounds())},n.appendChild(i),n}}function P(t,e,n){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(e))?i:String(i))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const E="Загрузка данных...";class S{constructor(t){this.options=t,P(this,"_container",document.createElement("div")),P(this,"_content",void 0),P(this,"_toggle",void 0),P(this,"status",void 0),this.status=void 0===this.options.open||this.options.open,this._updateContainer(),this.options.parent&&this.options.parent.appendChild(this.getContainer())}getContainer(){return this._container}open(){!this._content||this._content.innerHTML&&this._content.innerHTML!==E||this._updateContent(),this._toggle&&(this._toggle.innerHTML=this._getToggleButtonHtml("fas fa-chevron-up")),this.status=!0}close(){this._cleanContent(),this._toggle&&(this._toggle.innerHTML=this._getToggleButtonHtml("fas fa-chevron-down")),this.status=!1}toggle(){this.status?this.close():this.open()}_getToggleButtonHtml(t){return'\n    <a class="button is-small">\n    <span class="icon is-small">\n      <i class="'.concat(t,'"></i>\n    </span>\n    </a>\n    ')}_updateContainer(){if(this._container.innerHTML="",this.options.title){const t=this._createHeader();this._container.appendChild(t)}const t=document.createElement("div");t.innerHTML=E,t.className="panel-content",this._content=t,this._container.appendChild(t),this.status?this.open():this.close()}_createHeader(){const t=document.createElement("div");t.className="level is-mobile panel-header";const e=document.createElement("div");e.className="level-left";const n=document.createElement("div");n.className="level-item panel-header__title",n.innerHTML=this.options.title||"",e.appendChild(n);const i=document.createElement("div");i.className="level-right";const o=document.createElement("div");return o.className="level-item panel-header__toggle",i.appendChild(o),o.onclick=()=>{this.toggle()},this._toggle=o,t.appendChild(e),t.appendChild(i),t}_cleanContent(){this._content&&(this._content.innerHTML="")}async _updateContent(){if(this._cleanContent(),this._content){const t="function"==typeof this.options.content?await this.options.content():this.options.content;this._content.appendChild(t)}return this._content}}function D(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ms";const n=t.getTime();return"s"===e?n/1e3:t.toISOString()}n(7267);var T=n(8651);function O(t,e,n){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(e))?i:String(i))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class N{constructor(t){this.options=t,O(this,"ngwMap",void 0),O(this,"_container",void 0),this.ngwMap=t.ngwMap,this._container=this._createContainer()}getContainer(){return this._container}_createContainer(){const t=document.createElement("div");t.className="fires-contentainer panel-content-padding ";const e=document.createElement("div");e.className="fires-contentainer__layers";for(const t of this.options.layers)this._createFireItem(t,e);return t.appendChild(e),t}onLayerAdd(t,e){const n=this.options.ngwMap,i=n&&n.getLayer(t);if(i)e(i);else{const n=i=>{i.id===t&&(e(i),this.ngwMap.emitter.off("layer:add",n))};this.ngwMap.emitter.on("layer:add",n)}}_createFireItem(t,e){const n=document.createElement("div");n.className="tree-container__item";const i=t.id;if(!(0,T.r)(i))return;const o=document.createElement("div");o.innerHTML="загрузка...",e.appendChild(o);const s=e=>{const s=e.item;if(o.innerHTML="",s){const e=document.createElement("input");e.setAttribute("type","checkbox"),e.checked=!0,e.onclick=()=>{this.ngwMap.toggleLayer(i,e.checked)};const a=document.createElement("span"),r=s.resource.display_name.split("__")[0];a.innerHTML=r.replace("fires","").trim();const l=this._createSymbol(t);n.appendChild(e),n.appendChild(l),n.appendChild(a),o.appendChild(n)}};this.onLayerAdd(i,(t=>s(t)))}_createSymbol(t){var e;const n=document.createElement("span");if(n.className="item-symbol",null!==(e=t.adapterOptions)&&void 0!==e&&e.paint){var i;const{color:e,stroke:o,strokeColor:s}=null===(i=t.adapterOptions)||void 0===i?void 0:i.paint;"string"==typeof e&&(n.style.color=e,n.style.backgroundColor=e),o&&"string"==typeof s&&(n.style.borderColor=s)}return n}}var H=n(7450),I=n(8527),j=n(8809);class x extends N{_createContainer(){const t=super._createContainer(),e=this._createCalendar();return t.insertBefore(e,t.firstChild),t}_createCalendar(){const t=document.createElement("div"),e=this.options.layers,n=[];return e.forEach((t=>{const e=t.id;if(e){const t=new Promise((t=>{this.onLayerAdd(e,t)}));n.push(t)}})),Promise.all(n).then((e=>{const n=this._buildCalendarBlock(e,this.options.dateRange,this.options.defaultDateRange);t.appendChild(n)})),t}_buildCalendarBlock(t,e,n){const[i,o]=e,[s,a]=n,r={timedelta:this.options.timedelta,onChange:e=>{for(const n of t){const{dateField:t,timeUnit:i}=n.options.props||{};if(t){const o=[];e.start&&o.push([t,"ge",D(e.start,i)]),e.end&&o.push([t,"le",D(e.end,i)]),n.propertiesFilter&&n.propertiesFilter(o)}}this.options.onDateChange&&this.options.onDateChange()}};return i&&(r.minDate=i),s&&(r.startDate=s),o&&(r.maxDate=o),a&&(r.endDate=a),function(t){const{onChange:e,maxDate:n,minDate:i,startDate:o,endDate:s,timedelta:a}=t,r=document.createElement("div");r.className="field is-horizontal",r.innerHTML='\n  <button class="button calendar-open calendar-control-btn is-small">\n    <i class="fa fa-calendar" aria-hidden="true"></i>\n  </button>\n    <div class="field">\n        <input class="input input-from is-small" type="text" >\n    </div>\n\n    <div class="select is-small">\n      <select class="select-input">\n        '.concat(h.map((t=>"<option ".concat(a===t[0]?"selected":""," value=").concat(t[0],">").concat(t[1],"</option>"))),'\n      </select>\n    </div>\n    <button class="button calendar-clean calendar-control-btn is-small">✖</button>\n    ');const l=r.querySelector(".select-input"),c=r.querySelector(".input.input-from"),d=r.querySelector(".calendar-clean"),u=r.querySelector(".calendar-open"),m=new Date,g=(0,H.D)((t=>{t.start&&t.end&&e(t)})),_=o&&s?[o,s]:void 0,f=(0,I.Z)(c,{mode:"range",locale:j.Russian,allowInput:!0,maxDate:n||m,minDate:i,defaultDate:_,onChange:t=>{let[e,n]=t;l.value="",v(),g({start:e,end:n})}}),v=()=>{d.style.display=Number(l.value)===a?"none":"block"};v();const y=t=>{v();const[e,n]=p(t,s);f.setDate([e,n]),g({start:e,end:n})};return u.onclick=t=>{t.stopPropagation(),t.preventDefault(),f.isOpen?f.close():f.open()},d.onclick=()=>{l.value=String(a),y(a)},l.onchange=()=>{v(),y(Number(l.value))},r}(r)}}var B=n(8786);class F{constructor(t){var e,n,i,o;e=this,i=void 0,(n="symbol"==typeof(o=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n="_container"))?o:String(o))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i;const s=this._createTreeItem(t);s&&(this._container=s)}getContainer(){return this._container}_createTreeBranch(t){const e=document.createElement("div");return e.className="tree-container__item-children",t.forEach((t=>{if(t.item){const n=this._createTreeItem(t);n&&e.appendChild(n)}})),e}_createTreeItem(t){const e=t.item;if(!e)return!1;const n=document.createElement("div");if(n.className="tree-container__item",e.display_name){const i=document.createElement("input");i.setAttribute("type","checkbox");const o=t.properties.property("visibility");i.checked=!!o.get(),o&&(o.emitter.on("change",(t=>{i.checked=t.value})),i.onclick=()=>{o.set(i.checked,{propagation:B.y9.keys.pressed("ctrl")})});const s=document.createElement("span");s.innerHTML=e.display_name,n.appendChild(i),n.appendChild(s)}if("group"===e.item_type||"root"===e.item_type&&e.children.length){const e=t.tree.getChildren(),i=this._createTreeBranch(e.reverse());n.appendChild(i)}return n}}function A(t,e,n){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(e))?i:String(i))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const U={target:"tree"};class z{constructor(t,e){if(this.actionMap=t,A(this,"options",void 0),A(this,"sidebar",void 0),A(this,"_container",void 0),A(this,"_target",void 0),A(this,"ngwLayers",void 0),this.options={...U,...e},"string"==typeof this.options.target){const t=document.getElementById(this.options.target);if(!t)throw new Error("No element with ID #".concat(this.options.target," in document for webmap tree"));this._target=t}else{if(!(this.options.target instanceof HTMLElement))throw new Error("`target` option is not set");this._target=this.options.target}this.sidebar=new(y())(this._target,{closeButton:!1,position:"left",autoPan:!1}),this.sidebar.addTo(this.actionMap.ngwMap.mapAdapter.map),this.ngwLayers=this.options.ngwLayers,this._container=this._createContainer(),this.options.status||this.hide(),this._target&&this._target.appendChild(this._container)}show(){this._container.classList.remove("hidden"),this.sidebar.show()}hide(){this.sidebar.hide(),this._container.classList.add("hidden")}_createContainer(){const t=document.createElement("div");return t.className="tree-container",void 0!==this.options.width&&(t.style.width=this.options.width+"px"),(this.options.userFires||this.options.firms)&&new S({title:"Пожары",content:()=>this._createFiresContainer(),parent:t}),this.options.sensors&&new S({title:"Датчики",content:()=>this._createSensorContainer(),parent:t}),new S({title:"Базовые слои",content:()=>this._createNgwLayers(),open:!1,parent:t}),new S({title:"Подложки",content:()=>this._createBasemapsContainer(),open:!1,parent:t}),new S({title:"Закладки",content:()=>this._createBookmarksContainer(),open:!1,parent:t}),t}_createNgwLayers(){const t=document.createElement("div");t.className="webmap-tree-container";for(const e in this.ngwLayers){const n=this.ngwLayers[e],i=new F(n.layer.layer).getContainer();i&&t.appendChild(i)}return t}_createBookmarksContainer(){const t=document.createElement("div"),e=this.options.bookmarks;if(e){const n=new k({bookmarks:e,ngwMap:this.options.ngwMap});t.appendChild(n.getContainer())}return t}async _createFiresContainer(){const t=document.createElement("div"),{firms:e,userFires:n}=this.options;let i=[void 0,void 0];if(e||n){const o=[];n&&n.id&&(o.push(n),i=await function(t){let{connector:e,layer:n}=t;const i=n.resource;if(n&&i&&e){var o;const t=(null===(o=n.adapterOptions)||void 0===o||null===(o=o.props)||void 0===o?void 0:o.dateField)||"field_9";return e.getResourceIdOrFail(i).then((n=>{const i={resourceId:n,fields:[t],geom:!1,connector:e,limit:1},o=[(0,b.n)({...i,orderBy:[t]})];return Promise.all(o).then((e=>{let[n,i]=e;const[o]=[n,i].map((e=>{const n=e&&e[0];if(n){const e=n.fields[t];if(e)return i=e,new Date(i.year,i.month-1,i.day)}var i}));return[o,d]}))}))}return Promise.resolve([void 0,void 0])}({layer:n,connector:this.options.ngwMap.connector})),e&&e.forEach((t=>o.push(t)));const s=p(this.actionMap.options.timedelta||24,d),a=new x({layers:o,ngwMap:this.options.ngwMap,dateRange:i,defaultDateRange:s,timedelta:this.actionMap.options.timedelta||72,onDateChange:()=>{this.options.onDateChange&&this.options.onDateChange()}});t.appendChild(a.getContainer())}return t}async _createSensorContainer(){const t=document.createElement("div"),{sensors:e}=this.options;if(e){const n=new N({layers:[e],ngwMap:this.options.ngwMap});t.appendChild(n.getContainer())}return t}_createBasemapsContainer(){const t=document.createElement("div");if(this.options.firms){const e=new M({ngwMap:this.options.ngwMap});t.appendChild(e.getContainer())}return t}}var R=n(8956),q=n.n(R);var Z=n(9085),W=n(7282);function G(t){let{value:e,color:n,label:i}=t;return{value:e,options:{borderColor:n,borderWidth:3,borderDash:[5,5],label:{display:!1,backgroundColor:n,drawTime:"afterDatasetsDraw",content:["Порог СанПиН для ".concat(i),"(".concat(e," мкг/м3)")]},enter(t){let{element:e}=t;return e.label&&(e.label.options.display=!0),!0},leave(t,e){let{element:n}=t;return n.label&&(n.label.options.display=!1),!0}}}}n(9307),n(3383),n(6961),Z.kL.register(W.Z);const V=[{options:{height:200,units:"мкг/м3"},charts:{P1:{label:"PM 10",backgroundColor:"#1b9224",borderColor:"#1b9224",borderWidth:1,threshold:G({value:60,color:"#1b9224",label:"PM10"})},P2:{label:"PM 2.5",backgroundColor:"#08dddf",borderColor:"#08dddf",borderWidth:1,threshold:G({value:35,color:"#08dddf",label:"PM2.5"})}}},{options:{height:100,units:"%"},charts:{humidity:{label:"Влажность",backgroundColor:"#ee9602",borderColor:"#ee9602"}}},{options:{height:100,units:"°C"},charts:{temperature:{label:"Температура",backgroundColor:"#e1014a",borderColor:"#e1014a"}}}];function K(t){let{types:e,showXAxis:n,sensorsData:i}=t;const{charts:o,options:s}=e,{height:a,units:r}=s||{},l=function(t){const e=[];return Object.entries(t).forEach((t=>{let[n,i]=t;if(i.threshold){const{value:t,options:n}=i.threshold;e.push({type:"line",yMin:t,yMax:t,borderColor:"rgb(255, 99, 132)",borderWidth:2,...n})}})),{annotation:{annotations:e}}}(o),c=document.createElement("canvas");return c.height=a||200,console.log(c.style.height),c.className="sensor-char",new Z.kL(c,{data:{datasets:Object.entries(o).filter((t=>{let[e]=t;return i.some((t=>t.value_type===e))})).map((t=>{let[e,n]=t;return{type:"line",label:e,pointRadius:1,...n,data:i.filter((t=>t.value_type===e)).map((t=>({x:new Date(t.datetime).getTime(),y:t.value})))}}))},options:{responsive:!0,plugins:{...l,legend:{labels:{usePointStyle:!0,generateLabels:t=>t.data.datasets.map((function(e,n){return{text:e.label||"",lineCap:"round",lineDash:[],lineDashOffset:0,lineJoin:"round",lineWidth:2,strokeStyle:String(e.borderColor),fillStyle:String(e.backgroundColor),pointStyle:"line",rotation:0,hidden:!t.isDatasetVisible(n),datasetIndex:n}}))}}},scales:{x:{grid:{display:!0},ticks:{display:n,autoSkip:!0,maxTicksLimit:12},type:"time",time:{unit:"hour",displayFormats:{hour:"HH:mm"}}},y:{afterFit:t=>{t.width=30},title:{display:!!r,text:r,align:"center",padding:{top:20,bottom:0}}}}}}),c}function J(t,e,n){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(e))?i:String(i))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class Q{constructor(){J(this,"ngwMap",void 0),J(this,"_resourceItems",{})}setNgwMap(t){this.ngwMap=t}async createSensorPopupContent(t){return async function(t){let{feature:e,signal:n}=t;const i=document.createElement("div"),{SID_T:o,PLACE:s}=e.properties||{},a=[o,s].filter(Boolean);return 0===a.length||(i.innerHTML="Загрузка...",async function(t){let{signal:e,sensorIds:n,popupElement:i}=t;try{const t=await async function(t){let{valueType:e,lastHours:n,sensorIds:i,signal:o,start:s,end:a}=t;const r=[];for(const t of i){const i={sensor_id:t};e&&(i.value_type=e),n?i.lasthours=String(n):(s&&(i.start=s.toISOString()),a&&(i.end=a.toISOString()));const l="https://sensors.clear-horizon.org/";r.push(fetch("".concat(l,"api/v1/measurements?").concat(new URLSearchParams(i).toString()),{method:"GET",signal:o}).then((t=>t.json())))}return Promise.all(r).then((t=>t.flat()))}({sensorIds:n,lastHours:24,signal:e});if(0===t.length)return i.innerHTML="Данные для ".concat(n.length>1?"приёмников":"приёмника"," #").concat(n," за последние 24 часа не найдены"),i;t.reverse(),i.innerHTML="";for(const[e,n]of V.entries()){const o=K({types:n,sensorsData:t,showXAxis:e>=V.length-1});i.appendChild(o)}}catch{i.innerHTML="Ошибка загрузки"}}({signal:n,popupElement:i,sensorIds:a})),i}(t)}createPopupContent(t,e,n){const i=document.createElement("div"),o=t.properties,s=document.createElement("div");if(o){s.className="properties";const t=Object.entries(o).map((t=>{let[e,n]=t;return{key:e,value:n}}));s.innerHTML=this.createPropertiesHtml(t)}if(e){const o=document.createElement("div");o.appendChild(s),i.innerHTML="Загрузка...",this.updateElementContent(o,e,t).then((()=>{i.innerHTML="",i.appendChild(o)})),n&&n.length&&this._addPhotos(i,n,e,Number(t.id))}else i.appendChild(s);return i}createPropertiesHtml(t){let e="";return t.forEach((t=>{let{key:n,value:i}=t;"object"==typeof i&&i&&("year"in i?i=[i.day,i.month,i.year].join("."):"hour"in i&&(i=[i.hour,i.minute].join(":"))),e+='\n      <div class="columns is-mobile">\n        <div class="column is-two-fifths">'.concat(n,'</div>\n        <div class="column">').concat(function(t){return"string"==typeof t&&(e=t,new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e))?'<a href="'.concat(t,'" target="_blank">').concat(t,"</a>"):t;var e}(i),"</div>\n      </div>\n      ")})),e}async updateElementContent(t,e,n){const i=await this._getResourceItem(e);if(i.feature_layer){const e=[];i.feature_layer.fields.forEach((t=>{if(t.grid_visibility){let i=n.properties[t.keyname];i&&("string"==typeof i&&(i=i.replace(/\w+(;)\w+/g,((t,e)=>t.replace(e,e+" ")))),e.push({key:t.display_name,value:i}))}}));const o=this.createPropertiesHtml(e),s=t.getElementsByClassName("properties")[0];s&&(s.innerHTML=o)}return i}async _addPhotos(t,e,n,i){const o=document.createElement("div");o.className="carousel attachment";for(const t of e){const e=300,s=300,a=document.createElement("figure");a.className="image is-".concat(e,"x").concat(s),a.style.maxHeight=s+"px",a.style.maxWidth=e+"px";const r=await this._loadImage(t,{width:e,height:s,id:n,fid:i}),l=document.createElement("img");l.src=r,a.appendChild(l),o.appendChild(a)}t.appendChild(o),q().attach(o)}async _getResourceItem(t){if(!this._resourceItems[t]){const e=await this.ngwMap.connector.get("resource.item",null,{id:t});this._resourceItems[t]=e}return this._resourceItems[t]}_loadImage(t,e){return new Promise(((n,i)=>{const{width:o,height:s}=e,a="/api/resource/"+e.id+"/feature/"+e.fid+"/attachment/".concat(t.id,"/image")+(o&&s?"?size=".concat(o,"x").concat(s):"");this.ngwMap.connector.makeQuery(a,{},{responseType:"blob"}).then((t=>{const e=new FileReader;e.readAsDataURL(t),e.onloadend=()=>{n(e.result)}})).catch((t=>{i(t)}))}))}}const X=[];function $(t,e){X.push({name:t,stop:e})}function Y(t){X.forEach((e=>{e.name!==t&&e.stop()}))}function tt(t,e,n){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(e))?i:String(i))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class et extends C.Layer{constructor(t){super(t),tt(this,"options",{latlng:null,content:"",className:""}),tt(this,"_map",void 0),tt(this,"_offset",new C.Point(0,30)),tt(this,"_container",void 0),tt(this,"_contentNode",void 0),tt(this,"_closeButton",void 0),tt(this,"_containerBottom",void 0),tt(this,"_containerLeft",void 0),C.Util.setOptions(this,t),this.options.offset&&(this._offset=this.options.offset)}onAdd(t){return this._map=t,this._container||this._initLayout(),this._container&&t.getPanes().popupPane.appendChild(this._container),t.on("viewreset",this._updatePosition,this),C.Browser.any3d&&t.on("zoomanim",this._zoomAnimation,this),this._update(),this}addTo(t){return t.addLayer(this),this}onRemove(t){return this._container&&t.getPanes().popupPane.removeChild(this._container),t.off("viewreset",this._updatePosition,this),t.off("zoomanim",this._zoomAnimation,this),this._map=null,this}setLatLng(t){return this.options.latlng=(0,C.latLng)(t),this._updatePosition(),this}setContent(t){return this.options.content=t,this._updateContent(),this}enableClose(){return this._closeButton=C.DomUtil.create("span","close",this._container),this._closeButton.innerHTML='<svg class="icon" viewBox="0 0 40 40"><path stroke="#FF0000" stroke-width="3" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg>',this._closeButton}_initLayout(){this._container=C.DomUtil.create("div",this.options.className),this._contentNode=C.DomUtil.create("div","content",this._container)}_update(){this._map&&(this._updateContent(),this._updatePosition())}_updateContent(){this._contentNode&&this.options.content&&("string"==typeof this.options.content?this._contentNode.innerHTML=this.options.content:(this._contentNode.innerHTML="",this._contentNode.appendChild(this.options.content)))}_updatePosition(){if(this.options.latlng&&this._container){const t=this._map.latLngToLayerPoint(this.options.latlng),e=C.Browser.any3d,n=this._offset;e&&C.DomUtil.setPosition(this._container,t),this._containerBottom=-n.y-(e?0:t.y),this._containerLeft=n.x+(e?0:t.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}}_zoomAnimation(t){if(this._container){const e=this._map._latLngToNewLayerPoint(this.options.latlng,t.zoom,t.center);C.DomUtil.setPosition(this._container,e)}}}const nt={en:{linearMeasurement:"Distance measurement",areaMeasurement:"Area measurement",start:"Start",meter:"m",kilometer:"km",squareMeter:"m²",squareKilometers:"km²"},ru:{linearMeasurement:"Измерение расстояния",areaMeasurement:"Измерение площади",start:"Старт",meter:"м",kilometer:"км",squareMeter:"м²",squareKilometers:"км²"}};function it(t){return t*(Math.PI/180)}function ot(t){return Math.pow(t,2)}function st(t,e){return t<1e3?at(t,0)+" "+e.meter:at(t/1e3,2)+" "+e.kilometer}function at(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const n=t<0?"-":"",i=Math.abs(+t||0),o=parseInt(i.toFixed(e),10)+"",s=o.length>3?o.length%3:0;return[n,s?o.substr(0,s)+",":"",o.substr(s).replace(/(\d{3})(?=\d)/g,"$1,"),e?"."+Math.abs(i-Number(o)).toFixed(e).slice(2):""].join("")}function rt(t,e,n){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(e))?i:String(i))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class lt extends C.Handler{constructor(t,e){super(t),rt(this,"options",{color:"#FF0080",model:"distance",messages:nt.en}),rt(this,"_map",void 0),rt(this,"_measureHandler",void 0),rt(this,"_finished",void 0),rt(this,"_startMove",void 0),rt(this,"_measurementStarted",void 0),rt(this,"_lastPoint",void 0),rt(this,"_totalDistance",0),rt(this,"_trail",{overlays:[],points:[]}),rt(this,"_directPath",void 0),rt(this,"_measurePath",void 0),this._map=t,this._measureHandler=this,this._finished=!1,C.Util.setOptions(this,e)}setModel(t){return this.options.model=t,this}addHooks(){this._activeMeasure()}removeHooks(){this._disableMeasure()}_activeMeasure(){this._measureHandler._measurementStarted&&this._measureHandler._finishMeasure(),this._measurementStarted?this._finishMeasure():this._enableMeasure()}_onMouseClick(t){const e=t.latlng||this._map.mouseEventToLatLng(t);if(!this._lastPoint||!e.equals(this._lastPoint)){if(this._trail.points.length>0){const t=this._trail.points;t.push(e);const n=t.length;this._totalDistance+=function(t,e){const n=it(t.lat),i=it(e.lat),o=i-n,s=it(e.lng-t.lng),a=ot(Math.sin(o/2))+Math.cos(n)*Math.cos(i)*ot(Math.sin(s/2));return 12756274*Math.asin(Math.sqrt(a))}(t[n-2],t[n-1]),this._addMeasurePoint(e),this._addMarker(e),"area"!==this.options.model&&this._addLable(e,st(this._totalDistance,this.options.messages),"leaflet-measure-label")}else this._totalDistance=0,this._addMeasurePoint(e),this._addMarker(e),"area"!==this.options.model&&this._addLable(e,this.options.messages.start,"leaflet-measure-label"),this._trail.points.push(e);this._lastPoint=e,this._startMove=!1}}_onMouseMove(t){const e=t.latlng;this._directPath&&this._trail.points.length>0&&(this._startMove?this._directPath.setLatLngs(this._trail.points.concat(e)):(this._directPath.setLatLngs([e]),this._startMove=!0))}_enableMeasure(){this._trail={overlays:[],points:[]};const t=this._map;C.DomUtil.addClass(t.getContainer(),"leaflet-measure-map"),t.contextMenu&&t.contextMenu.disable(),this._measurementStarted=!0,t.on("click",this._onMouseClick,this),t.on("dblclick",this._finishMeasure,this),t.on("contextmenu",this._finishMeasure,this),t.doubleClickZoom.disable(),t.on("mousemove",this._onMouseMove,this),t.fire("measure:start")}_disableMeasure(){const t=this._map;C.DomUtil.removeClass(t.getContainer(),"leaflet-measure-map"),t.contextMenu&&t.contextMenu.enable(),t.off("click",this._onMouseClick,this),t.off("dblclick",this._finishMeasure,this),t.off("contextmenu",this._finishMeasure,this),t.off("mousemove",this._onMouseMove,this),t.doubleClickZoom.enable(),this._measurementStarted=this._startMove=!1,this._finished||this._clearOverlay.call(this),t.fire("measure:stop")}_finishMeasure(t){this._trail.points.length>0&&(this._trail.points.length>1?(!this._directPath||t&&"contextmenu"!==t.type||this._directPath.setLatLngs(this._trail.points),this._lastPoint&&("area"===this.options.model?this._addLable(this._lastPoint,function(t,e){const n=Math.round(function(t){const e=6378137;let n=0;const i=t.length;let o=t[i-1].lng,s=t[i-1].lat;for(let e=0;e<i;e++){const i=t[e].lng,a=t[e].lat;n+=it(i-o)*(2+Math.sin(it(s))+Math.sin(it(a))),o=i,s=a}return Math.abs(n*e*e/2)}(t));return n<1e6?at(n,0)+" "+e.squareMeter:at(n/1e6,2)+" "+e.squareKilometers}(this._trail.points,this.options.messages),"leaflet-measure-label",!0):this._addLable(this._lastPoint,st(this._totalDistance,this.options.messages),"leaflet-measure-label",!0)),this._directPath&&this._map.removeLayer(this._directPath),this._finished=!0):this._clearOverlay.call(this)),this.disable()}_resetDirectPath(t){if(this._directPath)this._directPath.addLatLng(t);else{let e;e="area"===this.options.model?new C.Polygon([t],{weight:2,color:this.options.color,dashArray:[5,5],fillOpacity:0,interactive:!1}):new C.Polyline([t],{weight:2,color:this.options.color,dashArray:[5,5],interactive:!1}),this._map.addLayer(e),this._trail.overlays.push(e),this._directPath=e}}_addMeasurePoint(t){if(this._measurePath)this._measurePath.addLatLng(t);else{let e;e="area"===this.options.model?new C.Polygon([t],{weight:2,color:this.options.color,fillColor:this.options.color,fillOpacity:.5,interactive:!1}):new C.Polyline([t],{weight:2,color:this.options.color,interactive:!1}),this._map.addLayer(e),this._trail.overlays.push(e),this._measurePath=e}this._resetDirectPath(t)}_addMarker(t){const e=new C.CircleMarker(t,{color:this.options.color,opacity:1,weight:1,fillColor:"#FFFFFF",fill:!0,fillOpacity:1,radius:3,interactive:!1});this._map.addLayer(e),this._trail.overlays.push(e)}_addLable(t,e,n,i){const o=new et({latlng:t,content:e,className:n});if(this._map.addLayer(o),this._trail.overlays.push(o),i){const t=o.enableClose();C.DomEvent.on(t,"click",(t=>{C.DomEvent.stopPropagation(t),this._clearOverlay()}),this)}}_clearOverlay(){const t=this._trail.overlays;let e,n=0;for(e=t.length;n<e;n++)this._map.removeLayer(t[n])}}function ct(t,e,n){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(e))?i:String(i))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class ht extends C.Control{constructor(t){super(t),ct(this,"options",{position:"topright",title:"Measurement",collapsed:!0,color:"#FF0080",locale:"en",messages:nt.en}),ct(this,"_map",void 0),ct(this,"_container",void 0),ct(this,"_link",void 0),ct(this,"_contents",void 0),ct(this,"_measureHandler",void 0),C.Util.setOptions(this,t);const e=t.locale;if(e&&"en"!==e){const t=nt[e];t?this.options.messages={...nt,...t}:console.error("Measure control has no messages for "+this.options.locale+" locale")}}onAdd(t){return this._map=t,this._container||this._initLayout()}disableMeasure(){this._measureHandler&&(this._measureHandler.disable(),this._measureHandler=void 0)}_buildContainer(){return this._container=C.DomUtil.create("div","leaflet-control-measure leaflet-bar leaflet-control"),this._contents=C.DomUtil.create("div","leaflet-measure-contents",this._container),this._link=C.DomUtil.create("a","leaflet-measure-toggle",this._container),this._link.title=this.options.title||"Measurement",this._link.href="#",this._buildItems(),this._container}_buildItems(){const t=C.DomUtil.create("ul","leaflet-measure-actions",this._contents);let e=C.DomUtil.create("li","leaflet-measure-action",t);const n=C.DomUtil.create("a","start",e);n.innerText=this.options.messages.linearMeasurement,n.href="#",C.DomEvent.disableClickPropagation(n),C.DomEvent.on(n,"click",this._enableMeasureLine,this),e=C.DomUtil.create("li","leaflet-measure-action",t);const i=C.DomUtil.create("a","leaflet-measure-action start",e);i.innerText=this.options.messages.areaMeasurement,i.href="#",C.DomEvent.disableClickPropagation(i),C.DomEvent.on(i,"click",this._enableMeasureArea,this)}_initLayout(){const t=this._buildContainer();return C.DomEvent.disableClickPropagation(t),C.DomEvent.disableScrollPropagation(t),this.options.collapsed?C.DomEvent.on(t,{mouseenter:this._expand,mouseleave:this._collapse},this):this._expand(),t}_enableMeasureLine(t){C.DomEvent.stopPropagation(t),this.disableMeasure(),this._map&&(this._measureHandler=new lt(this._map,{model:"distance",color:this.options.color,messages:this.options.messages}),this._measureHandler.enable())}_enableMeasureArea(t){C.DomEvent.stopPropagation(t),this.disableMeasure(),this._map&&(this._measureHandler=new lt(this._map,{model:"area",color:this.options.color,messages:this.options.messages}),this._measureHandler.enable())}_expand(){return this._link&&this._container&&(this._link.style.display="none",C.DomUtil.addClass(this._container,"leaflet-measure-expanded")),this}_collapse(){return this._link&&this._container&&(this._link.style.display="block",C.DomUtil.removeClass(this._container,"leaflet-measure-expanded")),this}}function dt(t,e,n){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(e))?i:String(i))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class pt{constructor(t){this.options=t,dt(this,"ngwMap",void 0),dt(this,"tree",void 0),dt(this,"treeControl",void 0),dt(this,"authControl",void 0),dt(this,"popup",void 0),dt(this,"_promises",{}),dt(this,"_popupAbortController",void 0),this.popup=new Q}async create(t){const e={...t.mapOptions},{basemaps:n,firms:i,userFires:l,sensors:c}=t,h=new a.Z8({mapAdapter:new s.Z,controls:[],minZoom:4,runtimeParams:[new r.Z],...e});this.ngwMap=h,h.setCursor("default"),this.popup.setNgwMap(h),n&&h.onLoad().then((()=>n.forEach(((t,e)=>{h.addBaseLayer("QMS",{...t,visibility:0===e})})))),h.getPaintFunctions={base:o.q},h.addControl("ZOOM","top-left"),this._createLocateControl(),h.addControl("ATTRIBUTION","bottom-right",{customAttribution:['<a href="https://nextgis.com" target="_blank">©NextGIS</a>']}),function(t){const e=new ht({locale:"ru"});t.addControl(e,"top-left"),t.onLoad().then((()=>{const n=t.mapAdapter.map;n&&(n.on("measure:start",(()=>{Y("measure"),t.disableSelection()})),n.on("measure:stop",(()=>{t.setCursor("default"),t.enableSelection()}))),$("measure",(()=>{e.disableMeasure()}))}))}(h),this._createShareControl();const d=await h.getNgwLayers(),p=[];Object.values(d).forEach((t=>{const e=t.layer.item&&t.layer.item.webmap&&t.layer.item.webmap.bookmark_resource;e&&p.push(e)})),await this._addFireLayer(t.userFires),await this._addFirms(t.firms),await this._addSensors(t.sensors),this._createGetCoordinateControl(),this._addTreeControl({ngwLayers:d,firms:i,sensors:c,userFires:l,bookmarks:p}),this._addEventsListeners()}_locate(){this.ngwMap.locate({setView:!1},{locationfound:t=>{var e;const n=t.lngLat;this.ngwMap.setView(n,Math.max(null!==(e=this.ngwMap.getZoom())&&void 0!==e?e:0,16))}})}_createShareControl(){const t=document.getElementsByClassName("js-modal")[0],e=document.getElementsByClassName("js-modal-close")[0],n=document.getElementsByClassName("js-share-modal-content")[0],i=document.getElementsByClassName("js-share-input")[0],o=()=>{const e=location.href,o=this._createShareModalContent(e);i.value=e,n.innerHTML=o,c().update(),t.classList.add("is-active")};e.addEventListener("click",(()=>{n.innerHTML="",t.classList.remove("is-active")}));const s=this.ngwMap.createButtonControl({html:'<i class="fas fa-share-alt btn-control-icon "></i>',onClick(){o()}});this.ngwMap.addControl(s,"bottom-right")}async _createGetCoordinateControl(){const t=new f(this,{toggle:t=>{t?(Y("coordinate"),this.ngwMap.disableSelection()):this.ngwMap.enableSelection()}}),e=await this.ngwMap.createToggleControl(t);this.ngwMap.addControl(e,"top-left"),$("coordinate",(()=>e.onClick(!1)))}_createLocateControl(){const t=this.ngwMap.createButtonControl({html:'<i class="fas fa-location-arrow btn-control-icon"></i>',title:"Найти меня на карте",onClick:()=>this._locate()});this.ngwMap.addControl(t,"top-left")}_createShareModalContent(t){return'<div class="buttons share-btn js-share-btn" data-url="'.concat(t,'" data-title="" data-desc="">\n      ').concat([{id:"tw",name:"Twitter",icon:"fab fa-twitter"},{id:"vk",name:"VK",icon:"fab fa-vk"},{id:"fb",name:"Facebook",icon:"fab fa-facebook-square"}].map((t=>'<a class="button is-primary" data-id="'.concat(t.id,'">\n                    <span class="icon">\n                        <i class="').concat(t.icon,'"></i>\n                    </span>\n                    <span>').concat(t.name,"</span>\n                </a>"))).join(""),"\n    </div>")}async _addFireLayer(t,e){if(t){const n=t.adapterOptions&&t.adapterOptions.paint?t.adapterOptions.paint:{};return this.ngwMap.addNgwLayer({resource:t.resource,id:t.id,adapterOptions:{...t.adapterOptions,paint:{...n,radius:5},selectable:!0,selectedPaint:{...n,radius:7},...e,propertiesFilter:u(this.options.timedelta||24,t.adapterOptions,d)}})}}async _addFirms(t){if(t)for(const e of t)await this._addFireLayer(e)}async _addSensors(t){return t&&this.ngwMap.addNgwLayer(t)}async _addTreeControl(t){const e=document.getElementsByClassName("js-sidebar")[0];await this.ngwMap.onLoad(),this.tree=new z(this,{...t,onDateChange:()=>{this._cleanSelection()},ngwMap:this.ngwMap});const n=t=>{(t=void 0!==t?t:e.classList.contains("is-active"))?(Y("tree"),this.tree&&this.tree.show(),e.classList.add("is-active")):(this.tree&&this.tree.hide(),e.classList.remove("is-active"))};e.addEventListener("click",(()=>{n()})),setTimeout((()=>{n()}),500),$("tree",(()=>n(!1)))}_abortPopup(){this._popupAbortController&&this._popupAbortController.abort(),this._popupAbortController=void 0}_cleanSelection(){this._promises.getFeaturePromise instanceof i.Z&&this._promises.getFeaturePromise.cancel(),this.ngwMap.removeLayer("highlight")}_highlighNgwLayer(t){this._cleanSelection();const e=t.getIdentifyItems(),n=e[e.length-1];if(n){const t=this.options.sensors&&n.layerId===this.options.sensors.resource;n.identify().then((e=>{e&&e.toGeojson().then((i=>{this.ngwMap.addLayer("GEOJSON",{id:"highlight",data:i,paint:{color:"green",stroke:!0,fillOpacity:"0.8"},popup:!0,popupOptions:{maxWidth:500,minWidth:400,createPopupContent:o=>{if(this._abortPopup(),o.onClose((()=>{this._abortPopup(),this._cleanSelection(),this.ngwMap.unSelectLayers()})),o.feature){if(t){const t=new AbortController;return this._popupAbortController=t,this.popup.createSensorPopupContent({feature:i,signal:t.signal})}return this.popup.createPopupContent(i,n.layerId,e.extensions.attachment)}}}})}))}))}}_addEventsListeners(){this.ngwMap.emitter.on("click",(()=>{this.ngwMap.cancelPromises("identify","select")})),this.ngwMap.emitter.on("ngw:select",(t=>t&&this._highlighNgwLayer(t)))}}n(7285);const ut={limit:2e3,props:{dateField:"timestamp",timeUnit:"s"}},mt={stroke:!0,strokeColor:"#ffffff",strokeOpacity:1,opacity:1},gt={mapOptions:{target:"map",bounds:[36.59,43.385,49.374,50.214],baseUrl:"https://clear-horizon.nextgis.com",resources:[{resource:1,fit:!0,adapterOptions:{selectable:!0}}]},timedelta:72,basemaps:[{qmsId:1135}],userFires:{resource:"userfirepoints",id:"USERFIRE",adapterOptions:{paint:{color:"rgb(100,20,40)",...mt},props:{dateField:"field_9",timeUnit:"ISO"}}},sensors:{resource:446,id:"SENSOR",adapterOptions:{selectable:!0,paint:{color:"#0000ff",radius:5,...mt}}},firms:[{resource:103,id:"MODIS",adapterOptions:{paint:{color:"red",...mt},...ut}},{resource:105,id:"VIIRS",adapterOptions:{paint:{color:"orange",...mt},...ut}}]};new class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e,n,i,o;this.options=t,e=this,i=void 0,(n="symbol"==typeof(o=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n="actionMap"))?o:String(o))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,this.actionMap=new pt(t)}async create(t){this.options={...this.options,...t},this.showContent(),await this.actionMap.create(this.options)}showContent(){const t=document.getElementById("app"),e=document.getElementById("app-loading");e&&(e.style.display="none"),t&&(t.style.display="block")}}(gt).create()}},t=>{t.O(0,[531,956,221,148,157,80,923,243,804,890,358,992,69,381,826,664,185,189,692],(()=>(4252,t(t.s=4252)))),t.O()}]);
//# sourceMappingURL=main-4f064d564a578ff.js.map