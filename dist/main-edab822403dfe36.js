"use strict";(self.webpackChunkclear_horizon=self.webpackChunkclear_horizon||[]).push([[888],{4468:function(e,t,r){r.d(t,{lO:function(){return Pr},Dm:function(){return Rr},Ok:function(){return L},u4:function(){return Vr},Sy:function(){return pr},D1:function(){return Zr},K1:function(){return $r},Cg:function(){return Nr},UJ:function(){return F},vS:function(){return Ar},nm:function(){return B},U2:function(){return y},GW:function(){return Jr},RP:function(){return Gr},PA:function(){return Wr}}),r(1539),r(8674),r(7042),r(8309),r(1038),r(8783),r(2526),r(1817),r(2165),r(6992),r(3948),r(7941),r(7327),r(5003),r(4747),r(9337),r(5666);var n=r(7869),o=(r(8304),r(489),r(2419),r(2772),r(1344)),i=(r(2222),r(4819),r(7187)),a=r(8133);function c(e,t){var r=document.createElement("div");if(t&&t.feature_layer)t.feature_layer.fields.forEach((function(t){if(t.grid_visibility){var n=e.properties&&e.properties[t.keyname];if(n){var o=document.createElement("div");r.appendChild(o),o.innerHTML="<span>".concat(t.display_name,"</span>: ").concat(n,"<span></span>")}}}));else if(e.properties)for(var n in e.properties){var o=document.createElement("div");r.appendChild(o),o.innerHTML="<span>".concat(n,"</span>: ").concat(e.properties[n],"<span></span>")}return r}var u=["fields","intersects","limit","orderBy","strategy"];function s(e){var t={};return u.forEach((function(r){var n=e[r];void 0!==n&&(t[r]=n)})),t}var f=r(1521);function l(e){var t=e.extent_bottom,r=e.extent_left,n=e.extent_top,o=e.extent_right;if(t&&r&&n&&o){var i=[r,t,o,n];return i[3]>82&&(i[3]=82),i[1]<-82&&(i[1]=-82),i}}function p(e){var t=e.resourceId,r=e.connector,n=e.cache,o=void 0===n||n;return r.get("layer.extent",{cache:o},{id:t}).then((function(e){if(e){var t=e.extent,r=t.maxLat,n=t.maxLon,o=t.minLat;return[t.minLon,o,n,r]}}))}function y(e,t){if(e.webmap)return f.Z.resolve(l(e.webmap));var r=e.resource;return r.cls&&-1!==r.cls.indexOf("style")?t.getResource(r.parent.id).then((function(e){if(e)return p({resourceId:e.resource.id,connector:t})})):p({resourceId:r.id,connector:t})}function h(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){h(i,n,o,a,c,"next",e)}function c(e){h(i,n,o,a,c,"throw",e)}a(void 0)}))}}function b(e,t){return v.apply(this,arguments)}function v(){return(v=d(regeneratorRuntime.mark((function e(t,r){var n,o,i,a,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.resource,o=n,i=t.keyname,a=t.resourceId,!n){e.next=19;break}if("string"!=typeof n){e.next=8;break}i=n,e.next=19;break;case 8:if("number"!=typeof n){e.next=12;break}a=n,e.next=19;break;case 12:if(!o.resource||void 0===o.resource||!("resource"in o)){e.next=16;break}a=n.resource.id,e.next=19;break;case 16:return e.next=18,b(n,r);case 18:a=e.sent;case 19:if(a||!i){e.next=24;break}return e.next=22,r.getResource(i);case 22:(c=e.sent)&&(a=c.resource.id);case 24:return e.abrupt("return",a);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=P(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function g(e){return function(e){if(Array.isArray(e))return x(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||P(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){_(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],a=!0,c=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}}(e,t)||P(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){if(e){if("string"==typeof e)return x(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(e,t):void 0}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}r(9600),r(5827),r(561),r(1249),r(9653),r(1058),r(4678);var k={srs:4326,geom_format:"geojson"};function L(e){var t=e.geom;return{id:e.id,type:"Feature",properties:e.fields,geometry:t}}function I(e,t){var r=t.extensions,n=t.geom,i=t.fields,a=t.srs;e.extensions=r?r.join(","):"",void 0!==i&&(e.fields=Array.isArray(i)?i.join(","):""),void 0!==n&&(e.geom=n?"yes":"no",n||(delete e.srs,delete e.geom_format)),(0,o.ri)(a)&&(e.srs=a)}function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=e.filters,o="string"==typeof n[0]?n[0]:"all",i=n.filter((function(e){return Array.isArray(e)})),c=function(e){var t=j(e,3),r=t[0],n=t[1],o=t[2];return["".concat("id"!==r?"fld_":"").concat(r,"__").concat(n),o]};if("any"===o)i.forEach((function(n){(0,a.a$)(n)?t.push(R(O(O({},e),{},{paramList:[].concat(g(r),[c(n)])}))):S(O(O({},e),{},{filters:n}),t,g(r))}));else if("all"===o){var u,s=[],l=[],p=m(i);try{for(p.s();!(u=p.n()).done;){var y=u.value;(0,a.a$)(y)?s.push(c(y)):l.push(y)}}catch(e){p.e(e)}finally{p.f()}if(l.length){var h,d=m(l);try{for(d.s();!(h=d.n()).done;){var b=h.value;S(O(O({},e),{},{filters:b}),t,[].concat(g(r),s))}}catch(e){d.e(e)}finally{d.f()}}else t.push(R(O(O({},e),{},{paramList:[].concat(g(r),s)})))}return f.Z.all(t).then((function(t){var r=t.reduce((function(e,t){return e.concat(t)}),[]),n=void 0!==e.offset?e.offset:0,o=void 0!==e.limit?e.limit:r.length;return e.offset||e.limit?r.splice(n,o):r}))}function R(e){var t,r=O({},k),n=e.connector,i=e.limit,a=e.offset,c=e.intersects,u=e.orderBy,s=e.resourceId,f=e.paramList;if(i?i!==Number.POSITIVE_INFINITY&&(r.limit=i):r.limit=7e3,a&&(r.offset=a),I(r,e),u&&(r.order_by=u.join(",")),Array.isArray(c)){var l=(0,o.T8)(c)?(0,o.dy)(c):c;r.intersects=(t=l.map((function(e){var t=j(e,2),r=t[0],n=t[1],i=j((0,o.Qm)(r,n),2);return i[0]+" "+i[1]})),"POLYGON((".concat(t.join(", "),"))"))}else"string"==typeof c&&(r.intersects=c);f&&(r.paramList=f);var p=O({id:s},r);return n.get("feature_layer.feature.collection",{cache:e.cache},p)}function E(e,t,r){return(E=M()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&D(o,r.prototype),o}).apply(null,arguments)}function M(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e){var t;for(t in e){var r=e[t];if((0,o.Kn)(r)){var n=r;(0,o.ri)(n.year)&&(0,o.ri)(n.month)&&(0,o.ri)(n.day)&&function(){var r=[n.year,n.month-1,n.day];"hour"in n&&[n.hour,n.minute,n.second].forEach((function(e){r.push(e)})),e[t]=E(Date,r).toISOString()}()}}return e}function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){C(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function C(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function B(e){var t=e.filters;return t?S(T(T({},e),{},{filters:t})).then((function(e){return e.filter((function(e){var r=A(T({},e.fields));return(0,a.Ml)(r,t)})),e})):R(e)}function F(e){return function(e){return B(e).then((function(e){var t=[];return e.forEach((function(e){t.push(L(e))})),t}))}(e).then((function(e){return{type:"FeatureCollection",features:e}}))}function U(e){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $(e,t,r){return t&&Z(e.prototype,t),r&&Z(e,r),e}function W(e,t,r){return(W="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Y(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function V(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Y(e);if(t){var o=Y(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return J(this,r)}}function J(e,t){if(t&&("object"===U(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return K(e)}function K(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){X(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function X(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ee(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function te(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){ee(i,n,o,a,c,"next",e)}function c(e){ee(i,n,o,a,c,"throw",e)}a(void 0)}))}}function re(e){return ne.apply(this,arguments)}function ne(){return(ne=te(regeneratorRuntime.mark((function e(t){var r,n,u,f,l,p,h,d,v,m,g,w,O,_,j,P,x,k,L;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.item,f=t.webMap,l=t.Adapter,p=t.connector,h=t.layerOptions,d=t.addLayerOptionsPriority,v=null==d||d,m=h,g=l||f.mapAdapter.layerAdapters.GEOJSON,w=!1,e.next=7,b(m,p);case 7:return j=e.sent,null!==(r=m.adapterOptions)&&void 0!==r&&null!==(n=r.popupOptions)&&void 0!==n&&n.fromProperties&&(m.adapterOptions.popupOptions.createPopupContent=function(e){var t=e.feature;return t&&c(t,u)}),P=function(){var e=te(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k(),O={filters:t,options:r},_=F(Q({resourceId:j,filters:t,connector:p,cache:!0},r)),e.next=5,_;case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),x=!1,k=function(){_&&(_.cancel(),_=void 0)},L=function(e){V(l,e);var t,r,n,c=z(l);function l(){var e;G(this,l);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return X(K(e=c.call.apply(c,[this].concat(r))),"emitter",new i.EventEmitter),X(K(e),"_count",void 0),X(K(e),"__onMapMove",void 0),X(K(e),"__onMapMoveStart",void 0),X(K(e),"__enableMapMoveListener",void 0),X(K(e),"__disableMapMoveListener",void 0),e}return $(l,[{key:"addLayer",value:(n=te(regeneratorRuntime.mark((function e(t){var r,n,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!t.data,n=void 0===t.waitFullLoad||t.waitFullLoad,void 0!==m.id&&(t.id=m.id),u&&u.vector_layer&&(t.type=lr[u.vector_layer.geometry_type]),m.adapterOptions&&(t=v?Q(Q({},m.adapterOptions),t):Q(Q({},t),m.adapterOptions)),t.data&&0===Object.keys(t.data).length&&(t.data=void 0,r=!1),o=W(Y(l.prototype),"addLayer",this).call(this,t),this.options.strategy=t.strategy||void 0,O={filters:t.propertiesFilter,options:s(t)},r&&(i=this.updateLayer()),!n||!i){e.next=13;break}return e.next=13,i;case 13:return"BBOX"!==this.options.strategy||w||this._addBboxEventListener(),e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getExtent",value:function(){var e=this.getLayers&&this.getLayers().length;return"BBOX"===this.options.strategy||e?y(u,p):W(Y(l.prototype),"getExtent",this)?W(Y(l.prototype),"getExtent",this).call(this):void 0}},{key:"beforeRemove",value:function(){x=!0,this._removeMoveEventListener(),this._removeBboxEventListener(),this.__disableMapMoveListener=void 0,this.__enableMapMoveListener=void 0,this.__onMapMove=void 0,this.__onMapMoveStart=void 0,k()}},{key:"getCount",value:function(){var e=this;return void 0!==this._count?this._count:p.get("feature_layer.feature.count",{cache:!0},{id:j}).then((function(t){if(t)return e._count=t.total_count,e._count}))}},{key:"updateLayer",value:(r=te(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=t||O||{},"BBOX"!==this.options.strategy){e.next=6;break}return e.next=4,f.onLoad("create");case 4:t.options=t.options||{},t.options.intersects=f.getBounds();case 6:if(!x){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,e.next=11,P(t.filters,Q(Q({},t.options),{},{srs:this.options.srs}));case 11:return r=e.sent,e.next=14,this.getCount();case 14:return n=e.sent,w=n===r.features.length,e.next=18,f.setLayerData(this,r);case 18:this.emitter.emit("updated"),e.next=25;break;case 21:if(e.prev=21,e.t0=e.catch(8),!(e.t0 instanceof Error&&"CancelError"!==e.t0.name)){e.next=25;break}throw e.t0;case 25:W(Y(l.prototype),"updateLayer",this)&&W(Y(l.prototype),"updateLayer",this).call(this);case 26:case"end":return e.stop()}}),e,this,[[8,21]])}))),function(e){return r.apply(this,arguments)})},{key:"propertiesFilter",value:(t=te(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k(),!this.filter||!w){e.next=5;break}this.filter((function(e){var r=e.feature&&e.feature.properties&&A(Q({},e.feature.properties));return!r||(0,a.Ml)(r,t)})),e.next=11;break;case 5:if(!this.setData){e.next=11;break}return this.clearLayer&&this.clearLayer(),e.next=9,P(t,Q(Q({},r),{},{srs:this.options.srs}));case 9:n=e.sent,this.setData(n);case 11:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"removeFilter",value:function(){O=void 0,this.propertiesFilter([]),this.filter&&this.filter((function(){return!0}))}},{key:"_addBboxEventListener",value:function(){var e=this;this.__enableMapMoveListener=function(t){t===e&&(e._removeMoveEventListener(),e.updateLayer(),e._addMoveEventListener())},this.__disableMapMoveListener=function(t){t===e&&e._removeMoveEventListener()},f.emitter.on("layer:show",this.__enableMapMoveListener),f.emitter.on("layer:hide",this.__disableMapMoveListener),this.__enableMapMoveListener(this)}},{key:"_removeBboxEventListener",value:function(){this.__enableMapMoveListener&&f.emitter.on("layer:show",this.__enableMapMoveListener),this.__disableMapMoveListener&&f.emitter.on("layer:hide",this.__disableMapMoveListener)}},{key:"_addMoveEventListener",value:function(){var e=this;this.__onMapMove=(0,o.Ds)((function(){return e.updateLayer()})),this.__onMapMoveStart=k,f.emitter.on("movestart",this.__onMapMoveStart),f.emitter.on("moveend",this.__onMapMove)}},{key:"_removeMoveEventListener",value:function(){this.__onMapMove&&f.emitter.removeListener("moveend",this.__onMapMove),this.__onMapMoveStart&&f.emitter.removeListener("movestart",this.__onMapMoveStart)}}]),l}(g),e.abrupt("return",L);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(e){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ae(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ce(e){var t,r=e.options,n=e.webMap,o=e.baseUrl,i=r.adapter||"IMAGE",a=n&&n.getLayerAdapters(),c=!a||a.IMAGE,u=r.resource,s=r.tileNoData?r.tileNoData:200;if("number"==typeof u){if("IMAGE"===i){if(c)return{url:t=o+"/api/component/render/image",resourceId:u,headers:r.headers,params:{resource:u,nd:s},updateWmsParams:function(e){return sr(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ie(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({nd:s},e),u)}};i="TILE"}if("WMS"===i){t="".concat(o,"/api/resource/").concat(u,"/wms");var f=r.adapterOptions;return{url:t,format:"image/png",version:"1.1.1",layers:f&&f.layers,headers:r.headers}}if("MVT"===i)return{url:t=o+"/api/component/feature_layer/mvt?x={x}&y={y}&z={z}&resource="+u+"&simplification="+(r.simplification||0)};if("TERRAIN"===i)return{url:t=o+"/api/resource/".concat(u,"/terrain_provider"),adapter:i};if("MODEL_3D"===i)return{url:t=o+"/api/component/model_3d/".concat(u,"/data.glb")};if("TILE"===i)return{url:t=o+"/api/component/render/tile?z={z}&x={x}&y={y}&resource="+u+"&nd="+s,adapter:i}}else{if(void 0!==u)throw new Error("Option `resource` must be number, not "+oe(u));console.log("Option `resource` not set")}}function ue(e){return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?se(Object(r),!0).forEach((function(t){Oe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ye(e,t,r){return t&&pe(e.prototype,t),r&&pe(e,r),e}function he(e,t,r){return(he="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=we(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function de(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&be(e,t)}function be(e,t){return(be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=we(e);if(t){var o=we(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return me(this,r)}}function me(e,t){if(t&&("object"===ue(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ge(e)}function ge(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function we(e){return(we=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _e(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function je(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){_e(i,n,o,a,c,"next",e)}function c(e){_e(i,n,o,a,c,"throw",e)}a(void 0)}))}}function Pe(e){return xe.apply(this,arguments)}function xe(){return(xe=je(regeneratorRuntime.mark((function e(t){var r,n,i,a,c,u,s,f,l,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.layerOptions,n=t.webMap,i=t.connector,a=t.item,c=a.resource.cls,u={wmsserver_service:"WMS",tmsclient_layer:"IMAGE"},void 0!==(s=r.adapter||c&&u[c]||"IMAGE")&&(r.adapter=s),"IMAGE"===s&&(!(f=n.getLayerAdapters())||f.IMAGE||(s="TILE")),!(l=n.mapAdapter.layerAdapters[s])){e.next=14;break}return e.next=10,b(r,i);case 10:return p=e.sent,e.abrupt("return",function(e){de(u,e);var t,c=ve(u);function u(e,t){var s;le(this,u),(s=c.call(this,e,t)).map=e,Oe(ge(s),"item",a),Oe(ge(s),"resourceId",p);var f=ce({options:r,webMap:n,baseUrl:i.options.baseUrl||""});if(f){var l,y=fe(fe({},f),{},{setViewDelay:null===(l=r.adapterOptions)||void 0===l?void 0:l.setViewDelay,params:{resource:p},layers:String(p),resourceId:p});r.adapterOptions&&(0,o.ri)(r.adapterOptions.setViewDelay)&&(y.setViewDelay=r.adapterOptions.setViewDelay),s.options=fe(fe({},s.options),y)}return s}return ye(u,[{key:"addLayer",value:function(e){return he(we(u.prototype),"addLayer",this).call(this,fe(fe({},this.options),e))}},{key:"getIdentificationIds",value:(t=je(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.item&&this.item.resource.parent.id,!(0,o.ri)(t)){e.next=3;break}return e.abrupt("return",[t]);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),u}(l));case 14:throw new Error(s+" not supported yet. Only TILE");case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}r(9826),r(2707),r(3112);var ke=r(6952),Le=r(4034);function Ie(e){return(Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Se(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Re(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ee(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function Ee(e,t){if(e){if("string"==typeof e)return Me(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Me(e,t):void 0}}function Me(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function De(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?De(Object(r),!0).forEach((function(t){Ue(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):De(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Te(e,t){return(Te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ce(e,t){if(t&&("object"===Ie(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Be(e)}function Be(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fe(e){return(Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ue(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ge=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Te(e,t)}(l,e);var t,r,n,a,c,u,s,f=(u=l,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Fe(u);if(s){var r=Fe(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ce(this,e)});function l(e,t,r,n,o,a){var c;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(c=f.call(this,Ae(Ae({},l.options),r))).webMap=e,Ue(Be(c),"item",void 0),Ue(Be(c),"connector",void 0),Ue(Be(c),"layer",void 0),Ue(Be(c),"emitter",new i.EventEmitter),Ue(Be(c),"_rootDescendantsCount",0),n&&(c.connector=n),o&&c.tree.setParent(o),c.item=t,"root"===c.item.item_type)c._rootDescendantsCount=c._sumUp(c.item.children);else{var u=c.tree.getRoot();u&&(c._rootDescendantsCount=u._rootDescendantsCount)}return c.initProperties(),a||c._init(t),c}return t=l,r=[{key:"initItem",value:function(e){var t,r=this,n=e,o=this.getItemOptions(e),i=function(e){n._layer=e,r.layer=e,r.properties.get("visibility")&&r.properties.set("visibility",!0),void 0!==o.opacity&&r.webMap.setLayerOpacity(e,o.opacity)};return"group"===e.item_type||"root"===e.item_type?(e.children&&e.children.length&&this.getChildren(e).forEach((function(e){var t=new l(r.webMap,e,r.options,r.connector,r);r.tree.addChild(t)})),Promise.resolve()):("layer"===e.item_type?t=e.adapter||e.layer_adapter.toUpperCase():l.GetAdapterFromLayerType[e.item_type]&&(t=(0,l.GetAdapterFromLayerType[e.item_type])(e,o,this.webMap,this.connector)),t?this.webMap.addLayer(t,o).then((function(e){i(e)})):e._layer?Promise.resolve(i(e._layer)):Promise.reject("No layer added"))}},{key:"bringToFront",value:function(){}},{key:"fit",value:function(){this.item.item_type}},{key:"getItemOptions",value:function(e){var t="layer"===e.item_type&&e.layer_transparency,r="number"==typeof t?(100-t)/100:void 0,n={visibility:!1,headers:this.options.headers,crossOrigin:this.options.crossOrigin,setViewDelay:this.options.setViewDelay,params:{resource:this.item.resourceId}};if(this.options.order){var i=this.options.drawOrderEnabled&&"draw_order_position"in e?this._rootDescendantsCount-e.draw_order_position:this.id,a=String(i).padStart(4,"0");n.order=Number((0|this.options.order)+"."+a)}if("layer"===e.item_type){var c=e.layer_max_scale_denom?this._mapScaleToZoomLevel(e.layer_max_scale_denom):this.webMap.options.maxZoom,u=e.layer_min_scale_denom?this._mapScaleToZoomLevel(e.layer_min_scale_denom):this.webMap.options.minZoom;(0,o.wB)(n,{updateWmsParams:e.updateWmsParams,url:e.url,headers:this.options.headers,ratio:this.options.ratio,maxZoom:c,minZoom:u,minScale:e.layer_min_scale_denom,maxScale:e.layer_max_scale_denom})}return void 0!==r&&(n.opacity=r),n}},{key:"getChildren",value:function(e){return(t=e.children,function(e){if(Array.isArray(e))return Me(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||Ee(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).reverse();var t}},{key:"_mapScaleToZoomLevel",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return br(hr()*dr(t)/e)}(e)}},{key:"_init",value:function(e){var t=this;this.initItem(e).then((function(){t.emitter.emit("init")}))}},{key:"_sumUp",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Re(e);try{for(n.s();!(t=n.n()).done;){var o=t.value;"layer"===o.item_type?(r+=1,o.draw_order_position=o.draw_order_position||r):"group"===o.item_type&&(r=this._sumUp(o.children,r))}}catch(e){n.e(e)}finally{n.f()}return r}}],n=[{key:"create",value:(a=regeneratorRuntime.mark((function e(t,r,n,o,i){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new l(t,r,n,o,i,!0),e.next=3,a._init(r);case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})),c=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=a.apply(e,t);function i(e){Se(o,r,n,i,c,"next",e)}function c(e){Se(o,r,n,i,c,"throw",e)}i(void 0)}))},function(e,t,r,n,o){return c.apply(this,arguments)})}],r&&Ne(t.prototype,r),n&&Ne(t,n),l}(ke.ck);function Ze(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function $e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(r),!0).forEach((function(t){ze(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ze(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function We(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function qe(e,t,r){return t&&Ve(e.prototype,t),r&&Ve(e,r),e}function ze(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Je(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Ke(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Je(i,n,o,a,c,"next",e)}function c(e){Je(i,n,o,a,c,"throw",e)}a(void 0)}))}}function Ye(e){return He.apply(this,arguments)}function He(){return(He=Ke(regeneratorRuntime.mark((function e(t){var r,n,o,i,a,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.webMap,n=t.adapterOptions,o=void 0===n?{}:n,i=t.onLayerAdded,a=t.createAdapter,c=function(){function e(){We(this,e),ze(this,"options",{}),ze(this,"layer",[]),ze(this,"_removed",!1),ze(this,"_creatingInProgress",!1)}var t;return qe(e,[{key:"addLayer",value:function(){return this.layer}},{key:"removeLayer",value:function(){this._removed=!0,this.layer.forEach((function(e){return r.removeLayer(e)}))}},{key:"destroyed",value:function(){return this._removed}},{key:"showLayer",value:function(){this.options.visibility=!0,this.layer.length?this.layer.forEach((function(e){r.showLayer(e)})):this.loadLayer()}},{key:"loadLayer",value:(t=Ke(regeneratorRuntime.mark((function e(){var t,n,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layer.length||this._creatingInProgress){e.next=19;break}return this._creatingInProgress=!0,e.next=4,a(this);case 4:if(!(t=e.sent)){e.next=19;break}return n=new t(r.mapAdapter.map,$e({},o)),e.next=9,n.addLayer({order:this.options.order,headers:this.options.headers,baselayer:this.options.baselayer});case 9:if(c=e.sent,i&&i(n),Object.assign(n.options,o),n.layer=c,this._removed&&r.removeLayer(n),!this.options.visibility){e.next=17;break}return e.next=17,r.showLayer(n);case 17:this.layer.push(n),this._creatingInProgress=!1;case 19:return e.abrupt("return",this.layer);case 20:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"hideLayer",value:function(){this.options.visibility=!1,this.layer&&this.layer.forEach((function(e){return r.hideLayer(e)}))}}]),e}(),e.abrupt("return",c);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qe(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Xe(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Qe(i,n,o,a,c,"next",e)}function c(e){Qe(i,n,o,a,c,"throw",e)}a(void 0)}))}}function et(){return(et=Xe(regeneratorRuntime.mark((function e(t){var r,n,o,i,a,c,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.webMap,n=t.connector,o=t.item,i=t.adapterOptions,a=void 0===i?{}:i,c=t.idPrefix,u=void 0===c?"first-show-adapter":c,s=Ye({webMap:r,adapterOptions:a,onLayerAdded:function(e){e.options.baselayer=!1,e.id=u+"-"+o.resource_id},createAdapter:function(){return er({resource:o.resource_id,adapterOptions:{name:o.display_name,opacity:o.opacity}},r,n)}}),e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function rt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Ue(Ge,"GetAdapterFromLayerType",{}),Ue(Ge,"options",{properties:[{type:"boolean",name:"visibility",getProperty:function(e){if(e){if("group"===e.item.item_type||"root"===e.item.item_type)return(0,Le.cC)(e.item,(function(e){return"layer_enabled"in e&&e.layer_enabled}),(function(e){return e.children}));if("layer"===e.item.item_type)return e.item.layer_enabled}return!1},onSet:function(e,t,r){r&&"layer"===r.item.item_type&&(r.layer&&(e?r.webMap.showLayer(r.layer):r.webMap.hideLayer(r.layer)),r.item.layer_enabled=e)}}]}),r(9601);var nt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,rt(this,"name",void 0),rt(this,"resourceId",void 0),rt(this,"item",void 0),rt(this,"_extent",void 0),this.resourceId=t.resourceId;var r=t.item;this.item=r,t.labelField&&r.fields?this.name=r.fields[t.labelField]:this.name=String(r.id)}var t,r;return t=e,(r=[{key:"extent",value:function(){var e=this;return this._extent?f.Z.resolve(this._extent):this.options.connector.get("feature_layer.feature.item_extent",null,{id:this.resourceId,fid:this.item.id}).then((function(t){var r=t.extent,n=r.minLat,o=r.minLon,i=r.maxLat,a=[o,n,r.maxLon,i];return e._extent=a,a}))}},{key:"geoJson",value:function(){var e=this;return this.item.geom?f.Z.resolve(L(this.item)):Ar({resourceId:this.resourceId,featureId:this.item.id,connector:this.options.connector,geom:!0,fields:null,extensions:null}).then((function(t){var r=t.geom;return e.item.geom=r,L(e.item)}))}}])&&tt(t.prototype,r),e}();function ot(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function it(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function at(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?it(Object(r),!0).forEach((function(t){ft(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):it(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ct(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function ut(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){ct(i,n,o,a,c,"next",e)}function c(e){ct(i,n,o,a,c,"throw",e)}a(void 0)}))}}function st(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ft(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var lt=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.map=t,this.options=r,ft(this,"layer",void 0),ft(this,"NgwWebmapItem",Ge),ft(this,"pixelRadius",10),ft(this,"resourceId",void 0),ft(this,"webmapClassName","webmap"),ft(this,"emitter",new i.EventEmitter),ft(this,"_extent",void 0),ft(this,"response",void 0),ft(this,"_webmapLayersIds",void 0);var n=r.resourceId;if(Array.isArray(n)?(this.resourceId=n[0],this.options.id=n[1]):this.resourceId=n,!this.resourceId)throw new Error("NGW `resourceId` is not defined")}var t,r,n,a,c,u,s;return t=e,(r=[{key:"addLayer",value:(s=ut(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.options=at(at({},this.options),t),e.next=3,this._getWebMapLayerItem();case 3:return this.layer=e.sent,e.abrupt("return",this.layer);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"removeLayer",value:function(){var e=this.options.webMap.mapAdapter;this.getDependLayers().forEach((function(t){"layer"in t&&e.removeLayer(t.layer.layer)})),delete this.layer,delete this.response,delete this._webmapLayersIds}},{key:"showLayer",value:function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!0)}},{key:"hideLayer",value:function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!1)}},{key:"getExtent",value:function(){var e=this.response&&this.response.webmap;if(e)return l(e)}},{key:"getDependLayers",value:function(){return this.layer&&this.layer.tree.getDescendants()||[]}},{key:"getBookmarksResourceId",value:function(){var e=this.response&&this.response.webmap;if(e)return e.bookmark_resource.id}},{key:"fetchBookmarks",value:function(){var e=this.getBookmarksResourceId(),t=this.options.connector;if(e)return t.getResourceOrFail(e).then((function(r){var n,o=null===(n=r.feature_layer)||void 0===n?void 0:n.fields.find((function(e){return e.label_field})),i=o&&o.keyname;return B({connector:t,resourceId:e,geom:!1,fields:i?[i]:void 0}).then((function(r){var n,o=[],a=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return ot(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ot(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}(r);try{for(a.s();!(n=a.n()).done;){var c=n.value,u=new nt({item:c,resourceId:e,labelField:i,connector:t});o.push(u)}}catch(e){a.e(e)}finally{a.f()}return o}))}));throw new Error("Webmap was not loaded correctly, it is impossible to extract bookmarks")}},{key:"getIdentificationIds",value:(u=ut(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],r=this._webmapLayersIds){e.next=7;break}return e.next=5,this._getWebMapIds();case 5:r=e.sent,this._webmapLayersIds=r;case 7:return r&&r.length&&this.getDependLayers().sort((function(e,t){return t.id-e.id})).forEach((function(e){var r=e.item,n=r.parentId;if(void 0!==n&&"layer"===r.item_type){var o=e.properties.property("visibility");o.get()&&!o.isBlocked()&&t.push(n)}})),e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"_getWebMapLayerItem",value:(c=ut(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.resourceId){e.next=6;break}return e.next=3,this.getWebMapConfig(this.resourceId);case 3:if(!(t=e.sent)||!t.root_item){e.next=6;break}return e.abrupt("return",new Promise((function(e){var n={};if(r.options.connector&&r.options.connector.options.auth){var o=r.options.connector.getAuthorizationHeaders();o&&(n.headers=o)}n.setViewDelay=r.options.setViewDelay,n.order=r.options.order,n.ratio=r.options.ratio,n.crossOrigin=r.options.crossOrigin,n.drawOrderEnabled=t.draw_order_enabled;var i=new r.NgwWebmapItem(r.options.webMap,t.root_item,n,r.options.connector);i.emitter.on("init",(function(){return e(i)}))})));case 6:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"getWebMapConfig",value:(a=ut(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.options.connector.getResource(t);case 2:if(!(r=e.sent)){e.next=13;break}if(this.response=r,n=r[this.webmapClassName],r.basemap_webmap&&r.basemap_webmap.basemaps.length?this._setBasemaps(r.basemap_webmap):this.options.defaultBasemap&&this.options.webMap.addBaseLayer("OSM",{id:"webmap-default-baselayer",name:"OpenStreetMap"}),!n){e.next=13;break}return this._extent=[n.extent_left,n.extent_bottom,n.extent_right,n.extent_top],this._updateItemsParams(n.root_item,this.options.webMap,r),e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_setBasemaps",value:function(e){var t=this,r=this.options.webMap,n=!1;e.basemaps.forEach((function(e){(function(e){return et.apply(this,arguments)})({webMap:r,connector:t.options.connector,item:e,adapterOptions:{crossOrigin:t.options.crossOrigin}}).then((function(t){var o=!n&&e.enabled;r.addBaseLayer(t,{id:Rr+e.resource_id,name:e.display_name,opacity:e.opacity,visibility:o}),e.enabled&&(n=!0)}))}))}},{key:"_updateItemsParams",value:function(e,t,r){var n=this;if(e)if("group"===e.item_type||"root"===e.item_type)e.children&&(e.children=e.children.map((function(e){return n._updateItemsParams(e,t,r)}))),"root"===e.item_type&&(e.display_name=r.resource.display_name);else if("layer"===e.item_type){var i=(0,o.nH)(this.options.connector.options.baseUrl+"/api/component/render/image"),a=e.layer_style_id;e.url=i,e.resourceId=a,e.updateWmsParams=function(e){return sr(e,a)};var c=ce({options:{adapter:e.layer_adapter.toUpperCase(),resource:a},webMap:t,baseUrl:this.options.connector.options.baseUrl||""});e=at(at({},e),c)}return e}},{key:"_getWebMapIds",value:(n=ut(regeneratorRuntime.mark((function e(){var t,r,n,o,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.layer)||"root"!==t.item.item_type){e.next=9;break}return r=t.tree.getDescendants(),n=[],r.forEach((function(e){var t=e.item;if("layer"===t.item_type){var r=t.layer_style_id,o=i.options.connector.getResource(r).then((function(e){if(e){var r=Number(e.resource.parent.id);return t.parentId=r,r}}));n.push(o)}})),e.next=7,Promise.all(n);case 7:return o=e.sent,e.abrupt("return",o.filter((function(e){return void 0!==e})));case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}])&&st(t.prototype,r),e}();function pt(e){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ht(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dt(e,t)}function dt(e,t){return(dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=mt(e);if(t){var o=mt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return vt(this,r)}}function vt(e,t){if(t&&("object"===pt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function mt(e){return(mt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function gt(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function wt(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){gt(i,n,o,a,c,"next",e)}function c(e){gt(i,n,o,a,c,"throw",e)}a(void 0)}))}}function Ot(e){return _t.apply(this,arguments)}function _t(){return(_t=wt(regeneratorRuntime.mark((function e(t){var r,n,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.layerOptions,n=t.webMap,o=t.connector,e.next=3,b(r,o);case 3:return i=e.sent,e.abrupt("return",function(e){ht(r,e);var t=bt(r);function r(e){return yt(this,r),t.call(this,e,{url:"",webMap:n,resourceId:i,connector:o})}return r}(lt));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jt(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Pt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function xt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var kt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),xt(this,"item",void 0),xt(this,"connector",void 0),xt(this,"_extent",void 0)}var t,r,n,o;return t=e,(r=[{key:"getExtent",value:(n=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._extent){e.next=2;break}return e.abrupt("return",this._extent);case 2:if(!this.item){e.next=7;break}return e.next=5,y(this.item,this.connector).then();case 5:return this._extent=e.sent,e.abrupt("return",this._extent);case 7:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(r,o){var i=n.apply(e,t);function a(e){jt(i,r,o,a,c,"next",e)}function c(e){jt(i,r,o,a,c,"throw",e)}a(void 0)}))},function(){return o.apply(this,arguments)})}])&&Pt(t.prototype,r),e}(),Lt=r(9847);function It(e){return(It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function St(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Rt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?St(Object(r),!0).forEach((function(t){Et(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):St(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Et(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Dt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function At(e,t,r){return t&&Dt(e.prototype,t),r&&Dt(e,r),e}function Nt(e,t,r){return(Nt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ut(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Tt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ct(e,t)}function Ct(e,t){return(Ct=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Ut(e);if(t){var o=Ut(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ft(this,r)}}function Ft(e,t){if(t&&("object"===It(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Ut(e){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Gt(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Zt(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Gt(i,n,o,a,c,"next",e)}function c(e){Gt(i,n,o,a,c,"throw",e)}a(void 0)}))}}function $t(e){return Wt.apply(this,arguments)}function Wt(){return(Wt=Zt(regeneratorRuntime.mark((function e(t){var r,n,o,i,a,c,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.webMap,!(n=t.item).basemap_layer){e.next=15;break}if(o=n.basemap_layer.qms,i=n.basemap_layer.url,!o){e.next=10;break}return a=JSON.parse(o),c=Promise.resolve(Lt.WL.utils.createQmsAdapter(r,void 0,{qms:a,baselayer:!0})),e.abrupt("return",c);case 10:if(!i){e.next=15;break}if(!(u=r.mapAdapter.layerAdapters.TILE)){e.next=15;break}return s=function(e){Tt(n,e);var t,r=Bt(n);function n(){return Mt(this,n),r.apply(this,arguments)}return At(n,[{key:"addLayer",value:(t=Zt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Nt(Ut(n.prototype),"addLayer",this).call(this,Rt(Rt({},t),{},{url:i})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),n}(u),e.abrupt("return",s);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Vt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function qt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Vt(Object(r),!0).forEach((function(t){zt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function zt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Jt(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Kt(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Jt(i,n,o,a,c,"next",e)}function c(e){Jt(i,n,o,a,c,"throw",e)}a(void 0)}))}}var Yt={},Ht=["mapserver_style","qgis_vector_style","qgis_raster_style","wmsserver_service","raster_style","basemap_layer","vector_layer","raster_layer","webmap","tmsclient_layer"];function Qt(e){return Xt.apply(this,arguments)}function Xt(){return(Xt=Kt(regeneratorRuntime.mark((function e(t){var r,n,o,i,a,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.layerOptions,n=t.webMap,o=t.connector,i=t.item,a=i.resource.id,e.next=4,o.getResourceChildren(a);case 4:if(c=e.sent,!(u=c&&c[0])){e.next=8;break}return e.abrupt("return",er(qt(qt({},r),{},{resource:u.resource.id}),n,o));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function er(e,t,r){return tr.apply(this,arguments)}function tr(){return(tr=Kt(regeneratorRuntime.mark((function e(t,r,n){var i,a,c,u,s,f,l,p,y,h,d,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.adapter,e.next=3,b(t,n);case 3:if(!(u=e.sent)){e.next=63;break}if(!(s=t.resource)||!s.resource||void 0===s.resource.id){e.next=11;break}a=s,e.next=14;break;case 11:return e.next=13,n.getResource(u);case 13:a=e.sent;case 14:if(!a){e.next=62;break}if(f=a.resource.cls,l=qt(qt({},t),{},{resource:u}),p={layerOptions:l,webMap:r,connector:n,item:a},-1===Ht.indexOf(f)){e.next=53;break}if("webmap"!==f){e.next=23;break}i=Ot(p),e.next=51;break;case 23:if("vector_layer"!==f){e.next=35;break}if(void 0===c||"GEOJSON"===c){e.next=32;break}if("MVT"!==c){e.next=29;break}i=Pe(p),e.next=30;break;case 29:return e.abrupt("return",Qt(p));case 30:e.next=33;break;case 32:i=re(p);case 33:e.next=51;break;case 35:if("raster_layer"!==f){e.next=39;break}return e.abrupt("return",Qt(p));case 39:if("basemap_layer"!==f){e.next=43;break}i=$t(p),e.next=51;break;case 43:if("GEOJSON"!==c){e.next=50;break}return e.next=46,n.getResource(a.resource.parent.id);case 46:(y=e.sent)&&(h=qt(qt({},t),{},{resource:a.resource.parent.id}),i=re(qt(qt({},p),{},{item:y,layerOptions:h}))),e.next=51;break;case 50:i=Pe(p);case 51:e.next=60;break;case 53:if(!Yt[f]){e.next=59;break}d=Yt[f],(v=c&&"function"!=typeof v?d[c]:d)&&(i=v(p)),e.next=60;break;case 59:throw"Resource class '".concat(f,"' not yet supported.");case 60:e.next=63;break;case 62:throw"Resource item is not found";case 63:if(!i){e.next=65;break}return e.abrupt("return",i.then((function(e){if(e){var t=e;return a&&(t.prototype.item=a,t.prototype.resourceId=a.resource.id,t.prototype.connector=n),(0,o.ef)(t,[kt],{replace:!1}),t}})));case 65:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rr(e){return(rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function or(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?nr(Object(r),!0).forEach((function(t){ir(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ir(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ar(e,t){return(ar=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function cr(e,t){if(t&&("object"===rr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ur(e){return(ur=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function sr(e,t){var r=e.bbox,n=e.width,o=e.height,i=e.nd;return{resource:t,extent:r,size:n+","+o,timestamp:Date.now(),nd:i}}var fr,lr={POINT:"point",LINESTRING:"line",POLYGON:"polygon",MULTIPOINT:"point",MULTILINESTRING:"line",MULTIPOLYGON:"polygon",POINTZ:"point",LINESTRINGZ:"line",POLYGONZ:"polygon",MULTIPOINTZ:"point",MULTILINESTRINGZ:"line",MULTIPOLYGONZ:"polygon"};function pr(e,t,r){var n=r.getAuthorizationHeaders();return n&&(e.headers=n),er(e,t,r)}function yr(e){return function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ar(e,t)}(i,t);var r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ur(r);if(n){var o=ur(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return cr(this,e)});function i(t,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),r=or(or({},e),r),o.call(this,t,r)}return i}(lt)}function hr(){if(void 0===fr){var e=document.createElement("div");e.style.cssText="position: absolute;  left: -100%;  top: -100%;  width: 100cm;",document.body.appendChild(e);var t=e.offsetWidth;document.body.removeChild(e),fr=t}return fr}function dr(e){return 12756274*Math.PI*Math.cos(e*Math.PI/180)}function br(e){return Math.log(e/256)/Math.LN2}function vr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function mr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?vr(Object(r),!0).forEach((function(t){jr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function gr(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return wr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?wr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function wr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Or(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function _r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function jr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Pr=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,jr(this,"url",void 0),jr(this,"connector",void 0),jr(this,"webMap",void 0),this.options.connector)this.url=this.options.connector.options.baseUrl||"",this.connector=this.options.connector;else{if(!this.options.baseUrl)throw new Error("url is not defined");this.url=this.options.baseUrl,this.connector=new n.Z({baseUrl:this.url,auth:this.options.auth})}}var t,r,o,i,a;return t=e,o=[{key:"addClassAdapters",value:function(e,t){Yt[e]=t}}],(r=[{key:"onLoadSync",value:(i=regeneratorRuntime.mark((function e(t){var r,n,o,i,a,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.options.resourceId||!this.url){e.next=23;break}if(!(r=[this.options.resourceId]).length){e.next=23;break}n=gr(r),e.prev=4,n.s();case 6:if((o=n.n()).done){e.next=15;break}return i=o.value,a={resourceId:i,connector:this.connector,webMap:t},e.next=11,t.addLayer(lt,mr({visibility:!0,fit:!0,pixelRadius:this.options.pixelRadius},a));case 11:return c=e.sent,e.abrupt("return",c);case 13:e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[4,17,20,23]])})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=i.apply(e,t);function a(e){Or(o,r,n,a,c,"next",e)}function c(e){Or(o,r,n,a,c,"throw",e)}a(void 0)}))},function(e){return a.apply(this,arguments)})},{key:"getLayerAdapters",value:function(){return Promise.resolve([this._getLayerAdapter()])}},{key:"_getLayerAdapter",value:function(){var e=this;return{name:"WEBMAP",createAdapter:function(t){return Promise.resolve(e._createAdapter(t))}}}},{key:"_createAdapter",value:function(e){return yr({webMap:e,connector:this.connector,baseUrl:this.url})}}])&&_r(t.prototype,r),o&&_r(t,o),e}();function xr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function kr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xr(Object(r),!0).forEach((function(t){Ir(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Lr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ir(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Sr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ir(this,"id",void 0),Ir(this,"label",void 0),Ir(this,"layerId",void 0),Ir(this,"parent",void 0),Ir(this,"fields",void 0),Ir(this,"geom",void 0),Ir(this,"extensions",void 0),Ir(this,"connector",void 0),Ir(this,"_item",void 0),Ir(this,"_geojson",void 0),Ir(this,"_resource",void 0);var r=t.feature;this.id=r.id,this.label=r.label,this.layerId=r.layerId,this.parent=r.parent,this.fields=r.fields,this.geom=r.geom,this.connector=t.connector}var t,r;return t=e,(r=[{key:"identify",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._item?f.Z.resolve(this._item):Ar(kr({connector:this.connector,featureId:this.id,resourceId:this.layerId,fields:null,extensions:["attachment","description"]},t)).then((function(t){return e._item=t,e.geom=t.geom,e.extensions=t.extensions,t}))}},{key:"resource",value:function(){var e=this;return this._resource?f.Z.resolve(this._resource.feature_layer):this.connector.getResource(this.layerId).then((function(t){return e._resource=t,e._resource.feature_layer}))}},{key:"geojson",value:function(){var e=this;return this._geojson?f.Z.resolve(this._geojson):this.identify().then((function(t){return t.toGeojson().then((function(t){return e._geojson=t,t}))}))}}])&&Lr(t.prototype,r),e}(),Rr="webmap-baselayer";function Er(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Mr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Er(Object(r),!0).forEach((function(t){Dr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Er(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Dr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ar(e){var t=Mr({},k);I(t,e);var r=Mr({id:e.resourceId,fid:e.featureId},t),n=e.cache||!0;return e.connector.get("feature_layer.feature.item",{cache:n},r).then((function(t){return Mr(Mr({},t),{},{toGeojson:function(){return t.geom?f.Z.resolve(L(t)):Ar(Mr(Mr({},e),{},{geom:!0,fields:null,extensions:null})).then((function(e){var r=e.geom;return L(Mr(Mr({},t),{},{geom:r}))}))}})}))}function Nr(e){return Ar(e).then((function(e){return L(e)}))}function Tr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],a=!0,c=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Cr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Cr(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Br(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Fr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Br(Object(r),!0).forEach((function(t){Ur(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Br(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ur(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gr(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[],o=[];for(var i in e){var a=Number(i);isNaN(a)||n.push(a)}var c=e.resources;c&&n.sort((function(e,t){return c.indexOf(e)-c.indexOf(t)}));for(var u=0;u<n.length;u++){var s=n[u],f=e[s];if("features"in f){var l=f.features,p=Number(s),y=l[0];if(y&&(t={featureId:y.id,resourceId:p,feature:y},o.push(t),!r))break}}return o}function Zr(e){var t=e.connector,r=e.identify;for(var n in r){var o=Number(n);if(!isNaN(o)){var i=r[n];if("features"in i){var a=i.features.find((function(e){return e.geom}));if(a&&a.geom){var c=a.geom;return f.Z.resolve(L(Fr(Fr({},a),{},{geom:c})))}}}}var u=Gr(r);return u&&u.length?Nr(Fr({connector:t},u[0])):f.Z.resolve(void 0)}function $r(e){var t=e.connector,r=Gr(e.identify);return r&&r.length?Ar(Fr(Fr({connector:t},e.requestOptions),r[0])):f.Z.resolve(void 0)}function Wr(e,t){(0,o.Vc)(e);var r=Tr(e.lngLat,2),n=r[0],i=r[1],a=[];if(t.geom){var c="Feature"===t.geom.type?t.geom.geometry:"Polygon"===t.geom.type&&t.geom;c&&(a=c.coordinates[0])}a.length||(a=(0,o.Wp)(n,i,t.radius));var u=[];a.forEach((function(e){var t=Tr(e,2),r=t[0],n=t[1],i=Tr((0,o.Qm)(r,n),2),a=i[0],c=i[1];u.push(a+" "+c)}));var s={geom:"POLYGON((".concat(u.join(", "),"))"),srs:3857,layers:t.layers};return t.connector.post("feature_layer.identify",{data:s})}function Vr(e){return new Sr(e)}function qr(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function zr(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){qr(i,n,o,a,c,"next",e)}function c(e){qr(i,n,o,a,c,"throw",e)}a(void 0)}))}}function Jr(e,t){return Kr.apply(this,arguments)}function Kr(){return(Kr=zr(regeneratorRuntime.mark((function e(t,r){var n,o,i,a,c,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("pyramid.settings",null,{component:"pyramid"});case 2:if(!((n=e.sent)&&n.company_logo&&n.company_logo.enabled)){e.next=30;break}return(i=document.createElement("a")).style.position="absolute",i.style.bottom="0",i.style.right="0",i.style.padding=null!==(o=null==r?void 0:r.padding)&&void 0!==o?o:"10px",i.className="ngw-map-logo",r&&r.cssClass&&(i.className+=" "+r.cssClass),(a=new Image).style.maxHeight="100px",a.style.maxWidth="100px",a.src="",e.prev=15,e.next=18,t.get("pyramid.company_logo",{responseType:"blob"});case 18:c=e.sent,u=window.URL||window.webkitURL,s=u.createObjectURL(c),a.src=s,e.next=27;break;case 24:e.prev=24,e.t0=e.catch(15),console.log(e.t0);case 27:return null!==n.company_logo.link&&""!==n.company_logo.link.trim()&&(i.href=n.company_logo.link,i.target="_blank",-1!==n.company_logo.link.search(/:\/\/nextgis/)&&(a.alt="Get your own Web GIS at nextgis.com")),i.appendChild(a),e.abrupt("return",i);case 30:case"end":return e.stop()}}),e,null,[[15,24]])})))).apply(this,arguments)}r(285),r(9254),r(3210),r(4916),r(4765)},7731:function(e,t,r){r.d(t,{Z8:function(){return A}}),r(5666),r(1539),r(8674),r(8309),r(9826),r(6992),r(3948),r(7941),r(4747),r(2772),r(561),r(9653),r(2479),r(2707),r(8783),r(1249),r(8304),r(489),r(2419),r(4819),r(5003),r(2526),r(7327),r(9337),r(1817),r(2165);var n=r(7187),o=r(1521),i=r(1344),a=r(9256),c=r(4468),u=r(8907);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e,t,r,n){if("number"==typeof t||"string"==typeof t)t=Number(t),e.push(p(p({},r),{},{resource:t}));else if(Array.isArray(t)){var o=(u=2,function(e){if(Array.isArray(e))return e}(c=t)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],a=!0,c=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}}(c,u)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}(c,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],a=o[1];e.push(p(p({},r),{},{resource:i,id:a},n))}else"object"===s(t)&&e.push(p(p(p({},r),t),n));var c,u}r(7042),r(1038);var d=r(7869),b=r(9847);function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var w={target:"map",baseUrl:"",whitlabel:!1,controls:["ZOOM","ATTRIBUTION"],controlsOptions:{ZOOM:{position:"top-left"},ATTRIBUTION:{position:"bottom-right",customAttribution:['<a href="https://nextgis.com" target="_blank">NextGIS</a>']}},pixelRadius:10};function O(e,t,r){var n;return(r=null!==(n=r)&&void 0!==n?n:10)*(40075016.686*Math.abs(Math.cos(180*e[1]/Math.PI))/Math.pow(2,t+8))*5e-4}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){D(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function x(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function k(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){x(i,n,o,a,c,"next",e)}function c(e){x(i,n,o,a,c,"throw",e)}a(void 0)}))}}function L(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function I(e,t,r){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=M(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e,t){if(t&&("object"===_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return E(e)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(A,e);var t,r,a,u,s,f,l,p,y,v,g,_,j,x=(_=A,j=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=M(_);if(j){var r=M(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return R(this,e)});function A(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,A),D(E(t=x.call(this,function(e){var t=[new b.WL];return e.starterKits&&e.starterKits.forEach((function(e){t.push(e)})),e.connector?e.connector&&(e.baseUrl=e.connector.options.baseUrl):e.connector=new d.Z({baseUrl:e.baseUrl||"",auth:e.auth}),(e=(0,i.vb)(w,e)).center||e.bounds||(e.bounds=[-179,-90,180,90],e.maxBounds=e.bounds),e.connector&&t.push(new c.lO({connector:e.connector,auth:e.auth})),m(m({},e),{},{starterKits:t,create:!1})}(e))),"emitter",new n.EventEmitter),D(E(t),"connector",void 0),D(E(t),"_ngwLayers",{}),D(E(t),"$$selectFromNgwRaster",void 0),D(E(t),"$$selectFromNgwVector",void 0),D(E(t),"_promises",{select:[],identify:[]}),e.connector&&(t.connector=e.connector),t._createWebMap().then((function(){var e=t.getContainer();e&&e.classList.add("ngw-map-container"),t.options.whitlabel&&t._whiteLabel()})),t}return t=A,(r=[{key:"addControl",value:(g=k(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.onLoad("controls:create");case 2:return e.abrupt("return",I(M(A.prototype),"addControl",this).call(this,t,r,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return g.apply(this,arguments)})},{key:"addNgwLayer",value:(v=k(regeneratorRuntime.mark((function e(t){var r,n,o,a,u,s,f,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.onMapLoad();case 2:if(r=t.keyname,n=t.resourceId,(r||void 0!==n)&&(0,i.vF)("set `resource` options instead of `keyname` or `resourceId`"),o=t.resource,r||n||o){e.next=7;break}throw new Error("resource, resourceId or keyname is required parameter to add NGW layer");case 7:if(!(0,i.ri)(this.options.baseUrl)){e.next=30;break}return e.prev=8,(0,i.ri)(this.options.setViewDelay)&&(t.adapterOptions=t.adapterOptions||{},(0,i.ri)(t.adapterOptions.setViewDelay)||(t.adapterOptions.setViewDelay=this.options.setViewDelay)),a=(0,c.Sy)(t,this,this.connector),u=P(P({visibility:!0},t),t.adapterOptions),e.next=14,this.addLayer(a,u);case 14:if(s=e.sent,f=s&&this.getLayerId(s),!s||!f){e.next=23;break}if(this._ngwLayers[f]={layer:s,resourceId:s.resourceId},s.options.name=s.options.name||s.item&&s.item.resource.display_name,!s.options.baselayer){e.next=23;break}if(!this.getActiveBaseLayer()){e.next=23;break}return e.abrupt("return",s);case 23:return e.abrupt("return",s);case 26:e.prev=26,e.t0=e.catch(8),l=(0,i.Kn)(o)&&"id"in o?o.id:r||n||o,console.error("Can't add NGW layer ".concat(l,"."),e.t0);case 30:case"end":return e.stop()}}),e,this,[[8,26]])}))),function(e){return v.apply(this,arguments)})},{key:"fit",value:function(){var e=this.options,t=e.center,r=e.zoom,n=e.bounds;t?(this.setCenter(t),r&&this.setZoom(r)):n&&this.fitBounds(n)}},{key:"fetchNgwLayerItem",value:function(e){return(0,c.vS)(P({connector:this.connector},e))}},{key:"fetchNgwLayerItems",value:function(e){return(0,c.nm)(P({connector:this.connector},e))}},{key:"fetchNgwLayerFeature",value:function(e){return(0,c.Cg)(P({connector:this.connector},e))}},{key:"fetchNgwLayerFeatures",value:function(e){return(0,c.UJ)(P({connector:this.connector},e))}},{key:"fetchIdentifyItem",value:function(e,t){var r=(0,c.K1)({identify:e,connector:this.connector,requestOptions:t});return this._addPromise("identify",r),r}},{key:"fetchIdentifyGeoJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=(0,c.D1)({identify:e,connector:this.connector,multiple:t});return r&&"then"in r?(this._addPromise("identify",r),r):o.Z.resolve(r)}},{key:"getIdentifyGeoJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.fetchIdentifyGeoJson(e,t)}},{key:"getNgwLayers",value:(y=k(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.onLoad();case 2:return e.abrupt("return",this._ngwLayers);case 3:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"getNgwLayerByResourceId",value:(p=k(regeneratorRuntime.mark((function e(t){var r,n,o,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=regeneratorRuntime.keys(this._ngwLayers);case 1:if((e.t1=e.t0()).done){e.next=21;break}if(r=e.t1.value,(n=this._ngwLayers[r]).resourceId!==t){e.next=8;break}return e.abrupt("return",n&&n.layer);case 8:if(!n.layer.getIdentificationIds){e.next=14;break}return e.next=11,n.layer.getIdentificationIds();case 11:if(!(o=e.sent)||!o.some((function(e){return e===t}))){e.next=14;break}return e.abrupt("return",n.layer);case 14:if(!n.layer.getDependLayers){e.next=19;break}if(i=n.layer.getDependLayers(),!(a=i.find((function(e){return e.item&&e.item.parentId===t})))){e.next=19;break}return e.abrupt("return",a.layer);case 19:e.next=1;break;case 21:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"fitLayer",value:(l=k(regeneratorRuntime.mark((function e(t,r){var n,o,i,a,u,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="string"==typeof t||"number"==typeof t?String(n):t.id,!(o=n&&this._ngwLayers[n])){e.next=21;break}if(!o.layer.getExtent){e.next=10;break}return e.next=6,o.layer.getExtent();case 6:(i=e.sent)&&this.fitBounds(i,r),e.next=19;break;case 10:if(!o.layer.item){e.next=14;break}a=o.layer.item,e.next=18;break;case 14:return u=o.resourceId,e.next=17,this.connector.getResource(u);case 17:a=e.sent;case 18:a&&(0,c.U2)(a,this.connector).then((function(e){e&&s.fitBounds(e,r)}));case 19:e.next=22;break;case 21:I(M(A.prototype),"fitLayer",this).call(this,t,r);case 22:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"zoomToLayer",value:(f=k(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fitLayer(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"onLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ngw-map:create";return I(M(A.prototype),"onLoad",this).call(this,e)}},{key:"removeLayer",value:function(e){var t=this.getLayer(e);if(t){var r=this.getLayerId(t);r&&delete this._ngwLayers[r],I(M(A.prototype),"removeLayer",this).call(this,t)}}},{key:"enableSelection",value:function(){var e=this;this.$$selectFromNgwRaster||(this.$$selectFromNgwRaster=function(t){e.emitter.listenerCount("ngw:select")&&e._selectFromNgwRaster(t)},this.$$selectFromNgwVector=function(t){e.emitter.listenerCount("ngw:select")&&e._selectFromNgwVector(t)},this.emitter.on("click",this.$$selectFromNgwRaster),this.emitter.on("layer:click",this.$$selectFromNgwVector))}},{key:"disableSelection",value:function(){this.$$selectFromNgwRaster&&(this.emitter.removeListener("click",this.$$selectFromNgwRaster),this.emitter.removeListener("click",this._selectFromNgwVector),this.$$selectFromNgwRaster=void 0,this.$$selectFromNgwVector=void 0)}},{key:"getNgwLayerItem",value:function(e){return this.fetchNgwLayerItem(e)}},{key:"getNgwLayerItems",value:function(e){return this.fetchNgwLayerItems(e)}},{key:"getNgwLayerFeature",value:function(e){return this.fetchNgwLayerFeature(e)}},{key:"getNgwLayerFeatures",value:function(e){return this.fetchNgwLayerFeatures(e)}},{key:"cancelPromise",value:function(){this.cancelPromises.apply(this,arguments)}},{key:"cancelPromises",value:function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.length||(r=Object.keys(this._promises)),r.forEach((function(t){var r=e._promises[t];r&&(r.forEach((function(e){return e.cancel()})),e._promises[t]=[])}))}},{key:"_addPromise",value:function(e,t){var r=this._promises[e];if(r&&-1===r.indexOf(t)){var n=function(){var e=r.indexOf(t);-1!==e&&r.splice(e,1)};t.then(n),t.catch(n),r.push(t)}}},{key:"_isFitFromResource",value:function(){var e=this._initMapState;return!e.zoom||!e.center}},{key:"_createWebMap",value:(s=k(regeneratorRuntime.mark((function e(){var t,r,n,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.create();case 2:this.options.qmsId&&this._addQmsBaseLayer(),this.options.osm&&this._addOsmBaseLayer(),t=[],r=this._isFitFromResource(),this.options.webmapId&&h(t,this.options.webmapId,{fit:r}),this.options.resources&&Array.isArray(this.options.resources)&&this.options.resources.forEach((function(e){var n={};r||(n.fit=!1),h(t,e,{},n)})),n=0,o=t;case 9:if(!(n<o.length)){e.next=22;break}return i=o[n],e.prev=11,e.next=14,this.addNgwLayer(i);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(11),console.log(e.t0);case 19:n++,e.next=9;break;case 22:this._emitStatusEvent("ngw-map:create",this),this.enableSelection();case 24:case"end":return e.stop()}}),e,this,[[11,16]])}))),function(){return s.apply(this,arguments)})},{key:"_addOsmBaseLayer",value:function(){this.addBaseLayer("OSM")}},{key:"_addQmsBaseLayer",value:function(){var e,t;Array.isArray(this.options.qmsId)?(e=this.options.qmsId[0],t=this.options.qmsId[1]):e=Number(this.options.qmsId);var r={qmsId:e};t&&(r.id=t),this.addBaseLayer("QMS",r)}},{key:"_selectFromNgwVector",value:function(e){var t=e.layer,r=t.item&&t.item.resource.id,n=e.feature;if(void 0!==r&&n){var o=n.id;if(o){var i=D({featureCount:1},r,{featureCount:1,features:[{id:Number(o),fields:n.properties||{},label:"#".concat(r),layerId:Number(r),parent:"",geom:n.geometry}]});return this._emitStatusEvent("ngw:select",this._prepareToIdentify(P(P({},i),{},{resources:[r],sourceType:"vector"}))),i}}}},{key:"_selectFromNgwRaster",value:(u=k(regeneratorRuntime.mark((function e(t){var r,n,o,i,a,u,s,f,l,p,y=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._emitStatusEvent("ngw:preselect"),r=[],(n=Object.values(this._ngwLayers)).sort((function(e,t){return e.layer.order&&t.layer.order?t.layer.order-e.layer.order:1})),n.forEach((function(e){var t=e.layer,n="function"==typeof t.getIdentificationIds&&t.getIdentificationIds;n&&t.options.selectable&&y.isLayerVisible(t)&&r.push(n.call(t))})),o=Promise.all(r),e.next=8,o;case 8:if(i=e.sent,a=[],i.forEach((function(e){e&&e.forEach((function(e){return a.push(e)}))})),a.length){e.next=14;break}return this._emitStatusEvent("ngw:select",null),e.abrupt("return");case 14:if(u=this.options.pixelRadius||10,s=this.getCenter(),f=void 0!==(f=this.getZoom())?f:20,s&&f){e.next=21;break}return this._emitStatusEvent("ngw:select",null),e.abrupt("return");case 21:return l=O(s,f,u),p=(0,c.PA)(t,{layers:a,connector:this.connector,radius:l}).then((function(e){return y._emitStatusEvent("ngw:select",y._prepareToIdentify(P(P({},e),{},{resources:a,sourceType:"raster",event:t}))),e})),this._addPromise("select",p),e.abrupt("return",p);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"_prepareToIdentify",value:function(e){var t=this;return P(P({},e),{},{getIdentifyItems:function(){return(0,c.RP)(e,!0).map((function(e){return(0,c.u4)({feature:e.feature,connector:t.connector})}))}})}},{key:"_whiteLabel",value:(a=k(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.getContainer())){e.next=6;break}return e.next=4,(0,c.GW)(this.connector,this.options.companyLogoOptions);case 4:(r=e.sent)&&t.appendChild(r);case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})}])&&L(t.prototype,r),A}(a.y9);D(A,"getIcon",u.q)}}]);
//# sourceMappingURL=main-edab822403dfe36.js.map