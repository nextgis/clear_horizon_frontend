"use strict";(self.webpackChunkclear_horizon=self.webpackChunkclear_horizon||[]).push([[778],{4482:function(e,t,r){r.d(t,{l:function(){return h}}),r(1539),r(8674),r(7042),r(8309),r(1038),r(8783),r(2526),r(1817),r(2165),r(6992),r(3948),r(7941),r(7327),r(5003),r(4747),r(9337),r(5666);var n=r(7869),o=r(560),i=r(9636),a=r(3388);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var h=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,y(this,"url",void 0),y(this,"connector",void 0),y(this,"webMap",void 0),this.options.connector)this.url=this.options.connector.options.baseUrl||"",this.connector=this.options.connector;else{if(!this.options.baseUrl)throw new Error("url is not defined");this.url=this.options.baseUrl,this.connector=new n.Z({baseUrl:this.url,auth:this.options.auth})}}var t,r,u,f,h;return t=e,r=[{key:"onLoadSync",value:(f=regeneratorRuntime.mark((function e(t){var r,n,o,a,u,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.options.resourceId||!this.url){e.next=23;break}if(!(r=[this.options.resourceId]).length){e.next=23;break}n=s(r),e.prev=4,n.s();case 6:if((o=n.n()).done){e.next=15;break}return a=o.value,u={resourceId:a,connector:this.connector,webMap:t},e.next=11,t.addLayer(i.b,c({visibility:!0,fit:!0,pixelRadius:this.options.pixelRadius},u));case 11:return f=e.sent,e.abrupt("return",f);case 13:e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[4,17,20,23]])})),h=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=f.apply(e,t);function i(e){l(o,r,n,i,a,"next",e)}function a(e){l(o,r,n,i,a,"throw",e)}i(void 0)}))},function(e){return h.apply(this,arguments)})},{key:"getLayerAdapters",value:function(){return Promise.resolve([this._getLayerAdapter()])}},{key:"_getLayerAdapter",value:function(){var e=this;return{name:"WEBMAP",createAdapter:function(t){return Promise.resolve(e._createAdapter(t))}}}},{key:"_createAdapter",value:function(e){var t=this.connector,r=this.url;return(0,o.$4)({webMap:e,connector:t,baseUrl:r})}}],u=[{key:"addClassAdapters",value:function(e,t){a.p[e]=t}}],r&&p(t.prototype,r),u&&p(t,u),e}()},9636:function(e,t,r){r.d(t,{b:function(){return le}}),r(5666),r(1249),r(4747),r(9826),r(2707),r(1539),r(8674),r(6992),r(8783),r(3948),r(7327),r(941),r(7941),r(2526),r(5003),r(9337),r(7042),r(8309),r(1038),r(1817),r(2165);var n=r(7187),o=r(77),i=r(9528),a=(r(3112),r(489),r(2419),r(6952)),u=r(4034),c=r(2735),s=r(560);function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function d(e,t){if(t&&("object"===f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(a,e);var t,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(n);if(o){var r=v(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return d(this,e)});function a(){return p(this,a),i.apply(this,arguments)}return t=a,(r=[{key:"getProperty",value:function(){var e=this.item.layer;return e&&e&&e.options&&void 0!==e.options.opacity?e.options.opacity:1}},{key:"update",value:function(e,t){var r=this;if(t=t||{},this.isGroup()){this._value=this._prepareValue(e,t);var n,o=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(this.getChildren());try{for(o.s();!(n=o.n()).done;){var i=n.value.properties.property(this.name);i&&(t.propagation?i.set(e,t):i.update(i.get(),t))}}catch(e){o.e(e)}finally{o.f()}}var a=this.item.layer;if(a){var u=e*this.getParents().reduce((function(e,t){var n=t.properties.property(r.name);return e*(n?n.getValue():1)}),1);this.item.webMap.setLayerOpacity(a,this._prepareValue(u))}}},{key:"_prepareValue",value:function(e,t){return t&&t.propagation&&this.isGroup()?1:Number(e)}}])&&y(t.prototype,r),a}(a.w8);function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function g(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function O(e){return function(e){if(Array.isArray(e))return j(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||_(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function _(e,t){if(e){if("string"==typeof e)return j(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?j(e,t):void 0}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){E(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function k(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function S(e,t){return S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},S(e,t)}function I(e,t){if(t&&("object"===m(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return R(e)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e){return L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},L(e)}function E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(p,e);var t,r,o,i,a,u,f,l=(u=p,f=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=L(u);if(f){var r=L(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return I(this,e)});function p(e,t,r,o,i,a){var u;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(u=l.call(this,P(P({},p.options),r))).webMap=e,E(R(u),"item",void 0),E(R(u),"connector",void 0),E(R(u),"layer",void 0),E(R(u),"emitter",new n.EventEmitter),E(R(u),"_rootDescendantsCount",0),o&&(u.connector=o),i&&u.tree.setParent(i),u.item=t,"root"===u.item.item_type)u._rootDescendantsCount=u._sumUp(u.item.children);else{var c=u.tree.getRoot();c&&(u._rootDescendantsCount=c._rootDescendantsCount)}return u.initProperties(),a||u._init(t),u}return t=p,r=[{key:"initItem",value:function(e){var t,r=this,n=e,o=this.getItemOptions(e),i=function(e){n._layer=e,r.layer=e,r.properties.get("visibility")&&r.properties.set("visibility",!0),void 0!==o.opacity&&r.webMap.setLayerOpacity(e,o.opacity)};if("group"===e.item_type||"root"===e.item_type){if(e.children&&e.children.length){var a,u=w(this.getChildren(e));try{for(u.s();!(a=u.n()).done;){var c=a.value,s=new this.constructor(this.webMap,c,this.options,this.connector,this);this.tree.addChild(s)}}catch(e){u.e(e)}finally{u.f()}}return Promise.resolve()}return"layer"===e.item_type?t=e.adapter||e.layer_adapter.toUpperCase():p.GetAdapterFromLayerType[e.item_type]&&(t=(0,p.GetAdapterFromLayerType[e.item_type])(e,o,this.webMap,this.connector)),t?this.webMap.addLayer(t,o).then((function(e){i(e)})):e._layer?Promise.resolve(i(e._layer)):Promise.reject("No layer added")}},{key:"bringToFront",value:function(){}},{key:"fit",value:function(){this.item.item_type}},{key:"getLayer",value:function(){return this.layer}},{key:"getItemOptions",value:function(e){var t="layer"===e.item_type&&e.layer_transparency,r="number"==typeof t?(100-t)/100:void 0,n={visibility:!1,headers:this.options.headers,crossOrigin:this.options.crossOrigin,setViewDelay:this.options.setViewDelay,params:{resource:this.item.resourceId,item:this.item}};if(this.options.order){var o=this.options.drawOrderEnabled&&"draw_order_position"in e?this._rootDescendantsCount-e.draw_order_position:this.id,i=String(o).padStart(4,"0");n.order=Number((0|this.options.order)+"."+i)}if(this.options.popupOptions&&(n.popupOptions=this.options.popupOptions),"layer"===e.item_type){var a=this._getZoomRange(e),u=a.maxZoom,s=a.minZoom;(0,c.w)(n,{updateWmsParams:e.updateWmsParams,url:e.url,headers:this.options.headers,ratio:this.options.ratio,maxZoom:u,minZoom:s,minScale:e.layer_min_scale_denom,maxScale:e.layer_max_scale_denom})}return void 0!==r&&(n.opacity=r),n}},{key:"getChildren",value:function(e){return O(e.children).reverse()}},{key:"_mapScaleToZoomLevel",value:function(e){return(0,s.kk)(e)}},{key:"_getZoomRange",value:function(e){var t=this.options.minZoom,r=this.options.maxZoom,n=e.layer_min_scale_denom?this._mapScaleToZoomLevel(e.layer_min_scale_denom):void 0,o=e.layer_max_scale_denom?this._mapScaleToZoomLevel(e.layer_max_scale_denom):void 0,i=[t,n].filter(Boolean),a=[r,o].filter(Boolean);return{minZoom:i.length?Math.max.apply(Math,O(i)):void 0,maxZoom:a.length?Math.min.apply(Math,O(a)):void 0}}},{key:"_init",value:function(e){var t=this;this.initItem(e).then((function(){t.emitter.emit("init")}))}},{key:"_sumUp",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=w(e);try{for(n.s();!(t=n.n()).done;){var o=t.value;"layer"===o.item_type?(r+=1,o.draw_order_position=o.draw_order_position||r):"group"===o.item_type&&(r=this._sumUp(o.children,r))}}catch(e){n.e(e)}finally{n.f()}return r}}],o=[{key:"create",value:(i=regeneratorRuntime.mark((function e(t,r,n,o,i){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new p(t,r,n,o,i,!0),e.next=3,a._init(r);case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=i.apply(e,t);function a(e){g(o,r,n,a,u,"next",e)}function u(e){g(o,r,n,a,u,"throw",e)}a(void 0)}))},function(e,t,r,n,o){return a.apply(this,arguments)})}],r&&k(t.prototype,r),o&&k(t,o),p}(a.ck);E(M,"GetAdapterFromLayerType",{}),E(M,"options",{properties:[{type:"boolean",name:"visibility",getProperty:function(e){if(e){if("group"===e.item.item_type||"root"===e.item.item_type)return(0,u.cC)(e.item,(function(e){return"layer_enabled"in e&&e.layer_enabled}),(function(e){return e.children}));if("layer"===e.item.item_type)return e.item.layer_enabled}return!1},onSet:function(e,t,r){r&&"layer"===r.item.item_type&&(r.layer&&(e?r.webMap.showLayer(r.layer):r.webMap.hideLayer(r.layer)),r.item.layer_enabled=e)}},{name:"opacity",handler:b}]});var A=r(3388);function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach((function(t){G(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function B(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return C(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function U(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Z(e,t,r){return t&&U(e.prototype,t),r&&U(e,r),e}function G(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function W(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function F(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){W(i,n,o,a,u,"next",e)}function u(e){W(i,n,o,a,u,"throw",e)}a(void 0)}))}}function V(e){return $.apply(this,arguments)}function $(){return $=F(regeneratorRuntime.mark((function e(t){var r,n,o,i,a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.webMap,n=t.adapterOptions,o=void 0===n?{}:n,i=t.onLayerAdded,a=t.createAdapter,u=function(){function e(){N(this,e),G(this,"options",{}),G(this,"layer",[]),G(this,"_removed",!1),G(this,"_creatingInProgress",!1)}var t,n,u;return Z(e,[{key:"addLayer",value:function(){return this.layer}},{key:"removeLayer",value:function(){this._removed=!0;var e,t=B(this.layer);try{for(t.s();!(e=t.n()).done;){var n=e.value;r.removeLayer(n)}}catch(e){t.e(e)}finally{t.f()}}},{key:"destroyed",value:function(){return this._removed}},{key:"showLayer",value:(u=F(regeneratorRuntime.mark((function e(){var t,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.options.visibility=!0,!this.layer.length){e.next=21;break}t=B(this.layer),e.prev=3,t.s();case 5:if((n=t.n()).done){e.next=11;break}return o=n.value,e.next=9,r.showLayer(o);case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),t.e(e.t0);case 16:return e.prev=16,t.f(),e.finish(16);case 19:e.next=23;break;case 21:return e.next=23,this.loadLayer();case 23:case"end":return e.stop()}}),e,this,[[3,13,16,19]])}))),function(){return u.apply(this,arguments)})},{key:"hideLayer",value:(n=F(regeneratorRuntime.mark((function e(){var t,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.options.visibility=!1,!this.layer){e.next=19;break}t=B(this.layer),e.prev=3,t.s();case 5:if((n=t.n()).done){e.next=11;break}return o=n.value,e.next=9,r.hideLayer(o);case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),t.e(e.t0);case 16:return e.prev=16,t.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[3,13,16,19]])}))),function(){return n.apply(this,arguments)})},{key:"loadLayer",value:(t=F(regeneratorRuntime.mark((function e(){var t,n,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layer.length||this._creatingInProgress){e.next=19;break}return this._creatingInProgress=!0,e.next=4,a(this);case 4:if(!(t=e.sent)){e.next=19;break}return n=new t(r.mapAdapter.map,T({},o)),e.next=9,n.addLayer({order:this.options.order,headers:this.options.headers,baselayer:this.options.baselayer});case 9:if(u=e.sent,i&&i(n),Object.assign(n.options,o),n.layer=u,this._removed&&r.removeLayer(n),this.layer.push(n),!this.options.visibility){e.next=18;break}return e.next=18,r.showLayer(n);case 18:this._creatingInProgress=!1;case 19:return e.abrupt("return",this.layer);case 20:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),e.abrupt("return",u);case 3:case"end":return e.stop()}}),e)}))),$.apply(this,arguments)}function q(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function z(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){q(i,n,o,a,u,"next",e)}function u(e){q(i,n,o,a,u,"throw",e)}a(void 0)}))}}function J(){return(J=z(regeneratorRuntime.mark((function e(t){var r,n,o,i,a,u,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.webMap,n=t.connector,o=t.item,i=t.adapterOptions,a=void 0===i?{}:i,u=t.idPrefix,c=void 0===u?"first-show-adapter":u,s=V({webMap:r,adapterOptions:a,onLayerAdded:function(e){e.options.baselayer=!1,e.id=c+"-"+o.resource_id},createAdapter:function(){return(0,A.N)({resource:o.resource_id,adapterOptions:{name:o.display_name,opacity:o.opacity}},r,n)}}),e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}r(9601);var Y=r(6834),H=r(4049),X=r(5360),Q=r(6818),K=r(1521);function ee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function te(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var re=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,te(this,"name",void 0),te(this,"resourceId",void 0),te(this,"item",void 0),te(this,"_extent",void 0),this.resourceId=t.resourceId;var r=t.item;this.item=r,t.labelField&&r.fields?this.name=r.fields[t.labelField]:this.name=String(r.id)}var t,r;return t=e,(r=[{key:"extent",value:function(){var e=this;return this._extent?K.Z.resolve(this._extent):this.options.connector.get("feature_layer.feature.item_extent",null,{id:this.resourceId,fid:this.item.id}).then((function(t){var r=t.extent,n=r.minLat,o=r.minLon,i=r.maxLat,a=[o,n,r.maxLon,i];return e._extent=a,a}))}},{key:"geoJson",value:function(){var e=this;return this.item.geom?K.Z.resolve((0,X.Ok)(this.item)):(0,Q.v)({resourceId:this.resourceId,featureId:this.item.id,connector:this.options.connector,geom:!0,fields:null,extensions:null}).then((function(t){var r=t.geom;return e.item.geom=r,(0,X.Ok)(e.item)}))}}])&&ee(t.prototype,r),e}();function ne(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return oe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?oe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(r),!0).forEach((function(t){fe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ie(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ue(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function ce(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){ue(i,n,o,a,u,"next",e)}function u(e){ue(i,n,o,a,u,"throw",e)}a(void 0)}))}}function se(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function fe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var le=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.map=t,this.options=r,fe(this,"layer",void 0),fe(this,"NgwWebmapItem",M),fe(this,"pixelRadius",10),fe(this,"resourceId",void 0),fe(this,"webmapClassName","webmap"),fe(this,"emitter",new n.EventEmitter),fe(this,"_extent",void 0),fe(this,"response",void 0),fe(this,"_webmapLayersIds",void 0),fe(this,"_webmapBaselayersIds",[]),fe(this,"_lastActiveBaselayer",void 0);var o=r.resourceId;if(Array.isArray(o)?(this.resourceId=o[0],this.options.id=o[1]):this.resourceId=o,!this.resourceId)throw new Error("NGW `resourceId` is not defined")}var t,r,a,u,c,f,l,p,y,h;return t=e,r=[{key:"addLayer",value:(h=ce(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.options=ae(ae({},this.options),t),e.next=3,this._getWebMapLayerItem();case 3:return this.layer=e.sent,o=null===(r=this.response)||void 0===r||null===(n=r.webmap)||void 0===n?void 0:n.extent_constrained,this.options.useExtentConstrained&&this._extent&&o&&this.options.webMap.setView({maxBounds:this._extent}),e.abrupt("return",this.layer);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"removeLayer",value:function(){var e=this.options.webMap.mapAdapter;if(this.getDependLayers().forEach((function(t){"layer"in t&&e.removeLayer(t.layer.layer)})),this._webmapBaselayersIds.length){var t,r=ne(this._webmapBaselayersIds);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.options.webMap.removeLayer(n)}}catch(e){r.e(e)}finally{r.f()}this._lastActiveBaselayer&&this.options.webMap.showLayer(this._lastActiveBaselayer)}this.options.useExtentConstrained&&this._extent&&this.options.webMap.setView({maxBounds:null}),delete this.layer,delete this.response,delete this._webmapLayersIds}},{key:"showLayer",value:(y=ce(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.layer||!this.layer.properties){e.next=2;break}return e.abrupt("return",this.layer.properties.property("visibility").set(!0));case 2:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"hideLayer",value:(p=ce(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.layer||!this.layer.properties){e.next=2;break}return e.abrupt("return",this.layer.properties.property("visibility").set(!1));case 2:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"setOpacity",value:(l=ce(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.layer||!this.layer.properties){e.next=2;break}return e.abrupt("return",this.layer.properties.property("opacity").set(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"getExtent",value:function(){return this.getBounds()}},{key:"getBounds",value:function(){var e=this.response&&this.response.webmap;if(e)return(0,H.gp)(e)}},{key:"getDependLayers",value:function(){return this.layer&&this.layer.tree.getDescendants()||[]}},{key:"getBookmarksResourceId",value:function(){var e=this.response&&this.response.webmap;if(e)return e.bookmark_resource.id}},{key:"fetchBookmarks",value:function(){var e=this.getBookmarksResourceId(),t=this.options.connector;if(e)return t.getResourceOrFail(e).then((function(r){var n,o=null===(n=r.feature_layer)||void 0===n?void 0:n.fields.find((function(e){return e.label_field})),a=o&&o.keyname;return(0,i.n)({connector:t,resourceId:e,geom:!1,fields:a?[a]:void 0}).then((function(r){var n,o=[],i=ne(r);try{for(i.s();!(n=i.n()).done;){var u=n.value,c=new re({item:u,resourceId:e,labelField:a,connector:t});o.push(c)}}catch(e){i.e(e)}finally{i.f()}return o}))}));throw new Error("Webmap was not loaded correctly, it is impossible to extract bookmarks")}},{key:"getIdentificationIds",value:(f=ce(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],r=this._webmapLayersIds){e.next=7;break}return e.next=5,this._getWebMapIds();case 5:r=e.sent,this._webmapLayersIds=r;case 7:return r&&r.length&&this.getDependLayers().sort((function(e,t){return t.id-e.id})).forEach((function(e){var r=e.item,n=r.parentId;if(void 0!==n&&"layer"===r.item_type){var o=e.properties.property("visibility");o.get()&&!o.isBlocked()&&t.push(n)}})),e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"_getWebMapLayerItem",value:(c=ce(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.resourceId){e.next=6;break}return e.next=3,this.getWebMapConfig(this.resourceId);case 3:if(!(t=e.sent)||!t.root_item){e.next=6;break}return e.abrupt("return",new Promise((function(e){var n={};if(r.options.connector&&r.options.connector.options.auth){var o=r.options.connector.getAuthorizationHeaders();o&&(n.headers=o)}n.setViewDelay=r.options.setViewDelay,n.order=r.options.order,n.ratio=r.options.ratio,n.crossOrigin=r.options.crossOrigin,n.minZoom=r.options.minZoom,n.maxZoom=r.options.maxZoom,n.drawOrderEnabled=t.draw_order_enabled,n.popupOptions=r.options.popupOptions;var i=new r.NgwWebmapItem(r.options.webMap,t.root_item,n,r.options.connector);i.emitter.on("init",(function(){return e(i)}))})));case 6:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"getWebMapConfig",value:(u=ce(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.options.connector.getResource(t);case 2:if(!(r=e.sent)){e.next=13;break}if(this.response=r,n=r[this.webmapClassName],this._setupBaselayers(r),!n){e.next=13;break}return this._extent=[n.extent_left,n.extent_bottom,n.extent_right,n.extent_top],this._updateItemsParams(n.root_item,this.options.webMap,r),e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"_setupBaselayers",value:function(e){var t,r=this.options.webMap;if(null===(t=this.options.useBasemap)||void 0===t||t)if(e.basemap_webmap&&e.basemap_webmap.basemaps.length){var n=r.getActiveBaseLayer();this._lastActiveBaselayer=n?n.id:void 0,this._setBasemaps(e.basemap_webmap)}else this.options.defaultBasemap&&r.addBaseLayer("OSM",{id:"webmap-default-baselayer",name:"OpenStreetMap"})}},{key:"_setBasemaps",value:function(e){var t,r=this,n=this.options.webMap,o=!1,i=ne(e.basemaps);try{var a=function(){var e=t.value;(function(e){return J.apply(this,arguments)})({webMap:n,connector:r.options.connector,item:e,adapterOptions:{crossOrigin:r.options.crossOrigin}}).then((function(t){var i=!o&&e.enabled;return e.enabled&&(o=!0),n.addBaseLayer(t,{id:"webmap-baselayer"+e.resource_id,name:e.display_name,opacity:e.opacity,visibility:i}).then((function(e){e.id&&r._webmapBaselayersIds.push(e.id)}))}))};for(i.s();!(t=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}}},{key:"_updateItemsParams",value:function(e,t,r){var n=this;if(e)if("group"===e.item_type||"root"===e.item_type)e.children&&(e.children=e.children.map((function(e){return n._updateItemsParams(e,t,r)}))),"root"===e.item_type&&(e.display_name=r.resource.display_name);else if("layer"===e.item_type){var i=(0,o.n)(this.options.connector.options.baseUrl+"/api/component/render/image"),a=e.layer_style_id;e.url=i,e.resourceId=a,e.updateWmsParams=function(e){return(0,s.Bq)(e,a)};var u=e.layer_adapter.toUpperCase(),c=(0,Y.Ee)({options:{adapter:u,resource:a},webMap:t,baseUrl:this.options.connector.options.baseUrl||""});e=ae(ae({},e),c)}return e}},{key:"_getWebMapIds",value:(a=ce(regeneratorRuntime.mark((function e(){var t,r,n,o,i,a,u,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.layer)||"root"!==t.item.item_type){e.next=10;break}r=t.tree.getDescendants(),n=[],o=ne(r);try{for(a=function(){var e=i.value.item;if("layer"===e.item_type){var t=e.layer_style_id,r=c.options.connector.getResource(t).then((function(t){if(t){var r=Number(t.resource.parent.id);return e.parentId=r,r}}));n.push(r)}},o.s();!(i=o.n()).done;)a()}catch(e){o.e(e)}finally{o.f()}return e.next=8,Promise.all(n);case 8:return u=e.sent,e.abrupt("return",u.filter((function(e){return void 0!==e})));case 10:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})}],r&&se(t.prototype,r),e}()},3388:function(e,t,r){r.d(t,{p:function(){return $e},N:function(){return Ye}}),r(5666),r(1539),r(8674),r(7941),r(2526),r(7327),r(5003),r(4747),r(9337);var n=r(4019),o=r(560),i=r(4049);function a(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function u(e){a(i,n,o,u,c,"next",e)}function c(e){a(i,n,o,u,c,"throw",e)}u(void 0)}))}}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"item",void 0),s(this,"connector",void 0),s(this,"_extent",void 0)}var t,r,n,o;return t=e,r=[{key:"getExtent",value:(o=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getBounds());case 1:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"getBounds",value:(n=u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._extent){e.next=2;break}return e.abrupt("return",this._extent);case 2:if(!this.item){e.next=7;break}return e.next=5,(0,i.U2)(this.item,this.connector,t);case 5:return this._extent=e.sent,e.abrupt("return",this._extent);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}],r&&c(t.prototype,r),e}(),l=(r(2222),r(6755),r(8309),r(489),r(2419),r(4819),r(7042),r(1038),r(8783),r(1817),r(2165),r(6992),r(3948),r(9714),r(7187)),p=r(7450),y=r(8133);function h(e,t){var r=document.createElement("div");if(t&&t.feature_layer)t.feature_layer.fields.forEach((function(t){if(t.grid_visibility){var n=e.properties&&e.properties[t.keyname];if(n){var o=document.createElement("div");r.appendChild(o),o.innerHTML="<span>".concat(t.display_name,"</span>: ").concat(n,"<span></span>")}}}));else if(e.properties)for(var n in e.properties){var o=document.createElement("div");r.appendChild(o),o.innerHTML="<span>".concat(n,"</span>: ").concat(e.properties[n],"<span></span>")}return r}var d=["fields","intersects","limit","orderBy","strategy"];function v(e){var t={};return d.forEach((function(r){var n=e[r];void 0!==n&&(t[r]=n)})),t}function b(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function m(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){b(i,n,o,a,u,"next",e)}function u(e){b(i,n,o,a,u,"throw",e)}a(void 0)}))}}function g(e,t){return O.apply(this,arguments)}function O(){return(O=m(regeneratorRuntime.mark((function e(t,r){var n,o,i,a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.resource,o=n,i=t.keyname,a=t.resourceId,!n){e.next=19;break}if("string"!=typeof n){e.next=8;break}i=n,e.next=19;break;case 8:if("number"!=typeof n){e.next=12;break}a=n,e.next=19;break;case 12:if(!o.resource||void 0===o.resource||!("resource"in o)){e.next=16;break}a=n.resource.id,e.next=19;break;case 16:return e.next=18,g(n,r);case 18:a=e.sent;case 19:if(a||!i){e.next=24;break}return e.next=22,r.getResource(i);case 22:(u=e.sent)&&(a=u.resource.id);case 24:return e.abrupt("return",a);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=r(447),_=r(8948);function j(e){var t=e.connector,r=e.resourceId,n=e.cache,o=void 0===n||n;return t.get("feature_layer.feature.count",{cache:o},{id:r}).then((function(e){return e.total_count}))}function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function P(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return k(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){u=!0,i=e})),f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function R(e,t,r){return t&&I(e.prototype,t),r&&I(e,r),e}function L(e,t,r){return L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=B(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}},L(e,t,r||e)}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}function M(e,t){return M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},M(e,t)}function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=B(e);if(t){var o=B(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return D(this,r)}}function D(e,t){if(t&&("object"===x(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return T(e)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function B(e){return B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},B(e)}function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){U(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function U(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Z(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function G(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Z(i,n,o,a,u,"next",e)}function u(e){Z(i,n,o,a,u,"throw",e)}a(void 0)}))}}function W(e){return F.apply(this,arguments)}function F(){return F=G(regeneratorRuntime.mark((function e(t){var r,n,a,u,c,s,f,d,b,m,O,x,k,I,M,D,C,Z,W,F;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.item,u=t.webMap,c=t.Adapter,s=t.connector,f=t.layerOptions,d=t.addLayerOptionsPriority,b=null==d||d,m=f,O=c||u.mapAdapter.layerAdapters.GEOJSON,x=[],k=!1,e.next=8,g(m,s);case 8:return D=e.sent,null!==(r=m.adapterOptions)&&void 0!==r&&null!==(n=r.popupOptions)&&void 0!==n&&n.fromProperties&&(m.adapterOptions.popupOptions.createPopupContent=function(e){var t=e.feature;return t&&h(t,a)}),C=function(){var e=G(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W(),I={filters:t,options:r},M=(0,w.U)(N({resourceId:D,filters:t,connector:s,cache:!0},r)),e.next=5,M;case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Z=!1,W=function(){M&&(M.cancel(),M=void 0)},F=function(e){E(h,e);var t,r,n,c,f=A(h);function h(){var e;S(this,h);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return U(T(e=f.call.apply(f,[this].concat(r))),"emitter",new l.EventEmitter),U(T(e),"__onMapMove",void 0),U(T(e),"__onMapMoveStart",void 0),U(T(e),"__enableMapMoveListener",void 0),U(T(e),"__disableMapMoveListener",void 0),e}return R(h,[{key:"addLayer",value:(c=G(regeneratorRuntime.mark((function e(t){var r,n,i,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!t.data,n=void 0===t.waitFullLoad||t.waitFullLoad,void 0!==m.id&&(t.id=m.id),a&&a.vector_layer&&(t.type=o.fo[a.vector_layer.geometry_type]),m.adapterOptions&&(t=b?N(N({},m.adapterOptions),t):N(N({},t),m.adapterOptions)),t.data&&0===Object.keys(t.data).length&&(t.data=void 0,r=!1),i=t.strategy||void 0,this.options.strategy=i,u=L(B(h.prototype),"addLayer",this).call(this,t),I={filters:t.propertiesFilter,options:v(t)},r&&(c=this.updateLayer()),!n||!c){e.next=14;break}return e.next=14,c;case 14:return i&&i.startsWith("BBOX")&&!k&&this._addBboxEventListener(),e.abrupt("return",u);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"getExtent",value:function(){return this.getBounds()}},{key:"getBounds",value:(n=G(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getLayers&&this.getLayers().length,!(null!=(r=this.options.strategy)&&r.startsWith("BBOX")||t)){e.next=6;break}return e.abrupt("return",(0,i.Ub)({connector:s,resourceId:a.resource.id}));case 6:if(!L(B(h.prototype),"getBounds",this)){e.next=8;break}return e.abrupt("return",L(B(h.prototype),"getBounds",this).call(this));case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"beforeRemove",value:function(){Z=!0,this._removeMoveEventListener(),this._removeBboxEventListener(),this.__disableMapMoveListener=void 0,this.__enableMapMoveListener=void 0,this.__onMapMove=void 0,this.__onMapMoveStart=void 0,W()}},{key:"getCount",value:function(){return j({connector:s,resourceId:D,cache:!0})}},{key:"updateLayer",value:(r=G(regeneratorRuntime.mark((function e(t){var r,n,o,i,a,c,s,f,l,p,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=t||I||{},null===(r=this.options.strategy)||void 0===r||!r.startsWith("BBOX")){e.next=15;break}return e.next=4,u.onLoad("create");case 4:if(t.options=t.options||{},t.options.intersects=u.getBounds(),n=this.options,o=n.minZoom,i=n.maxZoom,void 0===(a=u.getZoom())){e.next=15;break}if(!(void 0!==o&&a<o)){e.next=11;break}return e.abrupt("return");case 11:if(!(void 0!==i&&a>i)){e.next=13;break}return e.abrupt("return");case 13:if(!k){e.next=15;break}return e.abrupt("return");case 15:if(!Z){e.next=17;break}return e.abrupt("return");case 17:return e.prev=17,this.emitter.emit("preupdate",t),u._emitLayerEvent("layer:preupdate",m.id||"",t),e.next=22,C(t.filters,N(N({},t.options),{},{srs:this.options.srs}));case 22:return c=e.sent,s=c,e.next=26,this.getCount();case 26:if(f=e.sent,"BBOX+"!==this.options.strategy){e.next=36;break}s={type:"FeatureCollection",features:[]},l=P(c.features);try{for(l.s();!(p=l.n()).done;)y=p.value,-1===x.indexOf(String(y.id))&&(x.push(String(y.id)),s.features.push(y))}catch(e){l.e(e)}finally{l.f()}return k=void 0!==f&&x.length>=f,e.next=34,u.addLayerData(this,s);case 34:e.next=39;break;case 36:return k=void 0!==f&&c.features.length>=f,e.next=39,u.setLayerData(this,c);case 39:this.emitter.emit("updated",c),u._emitLayerEvent("layer:updated",m.id||"",{data:c,newData:s,isFull:k}),e.next=47;break;case 43:if(e.prev=43,e.t0=e.catch(17),!(e.t0 instanceof Error&&"CancelError"!==e.t0.name)){e.next=47;break}throw e.t0;case 47:L(B(h.prototype),"updateLayer",this)&&L(B(h.prototype),"updateLayer",this).call(this);case 48:case"end":return e.stop()}}),e,this,[[17,43]])}))),function(e){return r.apply(this,arguments)})},{key:"propertiesFilter",value:(t=G(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(W(),!this.filter||!k){e.next=5;break}this.filter((function(e){var r=e.feature&&e.feature.properties&&(0,_.f)(N({},e.feature.properties));return!r||(0,y.Ml)(r,t)})),e.next=11;break;case 5:if(!this.setData){e.next=11;break}return this.clearLayer&&this.clearLayer(),e.next=9,C(t,N(N({},r),{},{srs:this.options.srs}));case 9:n=e.sent,this.setData(n);case 11:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"removeFilter",value:function(){I=void 0,this.propertiesFilter([]),this.filter&&this.filter((function(){return!0}))}},{key:"_addBboxEventListener",value:function(){var e=this;this.__enableMapMoveListener=function(t){t===e&&(e._removeMoveEventListener(),e.updateLayer(),e._addMoveEventListener())},this.__disableMapMoveListener=function(t){t===e&&e._removeMoveEventListener()},u.emitter.on("layer:show",this.__enableMapMoveListener),u.emitter.on("layer:hide",this.__disableMapMoveListener),this.__enableMapMoveListener(this)}},{key:"_removeBboxEventListener",value:function(){this.__enableMapMoveListener&&u.emitter.on("layer:show",this.__enableMapMoveListener),this.__disableMapMoveListener&&u.emitter.on("layer:hide",this.__disableMapMoveListener)}},{key:"_addMoveEventListener",value:function(){var e=this;this.__onMapMove=(0,p.D)((function(){return e.updateLayer()})),this.__onMapMoveStart=W,u.emitter.on("movestart",this.__onMapMoveStart),u.emitter.on("moveend",this.__onMapMove)}},{key:"_removeMoveEventListener",value:function(){this.__onMapMove&&u.emitter.removeListener("moveend",this.__onMapMove),this.__onMapMoveStart&&u.emitter.removeListener("movestart",this.__onMapMoveStart)}}]),h}(O),e.abrupt("return",F);case 15:case"end":return e.stop()}}),e)}))),F.apply(this,arguments)}r(1249);var V=r(8651),$=r(6834);function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?z(Object(r),!0).forEach((function(t){ie(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function X(e,t,r){return t&&H(e.prototype,t),r&&H(e,r),e}function Q(e,t,r){return Q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=oe(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}},Q(e,t,r||e)}function K(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ee(e,t)}function ee(e,t){return ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ee(e,t)}function te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=oe(e);if(t){var o=oe(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return re(this,r)}}function re(e,t){if(t&&("object"===q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ne(e)}function ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e){return oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},oe(e)}function ie(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ae(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function ue(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){ae(i,n,o,a,u,"next",e)}function u(e){ae(i,n,o,a,u,"throw",e)}a(void 0)}))}}function ce(e){return se.apply(this,arguments)}function se(){return se=ue(regeneratorRuntime.mark((function e(t){var r,n,o,i,a,u,c,s,f,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.layerOptions,n=t.webMap,o=t.connector,i=t.item,a=i.resource.cls,u={wmsserver_service:"WMS",tmsclient_layer:"IMAGE"},void 0!==(c=r.adapter||a&&u[a]||"IMAGE")&&(r.adapter=c),"IMAGE"===c&&(!(s=n.getLayerAdapters())||s.IMAGE||(c="TILE")),!(f=n.mapAdapter.layerAdapters[c])){e.next=14;break}return e.next=10,g(r,o);case 10:return l=e.sent,e.abrupt("return",function(e){K(u,e);var t,a=te(u);function u(e,t){var c;Y(this,u),(c=a.call(this,e,t)).map=e,ie(ne(c),"item",i),ie(ne(c),"resourceId",l);var s=(0,$.Ee)({options:r,webMap:n,baseUrl:o.options.baseUrl||""});if(s){var f=J(J(J({},s),r.adapterOptions),{},{params:{resource:l},layers:s.layers||String(l),resourceId:l});r.adapterOptions&&(0,V.r)(r.adapterOptions.setViewDelay)&&(f.setViewDelay=r.adapterOptions.setViewDelay),c.options=J(J({},c.options),f)}return c}return X(u,[{key:"addLayer",value:function(e){return Q(oe(u.prototype),"addLayer",this).call(this,J(J({},this.options),e))}},{key:"getIdentificationIds",value:(t=ue(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.item){e.next=6;break}if("MVT"!==c){e.next=3;break}return e.abrupt("return",[this.item.resource.id]);case 3:if(t=this.item.resource.parent.id,!(0,V.r)(t)){e.next=6;break}return e.abrupt("return",[t]);case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),u}(f));case 14:throw new Error(c+" not supported yet. Only TILE");case 15:case"end":return e.stop()}}),e)}))),se.apply(this,arguments)}var fe=r(9636);function le(e){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le(e)}function pe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ye(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&he(e,t)}function he(e,t){return he=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},he(e,t)}function de(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=be(e);if(t){var o=be(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return ve(this,r)}}function ve(e,t){if(t&&("object"===le(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function be(e){return be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},be(e)}function me(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function ge(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){me(i,n,o,a,u,"next",e)}function u(e){me(i,n,o,a,u,"throw",e)}a(void 0)}))}}function Oe(e){return we.apply(this,arguments)}function we(){return we=ge(regeneratorRuntime.mark((function e(t){var r,n,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.layerOptions,n=t.webMap,o=t.connector,e.next=3,g(r,o);case 3:return i=e.sent,e.abrupt("return",function(e){ye(r,e);var t=de(r);function r(e){return pe(this,r),t.call(this,e,{url:"",webMap:n,resourceId:i,connector:o})}return r}(fe.b));case 5:case"end":return e.stop()}}),e)}))),we.apply(this,arguments)}var _e=r(9847);function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function xe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(r),!0).forEach((function(t){ke(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ke(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Se(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Re(e,t,r){return t&&Ie(e.prototype,t),r&&Ie(e,r),e}function Le(e,t,r){return Le="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Te(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}},Le(e,t,r||e)}function Ee(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}function Me(e,t){return Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Me(e,t)}function Ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Te(e);if(t){var o=Te(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return De(this,r)}}function De(e,t){if(t&&("object"===je(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Te(e){return Te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Te(e)}function Be(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function Ce(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Be(i,n,o,a,u,"next",e)}function u(e){Be(i,n,o,a,u,"throw",e)}a(void 0)}))}}function Ne(e){return Ue.apply(this,arguments)}function Ue(){return Ue=Ce(regeneratorRuntime.mark((function e(t){var r,n,o,i,a,u,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.webMap,!(n=t.item).basemap_layer){e.next=15;break}if(o=n.basemap_layer.qms,i=n.basemap_layer.url,!o){e.next=10;break}return a=JSON.parse(o),u=Promise.resolve(_e.WL.utils.createQmsAdapter(r,void 0,{qms:a,baselayer:!0})),e.abrupt("return",u);case 10:if(!i){e.next=15;break}if(!(c=r.mapAdapter.layerAdapters.TILE)){e.next=15;break}return s=function(e){Ee(n,e);var t,r=Ae(n);function n(){return Se(this,n),r.apply(this,arguments)}return Re(n,[{key:"addLayer",value:(t=Ce(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Le(Te(n.prototype),"addLayer",this).call(this,Pe(Pe({},t),{},{url:i})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),n}(c),e.abrupt("return",s);case 15:case"end":return e.stop()}}),e)}))),Ue.apply(this,arguments)}function Ze(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ge(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(r),!0).forEach((function(t){We(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ze(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function We(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fe(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function Ve(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Fe(i,n,o,a,u,"next",e)}function u(e){Fe(i,n,o,a,u,"throw",e)}a(void 0)}))}}var $e={},qe=["mapserver_style","qgis_vector_style","qgis_raster_style","wmsserver_service","raster_style","basemap_layer","vector_layer","raster_layer","postgis_layer","webmap","tmsclient_layer"];function ze(e){return Je.apply(this,arguments)}function Je(){return(Je=Ve(regeneratorRuntime.mark((function e(t){var r,n,o,i,a,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.layerOptions,n=t.webMap,o=t.connector,i=t.item,a=i.resource.id,e.next=4,o.getResourceChildren(a);case 4:if(u=e.sent,!(c=u&&u[0])){e.next=8;break}return e.abrupt("return",Ye(Ge(Ge({},r),{},{resource:c.resource.id}),n,o));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ye(e,t,r){return He.apply(this,arguments)}function He(){return(He=Ve(regeneratorRuntime.mark((function e(t,r,i){var a,u,c,s,l,p,y,h,d,v,b,m,O,w;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.adapter,e.next=3,g(t,i);case 3:if(!(s=e.sent)){e.next=68;break}if(!(l=t.resource)||!l.resource||void 0===l.resource.id){e.next=11;break}u=l,e.next=14;break;case 11:return e.next=13,i.getResource(s);case 13:u=e.sent;case 14:if(!u){e.next=67;break}if(p=u.resource.cls,y=Ge(Ge({},t),{},{resource:s}),h={layerOptions:y,webMap:r,connector:i,item:u},-1===qe.indexOf(p)){e.next=58;break}if("webmap"!==p){e.next=23;break}a=Oe(h),e.next=56;break;case 23:if("vector_layer"!==p&&"postgis_layer"!==p){e.next=40;break}if(d=u.vector_layer&&o.fo[u.vector_layer.geometry_type],(v=h.layerOptions.adapterOptions||{}).type=v.type||d,h.layerOptions.adapterOptions=v,t.adapterOptions=h,void 0===c||"GEOJSON"===c){e.next=37;break}if("MVT"!==c){e.next=34;break}a=ce(h),e.next=35;break;case 34:return e.abrupt("return",ze(h));case 35:e.next=38;break;case 37:a=W(h);case 38:e.next=56;break;case 40:if("raster_layer"!==p){e.next=44;break}return e.abrupt("return",ze(h));case 44:if("basemap_layer"!==p){e.next=48;break}a=Ne(h),e.next=56;break;case 48:if("GEOJSON"!==c){e.next=55;break}return e.next=51,i.getResource(u.resource.parent.id);case 51:(b=e.sent)&&(m=Ge(Ge({},t),{},{resource:u.resource.parent.id}),a=W(Ge(Ge({},h),{},{item:b,layerOptions:m}))),e.next=56;break;case 55:a=ce(h);case 56:e.next=65;break;case 58:if(!$e[p]){e.next=64;break}O=$e[p],(w=c&&"function"!=typeof w?O[c]:O)&&(a=w(h)),e.next=65;break;case 64:throw"Resource class '".concat(p,"' not yet supported.");case 65:e.next=68;break;case 67:throw"Resource item is not found";case 68:if(!a){e.next=70;break}return e.abrupt("return",a.then((function(e){if(e){var t=e;return u&&(t.prototype.item=u,t.prototype.resourceId=u.resource.id,t.prototype.connector=i),(0,n.ef)(t,[f],{replace:!1}),t}})));case 70:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},5360:function(e,t,r){r.d(t,{v2:function(){return m},Ok:function(){return g},_R:function(){return O},Jx:function(){return w},Ct:function(){return x}}),r(9600),r(561),r(6699),r(4916),r(5306),r(3210),r(2222),r(7327),r(1249),r(941),r(7042),r(1539),r(8309),r(1038),r(8783),r(2526),r(1817),r(2165),r(6992),r(3948),r(7941),r(5003),r(4747),r(9337);var n=r(1521),o=r(8133),i=r(8651),a=r(1895),u=r(1088),c=r(4220),s=r(584);function f(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||v(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,t)||v(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=v(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function v(e,t){if(e){if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(e,t):void 0}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var m={srs:4326,geom_format:"geojson"};function g(e){return{geometry:e.geom,id:e.id,type:"Feature",properties:e.fields}}function O(e,t){var r=t.extensions,n=t.geom,o=t.fields,a=t.srs;e.extensions=r?r.join(","):"",void 0!==o&&(e.fields=Array.isArray(o)?o.join(","):""),void 0!==n&&(e.geom=n?"yes":"no",n||(delete e.srs,delete e.geom_format)),(0,i.r)(a)&&(e.srs=a)}function w(e){var t=j(e);return n.Z.all(t).then((function(t){var r,n=[],o=[],i=d(t);try{for(i.s();!(r=i.n()).done;){var a,u=d(r.value);try{for(u.s();!(a=u.n()).done;){var c=a.value;n.includes(c.id)||(o.push(c),n.push(c.id))}}catch(e){u.e(e)}finally{u.f()}}}catch(e){i.e(e)}finally{i.f()}var s=void 0!==e.offset?e.offset:0,f=void 0!==e.limit?e.limit:o.length;return e.offset||e.limit?o.splice(s,f):o}))}function _(e){var t=h(e,3),r=t[0],n=t[1],o=t[2],i="id"!==r?"fld_":"",a="",u="",c=String(r).trim().replace(/^(%?)(.+?)(%?)$/,(function(e,t,r,n){return a=t,u=n,r})),s=a+o+u;return["".concat(i).concat(c,"__").concat(n),s]}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=e.filters,i="string"==typeof n[0]?n[0]:"all",a=n.filter((function(e){return Array.isArray(e)}));if("any"===i){var u,c=d(a);try{for(c.s();!(u=c.n()).done;){var s=u.value;(0,o.aN)(s)?t.push(x(p(p({},e),{},{paramList:[].concat(f(r),[_(s)])}))):j(p(p({},e),{},{filters:s}),t,f(r))}}catch(e){c.e(e)}finally{c.f()}}else if("all"===i){var l,y=[],h=[],v=d(a);try{for(v.s();!(l=v.n()).done;){var b=l.value;(0,o.aN)(b)?y.push(_(b)):h.push(b)}}catch(e){v.e(e)}finally{v.f()}if(h.length){var m,g=d(h);try{for(g.s();!(m=g.n()).done;){var O=m.value;j(p(p({},e),{},{filters:O}),t,[].concat(f(r),y))}}catch(e){g.e(e)}finally{g.f()}}else t.push(x(p(p({},e),{},{paramList:[].concat(f(r),y)})))}return t}function x(e){var t,r=p({},m),n=e.limit,o=e.cache,i=e.signal,f=e.offset,l=e.orderBy,y=e.paramList,d=e.connector,v=e.geomFormat,b=e.intersects,g=e.resourceId;if(n?n!==Number.POSITIVE_INFINITY&&(r.limit=n):r.limit=7e3,f&&(r.offset=f),v&&(r.geom_format=v),O(r,e),l&&(r.order_by=l.join(",")),Array.isArray(b)){var w=(0,c.T)(b)?(0,s.dy)(b):b;r.intersects=(t=w.map((function(e){var t=h(e,2),r=t[0],n=t[1],o=h((0,a.Qm)(r,n).map((function(e){return(0,u.N)(e)})),2);return o[0]+" "+o[1]})),"POLYGON((".concat(t.join(", "),"))"))}else"string"==typeof b&&(r.intersects=b);y&&(r.paramList=y);var _=p({id:g},r);return d.get("feature_layer.feature.collection",{cache:o,signal:i},_)}},4049:function(e,t,r){r.d(t,{gp:function(){return u},PL:function(){return s},Ub:function(){return f},U2:function(){return l}}),r(7941),r(2526),r(7327),r(5003),r(4747),r(9337);var n=r(1521);function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){var t=e.extent_bottom,r=e.extent_left,n=e.extent_top,o=e.extent_right;if(t&&r&&n&&o){var i=[r,t,o,n];return i[3]>82&&(i[3]=82),i[1]<-82&&(i[1]=-82),i}}function c(e){var t=e.resourceId,r=e.connector,n=e.cache,o=void 0===n||n;return r.get("layer.extent",{cache:o},{id:t}).then((function(e){if(e){var t=e.extent,r=t.maxLat,n=t.maxLon,o=t.minLat;return[t.minLon,o,n,r]}}))}function s(e){var t=e.resourceId,r=e.featureId,n=e.connector,o=e.cache,i=void 0===o||o;return n.get("feature_layer.feature.item_extent",{cache:i},{id:t,fid:r}).then((function(e){if(e){var t=e.extent,r=t.maxLat,n=t.maxLon,o=t.minLat;return[t.minLon,o,n,r]}}))}function f(e){return e.connector.getResource(e.resourceId).then((function(t){if(t)return l(t,e.connector,e)}))}function l(e,t,r){if(e.webmap)return n.Z.resolve(u(e.webmap));var o=e.resource;return o.cls&&-1!==o.cls.indexOf("style")?t.getResource(o.parent.id).then((function(e){if(e)return c(i(i({},r),{},{resourceId:e.resource.id,connector:t}))})):c(i(i({},r),{},{resourceId:o.id,connector:t}))}},7644:function(e,t,r){r.d(t,{C:function(){return i}});var n=r(6818),o=r(5360);function i(e){return(0,n.v)(e).then((function(e){return(0,o.Ok)(e)}))}},447:function(e,t,r){r.d(t,{U:function(){return i}}),r(4747);var n=r(9528),o=r(5360);function i(e){return function(e){return(0,n.n)(e).then((function(e){var t=[];return e.forEach((function(e){t.push((0,o.Ok)(e))})),t}))}(e).then((function(e){return{type:"FeatureCollection",features:e}}))}},6818:function(e,t,r){r.d(t,{v:function(){return c}}),r(7941),r(2526),r(7327),r(5003),r(4747),r(9337);var n=r(1521),o=r(5360);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e){var t=a({},o.v2);(0,o._R)(t,e);var r=a({id:e.resourceId,fid:e.featureId},t),i=e.cache||!0;return e.connector.get("feature_layer.feature.item",{cache:i},r).then((function(t){return a(a({},t),{},{toGeojson:function(){return t.geom?n.Z.resolve((0,o.Ok)(t)):c(a(a({},e),{},{geom:!0,fields:null,extensions:null})).then((function(e){var r=e.geom;return(0,o.Ok)(a(a({},t),{},{geom:r}))}))}})}))}},9528:function(e,t,r){r.d(t,{n:function(){return f}}),r(7327),r(7941),r(2526),r(5003),r(4747),r(9337);var n=r(8133),o=r(5360),i=r(8948),a=r(2476);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){var t=e.filters;return t?(0,o.Jx)(c(c({},e),{},{filters:t})).then((function(r){var o;return(null!==(o=e.clientFilterValidate)&&void 0!==o?o:l(t))&&(r=r.filter((function(e){var r=(0,i.f)(c(c({},e.fields),{},{id:e.id}));return(0,n.Ml)(r,t)}))),r})):(0,o.Ct)(e)}function l(e){if("any"===e[0])return!0;for(var t=1;t<e.length;t++){var r=e[t];if((0,a.kJ)(r)&&l(r))return!0}return!1}},3314:function(e,t,r){function n(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(o,i){var a=e.apply(t,r);function u(e){n(a,o,i,u,c,"next",e)}function c(e){n(a,o,i,u,c,"throw",e)}u(void 0)}))}}function i(e,t){return a.apply(this,arguments)}function a(){return(a=o(regeneratorRuntime.mark((function e(t,r){var n,o,i,a,u,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("pyramid.settings",null,{component:"pyramid"});case 2:if(!((n=e.sent)&&n.company_logo&&n.company_logo.enabled)){e.next=30;break}return(i=document.createElement("a")).style.position="absolute",i.style.bottom="0",i.style.right="0",i.style.padding=null!==(o=null==r?void 0:r.padding)&&void 0!==o?o:"10px",i.className="ngw-map-logo",r&&r.cssClass&&(i.className+=" "+r.cssClass),(a=new Image).style.maxHeight="100px",a.style.maxWidth="100px",a.src="",e.prev=15,e.next=18,t.get("pyramid.company_logo",{responseType:"blob"});case 18:u=e.sent,c=window.URL||window.webkitURL,s=c.createObjectURL(u),a.src=s,e.next=27;break;case 24:e.prev=24,e.t0=e.catch(15),console.warn(e.t0);case 27:return null!==n.company_logo.link&&""!==n.company_logo.link.trim()&&(i.href=n.company_logo.link,i.target="_blank",-1!==n.company_logo.link.search(/:\/\/nextgis/)&&(a.alt="Get your own Web GIS at nextgis.com")),i.appendChild(a),e.abrupt("return",i);case 30:case"end":return e.stop()}}),e,null,[[15,24]])})))).apply(this,arguments)}r.d(t,{G:function(){return i}}),r(5666),r(1539),r(8674),r(6992),r(8783),r(3948),r(285),r(1637),r(9254),r(3210),r(4916),r(4765)},1757:function(e,t,r){r.d(t,{u4:function(){return R},D1:function(){return k},K1:function(){return S},RP:function(){return x},PA:function(){return I}}),r(941),r(2707),r(9826),r(9600),r(2526),r(1817),r(1539),r(2165),r(6992),r(8783),r(3948),r(1038),r(7042),r(8309),r(7941),r(7327),r(5003),r(4747),r(9337);var n=r(1521),o=r(1895),i=r(3614),a=r(5034),u=r(6818),c=r(4049);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),p(this,"id",void 0),p(this,"label",void 0),p(this,"layerId",void 0),p(this,"parent",void 0),p(this,"fields",void 0),p(this,"geom",void 0),p(this,"extensions",void 0),p(this,"connector",void 0),p(this,"_item",void 0),p(this,"_geojson",void 0),p(this,"_resource",void 0),p(this,"_extent",void 0);var r=t.feature;this.id=r.id,this.geom=r.geom,this.label=r.label,this.parent=r.parent,this.fields=r.fields,this.layerId=r.layerId,this.connector=t.connector}var t,r;return t=e,r=[{key:"identify",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._item?n.Z.resolve(this._item):(0,u.v)(f({connector:this.connector,featureId:this.id,resourceId:this.layerId,fields:null,extensions:["attachment","description"]},t)).then((function(t){return e._item=t,e.geom=t.geom,e.extensions=t.extensions,t}))}},{key:"resource",value:function(){var e=this;return this._resource?n.Z.resolve(this._resource.feature_layer):this.connector.getResource(this.layerId).then((function(t){return e._resource=t,e._resource.feature_layer}))}},{key:"getBounds",value:function(){return this._extent?n.Z.resolve(this._extent):(0,c.PL)({connector:this.connector,featureId:this.id,resourceId:this.layerId})}},{key:"geojson",value:function(){var e=this;return this._geojson?n.Z.resolve(this._geojson):this.identify().then((function(t){return t.toGeojson().then((function(t){return e._geojson=t,t}))}))}}],r&&l(t.prototype,r),e}(),h=r(5360),d=r(7644);function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,t)||_(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function w(e){return function(e){if(Array.isArray(e))return j(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||_(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){if(e){if("string"==typeof e)return j(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?j(e,t):void 0}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function x(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[],n=[];for(var o in e){var i=Number(o);isNaN(i)||r.push(i)}var a=e.resources;a&&r.sort((function(e,t){return a.indexOf(e)-a.indexOf(t)}));for(var u=0;u<r.length;u++){var c=r[u],s=e[c];if("features"in s){var f=s.features,l=Number(c),p=P(f,l,t);if(p.length&&(n.push.apply(n,w(p)),!t))break}}return n}function P(e,t,r){var n,o=[],i=O(e);try{for(i.s();!(n=i.n()).done;){var a=n.value,u={featureId:a.id,resourceId:t,feature:a};if(o.push(u),!r)break}}catch(e){i.e(e)}finally{i.f()}return o}function k(e){var t=e.connector,r=e.identify,o=e.requestOptions;for(var i in r){var a=Number(i);if(!isNaN(a)){var u=r[i];if("features"in u){var c=u.features.find((function(e){return e.geom}));if(c&&c.geom){var s=c.geom;return n.Z.resolve((0,h.Ok)(m(m({},c),{},{geom:s})))}}}}var f=x(r);return f&&f.length?(0,d.C)(m(m({},o),{},{connector:t},f[0])):n.Z.resolve(void 0)}function S(e){var t=e.connector,r=x(e.identify);return r&&r.length?(0,u.v)(m(m({connector:t},e.requestOptions),r[0])):n.Z.resolve(void 0)}function I(e,t){(0,i.V)(e);var r=v(e.lngLat,2),n=r[0],u=r[1],c=t.geom,s=t.radius,f=t.signal,l=t.cache,p=null!=c?c:(0,a.W)(n,u,s);return function(e){var t=e.geom,r=e.signal,n=e.cache,i=[];if(Array.isArray(t))i=t;else{var a="Feature"===t.type?t.geometry:"Polygon"===t.type&&t;a&&(i=a.coordinates[0])}if(i){var u,c=[],s=O(i);try{for(s.s();!(u=s.n()).done;){var f=v(u.value,2),l=f[0],p=f[1],y=v((0,o.Qm)(l,p),2),h=y[0],d=y[1];c.push(h+" "+d)}}catch(e){s.e(e)}finally{s.f()}var b={geom:"POLYGON((".concat(c.join(", "),"))"),srs:3857,layers:e.layers};return e.connector.post("feature_layer.identify",{data:b,signal:r,cache:n})}throw new Error("Not valid geometry format to make intersection")}(m(m({},t),{},{geom:p,signal:f,cache:l}))}function R(e){return new y(e)}},6834:function(e,t,r){r.d(t,{Ee:function(){return i}}),r(2222),r(2526),r(1817),r(1539),r(2165),r(6992),r(8783),r(3948);var n=r(560);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e){var t,r=e.options,i=e.webMap,a=e.baseUrl,u=r.adapter||"IMAGE",c=i&&i.getLayerAdapters(),s=!c||c.IMAGE,f=r.resource,l=r.tileNoData?r.tileNoData:200;if("number"==typeof f){if("IMAGE"===u){if(s)return function(e){var t=e.resourceId,r=e.nd,o=e.headers,i=e.baseUrl+"/api/component/render/image",a={resource:t};return r&&(a.nd=r),{url:i,resourceId:t,headers:o,params:a,updateWmsParams:function(e){return r&&(e.nd=r),(0,n.Bq)(e,t)}}}({resourceId:f,headers:r.headers,nd:l,baseUrl:a});u="TILE"}if("WMS"===u){t="".concat(a,"/api/resource/").concat(f,"/wms");var p=r.adapterOptions;return{url:t,format:"image/png",version:"1.1.1",layers:p&&p.layers,headers:r.headers}}var y;if("MVT"===u)return{url:t=a+"/api/component/feature_layer/mvt?x={x}&y={y}&z={z}&resource="+f+"&simplification="+(null!==(y=r.simplification)&&void 0!==y?y:6),sourceLayer:"ngw:"+f,featureIdName:"$id"};if("TERRAIN"===u)return{url:t=a+"/api/resource/".concat(f,"/terrain_provider"),adapter:u};if("MODEL_3D"===u)return{url:t=a+"/api/component/model_3d/".concat(f,"/data.glb")};if("TILE"===u)return{url:t=a+"/api/component/render/tile?z={z}&x={x}&y={y}&resource="+f+"&nd="+l,adapter:u}}else{if(void 0!==f)throw new Error("Option `resource` must be number, not "+o(f));console.log("Option `resource` not set")}}},8948:function(e,t,r){r.d(t,{f:function(){return c}}),r(4747),r(1249),r(4916),r(3123),r(941),r(2419);var n=r(2476),o=r(8651);function i(e,t,r){return i=a()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&u(o,r.prototype),o},i.apply(null,arguments)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function c(e){var t;for(t in e){var r=e[t];if((0,n.Kn)(r)){var a=r;(0,o.r)(a.year)&&(0,o.r)(a.month)&&(0,o.r)(a.day)&&function(){var r=[a.year,a.month-1,a.day];"hour"in a&&[a.hour,a.minute,a.second].forEach((function(e){r.push(e)})),e[t]=i(Date,r).toISOString()}()}else"id"===t&&"string"==typeof r&&(e[t]=r.split(",").map(Number))}return e}},560:function(e,t,r){r.d(t,{Bq:function(){return p},fo:function(){return h},Sy:function(){return d},$4:function(){return v},kk:function(){return O}}),r(9600),r(489),r(2419),r(7941),r(2526),r(7327),r(5003),r(4747),r(9337),r(1817),r(1539),r(2165),r(6992),r(8783),r(3948);var n=r(3388),o=r(9636);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function f(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function p(e,t){var r=e.bbox,n=e.width,o=e.height,i=e.nd;return{resource:Array.isArray(t)?t.join(","):t,extent:r,size:n+","+o,timestamp:Date.now(),nd:null!=i?i:200}}var y,h={POINT:"point",LINESTRING:"line",POLYGON:"polygon",MULTIPOINT:"point",MULTILINESTRING:"line",MULTIPOLYGON:"polygon",POINTZ:"point",LINESTRINGZ:"line",POLYGONZ:"polygon",MULTIPOINTZ:"point",MULTILINESTRINGZ:"line",MULTIPOLYGONZ:"polygon"};function d(e,t,r){var o=r.getAuthorizationHeaders();return o&&(e.headers=o),(0,n.N)(e,t,r)}function v(e){return function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(i,t);var r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=l(r);if(n){var o=l(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return f(this,e)});function i(t,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),r=u(u({},e),r),o.call(this,t,r)}return i}(o.b)}function b(){if(void 0===y){var e=document.createElement("div");e.style.cssText="position: absolute;  left: -100%;  top: -100%;  width: 100cm;",document.body.appendChild(e);var t=e.offsetWidth;document.body.removeChild(e),y=t}return y}function m(e){return 12756274*Math.PI*Math.cos(e*Math.PI/180)}function g(e){return Math.log(e/256)/Math.LN2}function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=t,n=b()*m(r)/e,o=g(n);return o}}}]);
//# sourceMappingURL=main-f6f2830129735b2.js.map