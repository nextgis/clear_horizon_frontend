(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{118:function(t,e,r){"use strict";r.d(e,"a",(function(){return p}));var n,o=r(264),i=r(11),a=r(22),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),c=function(){return(c=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},u=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},l=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},p=function(t){function e(r,n,o,i,a){var s=t.call(this,c(c({},e.options),o))||this;if(s.webMap=r,s._rootDescendantsCount=0,i&&(s.connector=i),a&&s.tree.setParent(a),s.item=n,"root"===s.item.item_type)s._rootDescendantsCount=s._sumUp(s.item.children);else{var u=s.tree.getRoot();u&&(s._rootDescendantsCount=u._rootDescendantsCount)}return s.initProperties(),s._init(n),s}return s(e,t),e.prototype.initItem=function(t){return u(this,void 0,void 0,(function(){var r,n,o,a,s,c,u,p,f,h=this;return l(this,(function(l){switch(l.label){case 0:return r=t._layer,n=t,"group"!==t.item_type&&"root"!==t.item_type?[3,1]:(t.children&&t.children.length&&this.getChildren(t).forEach((function(t){var r=new e(h.webMap,t,h.options,h.connector,h);h.tree.addChild(r)})),[3,6]);case 1:return o=void 0,a={visibility:!1,headers:this.options.headers,crossOrigin:this.options.crossOrigin},this.options.order&&(s=this.options.drawOrderEnabled&&"draw_order_position"in t?this._rootDescendantsCount-t.draw_order_position:this.id,a.order=Number((0|this.options.order)+"."+s)),"layer"!==t.item_type?[3,2]:(o=t.adapter||t.layer_adapter.toUpperCase(),c=t.layer_max_scale_denom?this._mapScaleToZoomLevel(t.layer_max_scale_denom):this.webMap.options.maxZoom,u=t.layer_min_scale_denom?this._mapScaleToZoomLevel(t.layer_min_scale_denom):this.webMap.options.minZoom,Object(i.objectAssign)(a,{updateWmsParams:t.updateWmsParams,url:t.url,headers:this.options.headers,maxZoom:c,minZoom:u,minScale:t.layer_min_scale_denom,maxScale:t.layer_max_scale_denom}),[3,4]);case 2:return e.GetAdapterFromLayerType[t.item_type]?[4,(0,e.GetAdapterFromLayerType[t.item_type])(t,a,this.webMap,this.connector)]:[3,4];case 3:o=l.sent(),l.label=4;case 4:return o?[4,this.webMap.addLayer(o,a)]:[3,6];case 5:r=l.sent(),l.label=6;case 6:return r&&(n._layer=r,this.layer=r,this.properties&&"layer"===t.item_type&&t.layer_enabled&&this.properties.property("visibility").set(!0),"number"==typeof(p="layer"===t.item_type&&t.layer_transparency)&&(f=(100-p)/100,this.webMap.setLayerOpacity(r,f))),[2]}}))}))},e.prototype.bringToFront=function(){},e.prototype.fit=function(){"layer"===this.item.item_type&&console.log(this.item)},e.prototype.getChildren=function(t){return t.children.reverse()},e.prototype._mapScaleToZoomLevel=function(t){return Object(a.h)(t)},e.prototype._init=function(t){return u(this,void 0,void 0,(function(){return l(this,(function(e){switch(e.label){case 0:return[4,this.initItem(t)];case 1:return e.sent(),this.emitter.emit("init"),[2]}}))}))},e.prototype._sumUp=function(t,e){void 0===e&&(e=0);for(var r=0,n=t;r<n.length;r++){var o=n[r];"layer"===o.item_type?(e+=1,o.draw_order_position=o.draw_order_position||e):"group"===o.item_type&&(e=this._sumUp(o.children,e))}return e},e.GetAdapterFromLayerType={},e.options={properties:[{type:"boolean",name:"visibility",getProperty:function(t){if(t){if("group"===t.item.item_type)return!0;if("layer"===t.item.item_type)return t.item.layer_enabled;if("root"===t.item.item_type)return!0}return!1},onSet:function(t,e,r){r&&r.layer&&"layer"===r.item.item_type&&(t?r.webMap.showLayer(r.layer):r.webMap.hideLayer(r.layer),r.item.layer_enabled=t)}}]},e}(o.Item)},122:function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var n=r(74),o=function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},i=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},a=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function s(t){var e=t.webMap,r=t.connector,s=t.item,c=t.adapterOptions,u=void 0===c?{}:c,l=t.idPrefix,p=void 0===l?"basemapwebmap":l;return i(this,void 0,void 0,(function(){return a(this,(function(t){return[2,function(){function t(){this.options={},this.layer=[],this._removed=!1}return t.prototype.addLayer=function(){return this.layer},t.prototype.removeLayer=function(){this._removed=!0,this.layer.forEach((function(t){return e.removeLayer(t)}))},t.prototype.showLayer=function(){var t=this;this.options.visibility=!0,this.layer.length?this.layer.forEach((function(t){e.showLayer(t)})):Object(n.b)({resourceId:s.resource_id,adapterOptions:{name:s.display_name,opacity:s.opacity}},e,r).then((function(r){if(r){var n=new r(e.mapAdapter.map,o(o({},u),{baselayer:!1}));n.addLayer({}).then((function(r){n.options.baselayer=!1,Object.assign(n.options,u),n.id=p+"-"+s.resource_id,n.layer=r,t._removed&&e.removeLayer(n),t.options.visibility&&e.showLayer(n),t.layer.push(n)}))}}))},t.prototype.hideLayer=function(){this.options.visibility=!1,this.layer&&this.layer.forEach((function(t){return e.hideLayer(t)}))},t}()]}))}))}},123:function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));var n=r(22),o=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},i=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},a=function(){function t(){}return t.prototype.getExtent=function(){return o(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return this._extent?[2,this._extent]:this.item?(t=this,[4,Object(n.e)(this.item,this.connector).then()]):[3,2];case 1:return t._extent=e.sent(),[2,this._extent];case 2:return[2]}}))}))},t}()},126:function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var n=r(22);function o(t,e,r){var o=t.adapter||"IMAGE",i=e.getLayerAdapters(),a=!i||i.IMAGE,s=t.resourceId;if(s){if("IMAGE"===o){if(a)return{url:r+"/api/component/render/image",resourceId:s,headers:t.headers,updateWmsParams:function(t){return Object(n.i)(t,s)}};o="TILE"}if("WMS"===o)return{url:r+"/api/resource/"+s+"/wms",format:"image/png",version:"1.1.1",layers:t.layers,headers:t.headers};if("MVT"===o)return{url:r+"/api/component/feature_layer/mvt?x={x}&y={y}&z={z}&resource="+s+"&simplification="+(t.simplification||0)};if("TERRAIN"===o)return{url:r+"/api/resource/"+s+"/terrain_provider",adapter:o};if("MODEL_3D"===o)return{url:r+"/api/component/model_3d/"+s+"/data.glb"};if("TILE"===o)return{url:r+"/api/component/render/tile?z={z}&x={x}&y={y}&resource="+s,adapter:o}}else console.log("Option `resourceId` not set")}},165:function(t,e,r){"use strict";r.d(e,"a",(function(){return g}));var n=r(29),o=r(31),i=r(11),a=r(58),s=r(30),c=r(128),u=function(){return(u=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function l(t,e,r,n){if("number"==typeof e||"string"==typeof e)e=Number(e),t.push(u(u({},r),{resourceId:e}));else if(Array.isArray(e)){var o=e[0],i=e[1];t.push(u(u(u({},r),{resourceId:o,id:i}),n))}else"object"==typeof e&&t.push(u(u(u({},r),e),n))}var p=r(124),f=r(127),h={target:"map",baseUrl:"",whitlabel:!1,controls:["ZOOM","ATTRIBUTION"],controlsOptions:{ZOOM:{position:"top-left"},ATTRIBUTION:{position:"bottom-right",customAttribution:['<a href="https://nextgis.com" target="_blank">©NextGIS</a>']}},pixelRadius:10};var y,d=(y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),v=function(){return(v=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},b=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},m=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},w=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r},g=function(t){function e(e,r){var o=t.call(this,function(t,e){var r=[new f.QmsKit];e.connector?e.connector&&(e.baseUrl=e.connector.options.baseUrl):e.connector=new p.default({baseUrl:e.baseUrl||"",auth:e.auth});var n=Object(i.deepmerge)(h,e);return n.connector&&r.push(new s.NgwKit({connector:n.connector,auth:n.auth,identification:n.identification})),{mapAdapter:t,starterKits:r,runtimeParams:e.runtimeParams}}(e,r))||this;return o.emitter=new n.EventEmitter,o.options={},o._ngwLayers={},r.connector&&(o.connector=r.connector),o.options=Object(i.deepmerge)(h,r),o._createWebMap().then((function(){var t=o.getContainer();t&&t.classList.add("ngw-map-container"),o.options.whitlabel&&o._whiteLabel(),o._addControls()})),o}return d(e,t),e.prototype.addControl=function(e,r,n){return b(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return[4,this.onLoad("controls:create")];case 1:return o.sent(),[2,t.prototype.addControl.call(this,e,r,n)]}}))}))},e.prototype.addNgwLayer=function(t){return b(this,void 0,void 0,(function(){var e,r,n,o,a,c,u,l;return m(this,(function(p){switch(p.label){case 0:return[4,this.onMapLoad()];case 1:if(p.sent(),e=t.keyname,r=t.resourceId,n=t.resource,!e&&!r&&!n)throw new Error("resource, resourceId or keyname is required parameter to add NGW layer");if(!this.options.baseUrl&&""!==this.options.baseUrl)return[3,5];p.label=2;case 2:return p.trys.push([2,4,,5]),o=Object(s.addNgwLayer)(t,this,this.connector),[4,this.addLayer(o,v(v({visibility:!0},t),t.adapterOptions))];case 3:return a=p.sent(),c=a&&this.getLayerId(a),a&&c&&(this._ngwLayers[c]={layer:a,resourceId:a.resourceId},a.options.baselayer&&this.getActiveBaseLayer()),[2,a];case 4:return u=p.sent(),l=Object(i.isObject)(n)&&"id"in n?n.id:e||r||n,console.error("Can't add NGW layer "+l+".",u),[3,5];case 5:return[2]}}))}))},e.prototype.fit=function(){var t=this.options,e=t.center,r=t.zoom,n=t.bounds;e?(this.setCenter(e),r&&this.setZoom(r)):n&&this.fitBounds(n)},e.prototype.getNgwLayerItem=function(t){return Object(s.getNgwLayerItem)(v({connector:this.connector},t))},e.prototype.getNgwLayerItems=function(t){return Object(s.getNgwLayerItems)(v({connector:this.connector},t))},e.prototype.getNgwLayerFeature=function(t){return Object(s.getNgwLayerFeature)(v({connector:this.connector},t))},e.prototype.getNgwLayerFeatures=function(t){return Object(s.getNgwLayerFeatures)(v({connector:this.connector},t))},e.prototype.getIdentifyGeoJson=function(t,e){void 0===e&&(e=!1);var r=Object(s.getIdentifyGeoJson)({identify:t,connector:this.connector,multiple:e});return r&&"then"in r?r:o.a.resolve(r)},e.prototype.getNgwLayers=function(){return b(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,this.onLoad()];case 1:return t.sent(),[2,this._ngwLayers]}}))}))},e.prototype.getNgwLayerByResourceId=function(t){return b(this,void 0,void 0,(function(){var e,r,n,o,i,a,s,c;return m(this,(function(u){switch(u.label){case 0:for(r in e=[],this._ngwLayers)e.push(r);n=0,u.label=1;case 1:return n<e.length?(o=e[n],(i=this._ngwLayers[o]).resourceId!==t?[3,2]:[2,i&&i.layer]):[3,6];case 2:return i.layer.getIdentificationIds?[4,i.layer.getIdentificationIds()]:[3,4];case 3:if((a=u.sent())&&a.some((function(e){return e===t})))return[2,i.layer];u.label=4;case 4:if(i.layer.getDependLayers&&(s=i.layer.getDependLayers(),c=s.find((function(e){return e.item&&e.item.parentId===t}))))return[2,c.layer];u.label=5;case 5:return n++,[3,1];case 6:return[2]}}))}))},e.prototype.zoomToLayer=function(t){return b(this,void 0,void 0,(function(){var e,r,n,o,i,a=this;return m(this,(function(c){switch(c.label){case 0:return e="string"==typeof t||"number"==typeof t?String(e):t.id,(r=e&&this._ngwLayers[e])?r.layer.getExtent?[4,r.layer.getExtent()]:[3,2]:[3,6];case 1:return(n=c.sent())&&this.fitBounds(n),[3,6];case 2:return o=void 0,r.layer.item?(o=r.layer.item,[3,5]):[3,3];case 3:return i=r.resourceId,[4,this.connector.getResource(i)];case 4:o=c.sent(),c.label=5;case 5:o&&Object(s.getNgwResourceExtent)(o,this.connector).then((function(t){t&&a.fitBounds(t)})),c.label=6;case 6:return[2]}}))}))},e.prototype.onLoad=function(e){return void 0===e&&(e="ngw-map:create"),t.prototype.onLoad.call(this,e)},e.prototype.removeLayer=function(e){var r=this.getLayer(e);if(r){var n=this.getLayerId(r);n&&delete this._ngwLayers[n],t.prototype.removeLayer.call(this,r)}},e.prototype.enableSelection=function(){var t=this;this.__selectFromNgwRaster||(this.__selectFromNgwRaster=function(e){return t._selectFromNgwRaster(e)},this.__selectFromNgwVector=function(e){return t._selectFromNgwVector(e)},this.emitter.on("click",this.__selectFromNgwRaster),this.emitter.on("layer:click",this.__selectFromNgwVector))},e.prototype.disableSelection=function(){this.__selectFromNgwRaster&&(this.emitter.off("click",this.__selectFromNgwRaster),this.emitter.off("click",this._selectFromNgwVector),this.__selectFromNgwRaster=void 0,this.__selectFromNgwVector=void 0)},e.prototype._isFitFromResource=function(){var t=this._initMapState;return!t.zoom||!t.center},e.prototype._createWebMap=function(){return b(this,void 0,void 0,(function(){var t,e,r,n,o,i,a,s,c=this;return m(this,(function(u){switch(u.label){case 0:return[4,this.create(v({},this.options))];case 1:u.sent(),this.options.qmsId&&(t=void 0,e=void 0,Array.isArray(this.options.qmsId)?(t=this.options.qmsId[0],e=this.options.qmsId[1]):t=Number(this.options.qmsId),r={qmsId:t},e&&(r.id=e),this.addBaseLayer("QMS",r).then((function(t){c.showLayer(t)}))),n=[],o=this._isFitFromResource(),this.options.webmapId&&l(n,this.options.webmapId,{fit:o}),this.options.resources&&Array.isArray(this.options.resources)&&this.options.resources.forEach((function(t){var e={};o||(e.fit=!1),l(n,t,{},e)})),i=0,a=n,u.label=2;case 2:return i<a.length?(s=a[i],[4,this.addNgwLayer(s)]):[3,5];case 3:u.sent(),u.label=4;case 4:return i++,[3,2];case 5:return this._emitStatusEvent("ngw-map:create",this),this.enableSelection(),[2]}}))}))},e.prototype._addControls=function(){var t=this;this.options.controls&&this.options.controls.forEach((function(e){var r=e,n={};"string"==typeof e&&t.options.controlsOptions&&t.options.controlsOptions[e]&&void 0!==(n=t.options.controlsOptions[e]).control&&(r=n.control);var o=n.position,i=w(n,["position"]);t.addControl(r,o||"top-left",i)})),this._emitStatusEvent("controls:create")},e.prototype._selectFromNgwVector=function(t){return b(this,void 0,void 0,(function(){var e,r,n,o,i,a,s;return m(this,(function(c){return e=t.layer,r=e.item&&e.item.resource.id,n=t.feature,void 0!==r&&n&&(o=n.id)?(i={id:Number(o),fields:n.properties,label:"#"+r,layerId:Number(r),parent:"",geom:n.geometry},(s={featureCount:1})[r]={featureCount:1,features:[i]},a=s,this._emitStatusEvent("ngw:select",v(v({},a),{resources:[r],sourceType:"vector"})),[2,a]):[2]}))}))},e.prototype._selectFromNgwRaster=function(t){return b(this,void 0,void 0,(function(){var e,r,n,o,i,a,c,u,l,p,f=this;return m(this,(function(h){switch(h.label){case 0:for(r in this._emitStatusEvent("ngw:preselect"),e=[],this._ngwLayers)(n=this._ngwLayers[r].layer).getIdentificationIds&&n.options.selectable&&e.push(n.getIdentificationIds());return[4,Promise.all(e)];case 1:return o=h.sent(),i=[],o.forEach((function(t){t&&t.forEach((function(t){return i.push(t)}))})),i.length?(a=this.options.pixelRadius||10,c=this.getCenter(),u=this.getZoom(),c&&u?(l=40075016.686*Math.abs(Math.cos(180*c[1]/Math.PI))/Math.pow(2,u+8),p=a*l*5e-4,[2,Object(s.sendIdentifyRequest)(t,{layers:i,connector:this.connector,radius:p}).then((function(e){return f._emitStatusEvent("ngw:select",v(v({},e),{resources:i,sourceType:"raster",event:t})),e}))]):(this._emitStatusEvent("ngw:select",null),[2])):(this._emitStatusEvent("ngw:select",null),[2])}}))}))},e.prototype._whiteLabel=function(){return b(this,void 0,void 0,(function(){var t,e;return m(this,(function(r){switch(r.label){case 0:return(t=this.getContainer())?[4,Object(s.getCompanyLogo)(this.connector,this.options.companyLogoOptions)]:[3,2];case 1:(e=r.sent())&&t.appendChild(e),r.label=2;case 2:return[2]}}))}))},e.getIcon=c.a,e}(a.WebMap)},22:function(t,e,r){"use strict";r.d(e,"i",(function(){return l})),r.d(e,"j",(function(){return p})),r.d(e,"a",(function(){return f})),r.d(e,"f",(function(){return h})),r.d(e,"e",(function(){return d})),r.d(e,"c",(function(){return w})),r.d(e,"g",(function(){return g})),r.d(e,"d",(function(){return _})),r.d(e,"b",(function(){return O})),r.d(e,"h",(function(){return L}));var n,o=r(74),i=r(59),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),s=function(){return(s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},c=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},u=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function l(t,e){return{resource:e,extent:t.bbox,size:t.width+","+t.height,timestamp:Date.now()}}var p={POINT:"point",LINESTRING:"line",POLYGON:"polygon",MULTIPOINT:"point",MULTILINESTRING:"line",MULTIPOLYGON:"polygon",POINTZ:"point",LINESTRINGZ:"line",POLYGONZ:"polygon",MULTIPOINTZ:"point",MULTILINESTRINGZ:"line",MULTIPOLYGONZ:"polygon"};function f(t,e,r){var n=r.getAuthorizationHeaders();return n&&(t.headers=n),Object(o.b)(t,e,r)}function h(t){var e=t.extent_bottom,r=t.extent_left,n=t.extent_top,o=t.extent_right;if(e&&r&&n&&o){var i=[r,e,o,n];return i[3]>82&&(i[3]=82),i[1]<-82&&(i[1]=-82),i}}function y(t,e){return e.get("layer.extent",name,{id:t}).then((function(t){if(t){var e=t.extent,r=e.maxLat,n=e.maxLon,o=e.minLat;return[e.minLon,o,n,r]}}))}function d(t,e){return c(this,void 0,void 0,(function(){var r;return u(this,(function(n){return t.webmap?[2,h(t.webmap)]:-1!==(r=t.resource).cls.indexOf("style")?[2,e.getResource(r.parent.id).then((function(t){if(t)return y(t.resource.id,e)}))]:[2,y(r.id,e)]}))}))}var v,b=Math.PI/180,m=180/Math.PI;function w(t,e){e=e>85.06?85.06:e<-85.06?-85.06:e;var r=20037508.34*t/180,n=Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180);return[r,n=20037508.34*n/180]}function g(t,e){var r=function(t,e,r,n){void 0===r&&(r=10),void 0===n&&(n=6);for(var o=r/3963*m,i=o/Math.cos(e*b),a=[],s=0;s<n+1;s++){var c=Math.PI*(s/(n/2)),u=t+i*Math.cos(c),l=e+o*Math.sin(c);a.push([u,l])}return a}(t.latLng.lng,t.latLng.lat,e.radius),n=[];r.forEach((function(t){var e=w(t[0],t[1]),r=e[0],o=e[1];n.push(r+" "+o)}));var o={geom:"POLYGON(("+n.join(", ")+"))",srs:3857,layers:e.layers};return e.connector.post("feature_layer.identify",{data:o})}function _(t){return function(e){function r(r,n){return n=s(s({},t),n),e.call(this,r,n)||this}return a(r,e),r}(i.a)}function O(t,e){e.forEach((function(e){Object.getOwnPropertyNames(e.prototype).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e.prototype,r);n&&Object.defineProperty(t.prototype,r,n)}))}))}function L(t,e){if(void 0===e&&(e=104),e){var r=e;return function(t){return Math.log(t/256)/Math.LN2}(function(){if(void 0===v){var t=document.createElement("div");t.style.cssText="position: absolute;  left: -100%;  top: -100%;  width: 100cm;",document.body.appendChild(t);var e=t.offsetWidth;document.body.removeChild(t),v=e}return v}()*function(t){return 12756274*Math.PI*Math.cos(t*Math.PI/180)}(r)/t)}return Math.round(Math.log(591657550.5/(t/2))/Math.log(2))}},237:function(t,e,r){"use strict";r.d(e,"a",(function(){return l}));var n=r(124),o=r(22),i=r(59),a=r(74),s=function(){return(s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},c=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},u=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},l=function(){function t(t){if(this.options=t,this.options.connector)this.url=this.options.connector.options.baseUrl||"",this.connector=this.options.connector;else{if(!this.options.baseUrl)throw new Error("url is not defined");this.url=this.options.baseUrl,this.connector=new n.default({baseUrl:this.url,auth:this.options.auth})}}return t.addClassAdapters=function(t,e){a.a[t]=e},t.prototype.onLoadSync=function(t){return c(this,void 0,void 0,(function(){var e,r,n,o,a;return u(this,(function(c){switch(c.label){case 0:if(!this.options.resourceId||!this.url)return[3,4];if(!(e=[this.options.resourceId]).length)return[3,4];r=0,n=e,c.label=1;case 1:return r<n.length?(o=n[r],a={resourceId:o,connector:this.connector,webMap:t},[4,t.addLayer(i.a,s({visibility:!0,fit:!0,identification:this.options.identification,pixelRadius:this.options.pixelRadius},a))]):[3,4];case 2:return[2,c.sent()];case 3:return r++,[3,1];case 4:return[2]}}))}))},t.prototype.getLayerAdapters=function(){return Promise.resolve([this._getLayerAdapter()])},t.prototype._getLayerAdapter=function(){var t=this;return{name:"WEBMAP",createAdapter:function(e){return Promise.resolve(t._createAdapter(e))}}},t.prototype._createAdapter=function(t){var e=this.connector,r=this.url;return Object(o.d)({webMap:t,connector:e,baseUrl:r})},t}()},246:function(t,e){},247:function(t,e,r){"use strict";r.d(e,"b",(function(){return i})),r.d(e,"a",(function(){return a}));var n=r(68),o=function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function i(t,e){var r;void 0===e&&(e=!1);var n=[],o=[];for(var i in t){var a=Number(i);isNaN(a)||n.push(a)}var s=t.resources;s&&n.sort((function(t,e){return s.indexOf(t)-s.indexOf(e)}));for(var c=0;c<n.length;c++){var u=t[i=n[c]].features,l=Number(i),p=u[0];if(p&&(r={featureId:p.id,resourceId:l,feature:p},o.push(r),!e))break}return o}function a(t){var e=t.connector,r=t.identify;for(var a in r){var s=Number(a);if(!isNaN(s)){var c=r[a].features.find((function(t){return t.geom}));if(c&&c.geom){var u=c.geom;return Object(n.a)(o(o({},c),{geom:u}))}}}var l=i(r);if(l)return Object(n.b)(o({connector:e},l[0]))}},248:function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},o=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function i(t,e){var r;return n(this,void 0,void 0,(function(){var n,i,a,s,c,u,l;return o(this,(function(o){switch(o.label){case 0:return[4,t.get("pyramid.settings",{cache:!0},{component:"pyramid"})];case 1:if(!((n=o.sent())&&n.company_logo&&n.company_logo.enabled))return[3,6];(i=document.createElement("a")).style.position="absolute",i.style.bottom="0",i.style.right="0",i.style.padding=null!==(r=null==e?void 0:e.padding)&&void 0!==r?r:"10px",i.className="ngw-map-logo",e&&e.cssClass&&(i.className+=" "+e.cssClass),(a=new Image).style.maxHeight="100px",a.style.maxWidth="100px",a.src="",o.label=2;case 2:return o.trys.push([2,4,,5]),[4,t.get("pyramid.company_logo",{responseType:"blob"})];case 3:return s=o.sent(),c=window.URL||window.webkitURL,u=c.createObjectURL(s),a.src=u,[3,5];case 4:return l=o.sent(),console.log(l),[3,5];case 5:return null!==n.company_logo.link&&""!==n.company_logo.link.trim()&&(i.href=n.company_logo.link,i.target="_blank",-1!==n.company_logo.link.search(/:\/\/nextgis/)&&(a.alt="Get your own Web GIS at nextgis.com")),i.appendChild(a),[2,i];case 6:return[2]}}))}))}},249:function(t,e){},259:function(t,e,r){"use strict";var n=r(165);r.d(e,"NgwMap",(function(){return n.a}));r(58),r(249)},30:function(t,e,r){"use strict";var n=r(237);r.d(e,"NgwKit",(function(){return n.a}));var o=r(246);r.o(o,"addNgwLayer")&&r.d(e,"addNgwLayer",(function(){return o.addNgwLayer})),r.o(o,"createGeoJsonFeature")&&r.d(e,"createGeoJsonFeature",(function(){return o.createGeoJsonFeature})),r.o(o,"getCompanyLogo")&&r.d(e,"getCompanyLogo",(function(){return o.getCompanyLogo})),r.o(o,"getIdentifyGeoJson")&&r.d(e,"getIdentifyGeoJson",(function(){return o.getIdentifyGeoJson})),r.o(o,"getIdentifyItems")&&r.d(e,"getIdentifyItems",(function(){return o.getIdentifyItems})),r.o(o,"getNgwLayerFeature")&&r.d(e,"getNgwLayerFeature",(function(){return o.getNgwLayerFeature})),r.o(o,"getNgwLayerFeatures")&&r.d(e,"getNgwLayerFeatures",(function(){return o.getNgwLayerFeatures})),r.o(o,"getNgwLayerItem")&&r.d(e,"getNgwLayerItem",(function(){return o.getNgwLayerItem})),r.o(o,"getNgwLayerItems")&&r.d(e,"getNgwLayerItems",(function(){return o.getNgwLayerItems})),r.o(o,"getNgwResourceExtent")&&r.d(e,"getNgwResourceExtent",(function(){return o.getNgwResourceExtent})),r.o(o,"sendIdentifyRequest")&&r.d(e,"sendIdentifyRequest",(function(){return o.sendIdentifyRequest}));r(123),r(59),r(118);var i=r(22);r.d(e,"addNgwLayer",(function(){return i.a})),r.d(e,"getNgwResourceExtent",(function(){return i.e})),r.d(e,"sendIdentifyRequest",(function(){return i.g}));var a=r(247);r.d(e,"getIdentifyGeoJson",(function(){return a.a})),r.d(e,"getIdentifyItems",(function(){return a.b}));var s=r(248);r.d(e,"getCompanyLogo",(function(){return s.a}));var c=r(68);r.d(e,"createGeoJsonFeature",(function(){return c.a})),r.d(e,"getNgwLayerFeature",(function(){return c.b})),r.d(e,"getNgwLayerFeatures",(function(){return c.c})),r.d(e,"getNgwLayerItem",(function(){return c.d})),r.d(e,"getNgwLayerItems",(function(){return c.e}));r(46),r(122),r(93),r(91)},46:function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},o=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function i(t,e){return n(this,void 0,void 0,(function(){var r,n,a,s,c;return o(this,(function(o){switch(o.label){case 0:return r=t.resource,n=r,a=t.keyname,s=t.resourceId,r?"string"!=typeof r?[3,1]:(a=r,[3,5]):[3,5];case 1:return"number"!=typeof r?[3,2]:(s=r,[3,5]);case 2:return n.resource&&void 0!==n.resource&&"resmeta"in n?(s=r.resource.id,[3,5]):[3,3];case 3:return[4,i(r,e)];case 4:s=o.sent(),o.label=5;case 5:return s||!a?[3,7]:[4,e.getResourceByKeyname(a)];case 6:(c=o.sent())&&(s=c.resource.id),o.label=7;case 7:return[2,s]}}))}))}},59:function(t,e,r){"use strict";r.d(e,"a",(function(){return f}));var n=r(11),o=r(29),i=r(22),a=r(118),s=r(122),c=r(126),u=function(){return(u=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},l=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},p=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},f=function(){function t(t,e){this.map=t,this.options=e,this.WebMapLayerItem=a.a,this.pixelRadius=10,this.webmapClassName="webmap",this.emitter=new o.EventEmitter;var r=e.resourceId;if(Array.isArray(r)?(this.resourceId=r[0],this.options.id=r[1]):this.resourceId=r,!this.resourceId)throw new Error("NGW `resourceId` is not defined")}return t.prototype.addLayer=function(t){return l(this,void 0,void 0,(function(){var e,r,n=this;return p(this,(function(o){switch(o.label){case 0:return this.options=u(u({},this.options),t),e=this,[4,this._getWebMapLayerItem()];case 1:return e.layer=o.sent(),this.options.identification?[4,this._getWebMapIds()]:[3,3];case 2:(r=o.sent())&&(this._webmapLayersIds=r,this.$$onMapClick=function(t){return n._onMapClick(t)},this.options.webMap.emitter.on("click",this.$$onMapClick)),o.label=3;case 3:return[2,this.layer]}}))}))},t.prototype.removeLayer=function(){var t=this.options.webMap.mapAdapter;this.$$onMapClick&&this.options.webMap.emitter.off("click",this.$$onMapClick),this.getDependLayers().forEach((function(e){"layer"in e&&t.removeLayer(e.layer.layer)})),this.$$onMapClick=void 0,delete this.options,delete this.layer,delete this.response,delete this._webmapLayersIds},t.prototype.showLayer=function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!0)},t.prototype.hideLayer=function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!1)},t.prototype.getExtent=function(){var t=this.response&&this.response.webmap;if(t)return Object(i.f)(t)},t.prototype.getDependLayers=function(){return this.layer&&this.layer.tree.getDescendants()||[]},t.prototype.getIdentificationIds=function(){return l(this,void 0,void 0,(function(){var t,e;return p(this,(function(r){switch(r.label){case 0:return t=[],(e=this._webmapLayersIds)?[3,2]:[4,this._getWebMapIds()];case 1:e=r.sent(),this._webmapLayersIds=e,r.label=2;case 2:return e&&e.length&&this.getDependLayers().sort((function(t,e){return t.id-e.id})).forEach((function(e){var r=e.item,n=r.parentId;if(void 0!==n&&"layer"===r.item_type){var o=e.properties.property("visibility");o.get()&&!o.isBlocked()&&t.push(n)}})),[2,t]}}))}))},t.prototype._getWebMapLayerItem=function(){return l(this,void 0,void 0,(function(){var t,e=this;return p(this,(function(r){switch(r.label){case 0:return this.resourceId?[4,this.getWebMapConfig(this.resourceId)]:[3,2];case 1:if((t=r.sent())&&t.root_item)return[2,new Promise((function(r){var n={};if(e.options.connector&&e.options.connector.options.auth){var o=e.options.connector.getAuthorizationHeaders();o&&(n.headers=o)}n.order=e.options.order,n.crossOrigin=e.options.crossOrigin,n.drawOrderEnabled=t.draw_order_enabled;var i=new e.WebMapLayerItem(e.options.webMap,t.root_item,n,e.options.connector);i.emitter.on("init",(function(){return r(i)}))}))];r.label=2;case 2:return[2]}}))}))},t.prototype.getWebMapConfig=function(t){return l(this,void 0,void 0,(function(){var e,r;return p(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.options.connector.getResource(t)];case 1:return(e=n.sent())&&(this.response=e,r=e[this.webmapClassName],e.basemap_webmap&&this._setBasemaps(e.basemap_webmap),r)?(this._extent=[r.extent_left,r.extent_bottom,r.extent_right,r.extent_top],this._updateItemsParams(r.root_item,this.options.webMap,e),[2,r]):[3,3];case 2:throw n.sent();case 3:return[2]}}))}))},t.prototype._setBasemaps=function(t){var e=this,r=this.options.webMap;t.basemaps.forEach((function(t){Object(s.a)({webMap:r,connector:e.options.connector,item:t,adapterOptions:{crossOrigin:e.options.crossOrigin}}).then((function(e){r.addBaseLayer(e,{name:t.display_name,opacity:t.opacity,visibility:t.enabled})}))}))},t.prototype._updateItemsParams=function(t,e,r){var o=this;if(t)if("group"===t.item_type||"root"===t.item_type)t.children&&(t.children=t.children.map((function(t){return o._updateItemsParams(t,e,r)}))),"root"===t.item_type&&(t.display_name=r.resource.display_name);else if("layer"===t.item_type){var a=Object(n.fixUrlStr)(this.options.connector.options.baseUrl+"/api/component/render/image"),s=t.layer_style_id;t.url=a,t.resourceId=s,t.updateWmsParams=function(t){return Object(i.i)(t,s)};var l=t.layer_adapter.toUpperCase(),p=Object(c.a)({adapter:l,resourceId:s},e,this.options.connector.options.baseUrl||"");t=u(u({},t),p)}return t},t.prototype._getWebMapIds=function(){return l(this,void 0,void 0,(function(){var t,e,r,n=this;return p(this,(function(o){switch(o.label){case 0:return(t=this.layer)&&"root"===t.item.item_type?(e=t.tree.getDescendants(),r=[],e.forEach((function(t){var e=t.item;if("layer"===e.item_type){var o=e.layer_style_id,i=n.options.connector.getResource(o).then((function(t){if(t){var r=Number(t.resource.parent.id);return e.parentId=r,r}}));r.push(i)}})),[4,Promise.all(r)]):[3,2];case 1:return[2,o.sent().filter((function(t){return void 0!==t}))];case 2:return[2]}}))}))},t.prototype._sendIdentifyRequest=function(t){var e=this;if(this._webmapLayersIds)return Object(i.g)(t,{layers:this._webmapLayersIds,connector:this.options.connector,radius:this.pixelRadius}).then((function(r){return e.emitter.emit("identify",{ev:t,data:r}),r}))},t.prototype._onMapClick=function(t){this._sendIdentifyRequest(t)},t}()},68:function(t,e,r){"use strict";r.d(e,"a",(function(){return c})),r.d(e,"d",(function(){return u})),r.d(e,"b",(function(){return l})),r.d(e,"e",(function(){return h})),r.d(e,"c",(function(){return y}));var n=r(31),o=r(41),i=function(){return(i=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},a=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},s={srs:4326,geom_format:"geojson"};function c(t){var e=t.geom;return{id:t.id,type:"Feature",properties:t.fields,geometry:e}}function u(t){var e=i({},s);return t.connector.get("feature_layer.feature.item",null,i({id:t.resourceId,fid:t.featureId},e))}function l(t){return u(t).then((function(t){return c(t)}))}function p(t){var e=t.filterById[2],r="number"==typeof e?[e]:e.split(",").map((function(t){return Number(t)}));if("eq"!==t.filterById[1]&&"in"!==t.filterById[1])throw new Error("Unable to filter by object id. Except `eq` or `in` operator");var o=r.map((function(e){return u({connector:t.connector,resourceId:t.resourceId,featureId:e})}));return n.a.all(o)}function f(t){var e=i({},s),r=t.connector,n=t.limit,o=t.offset,a=t.fields,c=t.intersects,u=t.orderBy,l=t.resourceId,p=t.paramList;return n&&(e.limit=n),o&&(e.offset=o),a&&(e.fields=a.join()),c&&(e.intersects=c),p&&(e.paramList=p),u&&(e.order_by=u.join(",")),r.get("feature_layer.feature.collection",null,i({id:l},e))}function h(t){var e=t.filters;return e?function t(e,r,s){void 0===r&&(r=[]),void 0===s&&(s=[]);var c=e.filters,u=e.connector,l=e.resourceId,h="string"==typeof c[0]?c[0]:"all",y=c.filter((function(t){return Array.isArray(t)})),d=function(t){return["fld_"+t[0]+"__"+t[1],t[2]]};if("any"===h)y.forEach((function(n){"id"===n[0]&&r.push(p({filterById:n,connector:u,resourceId:l})),Object(o.a)(n)?r.push(f(i(i({},e),{paramList:a(s,[d(n)])}))):t(i(i({},e),{filters:n}),r,a(s))}));else if("all"===h){var v=y.find((function(t){return"id"===t[0]}));if(v)r.push(p({filterById:v,connector:u,resourceId:l}));else{var b=[],m=[];y.forEach((function(t){Object(o.a)(t)?b.push(d(t)):m.push(t)})),m.length?m.forEach((function(n){t(i(i({},e),{filters:n}),r,a(s,b))})):r.push(f(i(i({},e),{paramList:a(s,b)})))}}return n.a.all(r).then((function(t){var r=t.reduce((function(t,e){return t.concat(e)}),[]),n=void 0!==e.offset?e.offset:0,o=void 0!==e.limit?e.limit:r.length;return e.offset||e.limit?r.splice(n,o):r}))}(i(i({},t),{filters:e})):f(t).then((function(t){return e?t.filter((function(t){var r=t.fields;r&&Object(o.c)(r,e)})):t}))}function y(t){return h(t).then((function(t){var e=[];return t.forEach((function(t){e.push(c(t))})),{type:"FeatureCollection",features:e}}))}},74:function(t,e,r){"use strict";r.d(e,"a",(function(){return _})),r.d(e,"b",(function(){return I}));var n,o=r(93),i=r(91),a=r(59),s=r(46),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),u=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},l=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};var p=r(22),f=r(123),h=r(127),y=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),d=function(){return(d=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},v=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},b=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};var m=function(){return(m=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},w=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},g=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},_={},O=["mapserver_style","qgis_vector_style","qgis_raster_style","wmsserver_service","raster_style","basemap_layer","vector_layer","raster_layer","webmap","tmsclient_layer"];function L(t){var e=t.layerOptions,r=t.webMap,n=t.connector,o=t.item;return w(this,void 0,void 0,(function(){var t,i,a;return g(this,(function(s){switch(s.label){case 0:return t=o.resource.id,[4,n.get("resource.collection",null,{parent:t})];case 1:return i=s.sent(),(a=i&&i[0])?[2,I(m(m({},e),{resourceId:a.resource.id}),r,n)]:[2]}}))}))}function I(t,e,r){return w(this,void 0,void 0,(function(){var n,w,I,M,x,j,N,E,P,k,S,A;return g(this,(function(g){switch(g.label){case 0:return I=t.adapter,[4,Object(s.a)(t,r)];case 1:return(M=g.sent())?(x=t.resource)&&x.resource&&void 0!==x.resource.id?(w=x,[3,4]):[3,2]:[3,15];case 2:return[4,r.getResource(M)];case 3:w=g.sent(),g.label=4;case 4:return w?(j=w.resource.cls,N=m(m({},t),{resourceId:M}),E={layerOptions:N,webMap:e,connector:r,item:w},-1===O.indexOf(j)?[3,12]:"webmap"!==j?[3,5]:(n=function(t){var e=t.layerOptions,r=t.webMap,n=t.connector;return u(this,void 0,void 0,(function(){var t;return l(this,(function(o){switch(o.label){case 0:return[4,Object(s.a)(e,n)];case 1:return t=o.sent(),[2,function(e){function o(o){return e.call(this,o,{webMap:r,resourceId:t,connector:n})||this}return c(o,e),o}(a.a)]}}))}))}(E),[3,11])):[3,14];case 5:if("vector_layer"!==j)return[3,6];if(void 0!==I&&"GEOJSON"!==I){if("MVT"!==I)return[2,L(E)];n=Object(i.a)(E)}else n=Object(o.a)(E);return[3,11];case 6:return"raster_layer"!==j?[3,7]:[2,L(E)];case 7:return"basemap_layer"!==j?[3,8]:(n=function(t){var e=t.webMap,r=t.item;return v(this,void 0,void 0,(function(){var t,n,o,i;return b(this,(function(a){if(r.basemap_layer){if(t=r.basemap_layer.qms,n=r.basemap_layer.url,t)return(o=Promise.resolve(h.QmsKit.utils.createQmsAdapter(e))).then((function(e){if(e&&r){var n=JSON.parse(t);e.prototype.qms=n,e.prototype.baselayer=!0}})),[2,o];if(n&&(i=e.mapAdapter.layerAdapters.TILE))return[2,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.addLayer=function(e){return v(this,void 0,void 0,(function(){return b(this,(function(r){return[2,t.prototype.addLayer.call(this,d(d({},e),{url:n}))]}))}))},e}(i)]}return[2]}))}))}(E),[3,11]);case 8:return"GEOJSON"!==I?[3,10]:[4,r.getResource(w.resource.parent.id)];case 9:return(P=g.sent())&&(k=m(m({},t),{resourceId:w.resource.parent.id}),n=Object(o.a)(m(m({},E),{item:P,layerOptions:k}))),[3,11];case 10:n=Object(i.a)(E),g.label=11;case 11:return[3,13];case 12:if(!_[j])throw"Resource class '"+j+"' not yet supported.";S=_[j],A=void 0,(A=I&&"function"!=typeof A?S[I]:S)&&(n=A(E)),g.label=13;case 13:return[3,15];case 14:throw"Resource item is not found";case 15:return n?[2,n.then((function(t){if(t){var e=t;return e.prototype.item=w,e.prototype.resourceId=null==w?void 0:w.resource.id,e.prototype.connector=r,Object(p.b)(e,[f.a]),e}}))]:[2]}}))}))}},91:function(t,e,r){"use strict";r.d(e,"a",(function(){return l}));var n,o=r(126),i=r(46),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),s=function(){return(s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},c=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},u=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function l(t){var e=t.layerOptions,r=t.webMap,n=t.connector,l=t.item;return c(this,void 0,void 0,(function(){var t,p,f,h,y,d;return u(this,(function(v){switch(v.label){case 0:return t=l.resource.cls,p={wmsserver_service:"WMS",tmsclient_layer:"IMAGE"},void 0!==(f=e.adapter||t&&p[t]||"IMAGE")&&(e.adapter=f),"IMAGE"===f&&(h=r.getLayerAdapters(),!h||h.IMAGE||(f="TILE")),(y=r.mapAdapter.layerAdapters[f])?[4,Object(i.a)(e,n)]:[3,2];case 1:return d=v.sent(),[2,function(t){function i(i,a){var c=t.call(this,i,a)||this;c.map=i,c.resourceId=d;var u=Object(o.a)(e,r,n.options.baseUrl||"");if(u)if("resourceId"in u){var l=s(s({},u),{layers:String(u.resourceId),resourceId:u.resourceId});c.options=s(s({},c.options),l)}else{var p=u;c.options=s(s({},c.options),p)}return c}return a(i,t),i.prototype.addLayer=function(e){return t.prototype.addLayer.call(this,s(s({},this.options),e))},i.prototype.getIdentificationIds=function(){return c(this,void 0,void 0,(function(){var t;return u(this,(function(e){return(t=this.item&&this.item.resource.parent.id)?[2,[t]]:[2]}))}))},i}(y)];case 2:throw new Error(f+" not supported yet. Only TILE")}}))}))}},93:function(t,e,r){"use strict";r.d(e,"a",(function(){return b}));var n=r(29),o=r(58),i=r(11),a=r(68),s=r(46),c=r(22),u=r(130);var l=["fields","intersects","limit","orderBy","strategy"];function p(t){var e={};return l.forEach((function(r){var n=t[r];void 0!==n&&(e[r]=n)})),e}var f,h=(f=function(t,e){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),y=function(){return(y=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},d=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},v=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function b(t){return d(this,void 0,void 0,(function(){var e,r,l,f,b,m,w,g,_,O,L,I,M,x=this;return v(this,(function(j){switch(j.label){case 0:return e=t.webMap,r=t.connector,l=t.item,f=void 0===t.addLayerOptionsPriority||t.addLayerOptionsPriority,b=t.layerOptions,m=t.Adapter||e.mapAdapter.layerAdapters.GEOJSON,g=!1,[4,Object(s.a)(b,r)];case 1:return O=j.sent(),b.adapterOptions&&b.adapterOptions.popupOptions&&b.adapterOptions.popupOptions.fromProperties&&(b.adapterOptions.popupOptions.createPopupContent=function(t){var e=t.feature;return e&&function(t,e){var r=Object(u.a)("div");if(e)e.feature_layer&&e.feature_layer.fields.forEach((function(e){if(e.grid_visibility){var n=t.properties&&t.properties[e.keyname];if(n)Object(u.a)("div",null,r).innerHTML="<span>"+e.display_name+"</span>: "+n+"<span></span>"}}));else if(t.properties)for(var n in t.properties){Object(u.a)("div",null,r).innerHTML="<span>"+n+"</span>: "+t.properties[n]+"<span></span>"}return r}(e,l)}),L=function(t,e){return d(x,void 0,void 0,(function(){return v(this,(function(n){switch(n.label){case 0:return M(),_={filters:t,options:e},[4,w=Object(a.c)(y(y({resourceId:O,filters:t,connector:r},e),{limit:void 0!==(null==e?void 0:e.limit)?e.limit:3e3}))];case 1:return[2,n.sent()]}}))}))},I=!1,M=function(){w&&(w.cancel(),w=void 0)},[2,function(t){function a(){var e=null!==t&&t.apply(this,arguments)||this;return e.emitter=new n.EventEmitter,e}return h(a,t),a.prototype.addLayer=function(e){return d(this,void 0,void 0,(function(){var r,n,o;return v(this,(function(i){switch(i.label){case 0:return r=!e.data,void 0!==b.id&&(e.id=b.id),l&&l.vector_layer&&(e.type=c.j[l.vector_layer.geometry_type]),b.adapterOptions&&(e=f?y(y({},b.adapterOptions),e):y(y({},e),b.adapterOptions)),e.data&&0===Object.keys(e.data).length&&(e.data=void 0,r=!1),n=t.prototype.addLayer.call(this,e),this.options.strategy=e.strategy||void 0,_={filters:e.propertiesFilter,options:p(e)},r&&(o=this.updateLayer()),e.waitFullLoad&&o?[4,o]:[3,2];case 1:i.sent(),i.label=2;case 2:return"BBOX"===this.options.strategy&&this._addBboxEventListener(),[2,n]}}))}))},a.prototype.beforeRemove=function(){I=!0,this._removeMoveEventListener(),this._removeBboxEventListener(),this.__disableMapMoveListener=void 0,this.__enableMapMoveListener=void 0,this.__onMapMove=void 0,this.__onMapMoveStart=void 0,M()},a.prototype.getCount=function(){var t=this;return void 0!==this._count?this._count:r.get("feature_layer.feature.count",null,{id:O}).then((function(e){e&&(t._count=e.total_count)}))},a.prototype.updateLayer=function(r){return d(this,void 0,void 0,(function(){var n,o;return v(this,(function(i){switch(i.label){case 0:return r=r||_||{},"BBOX"!==this.options.strategy?[3,2]:[4,e.onLoad()];case 1:i.sent(),r.options=r.options||{},r.options.intersects=this._getMapBbox(),i.label=2;case 2:if(I)return[2];i.label=3;case 3:return i.trys.push([3,5,,6]),[4,L(r.filters,r.options)];case 4:return n=i.sent(),e.setLayerData(this,n),this.emitter.emit("updated"),[3,6];case 5:if("CancelError"!==(o=i.sent()).name)throw o;return[3,6];case 6:return t.prototype.updateLayer&&t.prototype.updateLayer.call(this),[2]}}))}))},a.prototype.propertiesFilter=function(t,e){return d(this,void 0,void 0,(function(){var r;return v(this,(function(n){switch(n.label){case 0:return M(),this.filter&&g?(this.filter((function(e){return!e.feature||!e.feature.properties||o.WebMap.utils.propertiesFilter(e.feature.properties,t)})),[3,3]):[3,1];case 1:return this.setData?(this.clearLayer&&this.clearLayer(),[4,L(t,e)]):[3,3];case 2:r=n.sent(),this.setData(r),n.label=3;case 3:return[2]}}))}))},a.prototype.removeFilter=function(){_=void 0,this.propertiesFilter([]),this.filter&&this.filter((function(){return!0}))},a.prototype._addBboxEventListener=function(){var t=this;this.__enableMapMoveListener=function(e){e===t&&(t._removeMoveEventListener(),t.updateLayer(),t._addMoveEventListener())},this.__disableMapMoveListener=function(e){e===t&&t._removeMoveEventListener()},e.emitter.on("layer:show",this.__enableMapMoveListener),e.emitter.on("layer:hide",this.__disableMapMoveListener),this.__enableMapMoveListener(this)},a.prototype._removeBboxEventListener=function(){this.__enableMapMoveListener&&e.emitter.on("layer:show",this.__enableMapMoveListener),this.__disableMapMoveListener&&e.emitter.on("layer:hide",this.__disableMapMoveListener)},a.prototype._addMoveEventListener=function(){var t=this;this.__onMapMove=Object(i.debounce)((function(){return t.updateLayer()})),this.__onMapMoveStart=M,e.emitter.on("movestart",this.__onMapMoveStart),e.emitter.on("moveend",this.__onMapMove)},a.prototype._removeMoveEventListener=function(){this.__onMapMove&&e.emitter.off("moveend",this.__onMapMove),this.__onMapMoveStart&&e.emitter.off("movestart",this.__onMapMoveStart)},a.prototype._getMapBbox=function(){var t=e.getBounds();if(t){var r=t[0],n=t[1],o=t[2],i=t[3];return"POLYGON(("+[[r,n],[o,n],[o,i],[r,i],[r,n]].map((function(t){var e=t[0],r=t[1],n=Object(c.c)(e,r);return n[0]+" "+n[1]})).join(", ")+"))"}},a}(m)]}}))}))}}}]);