(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{224:function(e,t,n){},583:function(e,t,n){},585:function(e,t,n){},588:function(e,t,n){},590:function(e,t,n){},591:function(e,t,n){},592:function(e,t,n){},593:function(e,t,n){},594:function(e,t){document.addEventListener("DOMContentLoaded",(function(){var e=Array.prototype.slice.call(document.querySelectorAll(".navbar-burger"),0);e.length>0&&e.forEach((function(e){e.addEventListener("click",(function(){var t=e.dataset.target,n=document.getElementById(t);e.classList.toggle("is-active"),n&&n.classList.toggle("is-active")}))}))}))},596:function(e,t,n){"use strict";n.r(t);n(224),n(225),n(580),n(581),n(582),n(583);var r=n(214),o=n.n(r),a=n(215),i=n.n(a),s=n(112),c=n(21),u=n(116),l=n(222),p=n(218),h=(n(585),n(30)),d=n(223),f=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},m=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},g=function(){function e(e){this._storageKey="auth",this._storage=localStorage,this.connector=new h.default({baseUrl:e.baseUrl,auth:e.auth});var t=this._storage.getItem(this._storageKey);t&&(this.auth=JSON.parse(t))}return e.prototype.login=function(e){return f(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return this._errorMessage="",e?[3,2]:[4,this.getAuth()];case 1:e=r.sent(),r.label=2;case 2:return r.trys.push([2,4,,7]),[4,this.connector.login(e)];case 3:if(r.sent(),!(t=this.connector.user))throw new Error;if("guest"===t.keyname)throw new Error;return[3,7];case 4:return r.sent(),this._errorMessage="Не удаётся войти",[4,this._showLoginDialog(e)];case 5:return n=r.sent(),[4,this.login(n)];case 6:return r.sent(),[3,7];case 7:return this.connector&&this._storage.setItem(this._storageKey,JSON.stringify(e)),[2]}}))}))},e.prototype.logout=function(){this.connector.logout(),this._storage.setItem(this._storageKey,""),this._errorMessage=""},e.prototype.getAuth=function(){return f(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,this._showLoginDialog(this.auth)];case 1:return[2,e.sent()]}}))}))},e.prototype._showLoginDialog=function(e){var t=this;return new Promise((function(n,r){var o=new d.a,a=t._createDialogHtml(e,(function(e){o.close(),n(e)}),(function(e){o.close(),r(e)}));o.updateContent(a),o.show()}))},e.prototype._createDialogHtml=function(e,t,n){void 0===e&&(e={login:"",password:""});var r=e.login,o=e.password,a=document.createElement("div");a.className="dialog--form login";var i='\n      <div><label><div>Имя пользователя:</div>\n        <input value="'+r+'" class="input dialog--input name"></input>\n      </label></div>\n      <div><label><div>Пароль:</div>\n        <input value="'+o+'" type="password" class="input dialog--input password"></input>\n      </label></div>\n      <div class="dialog-error"></div>\n      <button class="button dialog--button accept">Войти</button>\n      <button class="button dialog--button cancel">Отмена</button>\n    ';a.innerHTML=i;var s=a.getElementsByClassName("name")[0],c=a.getElementsByClassName("password")[0];if(this._errorMessage){var u=a.getElementsByClassName("dialog-error")[0];u.className="dialog-error",u.innerHTML='<div class="dialog-error--message">'+this._errorMessage+"</div>"}var l=a.getElementsByClassName("accept")[0],p=a.getElementsByClassName("cancel")[0],h=function(){return{login:s.value,password:c.value}},d=function(){var e=h();l.disabled=!(e.login&&e.password)},f=function(){d()},m=function(){[s,c].forEach((function(e){["change","input"].forEach((function(t){return e.removeEventListener(t,f)}))}))};return l.onclick=function(){m(),t(h())},p.onclick=function(){m(),n("Login cancel")},d(),[s,c].forEach((function(e){["change","input"].forEach((function(t){return e.addEventListener(t,f)}))})),a},e}(),v=n(220),y=n.n(v);function w(e){return"string"==typeof e&&(t=e,new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(t))?'<a href="'+e+'" target="_blank">'+e+"</a>":e;var t}var b=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},_=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},C=function(){function e(e){this.ngwMap=e,this._resourceItems={}}return e.prototype.setNgwMap=function(e){this.ngwMap=e},e.prototype.createPopupContent=function(e){var t=document.createElement("div"),n=document.createElement("div");n.className="properties";var r=Object.keys(e.properties).map((function(t){return{key:t,value:e.properties[t]}}));return n.innerHTML=this.createPropertiesHtml(r),t.appendChild(n),t},e.prototype.createPropertiesHtml=function(e){var t="";return e.forEach((function(e){var n=e.key,r=e.value;"object"==typeof r&&r&&("year"in r?r=[r.day,r.month,r.year].join("."):"hour"in r&&(r=[r.hour,r.minute].join(":"))),t+='\n      <div class="columns">\n        <div class="column is-two-fifths">'+n+'</div>\n        <div class="column">'+w(r)+"</div>\n      </div>\n      "})),t},e.prototype.updateElementContent=function(e,t,n){return b(this,void 0,void 0,(function(){var r,o,a,i;return _(this,(function(s){switch(s.label){case 0:return[4,this._getResourceItem(t)];case 1:return(r=s.sent()).feature_layer&&(o=[],r.feature_layer.fields.forEach((function(e){if(e.grid_visibility){var t=n.properties[e.keyname];t&&o.push({key:e.display_name,value:t})}})),a=this.createPropertiesHtml(o),(i=e.getElementsByClassName("properties")[0])&&(i.innerHTML=a)),[2]}}))}))},e.prototype._addPhotos=function(e,t,n,r){return b(this,void 0,void 0,(function(){var o,a,i,s,c,u,l;return _(this,(function(p){switch(p.label){case 0:(o=document.createElement("div")).className="carousel attachment",a=0,i=t,p.label=1;case 1:return a<i.length?(s=i[a],300,300,(c=document.createElement("figure")).className="image is-300x300",[4,this._loadImage(s,{width:300,height:300,id:n,fid:r})]):[3,4];case 2:u=p.sent(),(l=document.createElement("img")).src=u,c.appendChild(l),o.appendChild(c),p.label=3;case 3:return a++,[3,1];case 4:return e.appendChild(o),y.a.attach(o),[2]}}))}))},e.prototype._getResourceItem=function(e){return b(this,void 0,void 0,(function(){var t;return _(this,(function(n){switch(n.label){case 0:return this._resourceItems[e]?[3,2]:[4,this.ngwMap.connector.get("resource.item",null,{id:e})];case 1:t=n.sent(),this._resourceItems[e]=t,n.label=2;case 2:return[2,this._resourceItems[e]]}}))}))},e.prototype._loadImage=function(e,t){var n=this;return new Promise((function(r,o){var a=t.width,i=t.height,s="/api/resource/"+t.id+"/feature/"+t.fid+"/attachment/"+e.id+"/image"+(a&&i?"?size="+a+"x"+i:"");n.ngwMap.connector.makeQuery(s,{},{responseType:"blob"}).then((function(e){var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){r(t.result)}})).catch((function(e){o(e)}))}))},e}(),M=(n(588),n(221)),E=n.n(M),k=(n(589),n(590),function(){function e(e){this.options=e,this._container=document.createElement("div"),this.status=void 0===this.options.open||this.options.open,this._updateContainer(),this.options.parent&&this.options.parent.appendChild(this.getContainer())}return e.prototype.getContainer=function(){return this._container},e.prototype.open=function(){this._content.innerHTML||this._updateContent(),this._toggle&&(this._toggle.innerHTML=this._getToggleButtonHtml("fas fa-chevron-up")),this.status=!0},e.prototype.close=function(){this._cleanContent(),this._toggle&&(this._toggle.innerHTML=this._getToggleButtonHtml("fas fa-chevron-down")),this.status=!1},e.prototype.toggle=function(){this.status?this.close():this.open()},e.prototype._getToggleButtonHtml=function(e){return'\n    <a class="button is-small">\n    <span class="icon is-small">\n      <i class="'+e+'"></i>\n    </span>\n    </a>\n    '},e.prototype._updateContainer=function(){if(this._container.innerHTML="",this.options.title){var e=this._createHeader();this._container.appendChild(e)}var t=document.createElement("div");t.className="panel-content",this._content=t,this._container.appendChild(t),this.status?this.open():this.close()},e.prototype._createHeader=function(){var e=this,t=document.createElement("div");t.className="level is-mobile panel-header";var n=document.createElement("div");n.className="level-left";var r=document.createElement("div");r.className="level-item panel-header__title",r.innerHTML=this.options.title,n.appendChild(r);var o=document.createElement("div");o.className="level-right";var a=document.createElement("div");return a.className="level-item panel-header__toggle",o.appendChild(a),a.onclick=function(){e.toggle()},this._toggle=a,t.appendChild(n),t.appendChild(o),t},e.prototype._cleanContent=function(){this._content.innerHTML=""},e.prototype._updateContent=function(){this._cleanContent();var e="function"==typeof this.options.content?this.options.content():this.options.content;return this._content.appendChild(e),this._content},e}()),L=n(23),N=function(){function e(e){var t=this._createTreeItem(e);t&&(this._container=t)}return e.prototype.getContainer=function(){return this._container},e.prototype._createTreeBranch=function(e){var t=this,n=document.createElement("div");return n.className="tree-container__item-children",e.reverse().forEach((function(e){if(e.item){var r=t._createTreeItem(e);r&&n.appendChild(r)}})),n},e.prototype._createTreeItem=function(e){var t=e.item;if(!t)return!1;var n=document.createElement("div");if(n.className="tree-container__item",t.display_name){var r=document.createElement("input");r.setAttribute("type","checkbox");var o="layer"!==t.item_type||t.layer_enabled;r.checked=o;var a=e.properties.property("visibility");a&&(a.emitter.on("change",(function(e){r.checked=e.value})),r.onclick=function(){a.set(r.checked,{propagation:L.default.keys.pressed("ctrl")})});var i=document.createElement("span");i.innerHTML=t.display_name,n.appendChild(r),n.appendChild(i)}if("group"===t.item_type||"root"===t.item_type&&t.children.length){var s=e.tree.getChildren(),c=this._createTreeBranch(s.reverse());n.appendChild(c)}return n},e}(),T=(n(591),function(){function e(e){this.options=e,this._select=[["24","24 часа"],["48","48 часов"],["72","72 часа"],["168","неделя"]],this.ngwMap=e.ngwMap,this._container=this._createContainer()}return e.prototype.getContainer=function(){return this._container},e.prototype._createContainer=function(){var e=this,t=document.createElement("div");t.className="fires-contentainer panel-content-padding ";var n=this._createSelector();t.appendChild(n);var r=document.createElement("div");return r.className="fires-contentainer__layers",this.options.fires.forEach((function(t){e._createFireItem(t,r)})),t.appendChild(r),t},e.prototype._createFireItem=function(e,t){var n=this,r=document.createElement("div");r.className="tree-container__item";var o=this.ngwMap.getLayer(e.id).item,a=document.createElement("input");a.setAttribute("type","checkbox"),a.checked=!0,a.onclick=function(){n.ngwMap.toggleLayer(e.id,a.checked)};var i=document.createElement("span"),s=o.resource.display_name.split("__")[0];i.innerHTML=s.replace("fires","").trim();var c=this._createSymbol(e);r.appendChild(a),r.appendChild(c),r.appendChild(i),t.appendChild(r)},e.prototype._createSymbol=function(e){var t=document.createElement("span");return t.className="item-symbol",t.style.color=e.color,t.style.borderColor=e.color,t.style.backgroundColor=e.color,t},e.prototype._createSelector=function(){var e=this,t=document.createElement("div"),n=document.createElement("label");n.appendChild(document.createTextNode("Просмотр термоточек: "));var r=document.createElement("select");return this._select.forEach((function(e){var t=document.createElement("option");t.value=e[0],t.text=e[1],r.appendChild(t)})),r.onchange=function(){e.options.fires.forEach((function(t){e.ngwMap.getLayer(t.id).propertiesFilter([["timestamp","ge",Math.floor(Date.now()/1e3)-3600*Number(r.value)]])}))},n.appendChild(r),t.appendChild(n),t},e}()),B=(n(592),function(){function e(e){var t=this;this.options=e,this.ngwMap=e.ngwMap,this._container=this._createContainer(),this.ngwMap.emitter.on("layer:add",(function(e){t.ngwMap.isBaseLayer(e)&&t._updateBaseMapContainer()}))}return e.prototype.getContainer=function(){return this._container},e.prototype._createContainer=function(){var e=document.createElement("div");e.className="basemaps-contentainer panel-content-padding control";var t=document.createElement("div");return t.className="basemaps-contentainer__layers",this._baseMapsContainer=t,e.appendChild(t),this._updateBaseMapContainer(),e},e.prototype._updateBaseMapContainer=function(){var e=this;this._baseMapsContainer.innerHTML="",this._createBaseMapItem(),this.ngwMap.getBaseLayers().forEach((function(t){var n=e.ngwMap.getLayer(t);n&&e._createBaseMapItem(n)}))},e.prototype._createBaseMapItem=function(e){var t=this,n=document.createElement("div");n.className="control";var r=document.createElement("label");r.className="radio basemap-container__item";var o=document.createElement("input");o.setAttribute("type","radio"),o.setAttribute("name","basemap"),o.checked=this.ngwMap.isLayerVisible(e),o.onclick=function(){e?t.ngwMap.toggleLayer(e.id,o.checked):t.ngwMap.hideLayer(t.ngwMap.getActiveBaseLayer())};var a=e&&(e.name||e.options.name)||"Blank",i=document.createTextNode(a);r.appendChild(o),r.appendChild(i),n.appendChild(r),this._baseMapsContainer.appendChild(n)},e}()),x=(n(593),n(7)),I=function(){function e(e){this.options=e,this.ngwMap=e.ngwMap,this._container=this._createContainer()}return e.prototype.getContainer=function(){return this._container},e.prototype._createContainer=function(){var e=this,t=document.createElement("div");t.className="bookmarks-contentainer panel-content-padding ";var n=document.createElement("div");return n.className="bookmarks-contentainer__layers",this.options.bookmarks.forEach((function(n){e.ngwMap.connector.get("resource.item",null,{id:n.id}).then((function(r){var o=r.feature_layer.fields.find((function(e){return e.label_field}));e.ngwMap.getNgwLayerItems({resourceId:n.id}).then((function(n){n.forEach((function(n){var r=e._createBookmarkItem(n,o.keyname);t.appendChild(r)}))}))}))})),t.appendChild(n),t},e.prototype._createBookmarkItem=function(e,t){var n=this;void 0===t&&(t="name");var r=document.createElement("div");r.className="tree-container__item bookmark";var o=document.createElement("div");return o.innerHTML=e.fields[t],o.onclick=function(){var t=new x.GeoJSON(e.geom);n.ngwMap.mapAdapter.map.fitBounds(t.getBounds())},r.appendChild(o),r},e}(),O=function(){return(O=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},H={target:"tree"},P=function(){function e(e,t){if(this.actionMap=e,this.options=O(O({},H),t),"string"==typeof this.options.target){var n=document.getElementById(this.options.target);if(!n)throw new Error("No element with ID #"+this.options.target+" in document for webmap tree");this._target=n}else this.options.target instanceof HTMLElement&&(this._target=this.options.target);this.sidebar=new E.a(this._target,{closeButton:!1,position:"left",autoPan:!1}),this.sidebar.addTo(this.actionMap.ngwMap.mapAdapter.map),this.ngwLayers=this.options.ngwLayers,this._container=this._createContainer(),this.options.status||this.hide(),this._target.appendChild(this._container)}return e.prototype.show=function(){this._container.classList.remove("hidden"),this.sidebar.show()},e.prototype.hide=function(){this.sidebar.hide(),this._container.classList.add("hidden")},e.prototype._createContainer=function(){var e=this,t=document.createElement("div");return t.className="tree-container",void 0!==this.options.width&&(t.style.width=this.options.width+"px"),this.options.fires&&new k({title:"Термоточки (FIRMS)",content:function(){return e._createFiresContainer()},parent:t}),new k({title:"Базовые слои",content:function(){return e._createNgwLayers()},open:!1,parent:t}),new k({title:"Подложки",content:function(){return e._createBasemapsContainer()},open:!1,parent:t}),new k({title:"Закладки",content:function(){return e._createBookmarksContainer()},open:!1,parent:t}),t},e.prototype._createNgwLayers=function(){var e=document.createElement("div");for(var t in e.className="webmap-tree-container",this.ngwLayers){var n=this.ngwLayers[t],r=new N(n.layer.layer).getContainer();r&&e.appendChild(r)}return e},e.prototype._createBookmarksContainer=function(){var e=document.createElement("div"),t=this.options.bookmarks;if(t){var n=new I({bookmarks:t,ngwMap:this.options.ngwMap});e.appendChild(n.getContainer())}return e},e.prototype._createFiresContainer=function(){var e=document.createElement("div"),t=this.options.fires;if(t){var n=new T({fires:t,ngwMap:this.options.ngwMap});e.appendChild(n.getContainer())}return e},e.prototype._createBasemapsContainer=function(){var e=document.createElement("div");if(this.options.fires){var t=new B({ngwMap:this.options.ngwMap});e.appendChild(t.getContainer())}return e},e}(),S=function(){return(S=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},j=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},F=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},A=function(){function e(e){this.options=e,this._promises={},this.popup=new C(this.ngwMap)}return e.prototype.create=function(e,t,n){return j(this,void 0,void 0,(function(){var r,o,a,i,c=this;return F(this,(function(h){switch(h.label){case 0:r=new g(e),o=S({},e),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,r.login()];case 2:return h.sent(),o.connector=r.connector,[3,4];case 3:return h.sent(),[3,4];case 4:return this.ngwMap=new s.default(new l.a,S({controls:[],minZoom:4,runtimeParams:[new p.default]},o)),this.ngwMap.setCursor("default"),this.popup.setNgwMap(this.ngwMap),n&&this.ngwMap.onLoad().then((function(){return n.forEach((function(e,t){c.ngwMap.addBaseLayer("QMS",S(S({},e),{visibility:0===t}))}))})),this.ngwMap.getPaintFunctions={base:u.a},this.ngwMap.addControl("ZOOM","top-left"),this._createLocateControl(),this.ngwMap.addControl("ATTRIBUTION","bottom-right"),this._createShareControl(),[4,this._createAuthControl(r)];case 5:return h.sent(),[4,this.ngwMap.getNgwLayers()];case 6:return a=h.sent(),i=[],Object.values(a).forEach((function(e){var t=e.layer.item&&e.layer.item.webmap&&e.layer.item.webmap.bookmark_resource;t&&i.push(t)})),[4,this._addFires(t)];case 7:return h.sent(),this._addTreeControl({ngwLayers:a,fires:t,bookmarks:i}),this.ngwMap.addControl(this._crateMeasureControl(),"top-left"),this._addEventsListeners(),[2]}}))}))},e.prototype._locate=function(){var e=this;this.ngwMap.locate({setView:!1},{locationfound:function(t){var n=t.lngLat,r=e.ngwMap.getBounds();if(r){var o=r[0],a=r[1],i=r[2],s=r[3],c=n[0],u=n[1];o<c&&c<i&&(a<u&&u<s)&&e.ngwMap.setCenter(n)}}})},e.prototype._createAuthControl=function(e){return j(this,void 0,void 0,(function(){var t,n,r,o=this;return F(this,(function(a){return t=document.getElementsByClassName("js-auth-btn")[0],n=function(){return!(!o.ngwMap.connector||!o.ngwMap.connector.user)},r=function(){e.logout(),window.location.reload()},t.innerHTML=n()?"Выйти":"Войти",t.style.display="block",t.addEventListener("click",r),[2]}))}))},e.prototype._createShareControl=function(){var e=this,t=document.getElementsByClassName("js-modal")[0],n=document.getElementsByClassName("js-modal-close")[0],r=document.getElementsByClassName("js-share-modal-content")[0],a=document.getElementsByClassName("js-share-input")[0];n.addEventListener("click",(function(){r.innerHTML="",t.classList.remove("is-active")}));var i=this.ngwMap.createButtonControl({html:'<i class="fas fa-share-alt btn-control-icon "></i>',onClick:function(){var n,i;n=location.href,i=e._createShareModalContent(n),a.value=n,r.innerHTML=i,o.a.update(),t.classList.add("is-active")}});this.ngwMap.addControl(i,"bottom-right")},e.prototype._createLocateControl=function(){var e=this,t=this.ngwMap.createButtonControl({html:'<i class="fas fa-location-arrow btn-control-icon "></i>',title:"Найти меня на карте",onClick:function(){return e._locate()}});this.ngwMap.addControl(t,"top-left")},e.prototype._createShareModalContent=function(e){return'<div class="buttons share-btn js-share-btn" data-url="'+e+'" data-title="" data-desc="">\n      '+[{id:"tw",name:"Twitter",icon:"fab fa-twitter"},{id:"vk",name:"VK",icon:"fab fa-vk"},{id:"fb",name:"Facebook",icon:"fab fa-facebook-square"}].map((function(e){return'<a class="button is-primary" data-id="'+e.id+'">\n                    <span class="icon">\n                        <i class="'+e.icon+'"></i>\n                    </span>\n                    <span>'+e.name+"</span>\n                </a>"})).join("")+"\n    </div>"},e.prototype._addFires=function(e){return j(this,void 0,void 0,(function(){var t,n,r,o=this;return F(this,(function(a){switch(a.label){case 0:if(!e)return[3,4];t=0,n=e,a.label=1;case 1:return t<n.length?(r=n[t],[4,this.ngwMap.addNgwLayer({resourceId:r.resourceId,id:r.id,adapterOptions:{propertiesFilter:[["timestamp","ge",Math.floor(Date.now()/1e3)-3600*Number(this.options.timedelta)]],paint:{stroke:!0,color:r.color,fillOpacity:.6,radius:5},selectable:!0,selectedPaint:{stroke:!0,color:r.color,fillOpacity:.9,radius:7},selectOnHover:!0,popupOnSelect:!0,popupOptions:{createPopupContent:function(e){if(e.feature){var t=e.feature;return o.popup.createPopupContent(t)}}}}})]):[3,4];case 2:a.sent(),a.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},e.prototype._addTreeControl=function(e){return j(this,void 0,void 0,(function(){var t,n,r,o=this;return F(this,(function(a){switch(a.label){case 0:return t=document.getElementsByClassName("js-sidebar")[0],n=function(){return t.classList.contains("is-active")},[4,this.ngwMap.onLoad()];case 1:return a.sent(),this.tree=new P(this,S(S({},e),{ngwMap:this.ngwMap})),r=function(){n()?o.tree.show():o.tree.hide()},t.addEventListener("click",(function(){r()})),setTimeout((function(){r()}),500),[2]}}))}))},e.prototype._clean=function(){this._promises.getFeaturePromise&&this._promises.getFeaturePromise.cancel&&this._promises.getFeaturePromise.cancel(),this.ngwMap.removeLayer("highlight")},e.prototype._highlighNgwLayer=function(e){var t=this;this._clean();var n=c.default.utils.getIdentifyGeoJsonParams(e)[0];if(n){var r=n.resourceId;this._promises.getFeaturePromise=this.ngwMap.connector.get("feature_layer.feature.item",null,{id:n.resourceId,fid:n.featureId,geom_format:"geojson",srs:4326}).then((function(e){delete t._promises.getFeaturePromise;var o=c.default.utils.createGeoJsonFeature(e);t.ngwMap.addLayer("GEOJSON",{id:"highlight",data:o,visibility:!0,paint:{color:"green",stroke:!0,fillOpacity:"0.8"},selectOnHover:!0,popup:!0,popupOptions:{createPopupContent:function(o){if(o.feature){var a=t.popup.createPopupContent(o.feature);return t.popup.updateElementContent(a,r,o.feature),e.extensions&&e.extensions.attachment&&e.extensions.attachment.length&&t.popup._addPhotos(a,e.extensions.attachment,n.resourceId,n.featureId),a}}}})}))}},e.prototype._addEventsListeners=function(){var e=this;this.ngwMap.emitter.on("ngw:select",(function(t){return e._highlighNgwLayer(t)}));var t=[this.treeControl];[].forEach((function(e,n){e&&e.emitter.on("status",(function(e){e&&t.forEach((function(e,t){e&&n!==t&&e.onClick(!1)}))}))}))},e.prototype._crateMeasureControl=function(){var e=this,t=new i.a({showBearings:!0,bearingTextIn:"In",bearingTextOut:"Out",tooltipTextFinish:"Кликните чтобы <b>завершить изменрение</b><br>",tooltipTextDelete:"SHIFT + клик чтобы <b>удалить точку</b>",tooltipTextMove:"Клик + тянуть чтобы <b>передвинуть точку</b><br>",tooltipTextResume:"<br>CTRL + клик чтобы <b>продолжить линию</b>",tooltipTextAdd:"CTRL + клик чтобы <b>добавить точку</b>",measureControlTitleOn:"Перейти в режим измерения",measureControlTitleOff:"Выйти из режима измерений",measureControlLabel:'<i class="fas fa-ruler-combined btn-control-icon"></i>',measureControlClasses:[],unitControlLabel:{metres:"м",kilometres:"км"}});return this.ngwMap.mapAdapter.map.on("polylinemeasure:toggle",(function(t){t.sttus?e.ngwMap.disableSelection():(e.ngwMap.enableSelection(),e.ngwMap.setCursor("default"))})),t},e}(),D=(n(594),function(){return(D=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)}),R=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},z=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},G=function(){function e(e){this.options=e,this.actionMap=new A(this.options)}return e.prototype.create=function(e){return R(this,void 0,void 0,(function(){return z(this,(function(t){return this.options=D(D({},this.options),e),this.actionMap.create(this.options.mapOptions,this.options.fires,this.options.basemaps),[2]}))}))},e}(),J={};try{J=n(595)}catch(e){console.warn("Config file is not funded, run with default settings")}new G(s.default.utils.deepmerge({mapOptions:{target:"map",bounds:[36.59,43.385,49.374,50.214]},timedelta:24},J)).create()}},[[597,3,4,7,8,5,9,6,2,1]]]);